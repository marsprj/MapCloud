$().ready(function(){cookieObj=new MapCloud.Cookie;var e=cookieObj.getCookie("username");if(user=null,null!=e&&(user=new GeoBeans.User(e)),null!=user){var a="/ows/admin/mgr";authManager=new GeoBeans.AuthManager(a),MapCloud.notify=new MapCloud.Notify("container","alert_loading"),MapCloud.userPanel=new MapCloud.UserPanel("user_panel")}});
MapCloud.UserPanel=MapCloud.Class({panel:null,initialize:function(n){this.panel=$("#"+n),null!=user&&this.getUserInfo(user.name),this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find(".use-info-btn").click(function(){n.showUserInfoPanel()}),this.panel.find(".user-password-btn").click(function(){n.showUserPasswordPanel()}),this.panel.find(".btn-change-password").click(function(){n.changePassword()}),n.showUserInfoPanel()},showUserInfoPanel:function(){this.panel.find("#user_paswd_panel").css("display","none"),this.panel.find("#user_info_panel").css("display","block")},showUserPasswordPanel:function(){this.panel.find("#user_info_panel").css("display","none"),this.panel.find("#user_paswd_panel").css("display","block")},getUserInfo:function(n){authManager.getUser(n,this.getUserInfo_callback)},getUserInfo_callback:function(n){if(!(n instanceof Object))return void console.log(n);var s=MapCloud.userPanel;s.showUserInfo(n)},showUserInfo:function(n){var s=n.name,e=n.alias,a=n.email,i=n.role;this.panel.find(".user-info-name").val(s),this.panel.find(".user-info-alias").val(e),this.panel.find(".user-info-email").val(a),this.panel.find(".user-info-role").val(i),this.panel.find(".user-passwd-name").val(s)},changePassword:function(){var n=(this.panel.find(".user-passwd-name").val(),this.panel.find(".user-passwd").val());if(""==n)return MapCloud.notify.showInfo("请输入密码","Warning"),void this.panel.find(".user-passwd").focus();var s=this.panel.find(".user-repasswd").val();return""==s?(MapCloud.notify.showInfo("请再次输入密码","Warning"),void this.panel.find(".user-repasswd").focus()):n!=s?void MapCloud.notify.showInfo("两次输入的密码不一致","Warning"):void 0}});