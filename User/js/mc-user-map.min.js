$().ready(function(){function a(a){s(a),i(a),n(a)}function s(a){if($.isArray(a)){for(var s="",i=null,l=null,n=0;n<a.length;++n)i=a[n],null!=i&&(l=i.name,s+='<div class="row" mname="'+l+'">	<div class="col-md-1">		<i class="map-icon list-icon"></i>	</div>	<div class="col-md-9 map-tree-name">'+l+"	</div></div>");$(".map-tree").html(s),$(".map-tree .row").click(function(){var a=$(this).attr("mname");e(a)})}}function i(s){if($.isArray(s)){for(var i="",n=null,t=null,o=null,m=null,d="",p=null,r=0;r<s.length;++r)n=s[r],null!=n&&(t=n.name,o=n.extent,m=n.srid,p=n.thumbnail,null!=o&&(d=o.xmin.toFixed(2)+" , "+o.ymin.toFixed(2)+" , "+o.xmax.toFixed(2)+" , "+o.ymax.toFixed(2)),i+='<div class="row map-row" mname="'+t+'">	<div class="col-md-1 col-order">'+(r+1)+'	</div>	<div class="col-md-3">'+t+'	</div>	<div class="col-md-2">'+m+'	</div>	<div class="col-md-4">'+d+'	</div>	<div class="col-md-2">		<a href="javascript:void(0)" class="oper enter-map">进入</a>		<a href="javascript:void(0)" class="oper remove-map">删除</a>	</div></div><div class="row info-row" mname="'+t+'">	<div class="col-md-1 col-order">	</div>	<div class="col-md-3 thumb-div" style="background-image:url('+p+')">	</div>	<div class="col-md-4">		<div class="row info-row-item">			<div class="col-md-3">名称:</div>			<div class="col-md-5">'+t+'</div>		</div>		<div class="row info-row-item">			<div class="col-md-3">空间参考:</div>			<div class="col-md-5">'+m+"</div>		</div>	</div></div>");$(".map-list").html(i),$(".enter-map").click(function(){var a=$(this).parents(".row").first().attr("mname");null!=a&&e(a)}),$(".remove-map").click(function(){var s=$(this).parents(".row").first().attr("mname");if(null!=s&&confirm("确定删除地图["+s+"]?")){MapCloud.notify.loading();var i=c.removeMap(s),l="删除地图 [ "+s+" ]";MapCloud.notify.showInfo(i,l),"success"==i&&c.getMaps(a)}}),$(".map-list .map-row").click(function(){var a=$(this).next();if("block"==a.css("display"))a.slideUp(),$(this).removeClass("selected"),a.removeClass("selected");else{var s=$(this).attr("mname");c.getMapObj(s,l)}})}}function l(a){if(null!=a){var s=a.name,i=a.thumbnail,l=a.srid,n=a.layers,e=a.extent,t="";null!=e&&(t+='<div class="row info-row-item">	<span class="col-md-3">空间范围 :</span>	<span class="col-md-5">东 : '+e.xmax+'</span></div><div class="row info-row-item">	<span class="col-md-3"></span>	<span class="col-md-5">南 : '+e.ymin+'</span></div><div class="row info-row-item">	<span class="col-md-3"></span>	<span class="col-md-5">西 : '+e.xmin+'</span></div><div class="row info-row-item">	<span class="col-md-3"></span>	<span class="col-md-5">北 : '+e.ymax+"</span></div>");var o='	<div class="col-md-1 col-order">	</div>	<div class="col-md-3 thumb-div" style="background-image:url('+i+')">	</div>	<div class="col-md-4">		<div class="row info-row-item">			<div class="col-md-3">名称:</div>			<div class="col-md-5">'+s+'</div>		</div>		<div class="row info-row-item">			<div class="col-md-3">空间参考:</div>			<div class="col-md-5">'+l+'</div>		</div>		<div class="row info-row-item">			<div class="col-md-3">图层个数:</div>			<div class="col-md-5">'+n.length+"</div>		</div>"+t+"	</div>";$(".info-row[mname='"+s+"']").html(o),$(".info-row[mname='"+s+"']").slideDown(),$(".map-row[mname='"+s+"']").addClass("selected"),$(".map-row[mname='"+s+"']").next().addClass("selected")}}function n(a){if($.isArray(a)){for(var s="<ul id='maps_thumb_ul'>",i=null,l=null,n=null,t=0;t<a.length;++t)i=a[t],null!=i&&(l=i.name,n=i.thumbnail,s+='<li class="map-thumb" mname="'+l+'">	<a href="javascript:void(0)" class="map-thumb-a" style="background-image:url('+n+')"></a><div class="caption text-center">	<h6>'+l+"</h6></div></li>");$("#map_thumb_list").html(s),$("#map_thumb_list a").dblclick(function(){var a=$(this).parent().attr("mname");null!=a&&e(a)})}}function e(a){null!=a&&($(".right-panel-tab").css("display","none"),$("#map_tab").css("display","block"),$("#map_info_tab").css("display","block"),$("#show_map_view").attr("disabled",!1),$("#show_map_info").attr("disabled",!0),$(".service-extent").remove(),$(".map-tree .row").removeClass("selected"),$(".map-tree .row[mname='"+a+"']").addClass("selected"),$(".current-map").html(a),$(".map-info-name").empty(),$(".map-info-srid").empty(),$(".map-info-layers").empty(),$(".thumb-big-div").css("background-image",""),t(a))}function t(a){c.getMapObj(a,o)}function o(a){if(null!=a){var s=a.name,i=a.srid;$("#map_info_tab .map-info-name").html(s),$("#map_info_tab .map-info-srid").html(i);var l=a.extent;if(null!=l){var n="";n+='<div class="map-info-row service-extent">	<span class="map-info-item">空间范围 :</span>	<span class="map-info-extent">东 : '+l.xmax+'</span></div><div class="map-info-row service-extent">	<span class="map-info-item"></span>	<span class="map-info-extent">南 : '+l.ymin+'</span></div><div class="map-info-row service-extent">	<span class="map-info-item"></span>	<span class="map-info-extent">西 : '+l.xmin+'</span></div><div class="map-info-row service-extent">	<span class="map-info-item"></span>	<span class="map-info-extent">北 : '+l.ymax+"</span></div>",$(".map-info-srid").parent().after(n)}$(".thumb-big-div").css("background-image","url("+a.thumbnail+")"),$("#map_info_tab .map-info-layers").empty();for(var e=a.layers,t=null,s=null,l=null,o=null,m="",d=0;d<e.length;++d)if(t=e[d],null!=t){s=t.name,o=t.geomType,m+='<div class="map-info-row">	<span class="map-info-layer-name">'+s+'</span>	<span class="map-info-item">类型：</span>';var c="";if(null!=o?c=o:"raster"==t.type&&(c="Raster"),m+='	<span class="map-info-name">'+c+"</span>",l=t.extent,null!=l){var p=l.xmin.toFixed(2)+" , "+l.ymin.toFixed(2)+" , "+l.xmax.toFixed(2)+" , "+l.ymax.toFixed(2);m+='	<span class="map-info-item">范围：</span>	<span class="map-info-extent">'+p+"</span>"}m+="</div>"}$("#map_info_tab .map-info-layers").append(m)}}function m(a){if(null!=a){var s=c.getMap("map_view_tab",a);null==s||s.draw()}}MapCloud.notify=new MapCloud.Notify("container","alert_loading"),$(".map-tree").empty(),$(".map-list").empty(),$("#show-map-list").click(function(){$("#show-map-thumb").attr("disabled",!1),$(this).attr("disabled",!0),$(".right-panel-content-tab").css("display","none"),$("#map_list_tab").css("display","block")}),$("#show-map-thumb").click(function(){$("#show-map-list").attr("disabled",!1),$(this).attr("disabled",!0),$(".right-panel-content-tab").css("display","none"),$("#map_thumb_list").css("display","block")}),$("#show_map_info").click(function(){$("#show_map_view").attr("disabled",!1),$(this).attr("disabled",!0),$("#map_tab .right-panel-content-tab").css("display","none"),$("#map_tab #map_info_tab").css("display","block")}),$("#show_map_view").click(function(){$("#show_map_info").attr("disabled",!1),$(this).attr("disabled",!0),$("#map_tab .right-panel-content-tab").css("display","none"),$("#map_tab #map_view_tab").css("display","block");var a=$(".map-tree .row.selected").attr("mname");m(a)}),$(".return-map-list").click(function(){var s=user.getMapManager();s.getMaps(a),$(".right-panel-tab").css("display","none"),$("#maps_tab").css("display","block"),"disabled"==$("#show-map-thumb").attr("disabled")?($("#map_thumb_list").css("display","block"),$("#map_list_tab").css("display","none")):"disabled"==$("#show-map-list").attr("disabled")&&($("#map_list_tab").css("display","block"),$("#map_thumb_list").css("display","none"))}),cookieObj=new MapCloud.Cookie;var d=cookieObj.getCookie("username");if(user=null,null!=d&&(user=new GeoBeans.User(d)),null!=user){var c=user.getMapManager();c.getMaps(a)}});