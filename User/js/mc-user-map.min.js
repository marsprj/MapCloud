$().ready(function(){function a(a){t(a),i(a),l(a)}function t(a){if($.isArray(a)){for(var t="",i=null,l=null,n=0;n<a.length;++n)i=a[n],null!=i&&(l=i.name,t+='<div class="row" mname="'+l+'">	<div class="col-md-1">		<i class="map-icon list-icon"></i>	</div>	<div class="col-md-9 map-tree-name">'+l+"	</div></div>");$(".map-tree").html(t),$(".map-tree .row").click(function(){var a=$(this).attr("mname");s(a)})}}function i(t){if($.isArray(t)){for(var i="",l=null,n=null,e=null,m=null,o="",r=0;r<t.length;++r)l=t[r],null!=l&&(n=l.name,e=l.extent,m=l.srid,null!=e&&(o=e.xmin.toFixed(2)+" , "+e.ymin.toFixed(2)+" , "+e.xmax.toFixed(2)+" , "+e.ymax.toFixed(2)),i+='<div class="row" mname="'+n+'">	<div class="col-md-1">'+(r+1)+'	</div>	<div class="col-md-3">'+n+'	</div>	<div class="col-md-2">'+m+'	</div>	<div class="col-md-4">'+o+'	</div>	<div class="col-md-2">		<a href="javascript:void(0)" class="oper enter-map">进入</a>		<a href="javascript:void(0)" class="oper remove-map">删除</a>	</div></div>');$(".map-list").html(i),$(".enter-map").click(function(){var a=$(this).parents(".row").first().attr("mname");null!=a&&s(a)}),$(".remove-map").click(function(){var t=$(this).parents(".row").first().attr("mname");if(null!=t&&confirm("确定删除地图["+t+"]?")){MapCloud.notify.loading();var i=p.removeMap(t),l="删除地图 [ "+t+" ]";MapCloud.notify.showInfo(i,l),"success"==i&&p.getMaps(a)}})}}function l(a){if($.isArray(a)){for(var t="<ul id='maps_thumb_ul'>",i=null,l=null,n=null,e=0;e<a.length;++e)i=a[e],null!=i&&(l=i.name,n=i.thumbnail,t+='<li class="map-thumb" mname="'+l+'">	<a href="javascript:void(0)" class="map-thumb-a" style="background-image:url('+n+')"></a><div class="caption text-center">	<h6>'+l+"</h6></div></li>");$("#map_thumb_list").html(t),$("#map_thumb_list a").dblclick(function(){var a=$(this).parent().attr("mname");null!=a&&s(a)})}}function s(a){null!=a&&($(".right-panel-tab").css("display","none"),$("#map_tab").css("display","block"),$("#map_info_tab").css("display","block"),$("#show_map_view").attr("disabled",!1),$("#show_map_info").attr("disabled",!0),$(".map-tree .row").removeClass("selected"),$(".map-tree .row[mname='"+a+"']").addClass("selected"),$(".current-map").html(a),n(a))}function n(a){p.getMapObj(a,e)}function e(a){if(null!=a){var t=a.name,i=a.srid;$("#map_info_tab .map-info-name").html(t),$("#map_info_tab .map-info-srid").html(i);var l=a.extent;if(null!=l){var s=l.xmin.toFixed(2)+" , "+l.ymin.toFixed(2)+" , "+l.xmax.toFixed(2)+" , "+l.ymax.toFixed(2);$("#map_info_tab .map-info-extent").html(s)}$("#map_info_tab .map-info-layers").empty();for(var n=a.layers,e=null,t=null,l=null,m=null,o="",p=0;p<n.length;++p)if(e=n[p],null!=e){if(t=e.name,m=e.geomType,o+='<div class="map-info-row">	<span class="map-info-layer-name">'+t+'</span>	<span class="map-info-item">类型：</span>',null!=m?o+='	<span class="map-info-name">'+m+"</span>":"raster"==e.type&&(o+='	<span class="map-info-name">Raster</span>'),l=e.extent,null!=l){var s=l.xmin.toFixed(2)+" , "+l.ymin.toFixed(2)+" , "+l.xmax.toFixed(2)+" , "+l.ymax.toFixed(2);o+='	<span class="map-info-item">范围：</span>	<span class="map-info-extent">'+s+"</span>"}o+="</div>"}$("#map_info_tab .map-info-layers").append(o)}}function m(a){if(null!=a){var t=p.getMap("map_view_tab",a);null==t||t.draw()}}MapCloud.notify=new MapCloud.Notify("container","alert_loading"),$(".map-tree").empty(),$(".map-list").empty(),$("#show-map-list").click(function(){$("#show-map-thumb").attr("disabled",!1),$(this).attr("disabled",!0),$(".right-panel-content-tab").css("display","none"),$("#map_list_tab").css("display","block")}),$("#show-map-thumb").click(function(){$("#show-map-list").attr("disabled",!1),$(this).attr("disabled",!0),$(".right-panel-content-tab").css("display","none"),$("#map_thumb_list").css("display","block")}),$("#show_map_info").click(function(){$("#show_map_view").attr("disabled",!1),$(this).attr("disabled",!0),$("#map_tab .right-panel-content-tab").css("display","none"),$("#map_tab #map_info_tab").css("display","block")}),$("#show_map_view").click(function(){$("#show_map_info").attr("disabled",!1),$(this).attr("disabled",!0),$("#map_tab .right-panel-content-tab").css("display","none"),$("#map_tab #map_view_tab").css("display","block");var a=$(".map-tree .row.selected").attr("mname");m(a)}),$(".return-map-list").click(function(){$(".right-panel-tab").css("display","none"),$("#maps_tab").css("display","block"),"disabled"==$("#show-map-thumb").attr("disabled")?($("#map_thumb_list").css("display","block"),$("#map_list_tab").css("display","none")):"disabled"==$("#show-map-list").attr("disabled")&&($("#map_list_tab").css("display","block"),$("#map_thumb_list").css("display","none"))}),cookieObj=new MapCloud.Cookie;var o=cookieObj.getCookie("username");if(user=null,null!=o&&(user=new GeoBeans.User(o)),null!=user){var p=user.getMapManager();p.getMaps(a)}});