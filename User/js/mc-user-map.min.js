$().ready(function(){function a(a){s(a),l(a),n(a)}function s(a){if($.isArray(a)){for(var s="",l=null,i=null,n=0;n<a.length;++n)l=a[n],null!=l&&(i=l.name,s+='<div class="row" mname="'+i+'">	<div class="col-md-1 col-xs-1">		<i class="map-icon list-icon"></i>	</div>	<div class="col-md-9 col-xs-9 map-tree-name">'+i+"	</div></div>");$(".map-tree").html(s),$(".map-tree .row").click(function(){var a=$(this).attr("mname");e(a)})}}function l(s){if($.isArray(s)){for(var l="",n=null,o=null,t=null,c=null,m="",p=null,r=0;r<s.length;++r)n=s[r],null!=n&&(o=n.name,t=n.extent,c=n.srid,p=n.thumbnail,null!=t&&(m=t.xmin.toFixed(2)+" , "+t.ymin.toFixed(2)+" , "+t.xmax.toFixed(2)+" , "+t.ymax.toFixed(2)),l+='<div class="row map-row" mname="'+o+'">	<div class="col-md-1  col-xs-1 col-order">'+(r+1)+'	</div>	<div class="col-md-3 col-xs-3">'+o+'	</div>	<div class="col-md-2 col-xs-2">'+c+'	</div>	<div class="col-md-4 col-xs-4">'+m+'	</div>	<div class="col-md-2 col-xs-2">		<a href="javascript:void(0)" class="oper enter-map">进入</a>		<a href="javascript:void(0)" class="oper remove-map">删除</a>	</div></div><div class="row info-row" mname="'+o+'">	<div class="col-md-1 col-xs-1 col-order">	</div>	<div class="col-md-3 col-xs-3 thumb-div" style="background-image:url('+p+')">	</div>	<div class="col-md-4 col-xs-4">		<div class="row info-row-item">			<div class="col-md-3 col-xs-3">名称:</div>			<div class="col-md-5 col-xs-5">'+o+'</div>		</div>		<div class="row info-row-item">			<div class="col-md-3 col-xs-3">空间参考:</div>			<div class="col-md-5 col-xs-5">'+c+"</div>		</div>	</div></div>");$(".map-list").html(l),$(".enter-map").click(function(){var a=$(this).parents(".row").first().attr("mname");null!=a&&e(a)}),$(".remove-map").click(function(){var s=$(this).parents(".row").first().attr("mname");if(null!=s&&confirm("确定删除地图["+s+"]?")){MapCloud.notify.loading();var l=d.removeMap(s),i="删除地图 [ "+s+" ]";MapCloud.notify.showInfo(l,i),"success"==l&&d.getMaps(a)}}),$(".map-list .map-row").click(function(){var a=$(this).next();if("block"==a.css("display"))a.slideUp(),$(this).removeClass("selected"),a.removeClass("selected");else{var s=$(this).attr("mname");d.getMapObj(s,i)}})}}function i(a){if(null!=a){var s=a.name,l=a.thumbnail,i=a.srid,n=a.layers,e=a.extent,o="";null!=e&&(o+='<div class="row info-row-item">	<span class="col-md-3 col-xs-3">空间范围 :</span>	<span class="col-md-5 col-xs-5">东 : '+e.xmax+'</span></div><div class="row info-row-item">	<span class="col-md-3 col-xs-3"></span>	<span class="col-md-5 col-xs-5">南 : '+e.ymin+'</span></div><div class="row info-row-item">	<span class="col-md-3 col-xs-3"></span>	<span class="col-md-5 col-xs-5">西 : '+e.xmin+'</span></div><div class="row info-row-item">	<span class="col-md-3 col-xs-3"></span>	<span class="col-md-5 col-xs-5">北 : '+e.ymax+"</span></div>");var t='	<div class="col-md-1 col-xs-1 col-order">	</div>	<div class="col-md-3 col-xs-3 thumb-div" style="background-image:url('+l+')">	</div>	<div class="col-md-4 col-xs-4">		<div class="row info-row-item">			<div class="col-md-3 col-xs-3">名称:</div>			<div class="col-md-5 col-xs-5">'+s+'</div>		</div>		<div class="row info-row-item">			<div class="col-md-3 col-xs-3">空间参考:</div>			<div class="col-md-5 col-xs-5">'+i+'</div>		</div>		<div class="row info-row-item">			<div class="col-md-3 col-xs-3">图层个数:</div>			<div class="col-md-5 col-xs-5">'+n.length+"</div>		</div>"+o+"	</div>";$(".info-row[mname='"+s+"']").html(t),$(".info-row[mname='"+s+"']").slideDown(),$(".map-row[mname='"+s+"']").addClass("selected"),$(".map-row[mname='"+s+"']").next().addClass("selected")}}function n(a){if($.isArray(a)){for(var s="<ul id='maps_thumb_ul'>",l=null,i=null,n=null,o=0;o<a.length;++o)l=a[o],null!=l&&(i=l.name,n=l.thumbnail,s+='<li class="map-thumb" mname="'+i+'">	<a href="javascript:void(0)" class="map-thumb-a" style="background-image:url('+n+')"></a><div class="caption text-center">	<h6>'+i+"</h6></div></li>");$("#map_thumb_list").html(s),$("#map_thumb_list a").dblclick(function(){var a=$(this).parent().attr("mname");null!=a&&e(a)})}}function e(a){null!=a&&($(".right-panel-tab").css("display","none"),$("#map_tab").css("display","block"),$("#map_info_tab").css("display","block"),$("#show_map_view").attr("disabled",!1),$("#show_map_info").attr("disabled",!0),$(".service-extent").remove(),$(".map-tree .row").removeClass("selected"),$(".map-tree .row[mname='"+a+"']").addClass("selected"),$(".current-map").html(a),$(".map-info-name").empty(),$(".map-info-srid").empty(),$(".map-info-layers").empty(),$(".thumb-big-div").css("background-image",""),o(a))}function o(a){d.getMapObj(a,t)}function t(a){if(null!=a){var s=a.name,l=a.srid;$("#map_info_tab .map-info-name").html(s),$("#map_info_tab .map-info-srid").html(l);var i=a.extent;if(null!=i){var n="";n+='<div class="map-info-row service-extent">	<span class="map-info-item">空间范围 :</span>	<span class="map-info-extent">东 : '+i.xmax+'</span></div><div class="map-info-row service-extent">	<span class="map-info-item"></span>	<span class="map-info-extent">南 : '+i.ymin+'</span></div><div class="map-info-row service-extent">	<span class="map-info-item"></span>	<span class="map-info-extent">西 : '+i.xmin+'</span></div><div class="map-info-row service-extent">	<span class="map-info-item"></span>	<span class="map-info-extent">北 : '+i.ymax+"</span></div>",$(".map-info-srid").parent().after(n)}$(".thumb-big-div").css("background-image","url("+a.thumbnail+")"),$("#map_info_tab .map-info-layers").empty();for(var e=a.layers,o=null,s=null,i=null,t=null,c="",m=0;m<e.length;++m)if(o=e[m],null!=o){s=o.name,t=o.geomType,c+='<div class="map-info-row">	<span class="map-info-layer-name">'+s+"</span>";var d="";if(null!=t?d=t:"raster"==o.type&&(d="Raster"),c+='	<span class="map-info-name">'+d+"</span>",i=o.extent,null!=i){var p=i.xmin.toFixed(2)+" , "+i.ymin.toFixed(2)+" , "+i.xmax.toFixed(2)+" , "+i.ymax.toFixed(2);c+='	<span class="map-info-extent">'+p+'</span><span class="map-info-layer-name pull-right">	<input type="checkbox" name="my-checkbox" data-size="mini" data-on-color="info" disabled></span><span class="map-info-layer-name pull-right">	<input type="checkbox" name="my-checkbox" checked data-size="mini" data-on-color="info"></span>'}c+="</div>"}$("#map_info_tab .map-info-layers").append(c),$("[name='my-checkbox']").bootstrapSwitch()}}function c(a){null!=a&&(null!=mapObj&&(mapObj.close(),mapObj=null),mapObj=d.getMap("map_view_tab",a),null==mapObj||mapObj.draw())}MapCloud.notify=new MapCloud.Notify("container","alert_loading"),$(".map-tree").empty(),$(".map-list").empty(),$("#show-map-list").click(function(){$("#show-map-thumb").attr("disabled",!1),$(this).attr("disabled",!0),$(".right-panel-content-tab").css("display","none"),$("#map_list_tab").css("display","block")}),$("#show-map-thumb").click(function(){$("#show-map-list").attr("disabled",!1),$(this).attr("disabled",!0),$(".right-panel-content-tab").css("display","none"),$("#map_thumb_list").css("display","block")}),$("#show_map_info").click(function(){$("#show_map_view").attr("disabled",!1),$(this).attr("disabled",!0),$("#map_tab .right-panel-content-tab").css("display","none"),$("#map_tab #map_info_tab").css("display","block")}),$("#show_map_view").click(function(){$("#show_map_info").attr("disabled",!1),$(this).attr("disabled",!0),$("#map_tab .right-panel-content-tab").css("display","none"),$("#map_tab #map_view_tab").css("display","block");var a=$(".map-tree .row.selected").attr("mname");c(a)}),$(".return-map-list").click(function(){var s=user.getMapManager();s.getMaps(a),$(".right-panel-tab").css("display","none"),$("#maps_tab").css("display","block"),"disabled"==$("#show-map-thumb").attr("disabled")?($("#map_thumb_list").css("display","block"),$("#map_list_tab").css("display","none")):"disabled"==$("#show-map-list").attr("disabled")&&($("#map_list_tab").css("display","block"),$("#map_thumb_list").css("display","none"))}),cookieObj=new MapCloud.Cookie;var m=cookieObj.getCookie("username");if(user=null,null!=m&&(user=new GeoBeans.User(m)),null!=user){mapObj=null;var d=user.getMapManager();d.getMaps(a)}});