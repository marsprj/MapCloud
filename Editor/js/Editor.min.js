MapCloud.alert_info=null,MapCloud.create_map_dlg=null,MapCloud.new_layer_dialog=null,MapCloud.wms_dialog=null,MapCloud.wfs_datasource_dialog=null,MapCloud.wmts_dialog=null,MapCloud.edit_layer_dialog=null,MapCloud.layer_appearance_dialog=null,MapCloud.create_layer_dialog=null,MapCloud.file_dialog=null,MapCloud.data_source_dialog=null,MapCloud.db_admin_dialog=null,MapCloud.database_dlg=null,MapCloud.pgis_connection_dialog=null,MapCloud.new_chart_dialog=null,MapCloud.styleManager_dialog=null,MapCloud.style_dialog=null,MapCloud.styleName_dialog=null,MapCloud.heatMap_dialog=null,MapCloud.importVector_dialog=null,MapCloud.refresh_panel=null,MapCloud.overlay_panel=null,MapCloud.dataGrid=null,MapCloud.mapBar=null,MapCloud.wms_layer=null,MapCloud.getLayerGeomType=function(l){if(null==l)return null;var e=l.featureType;if(null==e){if(e=l.workspace.getFeatureType(this.layer.typeName),null==e)return null;this.layer.featureType=e}var a=e.fields;if(null==a&&(a=l.featureType.getFields(),null==a))return null;var n=e.geomFieldName;if(null==n)return null;var u=e.getFieldIndex(n);if(-1>u||u>=a.length)return null;var o=a[u];if(null==o)return null;var r=o.geomType;return r},MapCloud.rgb2hex=function(l){if("#"==l.charAt(0))return l;var e=l.split(/\D+/),a=65536*Number(e[1])+256*Number(e[2])+Number(e[3]);return"#"+MapCloud.zero_fill_hex(a,6)},MapCloud.zero_fill_hex=function(l,e){for(var a=l.toString(16);a.length<e;)a="0"+a;return a},MapCloud.rgb2rgba=function(l,e){var a="",n=l.indexOf("("),u=l.lastIndexOf(")"),o=l.slice(n+1,u);return a="rgba("+o+","+e+")"},MapCloud.rgba2rgb=function(l){var e=l.indexOf("("),a=l.lastIndexOf(","),n=l.slice(e+1,a),u="rgb("+n+")";return u},MapCloud.rgba2Opacity=function(l){var e=l.lastIndexOf(","),a=l.lastIndexOf(")"),n=l.slice(e+1,a);return n},MapCloud.getLayerGeomTypeHtml=function(l){var e="";switch(l){case GeoBeans.Geometry.Type.POINT:case GeoBeans.Geometry.Type.MULTIPOINT:e='<span class="glyphicon glyphicon-map-marker glyphicon-geom-type"></span>';break;case GeoBeans.Geometry.Type.LINESTRING:case GeoBeans.Geometry.Type.MULTILINESTRING:e='<span class="glyphicon glyphicon-align-justify glyphicon-geom-type"></span>';break;case GeoBeans.Geometry.Type.POLYGON:case GeoBeans.Geometry.Type.MULTIPOLYGON:e='<span class="glyphicon glyphicon-unchecked  glyphicon-geom-type"></span>';break;default:e='<span class="glyphicon glyphicon-unchecked  glyphicon-geom-type"></span>'}return e};
var mapObj=null,ribbonObj=null,mapManager=null,dbsManager=null,fileManager=null,styleManager=null,gpsManager=null,rasterDBManager=null,tileDBManger=null,poiManager=null,subManager=null,serviceManager=null,authServer="/ows/admin/mgr",authManager=new GeoBeans.AuthManager(authServer);$().ready(function(){MapCloud.account=new MapCloud.Account("login-panel","register-panel"),MapCloud.notify=new MapCloud.Notify("container","alert_loading"),MapCloud.create_map_dlg=new MapCloud.CreateMapDialog("createMapDialog"),MapCloud.wms_dialog=new MapCloud.WMSDialog("wmsDialog"),MapCloud.wfs_datasource_dialog=new MapCloud.WFSDatasourceDialog("wfsDatasourceDialog"),MapCloud.wmts_dialog=new MapCloud.WMTSDialog("wmtsDialog"),MapCloud.vector_db_dialog=new MapCloud.VectorDBDialog("vector_db_dialog"),MapCloud.pgis_connection_dialog=new MapCloud.PGISConnectDialog("pgisConnDialog"),MapCloud.new_layer_dialog=new MapCloud.NewLayerDialog("newLayerDialog"),MapCloud.new_raster_dblayer_dialog=new MapCloud.NewRasterDBLayerDialog("new_raster_dblayer_dialog"),MapCloud.style_dialog=new MapCloud.StyleDialog("style-dialog"),MapCloud.styleName_dialog=new MapCloud.StyleNameDialog("style-name-dialog"),MapCloud.file_dialog=new MapCloud.FileDialog("fileDialog"),MapCloud.import_dialog=new MapCloud.ImportDialog("import_dialog"),MapCloud.styleManager_dialog=new MapCloud.StyleManagerDialog("style-mgr-dialog"),MapCloud.heatMap_dialog=new MapCloud.HeatMapDialog("heatMapDialog"),MapCloud.importVector_dialog=new MapCloud.ImportVectorDialog("importVectorDialog"),MapCloud.importCSV_dialog=new MapCloud.ImportCSVDialog("import_csv_dialog"),MapCloud.features_dialog=new MapCloud.FeaturesDialog("featuresDialog"),MapCloud.aqi_24h_dialog=new MapCloud.AQI24hDialog("aqi24hDialog"),MapCloud.aqi_stat_comp_dialog=new MapCloud.AQIStatCompDialog("aqiStatCompDialog","aqi_station_comp_panel"),MapCloud.create_folder_dialog=new MapCloud.CreateFolderDialog("create_folder_dialog"),MapCloud.raster_db_dialog=new MapCloud.RasterDBDialog("raster_db_dialog"),MapCloud.import_raster_dialog=new MapCloud.ImportRasterDialog("import_raster_dialog"),MapCloud.gps_output_source_dialog=new MapCloud.GPSOutputSourceDialog("gps_output_source_dialog"),MapCloud.gps_kmean_dialog=new MapCloud.GPSKMeanDialog("gps_kmean_dialog"),MapCloud.gps_feature_project_dialog=new MapCloud.GPSFeatureProjectDialog("gps_feature_project_dialog"),MapCloud.gps_raster_edge_detect_dialog=new MapCloud.GPSRasterEdgeDetectDialog("gps_raster_edge_detect_dialog"),MapCloud.gps_raster_stretch_dialog=new MapCloud.GPSRasterStretchDialog("gps_raster_stretch_dialog"),MapCloud.gps_raster_sepia_tone_dialog=new MapCloud.GPSRasterSepiaToneDialog("gps_raster_sepia_tone_dialog"),MapCloud.gps_feature_import_dialog=new MapCloud.GPSFeatureImportDialog("gps_feature_import_dialog"),MapCloud.gps_csv_import_dialog=new MapCloud.GPSCsvImportDialog("gps_csv_import_dialog"),MapCloud.gps_raster_extract_dialog=new MapCloud.GPSRasterExtractDialog("gps_raster_extract_dialog"),MapCloud.gps_raster_reverse_dialog=new MapCloud.GPSRasterReverseDialog("gps_raster_reverse_dialog"),MapCloud.gps_raster_graylize_dialog=new MapCloud.GPSRasterGraylizeDialog("gps_raster_graylize_dialog"),MapCloud.gps_raster_smooth_dialog=new MapCloud.GPSRasterSmoothDialog("gps_raster_smooth_dialog"),MapCloud.gps_raster_subtract_dialog=new MapCloud.GPSRasterSubtractDialog("gps_raster_subtract_dialog"),MapCloud.gps_raster_pixel_blend_dialog=new MapCloud.GPSRasterPixelBlendDialog("gps_raster_pixel_blend_dialog"),MapCloud.gps_raster_threshold_dialog=new MapCloud.GPSRasterThresholdDialog("gps_raster_threshold_dialog"),MapCloud.gps_raster_his_equal_dialog=new MapCloud.GPSRasterHisEquaDialog("gps_raster_his_equal_dialog"),MapCloud.gps_dem_slope_dialog=new MapCloud.GPSDemSlopeDialog("gps_dem_slope_dialog"),MapCloud.gps_dem_aspect_dialog=new MapCloud.GPSDemAspectDialog("gps_dem_aspect_dialog"),MapCloud.gps_dem_stretch_dialog=new MapCloud.GPSDemStretchDialog("gps_dem_stretch_dialog"),MapCloud.gps_dem_hillshade_dialog=new MapCloud.GPSDemHillshadeDialog("gps_dem_hillshade_dialog"),MapCloud.gps_delaunay_dialog=new MapCloud.GPSDelaunayDialog("gps_delaunay_dialog"),MapCloud.gps_get_area_dialog=new MapCloud.GPSGetAreaDialog("gps_get_area_dialog"),MapCloud.gps_get_length_dialog=new MapCloud.GPSGetLengthDialog("gps_get_length_dialog"),MapCloud.gps_centroid_dialog=new MapCloud.GPSCentroidDialog("gps_centroid_dialog"),MapCloud.gps_convex_hull_dialog=new MapCloud.GPSConvexHullDialog("gps_convex_hull_dialog"),MapCloud.gps_multi_point_to_points_dialog=new MapCloud.GPSMultiPointToPointsDialog("gps_multi_point_to_points_dialog"),MapCloud.gps_line_to_points_dialog=new MapCloud.GPSLineToPointsDialog("gps_line_to_points_dialog"),MapCloud.gps_polygon_to_points_dialog=new MapCloud.GPSPolygonToPointsDialog("gps_polygon_to_points_dialog"),MapCloud.gps_polygon_to_line_dialog=new MapCloud.GPSPolygonToLineDialog("gps_polygon_to_line_dialog"),MapCloud.gps_gen_random_points_dialog=new MapCloud.GPSGenRandomPointsDialog("gps_gen_random_points_dialog"),MapCloud.gps_gen_random_points_in_polygon_dialog=new MapCloud.GenRandomPointsInPolygonDialog("gps_gen_random_points_in_polygon_dialog"),MapCloud.gps_buffer_dialog=new MapCloud.GPSBufferDialog("gps_buffer_dialog"),MapCloud.gps_build_pyramid_dialog=new MapCloud.GPSBuildPyramidDialog("gps_build_pyramid_dialog"),MapCloud.gps_update_tile_dialog=new MapCloud.GPSUpdateTileDialog("gps_update_tile_dialog"),MapCloud.gps_srid_dialog=new MapCloud.GPSSridDialog("gps_srid_dialog"),MapCloud.cut_map_dialog=new MapCloud.CutMapDialog("cut_map_dialog"),MapCloud.tile_db_dialog=new MapCloud.TileDBDialog("tile_db_dialog"),MapCloud.create_tile_store_dialog=new MapCloud.CreateTileStoreDialog("create_tile_store_dialog"),MapCloud.process_dialog=new MapCloud.ProcessDialog("process_dialog"),MapCloud.version_dialog=new MapCloud.VersionDialog("version_dialog"),MapCloud.refresh_panel=new MapCloud.refresh("left_panel"),MapCloud.overlay_panel=new MapCloud.TrackOverlay("left_panel_overlay","map_overlay_wrapper"),MapCloud.search_panel=new MapCloud.SearchPanel("search_wrapper"),MapCloud.chart_panel=new MapCloud.ChartPanel("chart_wrapper"),MapCloud.bar_chart_panel=new MapCloud.BarChartPanel("bar_chart_wrapper"),MapCloud.pie_chart_panel=new MapCloud.PieChartPanel("pie_chart_wrapper"),MapCloud.symbol_chart_panel=new MapCloud.SymbolChartPanel("symbol_chart_wrapper"),MapCloud.range_symbol_chart_panel=new MapCloud.RangeSymbolChartPanel("range_symbol_chart_wrapper"),MapCloud.cluster_chart_panel=new MapCloud.ClusterChartPanel("cluster_chart_wrapper"),MapCloud.aqi_chart_panel=new MapCloud.AQIChartPanel("aqi_chart_wrapper"),MapCloud.aqi_timeline_chart_panel=new MapCloud.AQITimelineChartPanel("aqi_timeline_chart_wrapper"),MapCloud.airline_panel=new MapCloud.AirlinePanel("airline_wrapper"),MapCloud.gps_oper_panel=new MapCloud.GPSOperPanel("gps_oper_wrapper"),MapCloud.data_source_panel=new MapCloud.DataSourcePanel("data_source_wrapper"),MapCloud.topicPanel=new MapCloud.TopicPanel("topic_panel"),MapCloud.login_dialog=new MapCloud.LoginDialog("loginDialog"),MapCloud.style_list_dialog=new MapCloud.StyleListDialog("style_list_dialog"),MapCloud.map_info_dialog=new MapCloud.MapInfoDialog("map_info_dialog"),MapCloud.base_layer_dialog=new MapCloud.BaseLayerDialog("base_layer_dialog"),MapCloud.symbol_dialog=new MapCloud.SymbolDialog("symbol_dialog"),MapCloud.layer_info_dialog=new MapCloud.LayerInfoDialog("layer_info_dialog"),MapCloud.query_dialog=new MapCloud.QueryDialog("query_dialog"),MapCloud.create_dataset_dialog=new MapCloud.CreateDataSetDialog("create_dataset_dialog"),MapCloud.poi_dialog=new MapCloud.PoiDialog("poi_dialog"),MapCloud.aqi_features_dialog=new MapCloud.AQIFeaturesDialog("aqi_features_dialog");new MapCloud.Logo;ribbonObj=new MapCloud.Ribbon,MapCloud.userToolBar=new MapCloud.UserToolBar("user_tool_bar"),MapCloud.mapBar=new MapCloud.MapBar,MapCloud.dataGrid=new MapCloud.DataGrid("datagrid_wrapper","datagrid_control_wrapper"),MapCloud.tools=new MapCloud.Tools,MapCloud.cookieObj=new MapCloud.Cookie,$(".modal").draggable({handle:".modal-header"}),$("#datagrid_wrapper,.mc-panel").draggable({handle:".panel-header"}),$(window).resize(function(){$("#home_tab").hasClass("mc-active-tab")});var a=MapCloud.cookieObj.getCookie("username");if(null!=a){var o=!1;if("admin"==a){var l=window.location.href,e=l.lastIndexOf("?name=");if(-1!=e){var p=l.slice(e+6,l.length);null!=p&&(a=p,o=!0)}}MapCloud.account.hideLoginPanel(),$(".map-panel").css("display","block"),MapCloud.account.initUser(a),o&&MapCloud.cookieObj.setCookie("username","admin","/MapCloud")}else MapCloud.account.showLoginPanel(),$(".map-panel").css("display","none");MapCloud.dateAdd=function(a,o,l){var e=new Date(a);switch(o.toLowerCase()){case"year":e.setFullYear(e.getFullYear()+l);break;case"quarter":e.setMonth(e.getMonth()+3*l);break;case"month":e.setMonth(e.getMonth()+l);break;case"week":e.setDate(e.getDate()+7*l);break;case"day":e.setDate(e.getDate()+l);break;case"hour":e.setTime(e.getTime()+36e5*l);break;case"minute":e.setTime(e.getTime()+6e4*l);break;case"second":e.setTime(e.getTime()+1e3*l);break;default:e=void 0}return e},MapCloud.dateFormat=function(a,o){var l={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(o)&&(o=o.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var e in l)new RegExp("("+e+")").test(o)&&(o=o.replace(RegExp.$1,1==RegExp.$1.length?l[e]:("00"+l[e]).substr((""+l[e]).length)));return o}});
MapCloud.Account=MapCloud.Class({loginPanel:null,loginName:null,registerPanel:null,registerName:null,initialize:function(n,e){this.loginPanel=$("."+n),this.registerPanel=$("."+e);var i=this;this.loginPanel.find(".btn-account").click(function(){i.login()}),this.loginPanel.find(".btn-register").click(function(){i.hideLoginPanel(),i.showRegisterPanel()}),this.loginPanel.find("input[name='password']").keypress(function(n){13==n.which&&i.login()}),this.registerPanel.find(".btn-account").click(function(){i.register()}),this.registerPanel.find(".btn-login").click(function(){i.hideRegisterPanel(),i.showLoginPanel()}),this.registerPanel.find("input[name='repassword']").keypress(function(n){13==n.which&&i.register()}),this.registerPanel.find("input[name='password']").bind("keyup onfocus onblur",function(){var n=document.getElementById("tips"),e=n.getElementsByTagName("span"),a=i.checkStrong(this.value),s=["弱","中","强","非常好"];n.style.display="block",n.className="s"+a;for(var t=0;t<e.length;t++)e[t].className=e[t].innerHTML="",""!=this.value&&(e[a-1].className="active",e[a-1].innerHTML=s[a-1])})},showLoginPanel:function(){this.loginName=null,this.loginPanel.css("display","block"),this.loginPanel.find("input").val(""),this.loginPanel.find("input").first().focus()},hideLoginPanel:function(){this.loginPanel.css("display","none")},showRegisterPanel:function(){this.registerName=null,this.registerPanel.css("display","block"),this.registerPanel.find("input").val(""),this.registerPanel.find("input").first().focus()},hideRegisterPanel:function(){this.registerPanel.css("display","none")},hideMapPanel:function(){$(".map-panel").css("display","none")},showMapPanel:function(){$(".map-panel").css("display","block")},login:function(){var n=this.loginPanel.find("input[name='username']").val();if(""==n)return MapCloud.notify.showInfo("请输入用户名","Warning"),void this.loginPanel.find("input[name='username']").focus();var e=this.loginPanel.find("input[name='password']").val();return""==e?(MapCloud.notify.showInfo("请输入密码","Warning"),void this.loginPanel.find("input[name='password']").focus()):(MapCloud.notify.loading(),this.loginName=n,void authManager.login(n,e,this.login_callback))},login_callback:function(n){if(MapCloud.notify.showInfo(n,"登录"),"success"==n){var e=MapCloud.account;e.hideLoginPanel(),$(".map-panel").css("display","block"),e.initUser(e.loginName)}},initUser:function(n){null!=n&&(user=new GeoBeans.User(n),mapManager=user.getMapManager(),styleManager=user.getStyleManager(),fileManager=user.getFileManager(),dbsManager=user.getDBSManager(),rasterDBManager=user.getRasterDBManager(),gpsManager=user.getGPSManager(),poiManager=user.getPoiManager(),subManager=user.getSubManager(),serviceManager=user.getServiceManager(),subManager.setSubParams("base","gc_aqi_ranking","time_point","area","gc_aqi_ranking_uptime","uptime","downtime",MapCloud.topicPanel.getSub_callback),MapCloud.cookieObj.setCookie("username",n,"/MapCloud"),MapCloud.userToolBar.showUser(n),MapCloud.notify.loading(),mapManager.getMaps(ribbonObj.getMaps_callback))},register:function(){var n=this.registerPanel.find("input[name='username']").val();if(null==n||""==n)return MapCloud.notify.showInfo("请输入注册的用户名","Warning"),void this.registerPanel.find("input[name='username']").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(n))return MapCloud.notify.showInfo("请输入有效的用户名","Warning"),void this.registerPanel.find("input[name='username']").focus();var i=this.registerPanel.find("input[name='alias']").val();if(null==i||""==i)return MapCloud.notify.showInfo("请输入注册的昵称","Warning"),void this.registerPanel.find("input[name='alias'").focus();if(!e.test(i))return MapCloud.notify.showInfo("请输入有效的昵称","Warning"),void this.registerPanel.find("input[name='alias']").focus();var a=this.registerPanel.find("input[name='email']").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入注册的邮箱","Warning"),void this.registerPanel.find("input[name='email']").focus();var s=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!s.test(a))return MapCloud.notify.showInfo("请输入有效的邮箱","Warning"),void this.registerPanel.find("input[name='email']").focus();var t=this.registerPanel.find("input[name='password']").val();if(null==t||""==t)return MapCloud.notify.showInfo("请输入注册的密码","Warning"),void this.registerPanel.find("input[name='password']").focus();var r=$("input[name='repassword'").val();return null==r||""==r?(MapCloud.notify.showInfo("请再次输入注册的密码","Warning"),void this.registerPanel.find("input[name='repassword']").focus()):t!=r?(MapCloud.notify.showInfo("两次输入的密码不同","Warning"),void this.registerPanel.find("input[name='repassword']").focus()):(this.registerName=n,MapCloud.notify.loading(),void authManager.createUser(n,i,t,a,"normal",this.register_callback))},register_callback:function(n){if(MapCloud.notify.showInfo(n,"注册"),"success"==n){var e=MapCloud.account;e.hideLoginPanel(),$(".map-panel").css("display","block"),e.initUser(e.registerName)}},checkStrong:function(n){var e=0;if(n.length<1)return e;switch(/\d/.test(n)&&e++,/[a-z]/.test(n)&&e++,/[A-Z]/.test(n)&&e++,/\W/.test(n)&&e++,e){case 1:return 1;case 2:return 2;case 3:case 4:return n.length<12?3:4}}});
MapCloud.Logo=MapCloud.Class({initialize:function(){$("#logo_panel").each(function(){$(this).click(function(){ribbonObj.isCollapsed()?ribbonObj.expand():ribbonObj.collapse()})})}});
MapCloud.Ribbon=MapCloud.Class({height_max:"100px",height_min:"20px",ribbon:null,ribbonContainer:null,maps:null,maxCount:null,pageCount:null,pageNumber:5,initialize:function(){this.ribbon=$("#ribbon_wrapper").first(),this.ribbonContainer=$("#ribbon_container").first(),this.hideAllRibbons(),this.displayFirstRibbon(),this.registerRibbonEvents(),this.enableMneuEffect(),this.registerMenuEvents()},destory:function(){},hideAllRibbons:function(){$(".ribbon_panel").each(function(){$(this).css("display","none")})},displayFirstRibbon:function(){$("#home_ribbon").css("display","block")},showRibbon:function(a){$("#"+a+"_ribbon").css("display","block"),"home"==a?(this.showMapListPanel(),$(".query-map-name").val("")):null!=mapObj&&"none"==$("#main_panel").css("display")?($("#map_list_panel").css("display","none"),$("#main_panel").css("display","block")):($("#map_list_panel").css("display","none"),$("#main_panel").css("display","block"))},showMapListPanel:function(){$("#map_list_panel").css("display","block"),$("#main_panel").css("display","none"),mapManager.getMaps(this.getMaps_callback)},showMapPanel:function(){$("#map_list_panel").css("display","none"),$("#main_panel").css("display","block")},expand:function(){this.ribbon.css("height",this.height_max),this.ribbonContainer.css("height","80px"),$("#main_panel").css("height","calc(100% - 122px)"),$("#map_list_panel").css("top","122px"),mapManager.getMaps(ribbonObj.getMaps_callback),$("#ribbon_container").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){null!=mapObj&&mapObj.resize("height")})},collapse:function(){this.ribbon.css("height",this.height_min),this.ribbonContainer.css("height","0px"),$("#main_panel").css("height","calc(100% - 42px)"),$("#map_list_panel").css("top","42px"),mapManager.getMaps(ribbonObj.getMaps_callback),$("#ribbon_container").bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){null!=mapObj&&mapObj.resize("height")})},isCollapsed:function(){return this.ribbon.css("height")==this.height_min},registerRibbonEvents:function(){var a=this;$("#ribbon_tabs li").each(function(){$(this).mouseover(function(){$(this).addClass("mc-theme-color-hover")}),$(this).mouseout(function(){$(this).removeClass("mc-theme-color-hover")}),$(this).click(function(){var n=$(this).attr("id"),e=n.substr(0,n.length-4);$("#ribbon_tabs li").each(function(){$(this).removeClass("mc-active-tab")}),$(this).addClass("mc-active-tab"),a.hideAllRibbons(),a.showRibbon(e)})})},enableMneuEffect:function(){$(".ribbon-item").each(function(a,n){$(this).mouseover(function(){$(this).addClass("ribbon-item-over")}),$(this).mouseout(function(){$(this).removeClass("ribbon-item-over")})})},registerMenuEvents:function(){var a=this;$(".btn-new-map").click(function(){a.onCreateMap()}),$(".query-map-name").on("input",function(n){a.onQueryMap($(this).val())}),$(".ribbon-item").each(function(n,e){$(this).click(function(e){switch(n){case 0:a.onCreateMap();break;case 1:a.onCloseMap();break;case 2:a.onRemoveMap();break;case 3:a.onMapPropertis();break;case 4:a.onDataSourcePanel();break;case 5:case 13:a.onLayerNew();break;case 6:case 14:a.onAddRasterLayer();break;case 7:case 15:a.onLayerAddWMS();break;case 8:case 16:a.onLayerAddWFS();break;case 9:case 17:a.onLayerAddWMTS();break;case 10:case 18:a.onAddBaseLayer("image");break;case 11:case 19:a.onAddBaseLayer("vector");break;case 12:case 20:a.onAddPanorama();break;case 21:a.onFile();break;case 22:a.onDataSource();break;case 23:a.onImportImage();break;case 24:a.onTileDataSource();break;case 25:a.onDataSourcePanel();break;case 26:a.onAddRangeChart();break;case 27:a.onAddBarChart();break;case 28:a.onAddPieChart();break;case 29:a.onAddSymbolChart();break;case 30:a.onAddRangeSymbolChart();break;case 31:a.onAddClusterLayer();break;case 32:a.onHeatMap();break;case 33:a.onAQI();break;case 34:a.onAQITimeline();break;case 35:a.onAirline();break;case 36:a.onLayerAddVector();break;case 37:a.onStyleManager();break;case 38:a.onTools();break;case 39:a.onProcess();break;case 40:a.onVersion()}})})},onCreateMap:function(){MapCloud.create_map_dlg.showDialog()},onCloseMap:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):($(".mc-panel").css("display","none"),MapCloud.refresh_panel.cleanup(),mapObj.close(),void(mapObj=null))},onRemoveMap:function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");if(confirm("确定要删除当前地图吗？")){var a=mapManager.removeMap(mapObj.name),n="Remove Map [ "+mapObj.name+" ]";MapCloud.notify.showInfo(a,n),MapCloud.refresh_panel.cleanup(),mapObj.close(),mapObj=null}},onSaveMap:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void mapManager.saveMap(mapObj,this.saveMap_callback)},onRefreshMap:function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var a=mapObj.viewer,n=mapManager.getMap("mapCanvas_wrapper",mapObj.name);null==n?MapCloud.notify.showInfo("failed","刷新地图"):(MapCloud.notify.showInfo("success","刷新地图"),mapObj=n,MapCloud.refresh_panel.refreshPanel(),MapCloud.dataGrid.cleanup(),mapObj.setViewer(a),mapObj.draw())},saveMap_callback:function(a){MapCloud.notify.showInfo(a,"保存地图")},onMapPropertis:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.map_info_dialog.showDialog(mapObj)},onDataSourcePanel:function(){MapCloud.data_source_panel.showPanel()},onLayerNew:function(){MapCloud.new_layer_dialog.showDialog()},onAddRasterLayer:function(){MapCloud.new_raster_dblayer_dialog.showDialog()},onLayerAddWMS:function(){MapCloud.wms_dialog.showDialog()},onLayerAddWFS:function(){MapCloud.wfs_datasource_dialog.showDialog()},onLayerAddWMTS:function(){MapCloud.wmts_dialog.showDialog()},onAddBaseLayer:function(a){MapCloud.base_layer_dialog.showDialog(a)},onAddPanorama:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void(0==mapObj.panoramaLayer.overlays.length?this.addPanorama():(mapObj.clearPanoramas(),mapObj.draw()))},addPanorama:function(){var a="http://192.168.111.152:8088/panorama/",n="../images/360.png",e=new GeoBeans.Geometry.Point(109.2113,18.291),o="南海观音",i=a+"nanshan12.html";mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.3446,18.2887),o="天涯海角",i=a+"sanyawan7.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.4899,18.2611),o="三亚湾",i=a+"sanyawan2.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.6313,18.23),o="美高梅",i=a+"GRANDjiudianshatan3.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.5156,18.231),o="免税店",i=a+"sanyamianshuidian.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.311399,18.3131264),o="办公楼会议室",i=a+"bangonglouhuiyishi.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.311388,18.313209),o="办公楼走道",i=a+"bangonglouzoudao4.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.311384,18.313269),o="办公楼机房",i=a+"jieshouzhanjifang2.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.31101,18.312646),o="财务楼报告厅",i=a+"caiwuloubaogaoting.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.311476,18.312623),o="财务楼大厅",i=a+"caiwuloudating.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.311561,18.313199),o="办公楼",i=a+"yaogansuojieshouzhan22.html",mapObj.addPanorama(e,o,i,n),e=new GeoBeans.Geometry.Point(109.31156,18.312892),o="室外",i=a+"yaogansuojieshouzhan5.html",mapObj.addPanorama(e,o,i,n);var s=new GeoBeans.Envelope(108.5077,17.8683,110.8703,19.3634);mapObj.setViewer(s),mapObj.draw()},onAddRangeChart:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.chart_panel.showPanel()},onAddBarChart:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.bar_chart_panel.showPanel()},onAddPieChart:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.pie_chart_panel.showPanel()},onAddSymbolChart:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.symbol_chart_panel.showPanel()},onAddRangeSymbolChart:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.range_symbol_chart_panel.showPanel()},onAddClusterLayer:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.cluster_chart_panel.showPanel()},onEditLayer:function(){},onShareLayer:function(){},onDuplicateLayer:function(){},onRemoveLayer:function(){if(0==$("#layers_row .layer_row.layer_row_selected").length)return void MapCloud.notify.showInfo("请选择图层","Warning");var a=$("#layers_row .layer_row.layer_row_selected").attr("lname");null!=a&&confirm("你确定要删除图层吗？")&&mapObj.removeLayer(a,this.removeLayer_callback)},removeLayer_callback:function(a){MapCloud.notify.showInfo(a,"删除图层");var n=MapCloud.refresh_panel;n.refreshPanel()},onZoomLayer:function(){if(0==$("#layers_row .layer_row.layer_row_selected").length)return void MapCloud.notify.showInfo("请选择图层","Warning");var a=$("#layers_row .layer_row.layer_row_selected").attr("lname");null!=a&&mapObj.zoomToLayer(a)},onSelectAllLayers:function(){},onImportLayer:function(){},onExportLayer:function(){},onCreateLayer:function(){null==MapCloud.create_layer_dialog&&(MapCloud.create_layer_dialog=new MapCloud.CreateLayerDialog("create_layer_dialog")),MapCloud.create_layer_dialog.showDialog()},addChart:function(){MapCloud.chart_panel.showPanel()},onFile:function(){MapCloud.file_dialog.showDialog()},onDataSource:function(){MapCloud.vector_db_dialog.showDialog()},onImportImage:function(){MapCloud.raster_db_dialog.showDialog()},onTileDataSource:function(){MapCloud.tile_db_dialog.showDialog()},onHeatMap:function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var a=$("#layers_row .layer_row_selected").attr("lname");if(null==a||""==a)return void MapCloud.notify.showInfo("请选择图层","Warning");var n=mapObj.getLayer(a);if(null!=n){var e=n.geomType;if(e!=GeoBeans.Geometry.Type.POINT&&e!=GeoBeans.Geometry.Type.MULTIPOINT)return void MapCloud.notify.showInfo("请选择点图层","Warning");MapCloud.notify.hideLoading(),MapCloud.heatMap_dialog.showDialog(),MapCloud.heatMap_dialog.setLayer(n)}},onAQI:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.aqi_chart_panel.showPanel()},onAQITimeline:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.aqi_timeline_chart_panel.showPanel()},onAirline:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.airline_panel.showPanel()},onLayerAddVector:function(){MapCloud.overlay_panel.show()},onStyleManager:function(){MapCloud.styleManager_dialog.showDialog()},onTools:function(){MapCloud.gps_oper_panel.showPanel()},onProcess:function(){MapCloud.process_dialog.showDialog()},onVersion:function(){MapCloud.version_dialog.showDialog()},onTopic:function(){var a=new Date("2015-11-24 08:42:23"),n=["aqi",["hotel"]];poiManager.beginSubscribe(n,a,this.poi_callback)},poi_callback:function(a,n,e,o){return null!=n?void MapCloud.notify.showInfo(n,"订阅"):void MapCloud.topicPanel.setResults(a,e,o)},setMaps:function(a){this.maps=a;var n=210,e=Math.floor($(".map-list-col").height()/n),o=(Math.floor($("#maps_list_ul").width()/n),$("#maps_list_ul").css("width"));o=parseInt(o.slice(0,o.lastIndexOf("px")));var i=$(".map-list-info").css("width");i=parseInt(i.slice(0,i.lastIndexOf("px")));var s=Math.floor(o/n),t=n*s,l=o-t,r=Math.floor(l/s),p=5+r;this.mapSizeMarginRight=p;var d=e*s;this.maxCount=d;var c=Math.ceil(a.length/this.maxCount);this.pageCount=c,this.ribbonContainer.find(".maps-count span").html(a.length),this.initPageControl(1,this.pageCount);var u=$(".map-list-info").css("width");u=parseInt(u.slice(0,u.lastIndexOf("px"))),$("#home_ribbon .map-page-div").css("right",u+"px");var m=$(".maps-count").css("width");m=parseInt(m.slice(0,m.lastIndexOf("px")));var h=$("#home_ribbon .pagination").css("width");h=parseInt(h.slice(0,h.lastIndexOf("px")));var b=m+h;$("#home_ribbon .map-page-div").css("width",b+"px")},initPageControl:function(a,n){if(!(0>=a||a>n)){var e="";if(e+=1==a?'<li class="disabled">		<a href="javascript:void(0)" aria-label="Previous">			<span aria-hidden="true">«</span>		</a>	</li>':'<li>		<a href="javascript:void(0)" aria-label="Previous">			<span aria-hidden="true">«</span>		</a>	</li>',n<=this.pageNumber)for(var o=1;n>=o;++o)e+=o==a?'<li class="active">	<a href="javascript:void(0)">'+a.toString()+'		<span class="sr-only">(current)</span></a></li>':"<li><a href='javascript:void(0)'>"+o+"</a></li>";else{var i=n-this.pageNumber+1;if(i>=a)for(var o=a;o<a+this.pageNumber;++o)e+=o==a?'<li class="active">	<a href="javascript:void(0)">'+a+"</a></li>":"<li><a href='javascript:void(0)'>"+o+"</a></li>";else for(var o=i;n>=o;++o)e+=o==a?'<li class="active">	<a href="javascript:void(0)">'+a+"</a></li>":"<li><a href='javascript:void(0)'>"+o+"</a></li>"}e+=a==n?'<li class="disabled">		<a href="javascript:void(0)" aria-label="Next">			<span aria-hidden="true">»</span>		</a>	</li>':'<li>		<a href="javascript:void(0)" aria-label="Next">			<span aria-hidden="true">»</span>		</a>	</li>',$("#home_ribbon .pagination").html(e),this.registerPageEvent();var s=(a-1)*this.maxCount,t=a*this.maxCount-1;this.showMaps(s,t)}},registerPageEvent:function(){var a=this;$("#home_ribbon .pagination li a").click(function(){var n=$("#home_ribbon .pagination li.active a").html(),e=parseInt(n),o=$(this).attr("aria-label");"Previous"==o?e-=1:"Next"==o?e+=1:e=parseInt($(this).html()),a.initPageControl(e,a.pageCount)})},showMaps:function(a,n){if($("#map-infos").css("display","none"),null!=this.maps){for(var e="",o=this,i=a;n>=i&&i<this.maps.length;++i){var s=this.maps[i],t=s.name,l=s.thumbnail,r="";r=null!=l?"	<a href='javascript:void(0)' class='map-thumb' style=\"background-image:url("+l+')"></a>':"	<a href='javascript:void(0)' class='map-thumb'></a>",e+="<li class='maps-thumb' name='"+t+"'>"+r+"	<div class='caption text-center'>		<h6>"+t+"</h6>	</div></li>"}$("#maps_list_ul").html(e),null!=this.mapSizeMarginRight&&$("#maps_list_ul li").css("margin-right",this.mapSizeMarginRight+"px");var p=$("#maps_list_ul").find("li").first();p.find("a").addClass("selected");var t=p.attr("name");mapManager.getMapObj(t,this.showMapInfo),o.registerMapListClickEvent()}},registerMapListClickEvent:function(){var a=this,n=300,e=0,o=null;$("#maps_list_ul").find(".map-thumb").click(function(){if(e++,1==e){var i=this;o=setTimeout(function(){console.log("Single Click"),$("#maps_list_ul").find(".map-thumb").removeClass("selected"),$(i).addClass("selected");var n=$(i).parent().attr("name");mapManager.getMapObj(n,a.showMapInfo),e=0},n)}else{clearTimeout(o),console.log("Double Click");var s=$(this).parent().attr("name");MapCloud.notify.loading(),null!=mapObj&&mapObj.close(),mapObj=null,a.showMapTab();var t="打开地图["+s+"]";mapObj=mapManager.getMap("mapCanvas_wrapper",s),null==mapObj?MapCloud.notify.showInfo("Warning",t+"失败"):(mapObj.setNavControl(!1),$(".mc-panel").css("display","none"),mapObj.draw(),mapObj.addEventListener(GeoBeans.Event.MOUSE_MOVE,MapCloud.tools.onMapMove),MapCloud.refresh_panel.refreshPanel(),MapCloud.dataGrid.cleanup(),MapCloud.notify.showInfo("success",t)),e=0}}).dblclick(function(a){a.preventDefault()})},showMapTab:function(){$("#ribbon_tabs li").removeClass("mc-active-tab"),$("#ribbon_tabs #map_tab").addClass("mc-active-tab"),this.hideAllRibbons(),this.showRibbon("map")},getMaps_callback:function(a){MapCloud.notify.hideLoading(),$(".map-list-info").css("display","none"),$("#maps_list_ul").empty(),ribbonObj.setMaps(a)},showMapInfo:function(a){if($(".map-list-info").css("display","block"),null!=a){var n=a.name,e=a.srid;$(".map-list-info .map-info-name").html(n),$(".map-list-info .map-info-srid").html(e);var o=a.extent;if(null!=o){var i=o.xmin.toFixed(2)+" , "+o.ymin.toFixed(2)+" , "+o.xmax.toFixed(2)+" , "+o.ymax.toFixed(2);$(".map-list-info .map-info-extent").html(i)}$(".map-list-info .map-info-layers").empty();var s=a.layers,t=null,n=null,o=null,l=null,r="",p=a.baseLayer;if(null!=p){var n=p.name,d=null;if(p.type==GeoBeans.Layer.TileLayer.Type.QS?d="QuadServer":p.type==GeoBeans.Layer.TileLayer.Type.WMTS&&(d="WMTS"),r+='<div class="map-info-layer-heading">	<span>'+n+"</span></div>",null!=d&&(r+='<div class="map-info-row">	<span class="map-info-item">类型：</span>	<span class="map-info-name">'+d+"</span></div>"),o=p.extent,null!=o){var i=o.xmin.toFixed(2)+" , "+o.ymin.toFixed(2)+" , "+o.xmax.toFixed(2)+" , "+o.ymax.toFixed(2);r+='<div class="map-info-row">	<span class="map-info-item">范围：</span>	<span class="map-info-name">'+i+"</span></div>"}}for(var c=0;c<s.length;++c)if(t=s[c],null!=t&&(n=t.name,l=t.geomType,r+='<div class="map-info-layer-heading">	<span>'+n+"</span></div>",null!=l&&(r+='<div class="map-info-row">	<span class="map-info-item">类型：</span>	<span class="map-info-name">'+l+"</span></div>"),o=t.extent,null!=o)){var i=o.xmin.toFixed(2)+" , "+o.ymin.toFixed(2)+" , "+o.xmax.toFixed(2)+" , "+o.ymax.toFixed(2);r+='<div class="map-info-row">	<span class="map-info-item">范围：</span>	<span class="map-info-name">'+i+"</span></div>"}$(".map-list-info .map-info-layers").append(r)}},onQueryMap:function(a){if(null!=a){var n=null;if(""==a){if(n=mapManager.maps,null!=mapManager.maps)return void this.setMaps(n)}else n=mapManager.getMapByNameChar(a);if(null!=n&&0!=n.length){for(var e=null,o="",i=0;i<n.length;++i){e=n[i];var s=e.name,t=e.thumbnail,l="";l=null!=t?"	<a href='javascript:void(0)' class='map-thumb' style=\"background-image:url("+t+')"></a>':"	<a href='javascript:void(0)' class='map-thumb'></a>",o+="<li class='maps-thumb' name='"+s+"'>"+l+"	<div class='caption text-center'>		<h6>"+s+"</h6>	</div></li>"}$("#maps_list_ul").html(o);var r=$("#maps_list_ul").find("li").first();r.find("a").addClass("selected");var s=r.attr("name");mapManager.getMapObj(s,this.showMapInfo),$(".btn-list-maps").removeClass("disabled"),this.registerMapListClickEvent()}}},refreshMap_callback:function(a){mapObj.draw(),MapCloud.refresh_panel.refreshPanel()}});
MapCloud.Tools=MapCloud.Class({toolBoxPanel:null,toolBoxFlag:null,initialize:function(){this.toolBoxPanel=$(".float-tool-box"),this.registerPanelEvent()},registerPanelEvent:function(){var a=this;this.toolBoxPanel.click(function(){var l=null;switch(a.toolBoxFlag){case"chart":l=MapCloud.chart_panel;break;case"barChart":l=MapCloud.bar_chart_panel;break;case"pieChart":l=MapCloud.pie_chart_panel;break;case"aqiChart":l=MapCloud.aqi_chart_panel;break;case"aqiTimeline":l=MapCloud.aqi_timeline_chart_panel}null!=l&&l.panel.css("display","block"),a.toolBoxPanel.css("display","none")})},onMapMove:function(a){var l=a.mapX,o=a.mapY;if(null!=l&&null!=o){var e=l.toFixed(4)+" , "+o.toFixed(4);$(".float-coordinates .coor-value").html(e)}},showToolBox:function(a){if(null!=a){this.toolBoxFlag=a;var l="";switch(a){case"chart":l="<i class='fa fa-bar-chart'></i>";break;case"barChart":l="<i class='fa fa-bar-chart'></i>";break;case"pieChart":l="<i class='fa fa-pie-chart'></i>";break;case"aqiChart":l="<i class='fa fa-cloud'></i>";break;case"aqiTimeline":l="<i class='fa fa-cloud'></i>"}this.toolBoxPanel.html(l),this.toolBoxPanel.css("display","block")}}});
MapCloud.AirlinePanel=MapCloud.Class(MapCloud.Panel,{chartLayer:null,dbName:"base",typeName:"osm_airports",option:{curveness:.4},initialize:function(){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerPanelEvent()},cleanup:function(){this.panel.find(".chart-table-name").val("航线图"),this.panel.find(".chart-table-radius").val("6"),this.panel.find(".line-width").val("0.6"),this.panel.find(".style_enable").prop("checked",!0),this.panel.find("input.slider").slider("setValue",100),this.panel.find(".colorSelector").colpickSetColor("#EEEEEE"),this.panel.find(".colorSelector").attr("disabled",!1),this.panel.find(".colorSelector div").css("background-color","#EEEEEE"),this.panel.find(".colorSelector div").css("opacity",1),this.panel.find(".color-opacity").html("1.0")},registerPanelEvent:function(){var i=this;this.panel.find(".slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(i){var e=$(this).parents(".form-group");e.find(".color-opacity").html(i.value/100);e.find(".colorSelector div").css("opacity",i.value/100)})}),this.panel.find(".colorSelector").each(function(){$(this).colpick({color:"cccccc",onChange:function(i,e,l,n,a){$(n).children().css("background-color","#"+e)},onSubmit:function(i,e,l,n,a){$(n).children().css("background-color","#"+e),$(n).colpickHide()}})}),this.panel.find(".btn-add-chart").click(function(){i.addLayer(),MapCloud.refresh_panel.refreshPanel()}),this.panel.find(".btn-cancel").click(function(){i.hidePanel()}),this.panel.find(".style_enable").click(function(){var i=$(this).parents(".form-group"),e=i.find("input.slider"),l=i.find("input[type='text']").not(".slider-value ,.slider"),n=i.find(".colorSelector"),a=$(this).prop("checked");a?(l.prop("readonly",!1),e.slider("enable"),n.attr("disabled",!1)):(l.prop("readonly",!0),e.slider("disable"),n.attr("disabled",!0))})},addLayer:function(){var i=this.panel.find(".chart-table-name").val();if(null==i||""==i)return void MapCloud.notify.showInfo("请输入名称","Warning");var e=this.panel.find(".chart-table-radius").val();if(null==e||""==e)return void MapCloud.notify.showInfo("请输入机场的点半径","Warning");var l=this.panel.find(".line-width").val();if(null==l||""==l)return void MapCloud.notify.showInfo("请输入航线的宽度","Warning");var n=this.panel.find(".airport-fill-div"),a=this.getColor(n),o=this.panel.find(".airport-stroke-div"),r=this.getColor(o),t=this.panel.find(".airline-stroke-div"),s=this.getColor(t),c=new GeoBeans.Symbolizer.PointSymbolizer;null==r?c.stroke=null:c.stroke.color=r,null==a?c.fill=null:c.fill.color=a,c.size=e;var d=new GeoBeans.Symbolizer.LineSymbolizer;d.stroke.color=s,d.fill=null,d.stroke.width=l,null!=this.layer&&mapObj.removeLayer(this.layer.name);var p=new GeoBeans.Layer.AirLineLayer(i,this.dbName,this.typeName,d,c,this.option);mapObj.addLayer(p,this.addLayer_callback)},getColor:function(i){if(null!=i){var e=i.find(".style_enable").prop("checked");if(!e)return null;var l=i.find(".colorSelector div"),n=l.css("background-color"),a=l.css("opacity"),o=new GeoBeans.Color;return o.setByRgb(n,a),o}},addLayer_callback:function(i){if("success"==i){mapObj.draw();var e=MapCloud.airline_panel,l=e.panel.find(".chart-table-name").val();e.layer=mapObj.getLayer(l)}else MapCloud.notify.showInfo(i,"添加航线图")},setLayer:function(i){if(null!=i){this.layer=i;var e=i.name;this.panel.find(".chart-table-name").val(e);var l=i.pointSymbolizer,n=l.stroke;if(null!=n){var a=(this.panel.find(".airport-stroke-div"),n.color);this.setColor(d,a)}var o=l.fill;if(null!=o){var r=this.panel.find(".airport-fill-div"),a=o.color;this.setColor(r,a)}var t=l.size;this.panel.find(".chart-table-radius").val(t);var s=i.symbolizer,c=s.stroke,d=this.panel.find(".airline-stroke-div");this.setColor(d,c.color);var p=c.width;this.panel.find(".line-width").val(p)}},setColor:function(i,e){if(null!=i&&null!=e){var l=e.getHex();i.find(".colorSelector").colpickSetColor(l),i.find(".colorSelector div").css("background-color",l);var n=e.getOpacity();i.find("input.slider").slider("setValue",100*n),i.find(".colorSelector div").css("opacity",n)}}});
MapCloud.AQIChartPanel=MapCloud.Class(MapCloud.Panel,{dbName:"base",timeTableName:"gc_aqi_uptime",timeTableTimeField:"uptime",tableName:"gc_aqi",timeField:"time_point",labelField:"position_name",flagField:"station_code",stationCode:null,positionName:null,chartLayer:null,styleMgr:null,initialize:function(e){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerEvent()},registerEvent:function(){var e=this;this.panel.find(".form_datetime").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",maxView:"year",language:"zh-CN"}).on("changeDate",function(a){var i=a.date;if(null!=i){var t=new Date(i);i.getDate();t.setHours(0),t.setMinutes(0),t.setSeconds(0);var n=MapCloud.dateAdd(t,"day",1);n.setHours(0),e.displayTimeList(t,n)}}),this.panel.find(".btn-add-chart").click(function(){if(null!=e.chartLayer){var a=e.chartLayer.name;mapObj.removeLayer(a)}e.addLayer(),MapCloud.refresh_panel.refreshPanel()}),this.panel.find(".btn-cancel").click(function(){e.hidePanel()}),this.panel.find(".panel-header").dblclick(function(){e.panel.css("display","none"),MapCloud.tools.showToolBox("aqiChart")}),this.panel.find(".aqi-style-div").click(function(){e.panel.find(".aqi-style-div").removeClass("selected"),$(this).addClass("selected")})},showPanel:function(){if("none"==this.panel.css("display")){this.cleanup(),this.panel.css("display","block");var e=styleManager.getColorMaps();this.getColorMaps_callback(e)}},hidePanel:function(){MapCloud.Panel.prototype.hidePanel.apply(this,arguments),MapCloud.refresh_panel.refreshPanel()},cleanup:function(){this.chartLayer=null,this.panel.find(".chart-table-name").val("空气质量指数专题图"),this.panel.find(".aqi-time-points").empty(),this.panel.find(".aqi-index option[value='aqi']").attr("selected",!0),this.panel.find(".form_datetime input").val(""),this.panel.find(".aqi-style-div").removeClass("selected")},getColorMaps_callback:function(e){if(null!=e){for(var a=MapCloud.aqi_chart_panel,i=null,t=null,n="",l=0;l<e.length;++l)i=e[l],t=i.url,n+="<li cid='"+i.id+"'>	<div class='color-ramp-item' style='background-image:url("+t+")' start='"+i.startColor+"' end='"+i.endColor+"'>	</div></li>";if(a.panel.find(".color-ramp-div ul").html(n),i=e[0],null!=i){t=i.url;var r=i.id,s="<li cid='"+r+"'>	<div class='color-ramp-item' style='background-image:url("+t+")' start='"+i.startColor+"' end='"+i.endColor+"'>	</div></li>";a.panel.find(".select-color-ramp").html(s)}a.panel.find(".color-ramp-div ul li").click(function(){var e=$(this).attr("cid"),i=$(this).find("div").attr("start"),t=$(this).find("div").attr("end");a.panel.find(".select-color-ramp li").attr("cid",e);var n=$(this).find(".color-ramp-item").css("background-image");a.panel.find(".select-color-ramp li .color-ramp-item").css("background-image",n),a.panel.find(".select-color-ramp li .color-ramp-item").attr("start",i),a.panel.find(".select-color-ramp li .color-ramp-item").attr("end",t)})}},displayTimeList:function(e,a){if(null!=e&&null!=a){var i="",t=MapCloud.aqi_24h_dialog.toTimeFormat(e),n=MapCloud.aqi_24h_dialog.toTimeFormat(a),l=new GeoBeans.AQITimePointList("tmp",this.dbName,this.timeTableName,this.timeTableTimeField,t,n);l.setMap(mapObj);var r=l.getTimeList();if(null!=r){for(var s=0;s<r.length;++s)i+="<option value='"+r[s]+"'>"+r[s]+"</option>";this.panel.find(".aqi-time-points").html(i)}}},addChart:function(){var e=this.panel.find(".chart-table-name").val();if(null==e||""==e)return void MapCloud.notify.showInfo("请输入名称","Warning");var a=this.panel.find(".aqi-time-points").val();if(null==a)return void MapCloud.notify.showInfo("请选择一个时刻","Warning");var i=this.panel.find(".aqi-index").val(),t=this.panel.find(".select-color-ramp li").attr("cid"),n={colorMapID:t},l=new GeoBeans.Layer.AQIChartLayer(e,this.dbName,this.tableName,i,this.labelField,this.flagField,this.timeField,a,n);mapObj.addLayer(l,this.addLayer_callback)},addLayer_callback:function(e){var a=MapCloud.aqi_chart_panel;if("success"==e){mapObj.draw();var i=a.panel.find(".chart-table-name").val(),t=a.panel.find(".aqi-index").val(),n="{area}[{position_name}] : {"+t+"}";mapObj.registerRippleHitEvent(i,n);var l=a.panel.find(".chart-table-name").val(),r=mapObj.getLayer(l);null!=r&&(a.chartLayer=r)}else MapCloud.notify.showInfo(e,"Error")},changeChartOption:function(){if(null!=this.chartLayer){var e=this.panel.find(".chart-table-name").val();this.chartLayer.setName(e);var a=this.panel.find(".select-color-ramp li").attr("cid"),i={colorMapID:a},t=this.panel.find(".aqi-index").val();this.chartLayer.setChartField(t);var n=this.panel.find(".aqi-time-points").val();if(null==n)return void MapCloud.notify.showInfo("请选择一个时刻","Warning");this.chartLayer.setTimePoint(n),this.chartLayer.setChartOption(i),mapObj.draw()}},addLayer:function(){var e=this.panel.find(".chart-table-name").val();if(null==e||""==e)return void MapCloud.notify.showInfo("请输入名称","Warning");var a=this.panel.find(".aqi-time-points").val();if(null==a)return void MapCloud.notify.showInfo("请选择一个时刻","Warning");var i=this.panel.find(".aqi-index").val();null==i&&MapCloud.notify.showInfo("请选择一个质量指数","Warning");var t=this.panel.find(".select-color-ramp li").attr("cid");if(null==t)return void MapCloud.notify.showInfo("请选择一个色阶","Warning");var n=this.panel.find(".aqi-style-div.selected");if(0==n.length)return void MapCloud.notify.showInfo("请选择一个样式","Warning");var l=n.attr("astyle");switch(l){case"ripple_effect":this.addLayerEffectRipple(e,a,i,t,!0);break;case"ripple":this.addLayerEffectRipple(e,a,i,t,!1);break;case"info":this.addLayerAQIChart(e,a,i,t)}},addLayerEffectRipple:function(e,a,i,t,n){var l=new GeoBeans.BinaryComparisionFilter;l.operator=GeoBeans.ComparisionFilter.OperatorType.ComOprEqual;var r=new GeoBeans.PropertyName;r.setName(this.timeField);var s=new GeoBeans.Literal;s.setValue(a),l.expression1=r,l.expression2=s;var o=this.getRippleLayerOption(i);o.showEffect=n;var d=new GeoBeans.Layer.RippleLayer(e,this.dbName,this.tableName,o,l);mapObj.addLayer(d,this.addLayer_callback);var p=this.panel.find(".select-color-ramp li div"),c=p.attr("start"),h=p.attr("end");d.begin=c,d.end=h},getRippleLayerOption:function(e){var a=this.panel.find(".aqi-index").val(),i=this.getMinMaxValue(a);i.min,i.max;this.minMaxValue=i;var t={scale:5,type:"stroke",alpha:.8,radiusField:e,colorField:e,period:4,radius:function(e){return e/20},color:this.colorFunctionByColorMap};return t},colorFunctionByColorMap:function(e,a){var i=MapCloud.aqi_chart_panel,t=a.begin,n=a.end,l=i.minMaxValue,r=l.min,s=l.max,o=new GeoBeans.Color;o.setByHex(t,1);var d=o.getHsl(),p=new GeoBeans.Color;p.setByHex(n,1);var c=p.getHsl(),h=d.h+(e-r)*(c.h-d.h)/(s-r),f=d.s+(e-r)*(c.s-d.s)/(s-r),m=d.l+(e-r)*(c.l-d.l)/(s-r),u=new GeoBeans.Color;return u.setByHsl(h,f,m),u.getHex()},getMinMaxValue:function(e){var a=0,i=500;switch(e){case"aqi":a=0,i=500;break;case"co":a=0,i=90;break;case"co_24h":a=0,i=90;break;case"no2":a=0,i=100;break;case"no2_24h":a=0,i=100;break;case"o3":a=0,i=200;break;case"o3_24h":a=0,i=200;break;case"o3_8h":a=0,i=200;break;case"o3_8h_24h":a=0,i=200;break;case"pm10":a=0,i=500;break;case"pm10_24":a=0,i=500;break;case"pm2_5":a=0,i=300;break;case"pm_2_5_24h":a=0,i=300;break;case"so2":a=0,i=500;break;case"so2_24h":a=0,i=500;break;default:a=0,i=500}return{min:a,max:i}},addLayerAQIChart:function(e,a,i,t){var n={colorMapID:t,type:"tip"},l=new GeoBeans.Layer.AQIChartLayer(e,this.dbName,this.tableName,i,this.labelField,this.flagField,this.timeField,a,n);mapObj.addLayer(l,this.addLayer_callback)},setChartLayer:function(e){null!=e&&(e instanceof GeoBeans.Layer.AQIChartLayer?this.setAQIChartLayer(e):e instanceof GeoBeans.Layer.RippleLayer&&this.setRippleLayer(e))},setAQIChartLayer:function(e){if(null!=e){this.chartLayer=e;var a=e.name;this.panel.find(".chart-table-name").val(a);var i=e.getTimePoint();this.setTimePoint(i);var t=e.getChartOption();if(null!=t){var n=t.colorMapID;if(null!=n){n=parseInt(n),this.panel.find(".select-color-ramp li").attr("cid",n);var l=this.panel.find(".dropdown-menu li[cid='"+n+"']"),r=l.find(".color-ramp-item").css("background-image");this.panel.find(".select-color-ramp li .color-ramp-item").css("background-image",r)}}var s=e.getChartField();null!=s&&this.panel.find(".aqi-index option[value='"+s+"']").attr("selected",!0),this.panel.find(".aqi-style-div[astyle='info']").addClass("selected")}},setRippleLayer:function(e){if(null!=e){this.chartLayer=e;var a=e.filter,i=null;if(null!=a){var t=a.expression1;t.type==GeoBeans.Expression.Type.Literal&&(i=t.value);var n=a.expression2;n.type==GeoBeans.Expression.Type.Literal&&(i=n.value)}this.setTimePoint(i);var l=e.option,r=l.radiusField;this.panel.find(".aqi-index option[value='"+r+"']").attr("selected",!0);var s=l.showEffect;s?this.panel.find(".aqi-style-div[astyle='ripple_effect']").addClass("selected"):this.panel.find(".aqi-style-div[astyle='ripple']").addClass("selected")}},setTimePoint:function(e){if(null!=e){var a=e.slice(0,10);this.panel.find(".form_datetime input").val(a),this.panel.find(".form_datetime").datetimepicker("update");var i=new Date(a),t=i.getDate(),n=new Date(i),l=new Date(i);n.setHours(0),n.setMinutes(0),n.setSeconds(0),l.setHours(0),l.setMinutes(0),l.setSeconds(0),l.setDate(t+1),this.displayTimeList(n,l),this.panel.find(".aqi-time-points option[value='"+e+"']").attr("selected",!0)}}});
MapCloud.AQITimelineChartPanel=MapCloud.Class(MapCloud.Panel,{dbName:"base",timeTableName:"gc_aqi_uptime",timeTableTimeField:"uptime",tableName:"gc_aqi",timeField:"time_point",labelField:"position_name",flagField:"station_code",styleMgr:null,initialize:function(a){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerEvent()},showPanel:function(){if("none"==this.panel.css("display")){this.cleanup(),this.panel.css("display","block");var a=styleManager.getColorMaps();this.getColorMaps_callback(a)}},cleanup:function(){this.chartLayer=null,this.panel.find(".chart-table-name").val("空气质量指数时间序列图"),this.panel.find(".aqi-start-time-points").empty(),this.panel.find(".aqi-end-time-points").empty(),this.panel.find(".aqi-index option[value='aqi']").attr("selected",!0),this.panel.find(".date input").val(""),this.panel.find(".chart-interval").html("3000")},getColorMaps_callback:function(a){if(null!=a){for(var i=MapCloud.aqi_timeline_chart_panel,t=null,e=null,n="",l=0;l<a.length;++l)t=a[l],e=t.url,n+="<li cid='"+t.id+"'>	<div class='color-ramp-item' style='background-image:	url("+e+")'>	</div></li>";if(i.panel.find(".color-ramp-div ul").html(n),t=a[0],null!=t){e=t.url;var r=t.id,o="<li cid='"+r+"'>	<div class='color-ramp-item' style='background-image:	url("+e+")'>	</div></li>";i.panel.find(".select-color-ramp").html(o)}i.panel.find(".color-ramp-div ul li").click(function(){var a=$(this).attr("cid");i.panel.find(".select-color-ramp li").attr("cid",a);var t=$(this).find(".color-ramp-item").css("background-image");i.panel.find(".select-color-ramp li .color-ramp-item").css("background-image",t)})}},registerEvent:function(){var a=this;this.panel.find(".start_form_datetime").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",maxView:"year",language:"zh-CN"}).on("changeDate",function(i){var t=i.date;if(null!=t){var e=t.getUTCFullYear(),n=t.getUTCMonth(),l=t.getUTCDate(),r=new Date(e+"-"+(n+1)+"-"+l+" 00:00:00"),o=a.panel.find(".aqi-start-time-points"),s=MapCloud.dateAdd(t,"day",1);s.setHours(0),a.displayTimeList(r,s,o)}}),this.panel.find(".end_form_datetime").datetimepicker({format:"yyyy-mm-dd",autoclose:!0,minView:"month",maxView:"year",language:"zh-CN"}).on("changeDate",function(i){var t=i.date;if(null!=t){var e=t.getUTCFullYear(),n=t.getUTCMonth(),l=t.getUTCDate(),r=new Date(e+"-"+(n+1)+"-"+l+" 00:00:00"),o=a.panel.find(".aqi-end-time-points"),s=MapCloud.dateAdd(r,"day",1);s.setHours(0),a.displayTimeList(r,s,o)}}),this.panel.find(".btn-add-chart").click(function(){null==a.chartLayer?a.addChart():a.changeChartOption(),MapCloud.refresh_panel.refreshPanel()}),this.panel.find(".btn-cancel").click(function(){a.hidePanel()}),this.panel.find(".panel-header").dblclick(function(){a.panel.css("display","none"),MapCloud.tools.showToolBox("aqiTimeline")}),this.panel.find(".aqi-style-div").click(function(){a.panel.find(".aqi-style-div").removeClass("selected"),$(this).addClass("selected")})},displayTimeList:function(a,i,t){if(null!=a&&null!=i&&null!=t){var e="",n=MapCloud.dateFormat(a,"yyyy-MM-dd hh:mm:ss"),l=MapCloud.dateFormat(i,"yyyy-MM-dd hh:mm:ss"),r=new GeoBeans.AQITimePointList("tmp",this.dbName,this.timeTableName,this.timeTableTimeField,n,l);r.setMap(mapObj);var o=r.getTimeList();if(null!=o){for(var s=0;s<o.length;++s)e+="<option value='"+o[s]+"'>"+o[s]+"</option>";t.html(e)}}},addChart:function(){var a=this.panel.find(".chart-table-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入名称","Warning"),void this.panel.find(".chart-table-name").focus();var i=this.panel.find(".aqi-start-time-points").val();if(null==i)return void MapCloud.notify.showInfo("请选择一个时刻","Warning");var t=this.panel.find(".aqi-end-time-points").val();if(null==t)return void MapCloud.notify.showInfo("请选择一个时刻","Warning");if(i==t)return void MapCloud.notify.showInfo("请至少选择两个时刻","Warning");var e=this.panel.find(".aqi-index").val(),n=this.panel.find(".select-color-ramp li").attr("cid"),l={colorMapID:n},r=new GeoBeans.AQITimePointList("tmp",this.dbName,this.timeTableName,this.timeTableTimeField,i,t);r.setMap(mapObj);var o=r.getTimeList();if(0==o.length)return void MapCloud.notify.showInfo("请选择一个有效的时间段","Warning");if(o.length>20)return void MapCloud.notify.showInfo("请选择少于20个时间点的时间段","Warning");var s=this.panel.find(".aqi-style-div.selected");if(0==s.length)return void MapCloud.notify.showInfo("请选择一个样式","Warning");var d=s.attr("astyle"),p=null;"point"==d?p="point":"tip"==d&&(p="tip");var n=this.panel.find(".select-color-ramp li").attr("cid"),l={colorMapID:n,type:p},h=this.panel.find(".chart-interval").val();if(h=parseInt(h),!($.isNumeric(h)&&h>0))return void MapCloud.notify.showInfo("请设置一个有效的时间间隔","Warning");var c=new GeoBeans.Layer.AQITimelineLayer(a,this.dbName,this.tableName,e,this.labelField,this.flagField,this.timeField,o,h,l);mapObj.addLayer(c,this.addLayer_callback)},addLayer_callback:function(a){var i=MapCloud.aqi_timeline_chart_panel;if("success"==a){mapObj.draw();var t=i.panel.find(".chart-table-name").val(),e=mapObj.getLayer(t);null!=e&&(i.chartLayer=e)}else MapCloud.notify.showInfo(a,"Error")},changeChartOption:function(){var a=this.panel.find(".chart-table-name").val();this.chartLayer.setName(a);var i=this.panel.find(".aqi-start-time-points").val();if(null==i)return void MapCloud.notify.showInfo("请选择一个时刻","Warning");var t=this.panel.find(".aqi-end-time-points").val();if(null==t)return void MapCloud.notify.showInfo("请选择一个时刻","Warning");if(i==t)return void MapCloud.notify.showInfo("请至少选择两个时刻","Warning");var e=this.chartLayer.getTimePoints();if(null!=e&&e.length>=2){var n=e.length,l=e[0],r=e[n-1];if(l!=i||r!=t){var o=new GeoBeans.AQITimePointList("tmp",this.dbName,this.timeTableName,this.timeTableTimeField,i,t);o.setMap(mapObj);var s=o.getTimeList();if(0==s.length)return void MapCloud.notify.showInfo("请选择一个有效的时间段","Warning");if(s.length>20)return void MapCloud.notify.showInfo("请选择少于20个时间点的时间段","Warning");this.chartLayer.setTimePoints(s)}}var d=this.panel.find(".chart-interval").val();if(d=parseInt(d),!($.isNumeric(d)&&d>0))return void MapCloud.notify.showInfo("请设置一个有效的时间间隔","Warning");this.chartLayer.setInterval(d);var p=this.panel.find(".select-color-ramp li").attr("cid"),h=this.chartLayer.getChartOption().type,c=this.panel.find(".aqi-style-div.selected").attr("astyle");if(this.chartLayer.getChartOption().colorMapID!=p||c!=h){var m={colorMapID:p,type:c};this.chartLayer.setChartOption(m)}var f=this.panel.find(".aqi-index").val();this.chartLayer.getChartField()!=f&&this.chartLayer.setChartField(f),mapObj.draw()},setChartLayer:function(a){if(this.chartLayer=a,null!=this.chartLayer){var i=this.chartLayer.name;this.panel.find(".chart-table-name").val(i);var t=this.chartLayer.getChartOption();if(null!=t){var e=t.colorMapID;if(null!=e){e=parseInt(e),this.panel.find(".select-color-ramp li").attr("cid",e);var n=this.panel.find(".dropdown-menu li[cid='"+e+"']"),l=n.find(".color-ramp-item").css("background-image");this.panel.find(".select-color-ramp li .color-ramp-item").css("background-image",l)}}var r=this.chartLayer.getChartField();null!=r&&this.panel.find(".aqi-index option[value='"+r+"']").attr("selected",!0);var o=this.chartLayer.getTimePoints();if(null!=o&&o.length>=2){var s=o.length,d=o[0],p=o[s-1],h=d.slice(0,10);this.panel.find(".start_form_datetime input").val(h),this.panel.find(".start_form_datetime").datetimepicker("update");var c=new Date(h),m=c.getUTCFullYear(),f=c.getUTCMonth(),u=c.getUTCDate(),v=new Date(m+"-"+(f+1)+"-"+u+" 00:00:00"),y=new Date(m+"-"+(f+1)+"-"+(u+1)+" 00:00:00"),g=this.panel.find(".aqi-start-time-points");this.displayTimeList(v,y,g),this.panel.find(".aqi-start-time-points option[value='"+d+"']").attr("selected",!0);var C=p.slice(0,10);this.panel.find(".end_form_datetime input").val(C),this.panel.find(".end_form_datetime").datetimepicker("update");var M=new Date(h),b=M.getUTCFullYear(),T=M.getUTCMonth(),L=M.getUTCDate(),w=new Date(b+"-"+(T+1)+"-"+L+" 00:00:00"),I=new Date(b+"-"+(T+1)+"-"+(L+1)+" 00:00:00"),_=this.panel.find(".aqi-end-time-points");this.displayTimeList(w,I,_),this.panel.find(".aqi-end-time-points option[value='"+p+"']").attr("selected",!0)}var q=this.chartLayer.getInterval();this.panel.find(".chart-interval").val(q)}}});
MapCloud.BarChartPanel=MapCloud.Class(MapCloud.Panel,{chartLayer:null,dbName:null,tableName:null,chartFields:null,initialize:function(a){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerEvent()},showPanel:function(){if("none"==this.panel.css("display")){this.cleanup(),this.panel.css("display","block"),this.panel.find(".panel-collapse:not(:eq(0))").each(function(){$(this).hasClass("in")&&$(this).collapse("hide")});var a=this.panel.find(".panel-collapse").first();a.hasClass("in")||a.collapse("show"),this.showLayerTab()}},hidePanel:function(){MapCloud.Panel.prototype.hidePanel.apply(this,arguments),MapCloud.refresh_panel.refreshPanel()},cleanup:function(){this.chartLayer=null,this.chartFields=[],this.dbName=null,this.tableName=null,this.panel.find(".form-group-field").remove(),this.panel.find(".chart-table").val(""),this.panel.find(".chart-table-fields").empty(),this.panel.find(".chart-base-layer").empty(),this.panel.find(".chart-base-layer-fields").empty(),this.panel.find(".chart-table-name").val("柱状图"),this.panel.find(".chart-table-radius").val("100"),this.panel.find(".chart-table-offset-x").val("0"),this.panel.find(".chart-table-offset-y").val("0"),this.panel.find(".chart-table-show-label").prop("checked",!1),this.panel.find(".chart-fields").empty(),this.panel.find("input.slider").slider("setValue",100),this.panel.find(".chart-opacity").html("1")},registerEvent:function(){var a=this;this.panel.find('[data-toggle="tooltip"]').tooltip(),this.panel.find(".btn-chose-chart").click(function(){MapCloud.vector_db_dialog.showDialog("bar")}),this.panel.find(".chart-base-layer").change(function(){var e=$(this).val();a.showFields(),null!=a.chartLayer&&a.chartLayer.setBaseLayer(e)}),this.panel.find(".chart-base-layer-fields").change(function(){var e=$(this).val();null!=a.chartLayer&&a.chartLayer.setBaseLayerField(e)}),this.panel.find(".chart-table-fields").change(function(){var e=$(this).val();null!=a.chartLayer&&a.chartLayer.setTableField(e)}),this.panel.find(".btn-add-chart").click(function(){null==a.chartLayer?a.addChart():a.changeChartOption(),MapCloud.refresh_panel.refreshPanel()}),this.panel.find(".btn-cancel").click(function(){a.hidePanel()}),this.panel.find(".slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(e){var t=e.value;a.panel.find(".chart-opacity").html(t/100),a.changeOpacity(t/100),a.changeDisplayOpacity()})}),this.panel.find(".panel-header").dblclick(function(){a.panel.css("display","none"),MapCloud.tools.showToolBox("barChart")})},setDataSet:function(a,e){this.dbName=a,this.tableName=e,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName),null!=this.chartLayer&&(this.chartLayer.setDbName(this.dbName),this.chartLayer.setTableName(this.tableName))},showTableFields:function(a,e){var t=new GeoBeans.WFSWorkspace("tmp",mapObj.server,"1.0.0"),l=new GeoBeans.FeatureType(t,e),i=l.getFields(null,a);if(null!=i){for(var n=null,h=null,r="",s=0;s<i.length;++s)n=i[s],null!=n&&(h=n.name,r+="<option value='"+h+"'>"+h+"</option>");this.panel.find(".chart-table-fields").html(r),this.showChartFields(i)}},showChartFields:function(a){for(var e=null,t=null,l="<list-group>",i=0;i<a.length;++i)e=a[i],null!=e&&(t=e.name,l+="<a href='#' class='list-group-item'>"+t+"<input type='checkbox' value='"+t+"'></a>");this.panel.find(".chart-fields").html(l);var n=this,h=this.panel.find(".chart-fields .list-group-item input[type='checkbox']");h.change(function(){var a=$(this).val(),e=$(this).prop("checked");e?n.addChartField(a):n.removeChartField(a),n.displayChartFields()})},showLayerTab:function(){if(null!=mapObj){for(var a=mapObj.getLayers(),e=null,t="",l=null,i=0;i<a.length;++i)e=a[i],null!=e&&e instanceof GeoBeans.Layer.DBLayer&&e.geomType==GeoBeans.Geometry.Type.POINT&&(l=e.name,t+="<option value='"+l+"'>"+l+"</option>");this.panel.find(".chart-base-layer").html(t);var n=this.panel.find(".chart-base-layer").val();this.showFields(n)}},showFields:function(a){var e=mapObj.getLayer(a);if(null!=e){var t=e.getFields();if(null!=t){for(var l=null,i=null,n="",h=0;h<t.length;++h)l=t[h],null!=l&&(i=l.name,n+="<option value ='"+i+"'>"+i+"</option>");this.panel.find(".chart-base-layer-fields").html(n)}}},addChartField:function(a){if(null!=a){var e=new GeoBeans.Color,t=this.panel.find(".chart-opacity").html();e.setOpacity(parseFloat(t));var l={name:a,color:e};this.chartFields.push(l)}},removeChartField:function(a){if(null!=a)for(var e=null,t=null,l=0;l<this.chartFields.length;++l)e=this.chartFields[l],null!=e&&(t=e.name,t==a&&this.chartFields.splice(l,1))},getChartField:function(a){if(null==a)return null;for(var e=null,t=0;t<this.chartFields.length;++t)if(e=this.chartFields[t],null!=e&&e.name==a)return e;return null},changeChartFieldColor:function(a,e){if(null!=a)for(var t=$(a).parents(".form-group-field"),l=t.attr("fname"),i=null,n=0;n<this.chartFields.length;++n)i=this.chartFields[n],null!=i&&i.name==l&&(i.color=e)},changeOpacity:function(a){if(null!=a)for(var e=null,t=0;t<this.chartFields.length;++t)if(e=this.chartFields[t],null!=e){var l=e.color;null!=l&&l.setOpacity(a)}},changeDisplayOpacity:function(){var a=this;this.panel.find(".colorSelector").each(function(){var e=$(this).parents(".form-group-field"),t=e.attr("fname"),l=a.getChartField(t);if(null!=l){var i=l.color;$(this).find("div").css("background-color",i.getRgba())}})},displayChartFields:function(){for(var a=null,e=null,t="",l=0;l<this.chartFields.length;++l)a=this.chartFields[l],null!=a&&(e=a.name,t+="<div class='form-group form-group-sm form-group-field' fname='"+e+"'>	<div class='col-md-1 col-xs-1 col-md-offset-3 col-xs-offset-3'>		<div class='btn btn-default colorSelector'>			<div></div>		</div>	</div>	<div class='col-md-6 col-xs-6'>		<span>"+e+"		</span>	</div></div>");this.panel.find(".form-group-field").remove(),this.panel.find("#bar_chart_table_style_coll .panel-body .form-horizontal").append(t);var i=this;this.panel.find(".colorSelector").each(function(){$(this).colpick({color:"EEEEEE",onChange:function(a,e,t,l,n){var h=i.panel.find(".chart-opacity").html(),r=new GeoBeans.Color;r.setByHex("#"+e,parseFloat(h)),$(l).children().css("background-color",r.getRgba()),i.changeChartFieldColor(l,r)},onSubmit:function(a,e,t,l,n){var h=i.panel.find(".chart-opacity").html(),r=new GeoBeans.Color;r.setByHex("#"+e,parseFloat(h)),$(l).children().css("background-color",r.getRgba()),i.changeChartFieldColor(l,r),$(l).colpickHide()}});for(var a=$(this).parents(".form-group-field"),e=a.attr("fname"),t=null,l=null,n=0;n<i.chartFields.length;++n)t=i.chartFields[n],null!=t&&t.name==e&&(l=t.color);if(null!=l){var h=l.getHex();$(this).colpickSetColor(h);var r=l.getRgba();$(this).find("div").css("background-color",r)}})},getChartOption:function(){for(var a=this.panel.find(".chart-table-height").val(),e=this.panel.find(".chart-table-width").val(),t=this.panel.find(".chart-table-offset-x").val(),l=this.panel.find(".chart-table-offset-y").val(),i=this.panel.find(".chart-table-top").val(),n=this.panel.find(".chart-table-bottom").val(),h=this.panel.find(".chart-table-left").val(),r=this.panel.find(".chart-table-right").val(),s=this.panel.find(".chart-table-x-axisLine").prop("checked"),o=this.panel.find(".chart-table-x-splitLine").prop("checked"),c=this.panel.find(".chart-table-y-axisLine").prop("checked"),d=this.panel.find(".chart-table-y-splitLine").prop("checked"),p=[],f=null,u=null,b=0;b<this.chartFields.length;++b)u=this.chartFields[b],null!=u&&(f=u.color,null!=f&&p.push(f.getHex()));var v=this.panel.find(".chart-opacity").html(),y=this.panel.find(".chart-table-show-label").prop("checked"),m={height:parseFloat(a),width:parseFloat(e),colors:p,offsetX:parseFloat(t),offsetY:parseFloat(l),left:parseFloat(h),right:parseFloat(r),top:parseFloat(i),bottom:parseFloat(n),showLabel:y,opacity:parseFloat(v),x_axisLine:s,x_splitLine:o,y_axisLine:c,y_splitLine:d};return m},getChartFields:function(){for(var a=[],e=null,t=0;t<this.chartFields.length;++t)e=this.chartFields[t],null!=e&&a.push(e.name);return a},addChart:function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var a=this.panel.find(".chart-table-name").val();if(""==a)return MapCloud.notify.showInfo("请输入专题图名称","Warning"),void this.panel.find(".chart-table-name").focus();var e=this.panel.find(".chart-base-layer").val();if(null==e||""==e)return void MapCloud.notify.showInfo("请选择底图","Warning");var t=this.panel.find(".chart-base-layer-fields").val();if(null==t||""==t)return void MapCloud.notify.showInfo("请选择空间字段","Warning");var l=this.dbName,i=this.tableName;if(null==l||null==i)return void MapCloud.notify.showInfo("请设置表格","Warning");var n=this.panel.find(".chart-table-fields").val();if(null==n||""==n)return void MapCloud.notify.showInfo("请设置关联字段","Warning");var h=this.getChartFields();if(null==h||0==h.length)return void MapCloud.notify.showInfo("请选择专题图字段","Warning");var r=this.getChartOption(),s=new GeoBeans.Layer.BarChartLayer(a,e,t,l,i,n,h,r);mapObj.addLayer(s,this.addChartLayer_callback)},addChartLayer_callback:function(a){if("success"==a){mapObj.draw();var e=MapCloud.bar_chart_panel,t=e.panel.find(".chart-table-name").val();e.chartLayer=mapObj.getLayer(t)}else MapCloud.notify.showInfo(a,"添加柱状图")},changeChartOption:function(){if(null!=this.chartLayer){var a=this.panel.find(".chart-table-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入专题图名称","Warning"),void this.panel.find(".chart-table-name").focus();var e=this.getChartOption(),t=this.getChartFields();this.chartLayer.setChartFields(t),this.chartLayer.setChartOption(e),this.chartLayer.setName(a),mapObj.draw()}},setChartLayer:function(a){if(this.chartLayer=a,null!=this.chartLayer){var e=this.chartLayer.name;this.panel.find(".chart-table-name").val(e);var t=this.chartLayer.getBaseLayer(),l=this.chartLayer.getBaseLayerField(),i=this.chartLayer.getDbName(),n=this.chartLayer.getTableName(),h=this.chartLayer.getTableField();this.dbName=i,this.tableName=n,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName),this.panel.find(".chart-table-fields option[value='"+h+"']").attr("selected",!0),this.panel.find(".chart-base-layer option[value='"+t+"']").attr("selected",!0),this.panel.find(".chart-base-layer-fields option[value='"+l+"']").attr("selected",!0);for(var r=this.chartLayer.getChartFields(),s=null,o=0;o<r.length;++o)s=r[o],this.panel.find(".list-group-item input[value='"+s+"']").attr("checked",!0);var c=this.chartLayer.getChartOption();if(null!=c){var d=c.height,p=c.width,f=c.colors,u=c.offsetX,b=c.offsetY,v=c.left,y=c.right,m=c.top,g=c.bottom,F=c.showLabel,L=c.opacity,C=c.x_axisLine,x=c.x_axisLabel,w=c.x_axisTick,k=c.x_splitLine,N=c.y_axisLine,_=c.y_axisLabel,O=c.y_axisTick,B=c.y_splitLine;this.panel.find(".chart-table-height").val(d),this.panel.find(".chart-table-width").val(p),this.panel.find(".chart-table-offset-x").val(u),this.panel.find(".chart-table-offset-y").val(b),this.panel.find(".chart-table-top").val(m),this.panel.find(".chart-table-bottom").val(g),this.panel.find(".chart-table-left").val(v),this.panel.find(".chart-table-right").val(y),this.panel.find(".chart-table-x-axisLine").prop("checked",C),this.panel.find(".chart-table-x-axisLabel").prop("checked",x),this.panel.find(".chart-table-x-axisTick").prop("checked",w),this.panel.find(".chart-table-x-splitLine").prop("checked",k),this.panel.find(".chart-table-y-axisLine").prop("checked",N),this.panel.find(".chart-table-y-axisLabel").prop("checked",_),this.panel.find(".chart-table-y-axisTick").prop("checked",O),this.panel.find(".chart-table-y-splitLine").prop("checked",B),this.panel.find(".chart-table-show-label").prop("checked",F),this.panel.find(".chart-opacity").html(L),this.panel.find("input.slider").slider("setValue",100*L);var M=null,$=null,s=null,T=null;this.chartFields=[];for(var o=0;o<r.length;++o)s=r[o],$=f[o],T=new GeoBeans.Color,T.setByHex($,L),M={name:s,color:T},this.chartFields.push(M);this.displayChartFields()}}}});
MapCloud.ChartPanel=MapCloud.Class(MapCloud.Panel,{chartLayer:null,dbName:null,tableName:null,styleMgr:null,initialize:function(a){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.panel.find("#chart_accordion").collapse(),this.registerEvent()},showPanel:function(){if("none"==this.panel.css("display")){this.cleanup(),this.panel.css("display","block"),this.panel.find(".panel-collapse").each(function(){$(this).hasClass("in")&&$(this).collapse("hide")});var a=this.panel.find(".panel-collapse").first();a.hasClass("in")||a.collapse("show"),this.showLayersTab();var e=styleManager.getColorMaps();this.getColorMaps_callback(e)}},hidePanel:function(){MapCloud.Panel.prototype.hidePanel.apply(this,arguments),MapCloud.refresh_panel.refreshPanel()},cleanup:function(){this.chartLayer=null,this.dbName=null,this.tableName=null,this.panel.find(".chart-table").val(""),this.panel.find(".chart-table-fields").empty(),this.panel.find(".chart-base-layer").empty(),this.panel.find(".chart-base-layer-fields").empty(),this.panel.find(".chart-table-name").val("分级图"),this.panel.find("#chart_style_fields").empty(),this.panel.find("input.slider").slider("setValue",100),this.panel.find("#chart_style_border_opacity").html("1"),this.panel.find("#chart_style_opacity").html("1")},setDataSet:function(a,e){this.dbName=a,this.tableName=e,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName)},registerEvent:function(){var a=this;this.panel.find(".btn-chose-chart").click(function(){MapCloud.vector_db_dialog.showDialog("range")}),this.panel.find(".chart-table-fields").change(function(){var e=$(this).val();null!=a.chartLayer&&a.chartLayer.setTableField(e)}),this.panel.find(".chart-base-layer").change(function(){var e=$(this).val();a.showBaseLayerFields(e),null!=a.chartLayer&&a.chartLayer.setBaseLayer(e)}),this.panel.find(".chart-base-layer-fields").change(function(){var e=$(this).val();null!=a.chartLayer&&a.chartLayer.setBaseLayerField(e)}),this.panel.find("#chart_style_fields").change(function(){var e=$(this).val();null!=a.chartLayer&&a.chartLayer.setChartFields([e])}),this.panel.find(".btn-cancel").click(function(){a.hidePanel()}),this.panel.find(".btn-add-chart").click(function(){null==a.chartLayer?a.addChart():a.changeChartOption(),MapCloud.refresh_panel.refreshPanel()}),this.panel.find(".form-group-fill-opacity .slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(e){var l=e.value;a.panel.find("#chart_style_opacity").html(l/100)})}),this.panel.find(".form-group-border .slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(e){var l=e.value;a.panel.find("#chart_style_border_opacity").html(l/100)})}),this.panel.find(".form-group-border .colorSelector").each(function(){$(this).colpick({color:"cccccc",onChange:function(a,e,l,t,i){$(t).children().css("background-color","#"+e)},onSubmit:function(a,e,l,t,i){$(t).children().css("background-color","#"+e),$(t).colpickHide()}}),$(this).colpickSetColor("#ccc"),$(this).find("div").css("background-color","#ccc")}),this.panel.find(".panel-header").dblclick(function(){a.panel.css("display","none"),MapCloud.tools.showToolBox("chart")})},showLayersTab:function(){this.showBaseLayer(),this.showLabelLayer()},showBaseLayer:function(){if(null!=mapObj){for(var a=mapObj.getLayers(),e=null,l=null,t="",i=0;i<a.length;++i)e=a[i],e instanceof GeoBeans.Layer.DBLayer&&(e.geomType==GeoBeans.Geometry.Type.POLYGON||e.geomType==GeoBeans.Geometry.Type.MULTIPOLYGON)&&(l=e.name,t+="<option value='"+l+"'>"+l+"</option>");this.panel.find(".chart-base-layer").html(t);var n=this.panel.find(".chart-base-layer").val();this.showBaseLayerFields(n)}},showBaseLayerFields:function(a){var e=mapObj.getLayer(a);if(null!=e){var l=e.getFields();if(null!=l){for(var t=null,i=null,n="",r=0;r<l.length;++r)t=l[r],null!=t&&(i=t.name,n+="<option value ='"+i+"'>"+i+"</option>");this.panel.find(".chart-base-layer-fields").html(n)}}},showLabelLayer:function(){if(null!=mapObj){for(var a=mapObj.getLayers(),e=null,l=null,t="",i=0;i<a.length;++i)e=a[i],e instanceof GeoBeans.Layer.DBLayer&&(e.geomType==GeoBeans.Geometry.Type.POINT||e.geomType==GeoBeans.Geometry.Type.MULTIPOINT)&&(l=e.name,t+="<option value='"+l+"'>"+l+"</option>");this.panel.find(".chart-label-layer").html(t);var n=this.panel.find(".chart-label-layer").val();this.showLabelLayerFields(n)}},showLabelLayerFields:function(a){var e=mapObj.getLayer(a);if(null!=e){var l=e.getFields();if(null!=l){for(var t=null,i=null,n="",r=0;r<l.length;++r)t=l[r],null!=t&&(i=t.name,n+="<option value ='"+i+"'>"+i+"</option>");this.panel.find(".chart-label-layer-fields").html(n)}}},showTableFields:function(a,e){var l=new GeoBeans.WFSWorkspace("tmp",mapObj.server,"1.0.0"),t=new GeoBeans.FeatureType(l,e),i=t.getFields(null,a);if(null!=i){for(var n=null,r=null,o="",s=0;s<i.length;++s)n=i[s],null!=n&&(r=n.name,o+="<option value='"+r+"'>"+r+"</option>");this.panel.find(".chart-table-fields").html(o),this.showChartFields(i)}},showChartFields:function(a){if(null!=a){for(var e=null,l=null,t=null,i="",n=0;n<a.length;++n)e=a[n],null!=e&&(t=e.type,("double"==t||"int"==t||"float"==t)&&(l=e.name,i+="<option value='"+l+"'>"+l+"</option>"));this.panel.find("#chart_style_fields").html(i)}},getColorMaps_callback:function(a){if(null!=a){for(var e=MapCloud.chart_panel,l=null,t=null,i="",n=0;n<a.length;++n)l=a[n],t=l.url,i+="<li cid='"+l.id+"'>	<div class='color-ramp-item' style='background-image:	url("+t+")'>	</div></li>";if(e.panel.find(".color-ramp-div ul").html(i),l=a[0],null!=l){t=l.url;var r=l.id,o="<li cid='"+r+"'>	<div class='color-ramp-item' style='background-image:	url("+t+")'>	</div></li>";e.panel.find(".select-color-ramp").html(o)}e.panel.find(".color-ramp-div ul li").click(function(){var a=$(this).attr("cid");e.panel.find(".select-color-ramp li").attr("cid",a);var l=$(this).find(".color-ramp-item").css("background-image");e.panel.find(".select-color-ramp li .color-ramp-item").css("background-image",l)})}},addChart:function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空");var a=this.panel.find(".chart-base-layer").val(),e=mapObj.getLayer(a);if(null==e)return void MapCloud.notify.showInfo("选择一个有效的底图","Waring");var l=this.panel.find(".chart-table-name").val();if(null==l||""==l)return void MapCloud.notify.showInfo("请输入图表名称","Waring");var t=this.panel.find(".chart-base-layer-fields").val();if(null==t||""==t)return void MapCloud.notify.showInfo("请选择空间字段","Warning");var i=this.dbName,n=this.tableName;if(null==i||null==n)return void MapCloud.notify.showInfo("请设置表格","Warning");var r=this.panel.find(".chart-table-fields").val();if(null==r||""==r)return void MapCloud.notify.showInfo("请设置关联字段","Warning");var o=this.panel.find("#chart_style_fields").val();if(null==o||""==o)return void MapCloud.notify.showInfo("请设置分级图字段","Warning");var s=this.panel.find(".chart-label-layer").val(),h=this.panel.find(".chart-label-layer-fields").val(),c=this.getChartOption(),e=new GeoBeans.Layer.RangeChartLayer(l,a,t,i,n,r,[o],c,s,h);mapObj.addLayer(e,this.addChartLayer_callback)},addChartLayer_callback:function(a){if("success"==a){mapObj.draw();var e=MapCloud.chart_panel,l=e.panel.find(".chart-table-name").val();e.chartLayer=mapObj.getLayer(l)}else MapCloud.notify.showInfo(a,"添加分级图")},changeChartOption:function(){if(null!=this.chartLayer){var a=this.panel.find(".chart-table-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入分级图名称","Warning"),void this.panel.find(".chart-table-name").focus();var e=this.getChartOption();this.chartLayer.setChartOption(e),this.chartLayer.setName(a),mapObj.draw()}},getChartOption:function(){var a=this.panel.find(".form-group-border .colorSelector div").css("background-color"),e=new GeoBeans.Color;e.setByRgb(a,1);var l=e.getHex(),t=this.panel.find("#chart_style_border_opacity").html(),i=this.panel.find("#chart_style_opacity").html(),n=this.panel.find(".select-color-ramp li").attr("cid"),r={colorMapID:n,opacity:i,border:l,borderOpacity:parseFloat(t)};return r},setChartLayer:function(a){if(this.chartLayer=a,null!=this.chartLayer){var e=this.chartLayer.name;this.panel.find(".chart-table-name").val(e);var l=this.chartLayer.getBaseLayer(),t=this.chartLayer.getBaseLayerField(),i=this.chartLayer.getDbName(),n=this.chartLayer.getTableName(),r=this.chartLayer.getTableField();this.dbName=i,this.tableName=n,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName),this.panel.find(".chart-table-fields option[value='"+r+"']").attr("selected",!0),this.panel.find(".chart-base-layer option[value='"+l+"']").attr("selected",!0),this.panel.find(".chart-base-layer-fields option[value='"+t+"']").attr("selected",!0);var o=this.chartLayer.getChartFields(),s=o[0];this.panel.find("#chart_style_fields option[value='"+s+"']").attr("selected",!0);var h=this.chartLayer.getChartOption(),c=h.colorMapID,d=h.border,p=h.borderOpacity,f=h.opacity;this.panel.find(".form-group-fill-opacity input.slider").slider("setValue",100*f),f=parseFloat(f),this.panel.find("#chart_style_opacity").html(f.toFixed(2)),this.panel.find(".form-group-border input.slider").slider("setValue",100*p),p=parseFloat(p),this.panel.find("#chart_style_border_opacity").html(p.toFixed(2)),this.panel.find(".form-group-border .colorSelector").colpickSetColor(d);color.getRgba();this.panel.find(".form-group-border .colorSelector div").css("background-color",d),this.panel.find(".form-group-border .colorSelector div").css("opacity",p),c=parseInt(c),this.panel.find(".select-color-ramp li").attr("cid",c);var u=this.panel.find(".dropdown-menu li[cid='"+c+"']"),y=u.find(".color-ramp-item").css("background-image");this.panel.find(".select-color-ramp li .color-ramp-item").css("background-image",y)}}});
MapCloud.ClusterChartPanel=MapCloud.Class(MapCloud.Panel,{chartLayer:null,initialize:function(){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerPanelEvent()},cleanup:function(){this.chartLayer=null,this.panel.find(".chart-layers-field").empty(),this.panel.find(".chart-table-name").val("点聚合图"),this.panel.find(".form-group-color input.slider").slider("setValue",100),this.panel.find(".form-group-border input.slider").slider("setValue",100),this.panel.find(".form-group-color .color-opacity").html(1),this.panel.find(".form-group-border .border-color-opacity").html(1),this.panel.find(".colorSelector").colpickSetColor("#EEEEEE"),this.panel.find(".colorSelector div").css("background-color","#EEEEEE"),this.panel.find(".colorSelector div").css("opacity",1)},showPanel:function(){MapCloud.Panel.prototype.showPanel.apply(this,arguments),this.showLayers()},registerPanelEvent:function(){var e=this;this.panel.find(".btn-add-chart").click(function(){null==e.chartLayer?e.addChart():e.changeChartOption(),MapCloud.refresh_panel.refreshPanel()}),this.panel.find(".btn-cancel").click(function(){e.hidePanel()}),this.panel.find(".colorSelector").each(function(){$(this).colpick({color:"EEEEEE",onChange:function(e,a,r,n,o){$(n).children().css("background-color","#"+a)},onSubmit:function(e,a,r,n,o){$(n).children().css("background-color","#"+a),$(n).colpickHide()}})}),this.panel.find(".form-group-color .slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(a){var r=a.value;e.panel.find(".color-opacity").html(r/100);var n=$(this).parent().prev().find(".colorSelector div");n.css("opacity",r/100)})}),this.panel.find(".form-group-border .slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(a){var r=a.value;e.panel.find(".border-color-opacity").html(r/100);var n=$(this).parent().prev().find(".colorSelector div");n.css("opacity",r/100)})})},showLayers:function(){if(null!=mapObj){for(var e=mapObj.getLayers(),a=null,r=null,n="",o=0;o<e.length;++o)a=e[o],null!=a&&null!=a&&a instanceof GeoBeans.Layer.DBLayer&&a.geomType==GeoBeans.Geometry.Type.POINT&&(r=a.name,n+="<option value='"+r+"'>"+r+"</option>");this.panel.find(".chart-layers-field").html(n)}},addChart:function(){var e=this.panel.find(".chart-table-name").val();if(null==e)return void MapCloud.notify.showInfo("请输入专题图名称","Warning");var a=this.panel.find(".chart-layers-field").val();if(null==a)return void MapCloud.notify.showInfo("请选择一个进行聚合的点图层","Warning");var r=mapObj.getLayer(a),n=this.getSymbolizer(),o=new GeoBeans.Layer.ClusterLayer(e,r,n);mapObj.addLayer(o,this.addLayer_callback)},addLayer_callback:function(e){if("success"==e){mapObj.draw();var a=MapCloud.cluster_chart_panel,r=a.panel.find(".chart-table-name").val();a.chartLayer=mapObj.getLayer(r)}else MapCloud.notify.showInfo(e,"注册专题图")},setLayer:function(e){if(null!=e){this.chartLayer=e;var a=this.chartLayer.name;this.panel.find(".chart-table-name").val(a);var r=this.chartLayer.sourceLayer;if(null!=r){var n=r.name;this.panel.find(".chart-layers-field option[value='"+n+"']").attr("selected",!0)}}},changeChartOption:function(){var e=this.panel.find(".chart-table-name").val();if(null==e)return void MapCloud.notify.showInfo("请输入专题图名称","Warning");var a=this.panel.find(".chart-layers-field").val();if(null==a)return void MapCloud.notify.showInfo("请选择一个进行聚合的点图层","Warning");if(null!=this.chartLayer){this.chartLayer.setName(e);var r=mapObj.getLayer(a);this.chartLayer.setLayer(r);var n=this.getSymbolizer();this.chartLayer.setSymbolizer(n),mapObj.draw()}},getSymbolizer:function(){var e=new GeoBeans.Symbolizer.PolygonSymbolizer,a=this.panel.find(".form-group-color .colorSelector div"),r=a.css("opacity"),n=a.css("background-color"),o=new GeoBeans.Color;o.setByRgb(n,r),e.fill.color=o;var l=this.panel.find(".form-group-border .colorSelector div"),t=l.css("opacity"),i=l.css("background-color"),o=new GeoBeans.Color;return o.setByRgb(i,t),e.stroke.color=o,e}});
MapCloud.DataGrid=MapCloud.Class({panel:null,controlPanel:null,maxFeatures:20,layer:null,features:null,query_function:null,output_function:null,initialize:function(t,n){this.panel=$("#"+t),this.controlPanel=$("#"+n),this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),this.registerExpand(),this.registerPageEvent()},cleanup:function(){this.panel.find("#datagrid_content table tbody").html(""),this.panel.find("#datagrid_content table thead tr").html(""),this.panel.find(".query_count").html("0"),this.panel.find(".pages-form-page").val("0"),this.panel.find(".pages-form-pages").html("0"),this.features=null,this.layer=null},showPanel:function(){this.panel.css("display","block"),this.controlPanel.css("display","none")},hidePanel:function(){this.panel.css("display","none"),this.controlPanel.css("display","none")},registerExpand:function(){var t=!0,n=this;this.panel.find(".panel-header-collapse").click(function(){t?(n.showPanel(),t=!1):(n.hidePanel(),t=!0)}),this.panel.find(".close").click(function(){n.panel.css("display","none"),n.controlPanel.css("display","none")}),this.controlPanel.find(".btn").click(function(){n.showPanel()}),this.panel.find(".btn-hide").click(function(){n.panel.css("display","none"),n.controlPanel.css("display","block")})},registerPageEvent:function(){var t=this;this.panel.find(".glyphicon-step-backward").each(function(){$(this).click(function(){var n=parseInt(t.panel.find(".pages-form-pages").html());n>=1&&t.setPage(1)})}),this.panel.find(".glyphicon-step-forward").each(function(){$(this).click(function(){var n=parseInt(t.panel.find(".pages-form-pages").html());n>=1&&t.setPage(n)})}),this.panel.find(".glyphicon-chevron-left").each(function(){$(this).click(function(){var n=parseInt(t.panel.find(".pages-form-page").val());t.setPage(n-1)})}),this.panel.find(".glyphicon-chevron-right").each(function(){$(this).click(function(){var n=parseInt(t.panel.find(".pages-form-page").val());t.setPage(n+1)})}),this.panel.find(".download-features").click(function(){if(null!=t.output_function){var n=t.output_function();window.open(n,"_blank")}}),this.panel.find(".clear-features").click(function(){mapObj.endQuery(),t.cleanup()})},showFeatures:function(t){if(null!=t){this.features=t;var n=null,e=t[0];if(null!=e&&(n=e.featureType),null!=n){var a=n.getFields();null!=a&&(this.setFieldsHtml(a),this.setValuesHtml(t))}}},setFieldsHtml:function(t){for(var n="",e=null,a=null,n="",l=0,i=0;i<t.length;++i)e=t[i],"geometry"!=e.type&&(a=e.name,n+="<th width='80'>"+a+"</th>",l+=1);this.panel.find("#datagrid_content table thead tr").html(n)},setValuesHtml:function(t){html="";for(var n=null,e=null,a=null,l=0;l<t.length;++l)if(n=t[l],null!=n&&(e=n.values,null!=e)){html+="<tr index='"+l+"'>";for(var i=0;i<e.length;++i)a=e[i],a instanceof GeoBeans.Geometry||(html+="<td>"+a+"</td>");html+="</tr>"}this.panel.find("#datagrid_content table tbody").html(html),this.registerFeatureSelected()},setQuery:function(t,n,e){if(null!=t&&null!=n){if(this.layer=t,this.query_function=e,0==n)return this.clearData(),void this.showPanel();this.panel.find(".query_count").html(n);var a=Math.ceil(n/this.maxFeatures);this.panel.find(".pages-form-pages").html(a),this.panel.find("#datagrid_content table thead tr").html(""),this.panel.find("#datagrid_content table tbody").html(""),this.setPage(1),this.showPanel()}},setOutput:function(t){this.output_function=t},setPage:function(t){var n=parseInt(this.panel.find(".pages-form-pages").html());if(this.panel.find(".pages-form-page").val(t),1==t?this.panel.find(".glyphicon-step-backward").addClass("disabled"):this.panel.find(".glyphicon-step-backward").removeClass("disabled"),t==n?this.panel.find(".glyphicon-step-forward").addClass("disabled"):this.panel.find(".glyphicon-step-forward").removeClass("disabled"),0>=t-1?this.panel.find(".glyphicon-chevron-left").addClass("disabled"):this.panel.find(".glyphicon-chevron-left").removeClass("disabled"),t+1>n?this.panel.find(".glyphicon-chevron-right").addClass("disabled"):this.panel.find(".glyphicon-chevron-right").removeClass("disabled"),!(0>t||t>n)){var e=(t-1)*this.maxFeatures,a=this.query_function(this.maxFeatures,e);this.showFeatures(a)}},clearData:function(){this.panel.find("#datagrid_content table thead tr").html(""),this.panel.find("#datagrid_content table tbody").html(""),this.panel.find(".query_count").html("0"),this.panel.find(".pages-form-page").val(0),this.panel.find(".pages-form-pages").html("0")},registerFeatureSelected:function(){var t=this;this.panel.find("#datagrid_content table tbody tr").each(function(){$(this).click(function(){$(this).parents("tbody").children().removeClass("selected"),$(this).addClass("selected");var n=$(this).attr("index"),e=t.features[n];null!=e&&mapObj.setFeatureBlink(e,3)})})}});
MapCloud.DataSourcePanel=MapCloud.Class(MapCloud.Panel,{initialize:function(a){MapCloud.Panel.prototype.initialize.apply(this,arguments)},showPanel:function(){"none"==this.panel.css("display")&&(this.cleanup(),this.panel.css("display","block"),this.getDataSources()),this.registerPanelEvent()},cleanup:function(){this.panel.find(".db-list").empty(),this.panel.find(".table-tree").empty()},registerPanelEvent:function(){var a=this;this.panel.find(".db-list").change(function(){var t=$(this).val();a.getDataSource(t)}),this.panel.find(".btn-refresh").click(function(){a.refresh()}),this.panel.find(".btn-upload").click(function(){MapCloud.import_dialog.showDialog("dataPanel");var t=a.panel.find(".db-list").val();MapCloud.import_dialog.setDataSourceName(t)})},getDataSources:function(){dbsManager.getDataSources(this.getDataSources_callback,"Feature")},refresh:function(){var a=this.panel.find(".db-list").val();this.getDataSource(a)},getDataSources_callback:function(a){MapCloud.notify.hideLoading();var t=MapCloud.data_source_panel;t.showDataSources(a)},showDataSources:function(a){if(null!=a){for(var t=null,e=null,l="",n=a.length-1;n>=0;--n)t=a[n],null!=t&&(e=t.name,l+="<option value='"+e+"'>"+e+"</option>");this.panel.find(".db-list").html(l);var i=this.panel.find(".db-list").val();null!=i&&""!=i&&this.getDataSource(i)}},getDataSource:function(a){this.panel.find(".table-tree").empty(),MapCloud.notify.loading(),dbsManager.getDataSource(a,this.getDataSource_callback)},getDataSource_callback:function(a){var t=MapCloud.data_source_panel;t.getDataSets(a)},getDataSets:function(a){null!=a&&a.getDataSets(this.getDataSets_callback)},getDataSets_callback:function(a){MapCloud.notify.hideLoading();var t=MapCloud.data_source_panel;t.showDataSets(a)},showDataSets:function(a){if(null!=a){for(var t="",e=null,l=null,n=null,i="",o=0;o<a.length;++o)e=a[o],null!=e&&(n=e.name,l=e.geometryType,i=MapCloud.vector_db_dialog.getDataSetGeomTypeHtml(l),t+="<div class='row' lname='"+n+"'><div class='col-md-1'>"+i+"</div><div class='col-md-9'>"+n+"</div><div class='col-md-1'>",null!=l&&(t+="<div class='fa fa-plus mc-icon add_layer'  	data-toggle='tooltip' data-placement='top' data-original-title='添加到地图'></div>"),t+="</div></div>");this.panel.find(".table-tree").html(t),this.panel.find("[data-toggle='tooltip']").tooltip({container:"body"});var s=this;this.panel.find(".table-tree .add_layer").click(function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var a=$(this).parents(".row").attr("lname");if(null==a)return void MapCloud.notify.showInfo("图层为空","Warning");var t=s.panel.find(".db-list").val(),e=new GeoBeans.Layer.FeatureDBLayer(a,null,t,a,null,null);MapCloud.notify.loading(),mapObj.insertLayer(e,s.addLayer_callback)})}},addLayer_callback:function(a){MapCloud.data_source_panel;MapCloud.notify.showInfo(a,"注册图层"),"success"==a.toLowerCase()&&MapCloud.refresh_panel.refreshPanel()}});
MapCloud.GPSOperPanel=MapCloud.Class(MapCloud.Panel,{initialize:function(a){MapCloud.Panel.prototype.initialize.apply(this,arguments);var e=this;this.panel.find(".btn-hide").click(function(){var a=e.panel.find(".panel-content");"600px"==a.css("height")?(a.css("height","0px"),e.panel.css("border-bottom","none")):(a.css("height","600px"),e.panel.css("border-bottom","1px solid #d3d3d3"))})},showPanel:function(){"none"==this.panel.css("display")&&(this.cleanup(),this.panel.css("display","block"),gpsManager.getCapabilities(this.getCapabilities_callback))},getCapabilities_callback:function(a){var e=MapCloud.gps_oper_panel;e.showOperList(a)},showOperList:function(a){if(null!=a){for(var e='<ul class="nav gps-oper-nav">',s=null,l=null,o=null,i=0;i<a.length;++i)if(set=a[i],null!=set&&(description=set.description,e+='<li>	<a href="javascript:void(0)" class="gps-oper-set">		<i class="fa fa-inbox"></i>		<span>'+description+"</span>	</a>",s=set.operList,null!=s)){e+='<ul class="nav">';for(var t=0;t<s.length;++t)if(l=s[t],null!=l){o=l.name;var p=l.alias;e+='<li>	<a href="javascript:void(0)" class="gps-oper" oname="'+o+'">		<i class="fa fa-wrench"></i>		<span>'+p+"</span>	</a></li>"}e+="</ul>",e+="</li>"}e+="</ul>",this.panel.find(".panel-content").html(e),this.registerEvent()}},registerEvent:function(){var a=this;this.panel.find(".gps-oper").click(function(){a.panel.find(".gps-oper.selected").removeClass("selected"),$(this).addClass("selected")}).dblclick(function(){var e=$(this).attr("oname");a.showOperDialog(e)}),this.panel.find(".gps-oper-set").click(function(){var a=$(this).parent().find("ul");"none"==a.css("display")?a.slideDown():a.css("display","block")&&a.slideUp()})},showOperDialog:function(a){if(null!=a){var e=null;switch(a){case"FeatureImport":e=MapCloud.gps_feature_import_dialog;break;case"FeatureProject":e=MapCloud.gps_feature_project_dialog;break;case"CsvImport":e=MapCloud.gps_csv_import_dialog;break;case"RasterEdgeDetect":e=MapCloud.gps_raster_edge_detect_dialog;break;case"RasterExtractByRectangle":e=MapCloud.gps_raster_extract_dialog;break;case"RasterReverse":e=MapCloud.gps_raster_reverse_dialog;break;case"RasterGraylize":e=MapCloud.gps_raster_graylize_dialog;break;case"RasterSmooth":e=MapCloud.gps_raster_smooth_dialog;break;case"RasterStretch":e=MapCloud.gps_raster_stretch_dialog;break;case"RasterSubtract":e=MapCloud.gps_raster_subtract_dialog;break;case"RasterPixelBlend":e=MapCloud.gps_raster_pixel_blend_dialog;break;case"RasterThreshold":e=MapCloud.gps_raster_threshold_dialog;break;case"RasterHistogramEqualization":e=MapCloud.gps_raster_his_equal_dialog;break;case"RasterSepiaTone":e=MapCloud.gps_raster_sepia_tone_dialog;break;case"DemSlope":e=MapCloud.gps_dem_slope_dialog;break;case"DemAspect":e=MapCloud.gps_dem_aspect_dialog;break;case"DemStretch":e=MapCloud.gps_dem_stretch_dialog;break;case"DemHillshade":e=MapCloud.gps_dem_hillshade_dialog;break;case"Delaunay":e=MapCloud.gps_delaunay_dialog;break;case"GetArea":e=MapCloud.gps_get_area_dialog;break;case"GetLength":e=MapCloud.gps_get_length_dialog;break;case"Buffer":e=MapCloud.gps_buffer_dialog;break;case"Centroid":e=MapCloud.gps_centroid_dialog;break;case"ConvexHull":e=MapCloud.gps_convex_hull_dialog;break;case"MultiPointToPoints":e=MapCloud.gps_multi_point_to_points_dialog;break;case"LineToPoints":e=MapCloud.gps_line_to_points_dialog;break;case"PolygonToPoints":e=MapCloud.gps_polygon_to_points_dialog;break;case"PolygonToLine":e=MapCloud.gps_polygon_to_line_dialog;break;case"BuildPyramid":e=MapCloud.gps_build_pyramid_dialog;break;case"GenerateRandomPoints":e=MapCloud.gps_gen_random_points_dialog;break;case"GenerateRandomPointsInPolygon":e=MapCloud.gps_gen_random_points_in_polygon_dialog;break;case"UpdateTile":e=MapCloud.gps_update_tile_dialog;break;case"KMean":e=MapCloud.gps_kmean_dialog}null!=e&&e.showDialog()}}});
MapCloud.MapBar=MapCloud.Class({panel:null,initialize:function(){this.panel=$("#map_bar_wrapper"),this.registerBarEvents()},registerBarEvents:function(){this.panel.find("[data-toggle='tooltip']").tooltip({container:"body"});var e=this;this.panel.find(".mc-icon").each(function(a,n){$(this).click(function(){switch(a){case 0:e.onStretch(this);break;case 1:e.onArea();break;case 2:e.onPolygon();break;case 3:e.onLine();break;case 4:break;case 5:break;case 6:e.onFeatureInfo();break;case 7:e.endQuery();break;case 8:e.onMapGlobe();break;case 9:break;case 10:break;case 11:e.onZoomIn();break;case 12:e.onZoomOut();break;case 12:}})})},onArea:function(){var e=$("#layers_row .layer_row_selected").attr("lname");if(null==e||""==e)return void MapCloud.notify.showInfo("请选择图层","Warning");var a=mapObj.getLayer(e);return null==a||a.type!=GeoBeans.Layer.DBLayer.Type.Feature?void MapCloud.notify.showInfo("请选择一个矢量图层","Warning"):(this.panel.find(".mc-icon").removeClass("active"),this.panel.find(".mc-icon-area").addClass("active"),void mapObj.queryByRect(e,this.query_callback))},query_callback:function(e,a){var n=MapCloud.mapBar;MapCloud.dataGrid.setQuery(e,a,n.query_function),MapCloud.dataGrid.setOutput(n.output_function)},query_function:function(e,a){var n=mapObj.queryByRectPage(e,a);return n},output_function:function(){var e=mapObj.queryByRectOutput(null,null);return e},onPolygon:function(){var e=$("#layers_row .layer_row_selected").attr("lname");if(null==e||""==e)return void MapCloud.notify.showInfo("请选择图层","Warning");var a=mapObj.getLayer(e);return null==a||a.type!=GeoBeans.Layer.DBLayer.Type.Feature?void MapCloud.notify.showInfo("请选择一个矢量图层","Warning"):(this.panel.find(".mc-icon").removeClass("active"),this.panel.find(".mc-icon-polygon").addClass("active"),void mapObj.queryByPolygon(e,this.queryByPolygon_callback))},queryByPolygon_callback:function(e,a){var n=MapCloud.mapBar;MapCloud.dataGrid.setQuery(e,a,n.queryByPolygon_function),MapCloud.dataGrid.setOutput(n.queryByPolygonOutput_function)},queryByPolygon_function:function(e,a){var n=mapObj.queryByPolygonPage(e,a);return n},queryByPolygonOutput_function:function(){var e=mapObj.queryByPolygonOutput(null,null);return e},onLine:function(){var e=$("#layers_row .layer_row_selected").attr("lname");if(null==e||""==e)return void MapCloud.notify.showInfo("请选择图层","Warning");var a=mapObj.getLayer(e);return null==a||a.type!=GeoBeans.Layer.DBLayer.Type.Feature?void MapCloud.notify.showInfo("请选择一个矢量图层","Warning"):(this.panel.find(".mc-icon").removeClass("active"),this.panel.find(".mc-icon-polygon").addClass("active"),void mapObj.queryByLine(e,this.queryByLine_callback))},queryByLine_callback:function(e,a){var n=MapCloud.mapBar;MapCloud.dataGrid.setQuery(e,a,n.queryByLine_function),MapCloud.dataGrid.setOutput(n.queryByLineOutput_function)},queryByLine_function:function(e,a){var n=mapObj.queryByLinePage(e,a);return n},queryByLineOutput_function:function(){var e=mapObj.queryByLineOutput(null,null);return e},onFeatureInfo:function(){var e=$("#layers_row .layer_row_selected").attr("lname");if(null==e||""==e)return void MapCloud.notify.showInfo("请选择图层","Warning");var a=mapObj.getLayer(e);return null==a||a.type!=GeoBeans.Layer.DBLayer.Type.Feature?void MapCloud.notify.showInfo("请选择一个矢量图层","Warning"):(this.panel.find(".mc-icon").removeClass("active"),this.panel.find(".mc-icon-info").addClass("active"),void mapObj.queryByClick(e,this.onFeatureInfo_callback))},onFeatureInfo_callback:function(e,a,n){if(null!=a&&null!=e){var o=e.getFields();if(null!=o){var t=a.values;if(null!=t){for(var l="<div style='width:220px;max-height:280px;overflow-x:hidden'><table class='table table-striped' ><thead><tr><th>Field</th><th>Value</th></tr></thead><tbody>",r=0;r<o.length;++r)field=o[r],null!=field&&(type=field.type,"geometry"!=type&&(name=field.name,value=t[r],l+="<tr>	<td>"+name+"</td>	<td>"+value+"</td>	</tr>"));l+="</tbody>",l+="</table>",l+="</div>";var i={title:e.name},u=new GeoBeans.InfoWindow(l,i);mapObj.openInfoWindow(u,n)}}}},endQuery:function(){null!=mapObj&&(this.panel.find(".mc-icon").removeClass("active"),this.panel.find(".mc-icon-mouse").addClass("active"),mapObj.endQuery(),MapCloud.dataGrid.cleanup(),mapObj.endZoom())},onMapGlobe:function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void mapManager.zoomToGlobeMap(mapObj,this.zoomToGlobeMap_callback)},onStretch:function(e){var a=$(e).find("a.btn i");a.hasClass("fa-angle-double-left")?(a.removeClass("fa-angle-double-left"),a.addClass("fa-angle-double-right"),this.panel.children().not(".control-icon").css("display","none"),this.panel.css("width","30px")):a.hasClass("fa-angle-double-right")&&(a.removeClass("fa-angle-double-right"),a.addClass("fa-angle-double-left"),this.panel.children().not(".control-icon").css("display","block"),this.panel.css("width","422px"))},returnEndQuery:function(){this.endQuery(),this.panel.find(".mc-icon").removeClass("active"),this.panel.find(".mc-icon-mouse").addClass("active")},zoomToGlobeMap_callback:function(e){MapCloud.notify.showInfo(e,"全图显示"),MapCloud.refresh_panel.refreshPanel()},onZoomIn:function(){null!=mapObj&&mapObj.zoomIn()},onZoomOut:function(){mapObj.zoomOut()}});
MapCloud.PieChartPanel=MapCloud.Class(MapCloud.Panel,{chartLayer:null,dbName:null,tableName:null,chartFields:null,initialize:function(a){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerEvent()},showPanel:function(){if("none"==this.panel.css("display")){this.cleanup(),this.panel.css("display","block"),this.panel.find(".panel-collapse").each(function(){$(this).hasClass("in")&&$(this).collapse("hide")});var a=this.panel.find(".panel-collapse").first();a.hasClass("in")||a.collapse("show"),this.showLayerTab()}},hidePanel:function(){MapCloud.Panel.prototype.hidePanel.apply(this,arguments),MapCloud.refresh_panel.refreshPanel()},cleanup:function(){this.chartLayer=null,this.chartFields=[],this.dbName=null,this.tableName=null,this.panel.find(".form-group-field").remove(),this.panel.find(".chart-table").val(""),this.panel.find(".chart-table-fields").empty(),this.panel.find(".chart-base-layer").empty(),this.panel.find(".chart-base-layer-fields").empty(),this.panel.find(".chart-table-name").val("饼状图"),this.panel.find(".chart-table-radius").val("40"),this.panel.find(".chart-table-offset-x").val("0"),this.panel.find(".chart-table-offset-y").val("0"),this.panel.find(".chart-table-show-label").prop("checked",!1),this.panel.find(".chart-fields").empty(),this.panel.find("input.slider").slider("setValue",100),this.panel.find(".chart-opacity").html("1")},registerEvent:function(){var a=this;this.panel.find('[data-toggle="tooltip"]').tooltip(),this.panel.find(".btn-chose-chart").click(function(){MapCloud.vector_db_dialog.showDialog("pie")}),this.panel.find(".chart-base-layer").change(function(){var e=$(this).val();a.showFields(),null!=a.chartLayer&&a.chartLayer.setBaseLayer(e)}),this.panel.find(".chart-base-layer-fields").change(function(){var e=$(this).val();null!=a.chartLayer&&a.chartLayer.setBaseLayerField(e)}),this.panel.find(".chart-table-fields").change(function(){var e=$(this).val();null!=a.chartLayer&&a.chartLayer.setTableField(e)}),this.panel.find(".slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(e){var t=e.value;a.panel.find(".chart-opacity").html(t/100),a.changeOpacity(t/100),a.changeDisplayOpacity()})}),this.panel.find(".btn-cancel").click(function(){a.hidePanel()}),this.panel.find(".btn-add-chart").click(function(){null==a.chartLayer?a.addChart():a.changeChartOption(),MapCloud.refresh_panel.refreshPanel()}),this.panel.find(".panel-header").dblclick(function(){a.panel.css("display","none"),MapCloud.tools.showToolBox("pieChart")})},showLayerTab:function(){if(null!=mapObj){for(var a=mapObj.getLayers(),e=null,t="",l=null,i=0;i<a.length;++i)e=a[i],null!=e&&e instanceof GeoBeans.Layer.DBLayer&&e.geomType==GeoBeans.Geometry.Type.POINT&&(l=e.name,t+="<option value='"+l+"'>"+l+"</option>");this.panel.find(".chart-base-layer").html(t);var n=this.panel.find(".chart-base-layer").val();this.showFields(n)}},showFields:function(a){var e=mapObj.getLayer(a);if(null!=e){var t=e.getFields();if(null!=t){for(var l=null,i=null,n="",r=0;r<t.length;++r)l=t[r],null!=l&&(i=l.name,n+="<option value ='"+i+"'>"+i+"</option>");this.panel.find(".chart-base-layer-fields").html(n)}}},setDataSet:function(a,e){this.dbName=a,this.tableName=e,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName),null!=this.chartLayer&&(this.chartLayer.setDbName(this.dbName),this.chartLayer.setTableName(this.tableName))},showTableFields:function(a,e){var t=new GeoBeans.WFSWorkspace("tmp",mapObj.server,"1.0.0"),l=new GeoBeans.FeatureType(t,e),i=l.getFields(null,a);if(null!=i){for(var n=null,r=null,s="",h=0;h<i.length;++h)n=i[h],null!=n&&(r=n.name,s+="<option value='"+r+"'>"+r+"</option>");this.panel.find(".chart-table-fields").html(s),this.showChartFields(i)}},showChartFields:function(a){for(var e=null,t=null,l="<list-group>",i=null,n=0;n<a.length;++n)e=a[n],null!=e&&(i=e.type,("int"==i||"float"==i||"double"==i)&&(t=e.name,l+="<a href='#' class='list-group-item'>"+t+"<input type='checkbox' value='"+t+"'></a>"));this.panel.find(".chart-fields").html(l);var r=this,s=this.panel.find(".chart-fields .list-group-item input[type='checkbox']");s.change(function(){var a=$(this).val(),e=$(this).prop("checked");e?r.addChartField(a):r.removeChartField(a),r.displayChartFields()})},addChartField:function(a){if(null!=a){var e=new GeoBeans.Color,t=this.panel.find(".chart-opacity").html();e.setOpacity(parseFloat(t));var l={name:a,color:e};this.chartFields.push(l)}},removeChartField:function(a){if(null!=a)for(var e=null,t=null,l=0;l<this.chartFields.length;++l)e=this.chartFields[l],null!=e&&(t=e.name,t==a&&this.chartFields.splice(l,1))},getChartField:function(a){if(null==a)return null;for(var e=null,t=0;t<this.chartFields.length;++t)if(e=this.chartFields[t],null!=e&&e.name==a)return e;return null},changeChartFieldColor:function(a,e){if(null!=a)for(var t=$(a).parents(".form-group-field"),l=t.attr("fname"),i=null,n=0;n<this.chartFields.length;++n)i=this.chartFields[n],null!=i&&i.name==l&&(i.color=e)},changeOpacity:function(a){if(null!=a)for(var e=null,t=0;t<this.chartFields.length;++t)if(e=this.chartFields[t],null!=e){var l=e.color;null!=l&&l.setOpacity(a)}},changeDisplayOpacity:function(){var a=this;this.panel.find(".colorSelector").each(function(){var e=$(this).parents(".form-group-field"),t=e.attr("fname"),l=a.getChartField(t);if(null!=l){var i=l.color;$(this).find("div").css("background-color",i.getRgba())}})},displayChartFields:function(){for(var a=null,e=null,t="",l=0;l<this.chartFields.length;++l)a=this.chartFields[l],null!=a&&(e=a.name,t+="<div class='form-group form-group-sm form-group-field' fname='"+e+"'>	<div class='col-md-1 col-xs-1 col-md-offset-3 col-xs-offset-3'>		<div class='btn btn-default colorSelector'>			<div></div>		</div>	</div>	<div class='col-md-6 col-xs-6'>		<span>"+e+"		</span>	</div></div>");this.panel.find(".form-group-field").remove(),this.panel.find("#pie_chart_table_style_coll .panel-body .form-horizontal").append(t);var i=this;this.panel.find(".colorSelector").each(function(){$(this).colpick({color:"EEEEEE",onChange:function(a,e,t,l,n){var r=i.panel.find(".chart-opacity").html(),s=new GeoBeans.Color;s.setByHex("#"+e,parseFloat(r)),$(l).children().css("background-color",s.getRgba()),i.changeChartFieldColor(l,s)},onSubmit:function(a,e,t,l,n){var r=i.panel.find(".chart-opacity").html(),s=new GeoBeans.Color;s.setByHex("#"+e,parseFloat(r)),$(l).children().css("background-color",s.getRgba()),i.changeChartFieldColor(l,s),$(l).colpickHide()}});for(var a=$(this).parents(".form-group-field"),e=a.attr("fname"),t=null,l=null,n=0;n<i.chartFields.length;++n)t=i.chartFields[n],null!=t&&t.name==e&&(l=t.color);if(null!=l){var r=l.getHex();$(this).colpickSetColor(r);var s=l.getRgba();$(this).find("div").css("background-color",s)}})},getChartOption:function(){for(var a=this.panel.find(".chart-table-radius").val(),e=this.panel.find(".chart-table-offset-x").val(),t=this.panel.find(".chart-table-offset-y").val(),l=this.panel.find(".chart-opacity").html(),i=this.panel.find(".chart-table-show-label").prop("checked"),n=[],r=null,s=null,h=0;h<this.chartFields.length;++h)s=this.chartFields[h],null!=s&&(r=s.color,null!=r&&n.push(r.getHex()));var o={radius:parseFloat(a),colors:n,offsetX:parseFloat(e),offsetY:parseFloat(t),showLabel:i,opacity:parseFloat(l)};return o},getChartFields:function(){for(var a=[],e=null,t=0;t<this.chartFields.length;++t)e=this.chartFields[t],null!=e&&a.push(e.name);return a},addChart:function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var a=this.panel.find(".chart-table-name").val();if(""==a)return MapCloud.notify.showInfo("请输入专题图名称","Warning"),void this.panel.find(".chart-table-name").focus();var e=this.panel.find(".chart-base-layer").val();if(null==e||""==e)return void MapCloud.notify.showInfo("请选择底图","Warning");var t=this.panel.find(".chart-base-layer-fields").val();if(null==t||""==t)return void MapCloud.notify.showInfo("请选择空间字段","Warning");var l=this.dbName,i=this.tableName;if(null==l||null==i)return void MapCloud.notify.showInfo("请设置表格","Warning");var n=this.panel.find(".chart-table-fields").val();if(null==n||""==n)return void MapCloud.notify.showInfo("请设置关联字段","Warning");var r=this.getChartFields();if(null==r||0==r.length)return void MapCloud.notify.showInfo("请选择专题图字段","Warning");var s=this.getChartOption(),h=new GeoBeans.Layer.PieChartLayer(a,e,t,l,i,n,r,s);mapObj.addLayer(h,this.addChartLayer_callback)},addChartLayer_callback:function(a){if("success"==a){mapObj.draw();var e=MapCloud.pie_chart_panel,t=e.panel.find(".chart-table-name").val();e.chartLayer=mapObj.getLayer(t)}else MapCloud.notify.showInfo(a,"添加饼状图")},changeChartOption:function(){if(null!=this.chartLayer){var a=this.panel.find(".chart-table-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入专题图名称","Warning"),void this.panel.find(".chart-table-name").focus();var e=this.getChartOption(),t=this.getChartFields();this.chartLayer.setChartFields(t),this.chartLayer.setChartOption(e),this.chartLayer.setName(a),mapObj.draw()}},setChartLayer:function(a){if(this.chartLayer=a,null!=this.chartLayer){var e=this.chartLayer.name;this.panel.find(".chart-table-name").val(e);var t=this.chartLayer.getBaseLayer(),l=this.chartLayer.getBaseLayerField(),i=this.chartLayer.getDbName(),n=this.chartLayer.getTableName(),r=this.chartLayer.getTableField();this.dbName=i,this.tableName=n,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName),this.panel.find(".chart-table-fields option[value='"+r+"']").attr("selected",!0),this.panel.find(".chart-base-layer option[value='"+t+"']").attr("selected",!0),this.panel.find(".chart-base-layer-fields option[value='"+l+"']").attr("selected",!0);for(var s=this.chartLayer.getChartFields(),h=null,o=0;o<s.length;++o)h=s[o],this.panel.find(".list-group-item input[value='"+h+"']").attr("checked",!0);var c=this.chartLayer.getChartOption();if(null!=c){var d=c.radius,f=c.offsetX,p=c.offsetY,u=c.showLabel,v=c.opacity,y=c.colors;this.panel.find(".chart-table-radius").val(d),this.panel.find(".chart-table-offset-x").val(f),this.panel.find(".chart-table-offset-y").val(p),this.panel.find(".chart-table-show-label").prop("checked",u),this.panel.find(".chart-opacity").html(v),this.panel.find("input.slider").slider("setValue",100*v);var b=null,m=null,h=null,g=null;this.chartFields=[];for(var o=0;o<s.length;++o)h=s[o],m=y[o],g=new GeoBeans.Color,g.setByHex(m,v),b={name:h,color:g},this.chartFields.push(b);this.displayChartFields()}}}});
MapCloud.RangeSymbolChartPanel=MapCloud.Class(MapCloud.Panel,{dbName:null,tableName:null,chartLayer:null,initialize:function(e){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerEvent()},showPanel:function(){if("none"==this.panel.css("display")){this.cleanup(),this.panel.css("display","block"),this.panel.find(".panel-collapse").each(function(){$(this).hasClass("in")&&$(this).collapse("hide")});var e=this.panel.find(".panel-collapse").first();e.hasClass("in")||e.collapse("show");var a=styleManager.getColorMaps();this.getColorMaps_callback(a),this.showLayerTab()}},hidePanel:function(){MapCloud.Panel.prototype.hidePanel.apply(this,arguments),MapCloud.refresh_panel.refreshPanel()},cleanup:function(){this.dbName=null,this.tableName=null,this.chartLayer=null,this.panel.find(".chart-table-name").val("分级和等级符号图"),this.panel.find(".chart-table").val(""),this.panel.find(".chart-table-fields").empty(),this.panel.find(".r-chart-base-layer").empty(),this.panel.find(".r-chart-base-layer-fields").empty(),this.panel.find(".s-chart-base-layer").empty(),this.panel.find(".s-chart-base-layer-fields").empty(),this.panel.find("#r_chart_style_fields").empty(),this.panel.find("#s_chart_style_fields").empty(),this.panel.find(".colorSelector").colpickSetColor("#EEEEEE"),this.panel.find(".colorSelector div").css("background-color","#EEEEEE"),this.panel.find(".colorSelector div").css("opacity",1),this.panel.find("input.slider").slider("setValue",100),this.panel.find(".opacity-value").html(1),this.panel.find(".chart-table-max-size").val(2),this.panel.find(".form-group-choose-level input[type='checkbox']").prop("checked",!1),this.panel.find("#chart_table_level").prop("disabled",!0),this.panel.find("#chart_table_level option[value='4']").attr("selected",!0)},registerEvent:function(){var e=this;this.panel.find(".btn-chose-chart").click(function(){MapCloud.vector_db_dialog.showDialog("rs")}),this.panel.find(".colorSelector").each(function(){$(this).colpick({color:"EEEEEE",onChange:function(e,a,l,t,r){$(t).children().css("background-color","#"+a)},onSubmit:function(e,a,l,t,r){$(t).children().css("background-color","#"+a),$(t).colpickHide()}})}),this.panel.find(".form-group .slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(e){var a=e.value;$(this).parents(".control-label").next().html(a/100);var l=$(this).parent().prev().find(".colorSelector div");l.css("opacity",a/100)})}),this.panel.find(".r-chart-base-layer").change(function(){var a=$(this).val();e.showRangeBaseLayerFields(a)}),this.panel.find(".s-chart-base-layer").change(function(){var a=$(this).val();e.showSymbolBaseLayerFields(a)}),this.panel.find(".btn-cancel").click(function(){e.hidePanel()}),this.panel.find(".btn-add-chart").click(function(){null==e.chartLayer?e.addChart():e.changeChartOption(),MapCloud.refresh_panel.refreshPanel()}),this.panel.find(".form-group-choose-level input[type='checkbox']").change(function(){var a=$(this).prop("checked");a?e.panel.find("#chart_table_level").prop("disabled",!1):e.panel.find("#chart_table_level").prop("disabled",!0)})},setDataSet:function(e,a){this.dbName=e,this.tableName=a,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName)},showTableFields:function(e,a){var l=new GeoBeans.WFSWorkspace("tmp",mapObj.server,"1.0.0"),t=new GeoBeans.FeatureType(l,a),r=t.getFields(null,e);if(null!=r){for(var i=null,n=null,o="",s=0;s<r.length;++s)i=r[s],null!=i&&(n=i.name,o+="<option value='"+n+"'>"+n+"</option>");this.panel.find(".chart-table-fields").html(o),this.showChartFields(r)}},showLayerTab:function(){this.showRangeBaseLayer(),this.showSymbolBaseLayer()},showRangeBaseLayer:function(){if(null!=mapObj){for(var e=mapObj.getLayers(),a=null,l=null,t="",r=0;r<e.length;++r)a=e[r],a instanceof GeoBeans.Layer.DBLayer&&(a.geomType==GeoBeans.Geometry.Type.POLYGON||a.geomType==GeoBeans.Geometry.Type.MULTIPOLYGON)&&(l=a.name,t+="<option value='"+l+"'>"+l+"</option>");this.panel.find(".r-chart-base-layer").html(t);var i=this.panel.find(".r-chart-base-layer").val();this.showRangeBaseLayerFields(i)}},showRangeBaseLayerFields:function(e){var a=mapObj.getLayer(e);if(null!=a){var l=a.getFields();if(null!=l){for(var t=null,r=null,i="",n=0;n<l.length;++n)t=l[n],null!=t&&(r=t.name,i+="<option value ='"+r+"'>"+r+"</option>");this.panel.find(".r-chart-base-layer-fields").html(i)}}},showSymbolBaseLayer:function(){if(null!=mapObj){for(var e=mapObj.getLayers(),a=null,l="",t=null,r=0;r<e.length;++r)a=e[r],null!=a&&a instanceof GeoBeans.Layer.DBLayer&&a.geomType==GeoBeans.Geometry.Type.POINT&&(t=a.name,l+="<option value='"+t+"'>"+t+"</option>");this.panel.find(".s-chart-base-layer").html(l);var i=this.panel.find(".s-chart-base-layer").val();this.showSymbolBaseLayerFields(i)}},showSymbolBaseLayerFields:function(e){var a=mapObj.getLayer(e);if(null!=a){var l=a.getFields();if(null!=l){for(var t=null,r=null,i="",n=0;n<l.length;++n)t=l[n],null!=t&&(r=t.name,i+="<option value ='"+r+"'>"+r+"</option>");this.panel.find(".s-chart-base-layer-fields").html(i)}}},showChartFields:function(e){if(null!=e){for(var a=null,l=null,t=null,r="",i=0;i<e.length;++i)a=e[i],null!=a&&(t=a.type,("double"==t||"int"==t||"float"==t)&&(l=a.name,r+="<option value='"+l+"'>"+l+"</option>"));this.panel.find("#r_chart_style_fields,#s_chart_style_fields").html(r)}},addChart:function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var e=this.dbName,a=this.tableName;if(null==e||null==a)return void MapCloud.notify.showInfo("请设置表格","Warning");var l=this.panel.find(".chart-table-fields").val();if(null==l||""==l)return void MapCloud.notify.showInfo("请设置关联字段","Warning");var t=this.panel.find(".chart-table-name").val();if(""==t)return MapCloud.notify.showInfo("请输入专题图名称","Warning"),void this.panel.find(".chart-table-name").focus();var r=this.panel.find(".r-chart-base-layer").val();if(null==r||""==r)return void MapCloud.notify.showInfo("请选择面底图","Warning");var i=this.panel.find(".r-chart-base-layer-fields").val();if(null==i||""==i)return void MapCloud.notify.showInfo("请选择面底图的关联字段","Warning");var n=this.panel.find(".s-chart-base-layer").val();if(null==n||""==n)return void MapCloud.notify.showInfo("请选择点底图","Warning");var o=this.panel.find(".s-chart-base-layer-fields").val();if(null==o||""==o)return void MapCloud.notify.showInfo("请选择点底图的关联字段","Warning");var s=this.panel.find("#r_chart_style_fields").val();if(null==s||""==s)return void MapCloud.notify.showInfo("请选择分级图的字段","Warning");var h=this.panel.find("#s_chart_style_fields").val();if(null==h||""==h)return void MapCloud.notify.showInfo("请选择等级符号图的字段","Warning");var c=this.panel.find(".chart-table-max-size").val();if(null==c||""==c)return void MapCloud.notify.showInfo("请设置等级符号大小","Warning");var d=this.getRangeChartOption(),p=this.getSymbolChartOption(),f=new GeoBeans.Layer.RangeSymbolChartLayer(t,r,i,s,n,o,h,e,a,l,d,p);mapObj.addLayer(f,this.addLayer_callback)},changeChartOption:function(){if(null!=this.chartLayer){var e=this.panel.find(".chart-table-name").val();if(""==e)return MapCloud.notify.showInfo("请输入专题图名称","Warning"),void this.panel.find(".chart-table-name").focus();this.chartLayer.setName(e),this.dbName!=this.chartLayer.dbName&&this.chartLayer.setDbName(this.dbName),this.tableName!=this.chartLayer.tableName&&this.chartLayer.setTableName(this.tableName);var a=this.panel.find(".chart-table-fields").val();if(null==a||""==a)return void MapCloud.notify.showInfo("请设置关联字段","Warning");this.chartLayer.setTableField(a);var l=this.panel.find(".r-chart-base-layer").val();if(null==l||""==l)return void MapCloud.notify.showInfo("请选择面底图","Warning");this.chartLayer.setRangeBaseLayer(l);var t=this.panel.find(".r-chart-base-layer-fields").val();if(null==t||""==t)return void MapCloud.notify.showInfo("请选择面底图的关联字段","Warning");this.chartLayer.setRangeBaseLayerField(t);var r=this.panel.find(".s-chart-base-layer").val();if(null==r||""==r)return void MapCloud.notify.showInfo("请选择点底图","Warning");var r=this.panel.find(".s-chart-base-layer").val();if(null==r||""==r)return void MapCloud.notify.showInfo("请选择点底图","Warning");this.chartLayer.setSymbolBaseLayer(r);var i=this.panel.find(".s-chart-base-layer-fields").val();if(null==i||""==i)return void MapCloud.notify.showInfo("请选择点底图的关联字段","Warning");this.chartLayer.setSymbolBaseLayerField(i);var n=this.panel.find("#r_chart_style_fields").val();if(null==n||""==n)return void MapCloud.notify.showInfo("请选择分级图的字段","Warning");this.chartLayer.setRangeChartField(n);var o=this.panel.find("#s_chart_style_fields").val();if(null==o||""==o)return void MapCloud.notify.showInfo("请选择等级符号图的字段","Warning");this.chartLayer.setSymbolChartField(o);var s=this.getRangeChartOption();this.chartLayer.setRangeChartOption(s);var h=this.getSymbolChartOption();this.chartLayer.setSymbolChartOption(h),mapObj.draw()}},getColorMaps_callback:function(e){if(null!=e){for(var a=MapCloud.range_symbol_chart_panel,l=null,t=null,r="",i=0;i<e.length;++i)l=e[i],t=l.url,r+="<li cid='"+l.id+"'>	<div class='color-ramp-item' style='background-image:	url("+t+")'>	</div></li>";if(a.panel.find(".color-ramp-div ul").html(r),l=e[0],null!=l){t=l.url;var n=l.id,o="<li cid='"+n+"'>	<div class='color-ramp-item' style='background-image:	url("+t+")'>	</div></li>";a.panel.find(".select-color-ramp").html(o)}a.panel.find(".color-ramp-div ul li").click(function(){var e=$(this).attr("cid");a.panel.find(".select-color-ramp li").attr("cid",e);var l=$(this).find(".color-ramp-item").css("background-image");a.panel.find(".select-color-ramp li .color-ramp-item").css("background-image",l)})}},getRangeChartOption:function(){var e=this.panel.find("#r_chart_style_coll .form-group-border .colorSelector div"),a=e.css("opacity"),l=e.css("background-color"),t=new GeoBeans.Color;t.setByRgb(l,1);var r=t.getHex(),i=this.panel.find(".select-color-ramp li").attr("cid"),n=this.panel.find("#r_chart_style_coll .form-group-color .opacity-value").html(),o={colorMapID:i,opacity:parseFloat(n),border:r,borderOpacity:parseFloat(a)};return o},getSymbolChartOption:function(){var e=this.panel.find("#s_chart_style_coll .form-group-color .colorSelector div"),a=e.css("opacity"),l=e.css("background-color"),t=new GeoBeans.Color;t.setByRgb(l,1);var r=t.getHex(),i=this.panel.find("#s_chart_style_coll .form-group-border .colorSelector div"),n=i.css("opacity"),o=i.css("background-color"),t=new GeoBeans.Color;t.setByRgb(o,1);var s=t.getHex(),h=this.panel.find(".chart-table-max-size").val(),c=this.panel.find(".form-group-choose-level input[type='checkbox']").prop("checked"),d=this.panel.find("#chart_table_level").val(),p=!1;c&&(p=!0);var f={color:r,opacity:parseFloat(a),border:s,borderOpacity:parseFloat(n),maxsize:parseFloat(h),byLevel:p,level:d};return f},addLayer_callback:function(e){var a=MapCloud.range_symbol_chart_panel;if("success"==e){mapObj.draw();var l=a.panel.find(".chart-table-name").val();a.chartLayer=mapObj.getLayer(l)}else MapCloud.notify.showInfo(e,"添加分级和等级符号图")},setChartLayer:function(e){if(this.chartLayer=e,null!=this.chartLayer){var a=this.chartLayer.name;this.panel.find(".chart-table-name").val(a);var l=this.chartLayer.rangeBaseLayerName,t=this.chartLayer.rangeBaseLayerField,r=this.chartLayer.rangeChartField,i=this.chartLayer.symbolBaseLayerName,n=this.chartLayer.symbolBaseLayerField,o=this.chartLayer.symbolChartField,s=this.chartLayer.dbName,h=this.chartLayer.tableName,c=this.chartLayer.tableField;this.dbName=s,this.tableName=h,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName),this.panel.find(".chart-table-fields option[value='"+c+"']").attr("selected",!0),this.panel.find(".r-chart-base-layer option[value='"+l+"']").attr("selected",!0),this.panel.find(".r-chart-base-layer-fields option[value='"+t+"']").attr("selected",!0),this.panel.find(".s-chart-base-layer option[value='"+i+"']").attr("selected",!0),this.panel.find(".s-chart-base-layer-fields option[value='"+n+"']").attr("selected",!0),this.panel.find("#r_chart_style_fields option[value='"+r+"']").attr("selected",!0);var d=this.chartLayer.rangeOption,p=d.colorMapID,f=d.border,u=d.borderOpacity,y=d.opacity;this.panel.find("#r_chart_style_coll .form-group-color input.slider").slider("setValue",100*y),this.panel.find("#r_chart_style_coll .form-group-border input.slider").slider("setValue",100*u),this.panel.find("#r_chart_style_coll .form-group-border .colorSelector").colpickSetColor(f),this.panel.find("#r_chart_style_coll .form-group-border .colorSelector div").css("background-color",f),this.panel.find("#r_chart_style_coll .form-group-border .colorSelector div").css("opacity",u),this.panel.find("#r_chart_style_coll .form-group-color .opacity-value").html(y),this.panel.find("#r_chart_style_coll .form-group-border .opacity-value").html(u),p=parseInt(p),this.panel.find(".select-color-ramp li").attr("cid",p);var b=this.panel.find(".dropdown-menu li[cid='"+p+"']"),v=b.find(".color-ramp-item").css("background-image");this.panel.find(".select-color-ramp li .color-ramp-item").css("background-image",v),this.panel.find("#s_chart_style_fields option[value='"+o+"']").attr("selected",!0);var m=this.chartLayer.symbolOption,g=m.color,y=m.opacity,f=m.border,u=m.borderOpacity,_=m.byLevel,L=m.maxsize,C=m.level;this.panel.find("#s_chart_style_coll .form-group-color input.slider").slider("setValue",100*y),this.panel.find("#s_chart_style_coll .form-group-border input.slider").slider("setValue",100*u),this.panel.find("#s_chart_style_coll .form-group-color .opacity-value").html(y),this.panel.find("#s_chart_style_coll .form-group-border .opacity-value").html(u),this.panel.find(".chart-table-max-size").val(L),_?(this.panel.find(".form-group-choose-level input[type='checkbox']").prop("checked",!0),this.panel.find("#chart_table_level").val(C)):this.panel.find(".form-group-choose-level input[type='checkbox']").prop("checked",!1),this.panel.find("#s_chart_style_coll .form-group-color .colorSelector").colpickSetColor(g),this.panel.find("#s_chart_style_coll .form-group-color .colorSelector div").css("background-color",g),this.panel.find("#s_chart_style_coll .form-group-color .colorSelector div").css("opacity",y),this.panel.find("#s_chart_style_coll .form-group-border .colorSelector").colpickSetColor(f),this.panel.find("#s_chart_style_coll .form-group-border .colorSelector div").css("background-color",f),this.panel.find("#s_chart_style_coll .form-group-border .colorSelector div").css("opacity",u)}}});
MapCloud.refresh=MapCloud.Class({panel:null,layerID:null,mapLayerID:null,styleID:null,layerName:null,getStyleLayerName:null,initialize:function(a){this.panel=$("#"+a),this.registerEvent()},registerEvent:function(){var a=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),this.panel.find(".glyphicon-plus").click(function(){MapCloud.new_layer_dialog.showDialog()}),this.panel.find(".glyphicon-minus").click(function(){if(0==$("#layers_row .layer_row.layer_row_selected").length)return void MapCloud.notify.showInfo("请选择图层","Warning");var a=$("#layers_row .layer_row.layer_row_selected").attr("lname");null!=a&&confirm("你确定要删除图层吗？")&&mapObj.removeLayer(a,MapCloud.refresh_panel.removeLayer_callback)}),this.panel.find("#layers_content_btn").click(function(){"none"==$("#layers_content").css("display")?$("#layers_content").slideDown():$("#layers_content").slideUp()}),this.panel.find("#create_service_btn").click(function(){a.createService()}),this.panel.find("#cut_map_btn").click(function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void MapCloud.cut_map_dialog.showDialog()}),this.panel.find("#map_globe_btn").click(function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void mapManager.zoomToGlobeMap(mapObj,a.zoomToGlobeMap_callback)}),this.panel.find("#save_map_btn").click(function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void mapManager.saveMap(mapObj,a.saveMap_callback)}),this.panel.find("#refresh_map_btn").click(function(){return null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void mapManager.refreshMap(mapObj,a.refreshMap_callback)})},cleanup:function(){this.panel.find("#map_name").html("Map Name"),this.panel.find("#layers_row").empty(),this.panel.find("#baseLayer_row").empty()},hide:function(){this.panel.css("display","none")},show:function(){this.panel.css({display:"block",opacity:"0"}).animate({opacity:"1"},1e3)},refreshPanel:function(){if(this.panel.find("#layers_row").empty(),null!=mapObj){var a=mapObj.name;this.panel.find("#map_name").html(a);var l="",e=mapObj.baseLayer;if(null!=e){var i=this.getBaseLayerHtml(e);$("#baseLayer_row").html(i),$("#baseLayer_row").css("padding","6px 0px"),$("#baseLayer_row").removeClass("sm")}else $("#baseLayer_row").empty();for(var o=mapObj.getLayers(),s=this,r=0;r<o.length;++r){var n=o[r];null!=n&&(n instanceof GeoBeans.Layer.WFSLayer?l+=this.getWFSLayerHtml(r,n):n instanceof GeoBeans.Layer.WMSLayer?l+=this.getWMSLayerHtml(r,n):n instanceof GeoBeans.Layer.DBLayer?l+=this.getDBLayerHtml(r,n):n instanceof GeoBeans.Layer.ChartLayer?l+=this.getChartLayerHtml(r,n):n instanceof GeoBeans.Layer.ClusterLayer?l+=this.getClusterLayer(r,n):n instanceof GeoBeans.Layer.RippleLayer?l+=this.getRippleLayer(r,n):n instanceof GeoBeans.Layer.AirLineLayer&&(l+=this.getAirlineLayer(r,n)))}$("#layers_row").html(l);var c=$(".layers-items").css("height");c=parseInt(c.slice(0,c.lastIndexOf("px"))),600>c?$(".layers-items").css("overflow-y","visible"):$(".layers-items").css("overflow-y","auto"),this.panel.find(".glyphicon-chevron-right").click(function(){var a=$(this).parents(".layer_row").first(),l=a.attr("lname"),e=mapObj.getLayer(l);if(null!=e){if(e instanceof GeoBeans.Layer.WMSLayer)return void($(this).hasClass("mc-icon-right")?($(a).find(".wms_layer_row").slideDown(),$(this).removeClass("mc-icon-right"),$(this).addClass("mc-icon-down"),$(this).css("transform","rotate(90deg) translate(3px,0px)")):($(a).find(".wms_layer_row").slideUp(),$(this).css("transform","rotate(0deg) translate(0px,0px)"),$(this).addClass("mc-icon-right"),$(this).removeClass("mc-icon-down")));if(e instanceof GeoBeans.Layer.WFSLayer)if($(this).hasClass("mc-icon-right")){if(0==a.find(".row").length){var i=e.style;if(null!=i){var o=s.getStyleHtml(-1,i);a.append(o),s.registerStyleSymbolClickEvent()}}else $(a).find(".row").slideDown();$(this).removeClass("mc-icon-right"),$(this).addClass("mc-icon-down"),$(this).css("transform","rotate(90deg) translate(3px,0px)")}else $(a).find(".row").slideUp(),$(this).css("transform","rotate(0deg) translate(0px,0px)"),$(this).addClass("mc-icon-right"),$(this).removeClass("mc-icon-down");else if(e.type==GeoBeans.Layer.DBLayer.Type.Feature){var i=e.style;if($(this).hasClass("mc-icon-right")){if(0==a.find(".row").length){var r=e.styleName;MapCloud.notify.loading(),s.getStyleLayerName=e.name,styleManager.getStyleXML(r,s.getStyleXML_callback)}else a.find(".row").slideDown();$(this).removeClass("mc-icon-right"),$(this).addClass("mc-icon-down"),$(this).css("transform","rotate(90deg) translate(3px,0px)")}else $(this).css("transform","rotate(0deg) translate(0px,0px)"),$(this).addClass("mc-icon-right"),$(this).removeClass("mc-icon-down"),a.find(".row").slideUp()}}}),this.registerStyleSymbolClickEvent(),this.registerSymbolIconClickEvent(),this.panel.find(".glyphicon-eye-open,.glyphicon-eye-close").each(function(){$(this).click(function(){if("baseLayer_row"==$(this).parents(".row").attr("id"))return void($(this).hasClass("glyphicon-eye-open")?($(this).removeClass("glyphicon-eye-open"),$(this).addClass("glyphicon-eye-close"),mapObj.baseLayer.setVisiable(!1),mapObj.draw()):($(this).removeClass("glyphicon-eye-close"),$(this).addClass("glyphicon-eye-open"),mapObj.baseLayer.setVisiable(!0),mapObj.draw()));var a=$(this).parents("li"),l=a.attr("lname"),e=mapObj.getLayer(l);if(null!=e){var i=$(this).parents(".wms_layer_row").attr("mname");null!=i&&(e=e.getMapLayer(i)),null!=e&&($(this).hasClass("glyphicon-eye-open")?($(this).removeClass("glyphicon-eye-open"),$(this).addClass("glyphicon-eye-close"),e.setVisiable(!1),mapObj.draw()):($(this).removeClass("glyphicon-eye-close"),$(this).addClass("glyphicon-eye-open"),e.setVisiable(!0),mapObj.draw()))}})}),this.panel.find(".layer_name").each(function(){$(this).click(function(){var a=$(".layer_row_selected").attr("lname");$(".layer_row").removeClass("layer_row_selected"),$("#baseLayer_row").removeClass("layer_row_selected");var l=$(this).parent();l.addClass("layer_row_selected");var e=l.attr("lname");s.registerAQILayerHitEvent(a,e),MapCloud.mapBar.returnEndQuery()})}),this.panel.find(".layer_row_quick_tool_zoom").each(function(){$(this).click(function(){if("baseLayer_row"==$(this).parents(".row").attr("id"))mapObj.zoomToBaseLayer();else{var a=$(this).parents("li.layer_row"),l=a.attr("lname");mapObj.zoomToLayer(l)}})}),this.panel.find(".layer_row_quick_tool_layer_info").click(function(){var a=$(this).parents("li.layer_row"),l=a.attr("lname");null!=l&&MapCloud.layer_info_dialog.showDialog(l)}),this.panel.find(".layer_row_quick_tool_features").click(function(){var a=$(this).parents("li.layer_row"),l=a.attr("lname");null!=l&&(MapCloud.features_dialog.setLayerName(l),MapCloud.features_dialog.showDialog())}),this.panel.find(".layer_row_quick_tool_search").click(function(){var a=$(this).parents("li.layer_row"),l=a.attr("lname");if(null!=l){var e=mapObj.getLayer(l);null!=e&&MapCloud.search_panel.showPanel(e)}}),this.panel.find(".layer_row_quick_tool_edit").each(function(){$(this).click(function(){})}),this.panel.find(".layer_row_quick_tool_share").each(function(){$(this).click(function(){alert("share")})}),this.panel.find(".layer_row_quick_tool_remove").each(function(){$(this).click(function(){var a=$(this).parents("li.layer_row"),l=a.attr("lname");confirm("确定删除图层["+l+"]?")&&mapObj.removeLayer(l,s.removeLayer_callback)})}),this.panel.find(".layer_row_quick_tool_heatMap span").each(function(){$(this).click(function(){var a=($(this).prop("checked"),$(this).parents("li.layer_row")),l=a.attr("lname"),e=mapObj.getLayer(l);null!=e&&(MapCloud.heatMap_dialog.showDialog(),MapCloud.heatMap_dialog.setLayer(e))})}),this.panel.find(".layer_row_quick_tool_heatMap input").each(function(){$(this).change(function(){var a=$(this).prop("checked"),l=$(this).parents("li.layer_row"),e=l.attr("lname"),i=mapObj.getLayer(e);if(null!=i){var o=i.getHeatMapLayer();if(null==o)return MapCloud.heatMap_dialog.showDialog(),void MapCloud.heatMap_dialog.setLayer(i);mapObj.setHeatMapVisible(e,a),mapObj.draw()}})}),this.panel.find(".layer_row_quick_tool_stretch input").each(function(){$(this).change(function(){var a=$(this).prop("checked"),l=$(this).parents("li.layer_row"),e=l.attr("lname"),i=mapObj.getLayer(e);null!=i&&MapCloud.notify.showInfo(a.toString(),"影像拉伸")})}),this.panel.find(".layer_row_quick_tool_remove_base").each(function(){$(this).click(function(){confirm("确定要删除底图吗？")&&mapObj.unRegisterBaseLayer(s.removeBaseLayer_callback)})}),this.panel.find(".layer_row .layer_oper").click(function(){var a=$(this).parents("li"),l=a.attr("lname"),e=mapObj.getLayer(l);null!=e&&($(this).hasClass("fa-arrow-up")?e.up(s.layerOper_callback):$(this).hasClass("fa-arrow-down")&&e.down(s.layerOper_callback))}),this.panel.find(".mc-icon-wmslayer").each(function(){$(this).click(function(){})}),this.panel.find(".mc-icon-wfslayer").each(function(){$(this).click(function(){var a=$(this).parents("li"),l=a.attr("lname"),e=mapObj.getLayer(l);if(null!=e){var i=e.style;null!=i&&(MapCloud.styleManager_dialog.showDialog(!1),MapCloud.styleManager_dialog.setWFSLayer(e))}})}),this.panel.find(".mc-icon-dblayer").each(function(){$(this).click(function(){var a=$(this).parents("li"),l=a.attr("lname"),e=mapObj.getLayer(l);null!=e&&e.type==GeoBeans.Layer.DBLayer.Type.Feature&&(MapCloud.styleManager_dialog.showDialog(!1),MapCloud.styleManager_dialog.setDBLayer(e))})}),this.panel.find(".mc-icon-chartlayer").click(function(){var a=$(this).parents("li"),l=a.attr("lname"),e=mapObj.getLayer(l);if(null!=e){var i=e.type;switch(i){case GeoBeans.Layer.ChartLayer.Type.RANGE:MapCloud.chart_panel.showPanel(),MapCloud.chart_panel.setChartLayer(e);break;case GeoBeans.Layer.ChartLayer.Type.BAR:MapCloud.bar_chart_panel.showPanel(),MapCloud.bar_chart_panel.setChartLayer(e);break;case GeoBeans.Layer.ChartLayer.Type.PIE:MapCloud.pie_chart_panel.showPanel(),MapCloud.pie_chart_panel.setChartLareyer(e);break;case GeoBeans.Layer.ChartLayer.Type.SYMBOL:MapCloud.symbol_chart_panel.showPanel(),MapCloud.symbol_chart_panel.setChartLayer(e);break;case GeoBeans.Layer.ChartLayer.Type.RANGESYMBOL:MapCloud.range_symbol_chart_panel.showPanel(),MapCloud.range_symbol_chart_panel.setChartLayer(e);break;case GeoBeans.Layer.ChartLayer.Type.AQI:MapCloud.aqi_chart_panel.showPanel(),MapCloud.aqi_chart_panel.setChartLayer(e);break;case GeoBeans.Layer.ChartLayer.Type.AQITIMELINE:MapCloud.aqi_timeline_chart_panel.showPanel(),MapCloud.aqi_timeline_chart_panel.setChartLayer(e)}}}),this.panel.find(".mc-icon-cluster-layer").click(function(){var a=$(this).parents("li"),l=a.attr("lname"),e=mapObj.getLayer(l);null!=e&&(MapCloud.cluster_chart_panel.showPanel(),MapCloud.cluster_chart_panel.setLayer(e))}),this.panel.find(".mc-icon-ripple-layer").click(function(){var a=$(this).parents("li"),l=a.attr("lname"),e=mapObj.getLayer(l);null!=e&&(MapCloud.aqi_chart_panel.showPanel(),MapCloud.aqi_chart_panel.setChartLayer(e))}),this.panel.find(".mc-icon-airline-layer").click(function(){var a=$(this).parents("li"),l=a.attr("lname"),e=mapObj.getLayer(l);null!=e&&(MapCloud.airline_panel.showPanel(),MapCloud.airline_panel.setLayer(e))})}},registerStyleSymbolClickEvent:function(){var a=this;this.panel.find(".style-symbol").each(function(){$(this).click(function(){var l=$(this).parents(".layer_row"),e=l.attr("lname"),i=mapObj.getLayer(e);if(null!=i){var o=i.style;if(null!=o){var s=o.rules;if(null!=s){var r=$(this).parents(".layer_style_row"),n=r.first().attr("sID"),c=s[n];if(null!=c){var t=null;if(i instanceof GeoBeans.Layer.DBLayer){var d=new GeoBeans.WFSWorkspace("tmp",mapObj.server,"1.0.0"),p=new GeoBeans.FeatureType(d,i.name);t=p.getFields(mapObj.name)}else i instanceof GeoBeans.Layer.WFSLayer&&(t=i.featureType.getFields());null!=t&&(a.layerName=e,a.styleID=n,MapCloud.style_dialog.showDialog(),MapCloud.style_dialog.setRule(c,t,"refresh"))}}}}})})},registerSymbolIconClickEvent:function(){var a=this;this.panel.find(".symbol-icon").click(function(){var l=$(this).parents(".layer_row"),e=l.attr("lname"),i=mapObj.getLayer(e);if(null!=i&&!(i instanceof GeoBeans.Layer.WFSLayer)){var o=i.style;if(null!=o){var s=o.rules;if(null!=s){var r=$(this).parents(".layer_style_row"),n=r.first().attr("sID"),c=s[n];if(null!=c){var t=c.symbolizer;if(null!=t){var d=t.symbol;a.layerName=e,a.styleID=n;var p=MapCloud.styleManager_dialog.getSymbolIconType(t.type),y=null;null!=d&&(y=d.name),MapCloud.symbol_dialog.showDialog("refresh",p,y)}}}}}})},createSymbolizerIcon:function(a,l){if(null==a||null==l)return null;var e="",i=l.toLowerCase();switch(i){case"point":case"multipolygon":case"polygon":var o=a.fillColor,s=a.outLineColor;e="background-color:"+o+";border:1px solid "+s+";";break;case"multilinestring":case"linestring":var r=a.color;e="background-color:"+r}return e},getTextSymbolizerIndexByFilter:function(a,l){for(var e=0;e<l.length;++e){var i=l[e],o=i.symbolizer;if(o instanceof GeoBeans.Style.TextSymbolizer){var s=i.filter;if(null==s&&null==a)return e;if(null!=s&&null!=a&&s.field==a.field&&s.value==a.value)return e}}return-1},setSymoblizerCallback:function(a,l,e,i){null==MapCloud.refresh_panel&&(MapCloud.refresh_panel=new MapCloud.refresh("left_panel"));var o=mapObj.layers[i];if(null!=o){var s=o.style;if(null!=s){var r=s.rules;if(null!=r){var n=r[e];if(null!=n){r[e].symbolizer=a;var c=r[e].filter,t=new GeoBeans.Style.Rule;t.filter=c,t.symbolizer=l;var d=MapCloud.refresh_panel.getTextSymbolizerIndexByFilter(n.filter,r);-1==d&&null!=l&&r.push(t),-1!=d&&null!=l&&(r[d].symbolizer=l),-1!=d&&null==l&&r.splice(d,1),MapCloud.refresh_panel.refreshPanel(),mapObj.draw()}}}}},getBaseLayerHtml:function(a){var l="",e=a.name,i="mc-icon-image",o=a.url,s=o.slice(o.lastIndexOf("=")+1,o.length);return"world_vector"==s?i="mc-icon-vector":"world_image"==s&&(i="mc-icon-image"),l+='	<div class="col-md-1 col-xs-1">		<div class="glyphicon glyphicon-chevron-down mc-icon"></div>	</div>	<div class="col-md-1 col-xs-1">',l+=a.visible?'		<div class="glyphicon glyphicon-eye-open mc-icon"></div>':'		<div class="glyphicon glyphicon-eye-close mc-icon"></div>',l+='	</div>	<div class="col-md-1 col-xs-1">		<div class="mc-icon '+i+'"></div>	</div>	<div class="col-md-5 col-xs-5 layer_name">		<strong title=\''+e+"'>"+e+'</strong>	</div>	<div class="col-md-1 col-xs-1 layer_name">	</div>	<div class="col-md-1 col-xs-1 layer_name">	</div>	<div class="col-md-1 col-xs-1 layer_row_quick_tool">		<ul>			<li class="dropdown pull-right">				<a href="javascript:void(0)" data-toggle="dropdown" class="dropdown-toggle">					<b class="glyphicon glyphicon-cog"></b>				</a>				<ul class="dropdown-menu">					<li><a href="javascript:void(0)" class="layer_row_quick_tool_zoom"><i class=\'dropdown-menu-icon glyphicon glyphicon-zoom-in\'></i>放大到图层</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_remove_base"><i class=\'dropdown-menu-icon glyphicon glyphicon-remove\'></i>删除图层</a></li>				</ul>			</li>		</ul>	</div>'},getWMSLayerHtml:function(a,l){var e="",i=l.name;e='<li class="row layer_row" lname="'+i+'">	<div class="col-md-1 col-xs-1">		<div class="glyphicon glyphicon-chevron-right mc-icon mc-icon-right mc-icon-rotate"></div>	</div>	<div class="col-md-1 col-xs-1">',e+=l.visible?'		<div class="glyphicon glyphicon-eye-open mc-icon"></div>':'		<div class="glyphicon glyphicon-eye-close mc-icon"></div>',e+='	</div>	<div class="col-md-1 col-xs-1">		<div class="mc-icon mc-icon-color"></div>	</div>	<div class="col-md-5 col-xs-5 layer_name">		<strong>'+i+'</strong>	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1 layer_row_quick_tool">		<ul class="layer_row_quick_tool_ul">			<li class="dropdown pull-right">				<a href="javascript:void(0)" data-toggle="dropdown" class="dropdown-toggle">					<b class="glyphicon glyphicon-cog"></b>				</a>				<ul class="dropdown-menu">					<li><a href="javascript:void(0)" class="layer_row_quick_tool_zoom"><i class=\'dropdown-menu-icon glyphicon glyphicon-zoom-in\'></i>放大到图层</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_remove"><i class=\'dropdown-menu-icon glyphicon glyphicon-remove\'></i>删除图层</a></li>				</ul>			</li>		</ul>	</div>	<br/>';for(var o=(l.layers,l.mapLayers),s=0;s<o.length;++s){var r=o[s];if(null!=r){var i=r.name,n='<div class="row wms_layer_row" mname="'+i+'" style="display:none">	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1">';n+=r.visible?'	<div class="glyphicon glyphicon-eye-open mc-icon"></div>':'	<div class="glyphicon glyphicon-eye-close mc-icon"></div>',n+=' </div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-5 col-xs-5">		<strong class=\'wms-map-layer\'>'+i+"</strong>	</div></div>",e+=n;var c=this.getStyleHtml(s,r.style);e+=c}}return e+="</li>"},getStyleHtml:function(a,l){if(null==l)return"";var e="",i=l.rules;if(0==i.length)return"";if(1!=i.length){var e="";if(l.styleClass==GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE||l.styleClass==GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES){var o=MapCloud.styleManager_dialog.getProperyNameByRule(i[0]);e+='<div class="row layer_style_row" lID="'+a+'">	<div class="col-md-1 col-xs-1"></div>	<div class="col-md-1 col-xs-1"></div>	<div class="col-md-1 col-xs-1"></div>	<div class="col-md-5 col-xs-5"><strong>'+o+"	</strong></div></div>"}for(var s=0;s<i.length;++s){var r=i[s];if(null!=r){var n=r.filter;if(null!=n){var c=MapCloud.styleManager_dialog.getSqlExpression(n),t=r.symbolizer,d=this.getSymbolizerHtml(t),p=this.getSymbolIconHtml(t.type,t.symbol);e+='<div class="row layer_style_row" lID="'+a+'" sID="'+s+'">	<div class="col-md-1 col-xs-1"></div>	<div class="col-md-1 col-xs-1"></div>	<div class="col-md-1 col-xs-1"></div>	<div class="col-md-1 col-xs-1">'+d+'	</div>	<div class="col-md-1 col-xs-1">'+p+'	</div>	<div class="col-md-5 col-xs-5">'+c+"	</div></div>"}}}return e}var r=i[0];if(null!=r){var n=r.filter;if(null==n){var t=r.symbolizer;if(null!=t){var d=this.getSymbolizerHtml(t);if(null==d)return"";var p=this.getSymbolIconHtml(t.type,t.symbol);return null==p?"":e+='<div class="row layer_style_row" lID="'+a+'" sID="0">	<div class="col-md-1 col-xs-1"></div>	<div class="col-md-1 col-xs-1"></div>	<div class="col-md-1 col-xs-1"></div>	<div class="col-md-1 col-xs-1">'+d+'	</div>	<div class="col-md-1 col-xs-1">'+p+"	</div></div>"}}}return""},getSymbolizerHtml:function(a){var l=MapCloud.styleManager_dialog.getSymbolHtml(a);return l},getSymbolIconHtml:function(a,l){var e=MapCloud.styleManager_dialog.getSymbolIconHtml(a,l);return e},getWFSLayerHtml:function(a,l){var e=l.name;l.style;return html='<li class="row layer_row" lname="'+e+'">	<div class="col-md-1 col-xs-1">		<div class="glyphicon glyphicon-chevron-right mc-icon mc-icon-right mc-icon-rotate"></div>	</div>	<div class="col-md-1 col-xs-1">',l.visible?html+='		<div class="glyphicon glyphicon-eye-open mc-icon"></div>':html+='		<div class="glyphicon glyphicon-eye-close mc-icon"></div>',html+='	</div>	<div class="col-md-1 col-xs-1">		<div class="mc-icon mc-icon-layer mc-icon-wfslayer"></div>	</div>	<div class="col-md-5 col-xs-5 layer_name">		<strong>'+e+'</strong>	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1 layer_row_quick_tool">		<ul class="layer_row_quick_tool_ul">			<li class="dropdown pull-right">				<a href="javascript:void(0)" data-toggle="dropdown" class="dropdown-toggle">					<b class="glyphicon glyphicon-cog"></b>				</a>				<ul class="dropdown-menu">					<li><a href="javascript:void(0)" class="layer_row_quick_tool_zoom"><i class=\'dropdown-menu-icon glyphicon glyphicon-zoom-in\'></i>放大到图层</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_remove"><i class=\'dropdown-menu-icon glyphicon glyphicon-remove\'></i>删除图层</a></li>				</ul>			</li>		</ul>	</div>	<br/>',html+="</li>",html},setRule:function(a){var l=mapObj.getLayer(this.layerName);if(null!=l){var e=l.style;if(null!=e){var i=e.rules;if(null!=i){var o=i[this.styleID];if(null!=o){var s=o.symbolizer.symbol;a.symbolizer.symbol=s,o.symbolizer=a.symbolizer,o.textSymbolizer=a.textSymbolizer;var r=e.name;if("default"==r)mapObj.draw(),MapCloud.refresh_panel.refreshPanel();else{var n=styleManager.writer.write(e);styleManager.updateStyle(n,r,this.updateCallback),mapObj.setStyle(this.layerName,e,this.setStyle_callback)}}}}}},updateCallback:function(a){MapCloud.notify.showInfo(a,"更新样式"),MapCloud.refresh_panel.refreshPanel()},setStyle_callback:function(a){MapCloud.notify.showInfo(a,"设置样式"),mapObj.draw(),MapCloud.refresh_panel.refreshPanel()},getDBLayerHtml:function(a,l){if(null==l)return"";var e=l.type,i="";return e==GeoBeans.Layer.DBLayer.Type.Raster?i=this.getRasterDBLayerHtml(l):e==GeoBeans.Layer.DBLayer.Type.Feature&&(i=this.getFeatureDBLayerHtml(l)),i},getFeatureDBLayerHtml:function(a){var l=a.name,e='<li class="row layer_row" lname="'+l+'">	<div class="col-md-1 col-xs-1">		<div class="glyphicon glyphicon-chevron-right mc-icon mc-icon-right mc-icon-rotate"></div>	</div>	<div class="col-md-1 col-xs-1">';e+=a.visible?'		<div class="glyphicon glyphicon-eye-open mc-icon"></div>':'		<div class="glyphicon glyphicon-eye-close mc-icon"></div>';var i="";if(a.geomType==GeoBeans.Geometry.Type.POINT||a.geomType==GeoBeans.Geometry.Type.MULTIPOINT){var o=a.getHeatMapLayer();i='<li><a href="javascript:void(0)" class="layer_row_quick_tool_heatMap">',i+=null!=o&&o.visible?"<i class='dropdown-menu-icon'><input type='checkbox' checked></i>":"<i class='dropdown-menu-icon'><input type='checkbox'></i>",i+="<span>热力图</span></a></li>"}else i="";return e+='	</div>	<div class="col-md-1 col-xs-1">		<div class="mc-icon mc-icon-dblayer"></div>	</div>	<div class="col-md-5  col-xs-5 layer_name">		<strong title=\''+l+"'>"+l+'</strong>	</div>	<div class=\'col-md-1 col-xs-1\'>		<div class=\'fa fa-arrow-up mc-icon layer_oper\'></div>	</div>	<div class=\'col-md-1 col-xs-1\'>		<div class=\'fa fa-arrow-down mc-icon layer_oper\'></div>	</div>	<div class="col-md-1 col-xs-1 layer_row_quick_tool">		<ul class="layer_row_quick_tool_ul">			<li class="dropdown pull-right">				<a href="javascript:void(0)" data-toggle="dropdown" class="dropdown-toggle">					<b class="glyphicon glyphicon-cog"></b>				</a>				<ul class="dropdown-menu">					<li><a href="javascript:void(0)" class="layer_row_quick_tool_zoom"><i class=\'dropdown-menu-icon glyphicon glyphicon-zoom-in\'></i>放大到图层</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_layer_info"><i class=\'dropdown-menu-icon fa fa-list-ul\'></i>图层属性</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_features"><i class=\'dropdown-menu-icon fa fa-list-ul\'></i>属性数据</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_search"><i class=\'dropdown-menu-icon fa fa-search\'></i>属性查询</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_remove"><i class=\'dropdown-menu-icon glyphicon glyphicon-remove\'></i>删除图层</a></li>'+i+"				</ul>			</li>		</ul>	</div>	<br/>",e+="</li>"},getRasterDBLayerHtml:function(a){var l=a.name,e='<li class="row layer_row" lname="'+l+'">	<div class="col-md-1 col-xs-1">		<div class="glyphicon glyphicon-chevron-right mc-icon mc-icon-right mc-icon-rotate"></div>	</div>	<div class="col-md-1 col-xs-1">';e+=a.visible?'		<div class="glyphicon glyphicon-eye-open mc-icon"></div>':'		<div class="glyphicon glyphicon-eye-close mc-icon"></div>';var i='<li><a href="javascript:void(0)" class="layer_row_quick_tool_stretch"><i class="dropdown-menu-icon"><input type="checkbox"></i><span>影像拉伸</span></a></li>';return e+='	</div>	<div class="col-md-1 col-xs-1">		<div class="mc-icon mc-icon-dblayer mc-icon-dblayer-raster"></div>	</div>	<div class="col-md-5 col-xs-5 layer_name">		<strong title=\''+l+"'>"+l+'</strong>	</div>	<div class=\'col-md-1\' col-xs-1>		<div class=\'fa fa-arrow-up mc-icon layer_oper\'></div>	</div>	<div class=\'col-md-1 col-xs-1\'>		<div class=\'fa fa-arrow-down mc-icon layer_oper\'></div>	</div>	<div class="col-md-1 col-xs-1 layer_row_quick_tool">		<ul class="layer_row_quick_tool_ul">			<li class="dropdown pull-right">				<a href="javascript:void(0)" data-toggle="dropdown" class="dropdown-toggle">					<b class="glyphicon glyphicon-cog"></b>				</a>				<ul class="dropdown-menu">					<li><a href="javascript:void(0)" class="layer_row_quick_tool_zoom"><i class=\'dropdown-menu-icon glyphicon glyphicon-zoom-in\'></i>放大到图层</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_layer_info"><i class=\'dropdown-menu-icon fa fa-list-ul\'></i>图层属性</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_remove"><i class=\'dropdown-menu-icon glyphicon glyphicon-remove\'></i>删除图层</a></li>'+i+"				</ul>			</li>		</ul>	</div>	<br/>",e+="</li>"},removeLayer_callback:function(a){MapCloud.notify.showInfo(a,"删除图层");var l=MapCloud.refresh_panel;l.refreshPanel(),mapObj.draw()},removeBaseLayer_callback:function(a){MapCloud.notify.showInfo(a,"删除底图");var l=MapCloud.refresh_panel;l.refreshPanel(),mapObj.draw()},getChartLayerHtml:function(a,l){if(null==l)return"";var e=l.name,i='<li class="row layer_row" lname="'+e+'">	<div class="col-md-1 col-xs-1">		<div class="glyphicon glyphicon-chevron-right mc-icon mc-icon-right mc-icon-rotate"></div>	</div>	<div class="col-md-1 col-xs-1">';return i+=l.visible?'		<div class="glyphicon glyphicon-eye-open mc-icon"></div>':'		<div class="glyphicon glyphicon-eye-close mc-icon"></div>',i+="	</div>	<div class=\"col-md-1 col-xs-1\">		<a href='javascript:void(0)' class='mc-icon-chartlayer'>			<i class='fa fa-bar-chart'></i>		</a>	</div>	<div class=\"col-md-5 col-xs-5 layer_name\">		<strong title='"+e+"'>"+e+'</strong>	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1 layer_row_quick_tool">		<ul class="layer_row_quick_tool_ul">			<li class="dropdown pull-right">				<a href="javascript:void(0)" data-toggle="dropdown" class="dropdown-toggle">					<b class="glyphicon glyphicon-cog"></b>				</a>				<ul class="dropdown-menu">					<li><a href="javascript:void(0)" class="layer_row_quick_tool_layer_info"><i class=\'dropdown-menu-icon fa fa-list-ul\'></i>图层属性</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_remove"><i class=\'dropdown-menu-icon glyphicon glyphicon-remove\'></i>删除图层</a></li>				</ul>			</li>		</ul>	</div>	<br/>',i+="</li>"},registerAQILayerHitEvent:function(a,l){var e=mapObj.getLayer(a),i=mapObj.getLayer(l);if(null!=i&&(e instanceof GeoBeans.Layer.AQIChartLayer&&(e.unRegisterHitEvent(),MapCloud.aqi_stat_comp_dialog.cleanupStations()),i instanceof GeoBeans.Layer.AQIChartLayer)){var o="<div>		<div style='margin:5px;text-align:center'>			<a href='javascript:void(0)' style='width:100%' 			class='aqi_24_h btn btn-sm btn-primary'>查看24小时变化图</a>		</div>		<div style='margin:5px;text-align:center'>			<a href='javascript:void(0)' style='width:100%'				class='aqi_add_stat btn btn-sm btn-success'>加入对比</a>		</div></div>";i.registerHitEvent(o,this.aqiHitCallback)}},aqiHitCallback:function(a,l,e){var i=MapCloud.refresh_panel;i.aqiChartLayer=e,i.stationCode=a,i.positionName=l,$(".aqi_24_h").click(function(){mapObj.closeInfoWindow();var a=MapCloud.aqi_24h_dialog;a.showDialog(),a.setStationCode(i.stationCode);var l=e.getTimeField();a.setTimeField(l);var o=e.timePoint;a.setTimePoint(o);var s=e.getDbName();a.setDbName(s);var r=e.getTableName();a.setTableName(r);var n=e.getChartField();a.setChartField(n);var c=e.getFlagField();a.setStationCodeField(c),a.setPositionName(i.positionName),a.showAQIIndexChart()}),$(".aqi_add_stat").click(function(){mapObj.closeInfoWindow();var a={name:i.positionName,code:i.stationCode};MapCloud.aqi_stat_comp_dialog.addStation(a),MapCloud.aqi_stat_comp_dialog.setChartLayer(e)})},saveMap_callback:function(a){MapCloud.notify.showInfo(a,"保存地图")},layerOper_callback:function(a){var l=MapCloud.refresh_panel;"success"==a?mapManager.saveMap(mapObj,l.saveMapLayers_callback):MapCloud.notify.showInfo(a,"调整底图顺序")},saveMapLayers_callback:function(a){MapCloud.notify.showInfo(a,"调整底图顺序"),MapCloud.refresh_panel.refreshPanel(),mapObj.draw()},setSymbol:function(a){if(null!=a){var l=("url("+a.icon+")",mapObj.getLayer(this.layerName));if(null!=l){var e=l.style;if(null!=e){var i=e.rules;if(null!=i){var o=i[this.styleID];if(null!=o){var s=o.symbolizer;if(null!=s){s.symbol=a;var r=e.name;if("default"==r)mapObj.draw(),this.refreshPanel();else{var n=styleManager.writer.write(e);styleManager.updateStyle(n,r,this.updateCallback),mapObj.setStyle(this.layerName,e,this.setStyle_callback)}}}}}}}},getStyleXML_callback:function(a){MapCloud.notify.hideLoading();var l=MapCloud.refresh_panel,e=l.panel.find(".layer_row[lname='"+l.getStyleLayerName+"']"),i=l.getStyleHtml(-1,a);e.append(i);var o=$(".layers-items").css("height");o=parseInt(o.slice(0,o.lastIndexOf("px"))),600>o?$(".layers-items").css("overflow-y","visible"):$(".layers-items").css("overflow-y","auto"),l.registerSymbolIconClickEvent(),l.registerStyleSymbolClickEvent();var s=mapObj.getLayer(l.getStyleLayerName);s.style=a,l.getStyleLayerName=null},refreshMap_callback:function(a){MapCloud.notify.showInfo(a,"刷新地图"),mapObj.draw(),MapCloud.refresh_panel.refreshPanel()},zoomToGlobeMap_callback:function(a){MapCloud.notify.showInfo(a,"全图显示"),MapCloud.refresh_panel.refreshPanel()},getClusterLayer:function(a,l){if(null!=l){var e=l.name,i='<li class="row layer_row" lname="'+e+'">	<div class="col-md-1 col-xs-1">		<div class="glyphicon glyphicon-chevron-right mc-icon mc-icon-right mc-icon-rotate"></div>	</div>	<div class="col-md-1 col-xs-1">';return i+=l.visible?'		<div class="glyphicon glyphicon-eye-open mc-icon"></div>':'		<div class="glyphicon glyphicon-eye-close mc-icon"></div>',i+="	</div>	<div class=\"col-md-1 col-xs-1\">		<a href='javascript:void(0)' class='mc-icon-cluster-layer'>			<i class='fa fa-bar-chart'></i>		</a>	</div>	<div class=\"col-md-5 col-xs-5 layer_name\">		<strong title='"+e+"'>"+e+'</strong>	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1 layer_row_quick_tool">		<ul class="layer_row_quick_tool_ul">			<li class="dropdown pull-right">				<a href="javascript:void(0)" data-toggle="dropdown" class="dropdown-toggle">					<b class="glyphicon glyphicon-cog"></b>				</a>				<ul class="dropdown-menu">					<li><a href="javascript:void(0)" class="layer_row_quick_tool_layer_info"><i class=\'dropdown-menu-icon fa fa-list-ul\'></i>图层属性</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_remove"><i class=\'dropdown-menu-icon glyphicon glyphicon-remove\'></i>删除图层</a></li>				</ul>			</li>		</ul>	</div>	<br/>',i+="</li>"}},getRippleLayer:function(a,l){if(null!=l){var e=l.name,i='<li class="row layer_row" lname="'+e+'">	<div class="col-md-1 col-xs-1">		<div class="glyphicon glyphicon-chevron-right mc-icon mc-icon-right mc-icon-rotate"></div>	</div>	<div class="col-md-1 col-xs-1">';return i+=l.visible?'		<div class="glyphicon glyphicon-eye-open mc-icon"></div>':'		<div class="glyphicon glyphicon-eye-close mc-icon"></div>',i+="	</div>	<div class=\"col-md-1 col-xs-1\">		<a href='javascript:void(0)' class='mc-icon-ripple-layer'>			<i class='fa fa-bar-chart'></i>		</a>	</div>	<div class=\"col-md-5 col-xs-5 layer_name\">		<strong title='"+e+"'>"+e+'</strong>	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1">	</div>	<div class="col-md-1 col-xs-1 layer_row_quick_tool">		<ul class="layer_row_quick_tool_ul">			<li class="dropdown pull-right">				<a href="javascript:void(0)" data-toggle="dropdown" class="dropdown-toggle">					<b class="glyphicon glyphicon-cog"></b>				</a>				<ul class="dropdown-menu">					<li><a href="javascript:void(0)" class="layer_row_quick_tool_layer_info"><i class=\'dropdown-menu-icon fa fa-list-ul\'></i>图层属性</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_remove"><i class=\'dropdown-menu-icon glyphicon glyphicon-remove\'></i>删除图层</a></li>				</ul>			</li>		</ul>	</div>	<br/>',
i+="</li>"}},getAirlineLayer:function(a,l){if(null!=l){var e=l.name,i='<li class="row layer_row" lname="'+e+'">	<div class="col-md-1 col-xs-1">		<div class="glyphicon glyphicon-chevron-right mc-icon mc-icon-right mc-icon-rotate"></div>	</div>	<div class="col-md-1 col-xs-1">';return i+=l.visible?'		<div class="glyphicon glyphicon-eye-open mc-icon"></div>':'		<div class="glyphicon glyphicon-eye-close mc-icon"></div>',i+="	</div>	<div class=\"col-md-1 col-xs-1\">		<a href='javascript:void(0)' class='mc-icon-airline-layer'>			<i class='fa fa-bar-chart'></i>		</a>	</div>	<div class=\"col-md-5 col-xs-5 layer_name\">		<strong title='"+e+"'>"+e+'</strong>	</div>	<div class="col-md-1">	</div>	<div class="col-md-1">	</div>	<div class="col-md-1 col-xs-1 layer_row_quick_tool">		<ul class="layer_row_quick_tool_ul">			<li class="dropdown pull-right">				<a href="javascript:void(0)" data-toggle="dropdown" class="dropdown-toggle">					<b class="glyphicon glyphicon-cog"></b>				</a>				<ul class="dropdown-menu">					<li><a href="javascript:void(0)" class="layer_row_quick_tool_layer_info"><i class=\'dropdown-menu-icon fa fa-list-ul\'></i>图层属性</a></li>					<li><a href="javascript:void(0)" class="layer_row_quick_tool_remove"><i class=\'dropdown-menu-icon glyphicon glyphicon-remove\'></i>删除图层</a></li>				</ul>			</li>		</ul>	</div>	<br/>',i+="</li>"}},createService:function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var a=mapObj.name,l="http://www.radi.ac.cn/"+a;serviceManager.createService(a,a,l,this.createService_callback)},createService_callback:function(a){MapCloud.notify.showInfo(a,"发布服务")}});
MapCloud.SearchPanel=MapCloud.Class(MapCloud.Panel,{layer:null,operList:["=","<>","Like",">",">=","<","<="],fitler:null,initialize:function(e){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerPanelEvent()},setLayer:function(e){if(null!=e){this.layer=e;var l=this.layer.getFields();this.setFields(l)}},showPanel:function(e){if(null!=e){var l=e.getFields();if(!$.isArray(l))return void MapCloud.notify.showInfo(l,"Warning");MapCloud.Panel.prototype.showPanel.apply(this,arguments),this.setFields(l),this.layer=e}},cleanup:function(){this.layer=null,this.filter=null,this.panel.find(".search-fields-div").html(""),this.panel.find(".search-unique-values").html(""),this.panel.find("#get_unique_btn").removeClass("disabled"),this.panel.find("#search-sql-content").val("")},registerPanelEvent:function(){var e=this;this.panel.find("#get_unique_btn").click(function(){var l=e.panel.find(".search-fields-div .list-group-item.active"),i=l.attr("value");null!=i&&($(this).addClass("disabled"),e.getUniqueValues(i))}),this.panel.find(".search-oper .oper-row .btn").each(function(l,i){$(this).click(function(i){var n=null;switch(l){case 0:n="=";break;case 1:n="<>";break;case 2:n="Like";break;case 3:n=">";break;case 4:n=">=";break;case 5:n="<";break;case 6:n="<="}var a=e.panel.find("#search-sql-content").val();e.sqlAddOper(a,n)})}),this.panel.find(".sql-clear-btn").click(function(){e.panel.find("#search-sql-content").val("")}),this.panel.find(".btn-search").click(function(){e.searchFeatures()})},setFields:function(e){if(null!=e){for(var l=null,i=null,n="",a=0;a<e.length;++a)l=e[a],null!=l&&(i=l.name,"geometry"!=l.type&&(n+="<a href='#' class='list-group-item' value='"+i+"'>\""+i+'"</a>'));this.panel.find(".search-fields-div").html(n),this.registerFieldEvent()}},registerFieldEvent:function(){var e=this;this.panel.find(".search-fields-div .list-group-item").click(function(){var l=e.panel.find(".search-fields-div .list-group-item.active");l.attr("value")!=$(this).attr("value")&&($(this).parent().children().removeClass("active"),$(this).addClass("active"),e.panel.find(".search-unique-values").html(""),e.panel.find("#get_unique_btn").removeClass("disabled"))}).dblclick(function(){var l=$(this).attr("value"),i=e.panel.find("#search-sql-content").val();e.sqlAddField(i,l)})},getUniqueValues:function(e){if(null!=e&&null!=this.layer){var l=this.layer.featureType;if(null!=l){var i=l.workspace;null!=i&&i.getValue(this.layer.name,e,mapObj.name,this.getUniqueValues_callback)}}},getUniqueValues_callback:function(e){if(null!=e){var l=MapCloud.search_panel;l.displayUniqueValues(e)}},displayUniqueValues:function(e){if(null!=e){for(var l=null,i="",n=0;n<e.length;++n)l=e[n],i+="<a href='#' class='list-group-item'>"+l+"</a>";this.panel.find(".search-unique-values").html(i),this.registerUniqueValuesEvent()}},registerUniqueValuesEvent:function(){var e=this;this.panel.find(".search-unique-values .list-group-item").click(function(){$(this).parent().children().removeClass("active"),$(this).addClass("active")}).dblclick(function(){var l=$(this).html(),i=e.panel.find("#search-sql-content").val();e.sqlAddValue(i,l)})},searchFeatures:function(){var e=this.panel.find("#search-sql-content").val(),l=this.getFilter(e);this.filter=l;var i=mapObj.getFeatureFilterCount(this.layer.name,l);MapCloud.dataGrid.setQuery(this.layer,i,this.query_function),MapCloud.dataGrid.setOutput(this.output_function)},query_function:function(e,l){var i=MapCloud.search_panel,n=mapObj.getFeatureFilter(i.layer.name,i.filter,e,l);return n},output_function:function(e,l){var i=MapCloud.search_panel,n=mapObj.queryByFilterOutput(i.layer.name,i.filter,e,l);return n},sqlAddField:function(e,l){if(null!=e&&null!=l){for(var i=e.split(" "),n=0;n<i.length;++n){var a=i[n];if(this.isField(a)){var t=new RegExp(a,"g");return e=e.replace(t,l),void this.panel.find("#search-sql-content").val(e)}}var r=this.panel.find("#search-sql-content").val();this.panel.find("#search-sql-content").val(l+r)}},isField:function(e){if(null!=e){var l=this.layer.getFields();if(null!=l){for(var i=null,n=0;n<l.length;++n)if(i=l[n],i.name==e)return!0;return!1}}},sqlAddOper:function(e,l){if(null!=e&&null!=l){for(var i=e.split(" "),n=!1,a=0;a<i.length;++a){var t=i[a];if(this.isOper(t)){var r=new RegExp(t,"g");return e=e.replace(r,l),void this.panel.find("#search-sql-content").val(e)}this.isField(t)&&(n=!0,field=t)}if(n&&null!=field){var s=(e.indexOf(field)+field.length,[e.slice(0,e.indexOf(field)+field.length)," "+l,e.slice(e.indexOf(field)+field.length,e.length)]);e=s.join(""),this.panel.find("#search-sql-content").val(e)}}},isOper:function(e){return null!=e?-1!=this.operList.indexOf(e)?!0:!1:void 0},sqlAddValue:function(e,l){if(null!=e&&null!=l){for(var i=e.split(" "),n=null,a=0;a<i.length;++a){var t=i[a];if(""!=t&&!this.isOper(t)&&!this.isField(t)&&(null==n?n=t:n+=" "+t,a==i.length-1)){var r=new RegExp(n,"g");return e=e.replace(r,l),void this.panel.find("#search-sql-content").val(e)}}var s=this.panel.find("#search-sql-content").val();this.panel.find("#search-sql-content").val(s+" "+l)}},getFilter:function(e){if(null==e)return null;for(var l=e.split(" "),i=null,n=null,a=null,t=0;t<l.length;++t){var r=l[t];this.isOper(r)&&(i=r),this.isField(r)&&(n=r),this.isOper(r)||this.isField(r)||(null==a?a=r:a+=" "+r)}if(null==i||null==n||null==a)return null;var s=this.createFilter(i,n,a);return s},createFilter:function(e,l,i){if(null==e||null==l||null==i)return null;var n=this.getComparisionOperator(e);if(null!=n){var a=new GeoBeans.PropertyName;a.setName(l);var t=new GeoBeans.Literal;if(t.setValue(i),n==GeoBeans.ComparisionFilter.OperatorType.ComOprIsLike){var r=new GeoBeans.IsLikeFilter;return r.properyName=a,r.literal=t,r.operator=n,r}var s=new GeoBeans.BinaryComparisionFilter;return s.expression1=a,s.expression2=t,s.operator=n,s}},getComparisionOperator:function(e){if(null==e)return null;var l=null;switch(e){case"=":l=GeoBeans.ComparisionFilter.OperatorType.ComOprEqual;break;case"<>":l=GeoBeans.ComparisionFilter.OperatorType.ComOprNotEqual;break;case"Like":l=GeoBeans.ComparisionFilter.OperatorType.ComOprIsLike;break;case">":l=GeoBeans.ComparisionFilter.OperatorType.ComOprGreaterThan;break;case">=":l=GeoBeans.ComparisionFilter.OperatorType.ComOprGreaterThanOrEqual;break;case"<":l=GeoBeans.ComparisionFilter.OperatorType.ComOprLessThan;break;case"<=":l=GeoBeans.ComparisionFilter.OperatorType.ComOprLessThanOrEqual}return l}});
MapCloud.SymbolChartPanel=MapCloud.Class(MapCloud.Panel,{chartLayer:null,initialize:function(e){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerEvent()},showPanel:function(){if("none"==this.panel.css("display")){this.cleanup(),this.panel.css("display","block"),this.panel.find(".panel-collapse").each(function(){$(this).hasClass("in")&&$(this).collapse("hide")});var e=this.panel.find(".panel-collapse").first();e.hasClass("in")||e.collapse("show"),this.showLayerTab()}},hidePanel:function(){MapCloud.Panel.prototype.hidePanel.apply(this,arguments),MapCloud.refresh_panel.refreshPanel()},cleanup:function(){this.chartLayer=null,this.dbName=null,this.tableName=null,this.panel.find(".chart-table-name").val("等级符号图"),this.panel.find(".chart-table").val(""),this.panel.find(".chart-table-fields").empty(),this.panel.find(".chart-base-layer").empty(),this.panel.find(".chart-base-layer-fields").empty(),this.panel.find("#symbol_chart_style_fields").empty(),this.panel.find(".form-group-color input.slider").slider("setValue",100),this.panel.find(".form-group-border input.slider").slider("setValue",100),this.panel.find("#symbol_chart_style_opacity,#symbol_chart_style_border_opacity").html(1),this.panel.find(".chart-table-max-size").val(2),this.panel.find(".form-group-choose-level input[type='checkbox']").prop("checked",!1),this.panel.find("#chart_table_level").prop("disabled",!0),this.panel.find("#chart_table_level option[value='4']").attr("selected",!0),this.panel.find(".colorSelector").colpickSetColor("#EEEEEE"),this.panel.find(".colorSelector div").css("background-color","#EEEEEE"),this.panel.find(".colorSelector div").css("opacity",1)},registerEvent:function(){var e=this;this.panel.find(".btn-chose-chart").click(function(){MapCloud.vector_db_dialog.showDialog("symbol")}),this.panel.find(".colorSelector").each(function(){$(this).colpick({color:"EEEEEE",onChange:function(e,a,t,l,i){$(l).children().css("background-color","#"+a)},onSubmit:function(e,a,t,l,i){$(l).children().css("background-color","#"+a),$(l).colpickHide()}})}),this.panel.find(".form-group-color .slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(a){var t=a.value;e.panel.find("#symbol_chart_style_opacity").html(t/100);var l=$(this).parent().prev().find(".colorSelector div");l.css("opacity",t/100)})}),this.panel.find(".form-group-border .slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(a){var t=a.value;e.panel.find("#symbol_chart_style_border_opacity").html(t/100);var l=$(this).parent().prev().find(".colorSelector div");l.css("opacity",t/100)})}),this.panel.find(".btn-cancel").click(function(){e.hidePanel()}),this.panel.find(".btn-add-chart").click(function(){null==e.chartLayer?e.addChart():e.changeChartOption(),MapCloud.refresh_panel.refreshPanel()}),this.panel.find(".chart-base-layer").change(function(){$(this).val();e.showFields()}),this.panel.find(".chart-base-layer-fields").change(function(){$(this).val()}),this.panel.find(".chart-table-fields").change(function(){$(this).val()}),this.panel.find(".form-group-choose-level input[type='checkbox']").change(function(){var a=$(this).prop("checked");a?e.panel.find("#chart_table_level").prop("disabled",!1):e.panel.find("#chart_table_level").prop("disabled",!0)})},showLayerTab:function(){if(null!=mapObj){for(var e=mapObj.getLayers(),a=null,t="",l=null,i=0;i<e.length;++i)a=e[i],null!=a&&a instanceof GeoBeans.Layer.DBLayer&&a.geomType==GeoBeans.Geometry.Type.POINT&&(l=a.name,t+="<option value='"+l+"'>"+l+"</option>");this.panel.find(".chart-base-layer").html(t);var n=this.panel.find(".chart-base-layer").val();this.showFields(n)}},showFields:function(e){var a=mapObj.getLayer(e);if(null!=a){var t=a.getFields();if(null!=t){for(var l=null,i=null,n="",r=0;r<t.length;++r)l=t[r],null!=l&&(i=l.name,n+="<option value ='"+i+"'>"+i+"</option>");this.panel.find(".chart-base-layer-fields").html(n)}}},setDataSet:function(e,a){this.dbName=e,this.tableName=a,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName)},showTableFields:function(e,a){var t=new GeoBeans.WFSWorkspace("tmp",mapObj.server,"1.0.0"),l=new GeoBeans.FeatureType(t,a),i=l.getFields(null,e);if(null!=i){for(var n=null,r=null,o="",s=0;s<i.length;++s)n=i[s],null!=n&&(r=n.name,o+="<option value='"+r+"'>"+r+"</option>");this.panel.find(".chart-table-fields").html(o),this.showChartFields(i)}},showChartFields:function(e){if(null!=e){for(var a=null,t=null,l=null,i="",n=0;n<e.length;++n)a=e[n],null!=a&&(l=a.type,("double"==l||"int"==l||"float"==l)&&(t=a.name,i+="<option value='"+t+"'>"+t+"</option>"));this.panel.find("#symbol_chart_style_fields").html(i)}},addChart:function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var e=this.panel.find(".chart-table-name").val();if(""==e)return MapCloud.notify.showInfo("请输入专题图名称","Warning"),void this.panel.find(".chart-table-name").focus();var a=this.panel.find(".chart-base-layer").val();if(null==a||""==a)return void MapCloud.notify.showInfo("请选择底图","Warning");var t=this.panel.find(".chart-base-layer-fields").val();if(null==t||""==t)return void MapCloud.notify.showInfo("请选择空间字段","Warning");var l=this.dbName,i=this.tableName;if(null==l||null==i)return void MapCloud.notify.showInfo("请设置表格","Warning");var n=this.panel.find(".chart-table-fields").val();if(null==n||""==n)return void MapCloud.notify.showInfo("请设置关联字段","Warning");var r=this.panel.find("#symbol_chart_style_fields").val();if(null==r||""==r)return void MapCloud.notify.showInfo("请设置专题图字段","Warning");var o=[r],s=this.panel.find(".chart-table-max-size").val();if(null==s||""==s)return void MapCloud.notify.showInfo("请设置符号大小","Warning");var h=this.getChartOption(),c=new GeoBeans.Layer.SymbolChartLayer(e,a,t,l,i,n,o,h);mapObj.addLayer(c,this.addChartLayer_callback),mapObj.draw()},addChartLayer_callback:function(e){if("success"==e){mapObj.draw();var a=MapCloud.symbol_chart_panel,t=a.panel.find(".chart-table-name").val();a.chartLayer=mapObj.getLayer(t)}else MapCloud.notify.showInfo(e,"添加等级符号图")},getChartOption:function(){var e=this.panel.find(".form-group-color .colorSelector div"),a=e.css("opacity"),t=e.css("background-color"),l=new GeoBeans.Color;l.setByRgb(t,1);var i=l.getHex(),n=this.panel.find(".form-group-border .colorSelector div"),r=n.css("opacity"),o=n.css("background-color"),l=new GeoBeans.Color;l.setByRgb(o,1);var s=l.getHex(),h=this.panel.find(".chart-table-max-size").val(),c=this.panel.find(".form-group-choose-level input[type='checkbox']").prop("checked"),d=this.panel.find("#chart_table_level").val(),p=!1;c&&(p=!0);var f={color:i,opacity:parseFloat(a),border:s,borderOpacity:parseFloat(r),maxsize:parseFloat(h),byLevel:p,level:d};return f},changeChartOption:function(){if(null!=this.chartLayer){var e=this.panel.find(".chart-table-name").val();if(""==e)return MapCloud.notify.showInfo("请输入专题图名称","Warning"),void this.panel.find(".chart-table-name").focus();this.chartLayer.setName(e);var a=this.panel.find(".chart-base-layer").val();if(null==a||""==a)return void MapCloud.notify.showInfo("请选择底图","Warning");this.chartLayer.setBaseLayer(a);var t=this.panel.find(".chart-base-layer-fields").val();if(null==t||""==t)return void MapCloud.notify.showInfo("请选择空间字段","Warning");this.chartLayer.setBaseLayerField(t),this.dbName!=this.chartLayer.dbName&&this.chartLayer.setDbName(this.dbName),this.tableName!=this.chartLayer.tableName&&this.chartLayer.setTableName(this.tableName);var l=this.panel.find(".chart-table-fields").val();if(null==l||""==l)return void MapCloud.notify.showInfo("请设置关联字段","Warning");this.chartLayer.setTableField(l);var i=this.panel.find("#symbol_chart_style_fields").val();if(null==i||""==i)return void MapCloud.notify.showInfo("请设置专题图字段","Warning");i!=this.chartLayer.chartFields[0]&&this.chartLayer.setChartFields([i]);var n=this.getChartOption();this.chartLayer.setChartOption(n),mapObj.draw()}},setChartLayer:function(e){if(this.chartLayer=e,null!=this.chartLayer){var a=this.chartLayer.name;this.panel.find(".chart-table-name").val(a);var t=this.chartLayer.getBaseLayer(),l=this.chartLayer.getBaseLayerField(),i=this.chartLayer.getDbName(),n=this.chartLayer.getTableName(),r=this.chartLayer.getTableField();this.dbName=i,this.tableName=n,this.panel.find(".chart-table").val(this.tableName),this.showTableFields(this.dbName,this.tableName),this.panel.find(".chart-table-fields option[value='"+r+"']").attr("selected",!0),this.panel.find(".chart-base-layer option[value='"+t+"']").attr("selected",!0),this.panel.find(".chart-base-layer-fields option[value='"+l+"']").attr("selected",!0);var o=this.chartLayer.getChartFields(),s=o[0];null!=s&&this.panel.find("#symbol_chart_style_fields option[value='"+s+"']").attr("selected",!0);var h=this.chartLayer.getChartOption(),c=h.color,d=h.opacity,p=h.border,f=h.borderOpacity,u=h.byLevel,b=h.maxsize,y=h.level;this.panel.find(".form-group-color input.slider").slider("setValue",100*d),this.panel.find(".form-group-border input.slider").slider("setValue",100*f),this.panel.find("#symbol_chart_style_opacity").html(d),this.panel.find("#symbol_chart_style_border_opacity").html(f),this.panel.find(".chart-table-max-size").val(b),u?(this.panel.find(".form-group-choose-level input[type='checkbox']").prop("checked",!0),this.panel.find("#chart_table_level").val(y)):this.panel.find(".form-group-choose-level input[type='checkbox']").prop("checked",!1),this.panel.find(".form-group-color .colorSelector").colpickSetColor(c),this.panel.find(".form-group-color .colorSelector div").css("background-color",c),this.panel.find(".form-group-color .colorSelector div").css("opacity",d),this.panel.find(".form-group-border .colorSelector").colpickSetColor(p),this.panel.find(".form-group-border .colorSelector div").css("background-color",p),this.panel.find(".form-group-border .colorSelector div").css("opacity",f)}}});
MapCloud.Table=MapCloud.Class({panel:null,height:200,width:300,number:5,colModel:null,datas:null,page:1,headerHtml:null,bodyHtml:null,footerHtml:null,html:null,clickCallback:null,initialize:function(t,i,l,e,a,n){this.panel=$("#"+t),this.height=l,this.width=i,this.colModel=e,this.datas=a,this.number=n;var o=a.length;this.page=Math.ceil(o/n),this.createHeaderHtml(),this.createBodyHtml(1),this.createFooterHtml(1)},createHeaderHtml:function(){var t='<div class="table_grid_header">';t+='<table  cellpadding="0" cellspacing="0" border="0">',t+="<thead>",t+="<tr>";for(var i=0;i<this.colModel.length;++i){var l=this.colModel[i],e=l.display,a=(l.name,l.hide);t+=1==a?'<td style ="display:none">':"<td>",t+='<div style="width:80px">',t+=e,t+="</div>",t+="</td>"}return t+="</tr>",t+="</thead>",t+="</table>",t+="</div>"},createBodyHtml:function(t){var i="";i='<table cellpadding="0" cellspacing="0" border="0">',i+="<tbody>";for(var l=(t-1)*this.number,e=l;e<l+this.number;++e){var a=this.datas[e];if(null!=a){i+=e%2==0?"<tr>":'<tr class="erow">';for(var n=0;n<this.colModel.length;++n){var o=this.colModel[n],c=o.hide;i+=1==c?'<td style="display:none">':"<td>",i+='<div style="width:80px">',i+=a[n],i+="</div>",i+="</td>"}i+="</tr>"}}return i+="</tbody>",i+="</table>"},createFooterHtml:function(t){return footerHtml='<div class="table_grid_footer">',footerHtml+="		<div>",footerHtml+='		<div class="mc-icon-first mc-icon float_left"></div>',footerHtml+='		<div class="mc-icon-prev mc-icon float_left"></div>',footerHtml+='		<input type="text" class="float_left page" value="'+t+'">',footerHtml+='		<span class="float_left">/</span>',footerHtml+='		<span class="float_left">'+this.page+"</span>",footerHtml+='		<div class="mc-icon-next mc-icon float_left"></div>',footerHtml+='		<div class="mc-icon-last mc-icon float_left"></div>',footerHtml+="		</div>",footerHtml+="</div>",footerHtml},show:function(t){html="<div class='table_grid'>",html+=this.createHeaderHtml(),html+='<div class="table_grid_content">',html+=this.createBodyHtml(1),html+="</div>",html+=this.createFooterHtml(1),html+="</div>",this.panel.html(html);var i=this.panel.find(".table_grid_header").height(),l=this.panel.find(".table_grid_footer").height(),e=this.height-i-l;this.panel.find(".table_grid_content").css("height",e+"px"),this.panel.find(".table_grid_content").each(function(){$(this).scroll(function(){var t=$(".table_grid_content").scrollLeft();$(".table_grid_header").scrollLeft(t)})});var a=this;this.panel.find(".mc-icon-next").each(function(){$(this).click(function(){a.toNext()})}),this.panel.find(".mc-icon-prev").each(function(){$(this).click(function(){a.toPrev()})}),this.panel.find(".mc-icon-first").each(function(){$(this).click(function(){a.toFirst()})}),this.panel.find(".mc-icon-last").each(function(){$(this).click(function(){a.toLast()})}),this.clickCallback=t,this.panel.find(".table_grid_content tr").each(function(){$(this).click(function(){a.clickCallback($(this))})})},toNext:function(){var t=parseInt(this.panel.find(".page").val()),i=t+1;this.toPage(i)},toPrev:function(){var t=parseInt(this.panel.find(".page").val()),i=t-1;this.toPage(i)},toFirst:function(){this.toPage(1)},toLast:function(){this.toPage(this.page)},toPage:function(t){if(!(t>this.page||1>t)){this.panel.find(".page").val(t);var i=this.createBodyHtml(t);this.panel.find(".table_grid_content").html(i);var l=this;this.panel.find(".table_grid_content tr").each(function(){$(this).click(function(){l.clickCallback($(this))})})}}});
MapCloud.TopicPanel=MapCloud.Class(MapCloud.Panel,{pois:null,aqiFeatures:null,initialize:function(i){MapCloud.Panel.prototype.initialize.apply(this,arguments),this.registerEvent()},showPanel:function(){this.panel.css("width","300px"),$(".float-coordinates").css("right","330px")},hidePanel:function(){this.panel.css("width","0px"),$(".float-coordinates").css("right","30px"),this.pois=null,this.aqiFeatures=null},registerEvent:function(){this.panel.find(".topic-count").click(function(){alert("infos")})},setPois:function(i){if(0!=i.length){var a=new Date;a=a.toLocaleString();var l='<div class="row">	<i class="fa fa-clock-o"></i><span>'+a+'</span><br/><br/><span style="margin-left:15px">新增订阅信息<a href="javascript:void(0)" class="topic-count">'+i.length+"</a>条</span></div>";this.panel.find(".panel-content").html(l),this.showPanel(),this.pois=i;var o=this;this.panel.find(".topic-count").click(function(){MapCloud.poi_dialog.showDialog(),MapCloud.poi_dialog.setPois(o.pois)})}},getSub_callback:function(i,a,l){var o=MapCloud.topicPanel;o.setResults(i,a,l)},setResults:function(i,a,l){var o=new Date;if(console.log(o),null!=i&&$.isArray(l)&&$.isArray(a)&&(console.log(i),console.log(null==l?"aqi null":l.length),console.log(null==a?"pois null":a.length),0!=l.length||0!=a.length)){var s=i.toLocaleString(),t="",t='<div class="row">	<i class="fa fa-clock-o"></i><span>'+s+"</span></div>";0!=l.length&&(t+='<div class="row"> 新增AQI点<a href="javascript:void(0)" class="aqi-count">'+ +l.length+"</a>条</div>"),0!=a.length&&(t+='<div class="row"> 新增POI点<a href="javascript:void(0)" class="poi-count">'+ +a.length+"</a>条</div>"),this.panel.find(".panel-content").html(t),this.showPanel();var n=this;n.pois=a,n.aqiFeatures=l,this.panel.find(".aqi-count").click(function(){MapCloud.aqi_features_dialog.showDialog(),MapCloud.aqi_features_dialog.setAqiFeatures(n.aqiFeatures)}),this.panel.find(".poi-count").click(function(){MapCloud.poi_dialog.showDialog(),MapCloud.poi_dialog.setPois(n.pois)})}}});
MapCloud.TrackOverlay=MapCloud.Class({panel:null,controlPanel:null,trackOverlayControl:null,editOverlay:null,initialize:function(l,t){this.panel=$("#"+l),this.controlPanel=$("#"+t);var a=this;this.controlPanel.find("#track_marker").each(function(){$(this).click(function(l){l.preventDefault(),$(this).toggleClass("normal"),a.trackMarker()})}),this.controlPanel.find("#track_polyline").each(function(){$(this).click(function(l){l.preventDefault(),a.trackPolyline()})}),this.controlPanel.find("#track_polygon").each(function(){$(this).click(function(l){l.preventDefault(),a.trackPolygon()})})},show:function(){if(null!=mapObj&&("block"!=this.panel.css("display")||"block"!=this.controlPanel.css("display"))){null==MapCloud.refresh_panel&&(MapCloud.refresh_panel=new MapCloud.refresh("left_panel")),null==this.trackOverlayControl&&(this.trackOverlayControl=new GeoBeans.Control.TrackOverlayControl,mapObj.controls.add(this.trackOverlayControl)),mapObj.registerOverlayEvent(),MapCloud.refresh_panel.hide(),this.panel.css({display:"block",opacity:"0"}).animate({opacity:"1"},1e3),this.controlPanel.css({display:"block",opacity:"0"}).animate({opacity:"1"},1e3);var l=mapObj.getOverlays();this.showOverlaysList(l)}},hide:function(){MapCloud.refresh_panel.show(),this.panel.css("display","none"),this.controlPanel.css("display","none"),mapObj.unregisterOverlayEvent()},trackMarker:function(){this.trackOverlayControl.trackMarker(this.callbackTrackOverlay)},trackPolyline:function(){this.trackOverlayControl.trackLine(this.callbackTrackOverlay)},trackPolygon:function(){this.trackOverlayControl.trackPolygon(this.callbackTrackOverlay)},callbackTrackOverlay:function(l){if(null==l&&null==MapCloud.overlay_panel.editOverlay){var t=mapObj.getOverlays();return void MapCloud.overlay_panel.showOverlaysList(t)}if(null!=l||null==MapCloud.overlay_panel.editOverlay){var a=l.isEdit;a?MapCloud.overlay_panel.showEditOverlay(l):MapCloud.overlay_panel.showHitOverlay(l)}},showEditOverlay:function(l){if(null!=l){this.editOverlay=l;var t="",a=l.name,e=l.type,n=this.getOverlayTypeSpanHtml(e),o=l.kvMap,r=this.getEditOverlayValuesHtml(o);t='<div class="row left_row">	<button type="button" class="btn btn-default col-md-offset-3 col-xs-offset-3 btn-cancel">撤销</button>	<button type="button" class="btn btn-primary btn-confirm col-md-offset-1 col-xs-offset-1">保存</button></div><div class="row left_row_wrapper left_row_title">	<div class="col-md-3 col-xs-3 left_row_title">名称</div></div><div class="row left_row overlay_row">	<div class="input-group">'+n+'	  <input type="text" class="form-control input-overlay-read" id="overlay_edit_name"		 value="'+a+'">	</div></div>	<div class="row left_row_wrapper left_row_title">	<div class="col-md-3 col-xs-3 left_row_title">属性</div></div>'+r,this.panel.html(t);var i=this;this.panel.find(".glyphicon-plus").each(function(){$(this).click(function(){var l='<li class="row left_row">	<div class="col-md-4 col-xs-4 overlay_key">		<input type="text" class="form-control" placeholder="key" value="">	</div>	<div class="input-group col-md-8 col-xs-8 overlay_value">		<input type="text" class="form-control" placeholder="Value" value="">		<span class="input-group-addon glyphicon glyphicon-trash span-overlay-marker"></span>	</div></li>';i.panel.find("#overlay_edit_values_row").append(l),i.panel.find(".glyphicon-trash").each(function(){$(this).click(function(){$(this).parents("li").remove()})})})}),this.panel.find(".glyphicon-trash").each(function(){$(this).click(function(){$(this).parents("li").remove()})}),this.panel.find(".btn-cancel").each(function(){$(this).click(function(){i.editOverlay.endEdit(),i.editOverlay=null;var l=mapObj.getOverlays();i.showOverlaysList(l)})}),this.panel.find(".btn-confirm").each(function(){$(this).click(function(){i.editOverlay.removeKeys();var l=i.panel.find("#overlay_edit_name").val();i.panel.find("#overlay_edit_values_row li").each(function(){var l=$(this).find(".overlay_key input").val(),t=$(this).find(".overlay_value input").val();i.editOverlay.addKeyValue(l,t)}),i.editOverlay.name=l,i.editOverlay.endEdit(),i.editOverlay=null;var t=mapObj.getOverlays();i.showOverlaysList(t)})})}},showHitOverlay:function(l){if(null==this.editOverlay){var t="",a=l.type,e=this.getOverlayTypeSpanHtml(a),n=l.name,o=l.kvMap,r=this.getHitOverlayValuesHtml(o);t+='<div class="row left_row_wrapper left_row_title">	<div class="col-md-3 col-xs-3 left_row_title">名称</div></div><div class="row left_row overlay_row">	<div class="input-group">'+e+'	  <input type="text" class="form-control input-overlay-read" 		 value="'+n+'" readonly>	</div></div>	<div class="row left_row_wrapper left_row_title">	<div class="col-md-3 col-xs-3 left_row_title">属性</div></div>'+r,this.panel.html(t)}},showOverlaysList:function(l){var t=this,a='<div class="row left_row_wrapper" style="margin-top: 10px">	<button type="button" class="btn btn-default col-md-offset-3 col-xs-offset-3 btn-cancel">清空</button>	<button type="button" class="btn btn-primary btn-confirm col-md-offset-1 col-xs-offset-1">返回</button></div>';a+='<ul class="row left_row_wrapper" id="overlays_row">';for(var e=0;e<l.length;++e){var n=l[e];if(null!=n){var o=this.showOverlay(n,e);a+=o}}a+="</ul>",this.panel.html(a),this.panel.find("#overlays_row .input-group").mouseover(function(){$(this).find(".input-group-btn").css("display","table-cell")}),this.panel.find("#overlays_row .input-group").mouseout(function(){$(this).find(".input-group-btn").css("display","none")}),this.panel.find(".btn-edit").each(function(){$(this).click(function(){var l=$(this).parents(".overlay_row").attr("value"),a=mapObj.getOverlay(parseInt(l));t.showEditOverlay(a),a.beginEdit(),mapObj.setFitView(a)})}),this.panel.find(".btn-remove").each(function(){$(this).click(function(){if(confirm("确定删除该标注吗？")){var l=$(this).parents(".overlay_row").attr("value");mapObj.removeOverlay(parseInt(l)),mapObj.draw();var a=mapObj.getOverlays();t.showOverlaysList(a)}})}),this.panel.find(".btn-confirm").each(function(){$(this).click(function(){t.hide()})}),this.panel.find(".btn-cancel").each(function(){$(this).click(function(){var l=confirm("确定清空标注吗？");if(l){mapObj.clearOverlays(),mapObj.draw();var a=mapObj.getOverlays();t.showOverlaysList(a)}})})},showOverlay:function(l,t){var a="",e=l.name,n=l.type,o=this.getOverlayTypeSpanHtml(n);return a+='<li class="row left_row overlay_row" value="'+t+'">	<div class="input-group">'+o+'	  <input type="text" class="form-control input-overlay-read" 			readonly value="'+e+'">	  <span class="input-group-btn" style="display: none;">	 	 <button class="btn btn-default btn-edit" type="button">编辑</button>	  	 <button class="btn btn-default btn-remove" type="button">删除</button>	  </span>	</div></li>'},getOverlayTypeSpanHtml:function(l){var t="";switch(l){case GeoBeans.Overlay.Type.MARKER:t='<span class="input-group-addon glyphicon glyphicon-map-marker span-overlay-marker"></span>';break;case GeoBeans.Overlay.Type.PLOYLINE:t='<span class="input-group-addon glyphicon glyphicon-align-justify span-overlay-marker"></span>';break;case GeoBeans.Overlay.Type.POLYGON:t='<span class="input-group-addon glyphicon glyphicon-unchecked span-overlay-marker"></span>';break;default:t='<span class="input-group-addon glyphicon glyphicon-globe span-overlay-marker"></span>'}return t},getHitOverlayValuesHtml:function(l){var t='<ul class="row left_row_wrapper" id="overlay_hit_values_row">';for(var a in l){var e=l[a];t+='<li class="row left_row">	<div class="col-md-5 col-xs-5 overlay_key">		<input type="text" class="form-control" value="'+a+'" readonly>	</div>	<div class="col-md-7 col-xs-7 overlay_value">		<input type="text" class="form-control" value="'+e+'" readonly>	</div></li>'}return t+="</ul>"},getEditOverlayValuesHtml:function(l){var t='<div class="row left_row_wrapper" id="overlay_add_value_row">	 <button type="button" class="btn glyphicon glyphicon-plus 		col-md-4 col-md-offset-4 col-xs-4 col-xs-offset-4"></button></div><ul class="row left_row_wrapper" id="overlay_edit_values_row">';for(var a in l){var e=l[a];t+='<li class="row left_row">	<div class="col-md-4  col-xs-4 overlay_key">		<input type="text" class="form-control" value="'+a+'">	</div>	<div class="input-group col-md-8 col-xs-8 overlay_value">		<input type="text" class="form-control" value="'+e+'">		<span class="input-group-addon glyphicon glyphicon-trash span-overlay-marker"></span>	</div></li>'}return t+="</ul>"}});
MapCloud.UserToolBar=MapCloud.Class(MapCloud.Panel,{initialize:function(a){MapCloud.Panel.prototype.initialize.apply(this,arguments)},showUser:function(a){this.panel.find(".login-li").html('<a href="javascript:void(0)" id="logout_btn">退出</a>'),"admin"==a?this.panel.find(".register-li").html('<a href="../Admin/" target="_blank">'+a+"</a>"):this.panel.find(".register-li").html('<a href="../User/" target="_blank">'+a+"</a>");var l=this;l.username=a,$("#logout_btn").click(function(){confirm("确定要退出当前账户吗？")&&authManager.logout(l.username,l.logout_callback)})},logout_callback:function(a){MapCloud.notify.showInfo(a,"注销");MapCloud.userToolBar;"success"==a&&(MapCloud.account.showLoginPanel(),$(".map-panel").css("display","none"),$(".register-panel").css("display","none"),$(".login-panel").css("display","block"),user.logout(),MapCloud.cookieObj.delCookie("username","/MapCloud"),MapCloud.refresh_panel.cleanup(),null!=mapObj&&mapObj.close(),mapObj=null)}});
MapCloud.AQI24hDialog=MapCloud.Class(MapCloud.Dialog,{dbName:null,tableName:null,timeField:null,timePoint:null,chartField:null,stationCodeField:null,stationCode:null,positionName:null,container:null,chart:null,indexSelect:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments),this.container=this.panel.find("#aqi_24_div"),this.chartFields=[]},cleanup:function(){null!=this.chart&&(this.chart.cleanup(),this.chart=null),this.chartFields=[],this.panel.find(".aqi-index-div").empty();var t='<select id="aqi_24_index_select" multiple="multiple" style="width:100%">		<option value="aqi">空气质量指数</option>		<option value="pm10">颗粒物（粒径小于等于10μm）1小时平均</option>		<option value="pm10_24h">颗粒物（粒径小于等于10μm）24小时滑动平均</option>		<option value="pm2_5">颗粒物（粒径小于等于2.5μm）1小时平均</option>		<option value="pm2_5_24h">颗粒物（粒径小于等于2.5μm）24小时滑动平均</option>		<option value="no2">二氧化氮1小时平均</option>		<option value="no2_24h">二氧化氮24小时滑动平均</option>		<option value="o3">臭氧1小时平均</option>		<option value="o3_24h">臭氧日最大1小时平均</option>		<option value="o3_8h">臭氧8小时滑动平均</option>		<option value="o3_8h_24h">臭氧日最大8小时滑动平均</option>		<option value="so2">二氧化硫1小时平均</option>		<option value="so2_24h">二氧化硫24小时滑动平均</option>		<option value="co">一氧化碳1小时平均</option>		<option value="co_24h">一氧化碳24小时滑动平均</option>	</select>';this.panel.find(".aqi-index-div").html(t);var i=this;this.indexSelect=this.panel.find("#aqi_24_index_select"),this.indexSelect.multiselect({buttonWidth:"30px",onChange:function(t,e){var n=i.indexSelect.val();return null==n?void MapCloud.notify.showInfo("请选择一个展示的质量指数","Warning"):(i.chartFields=n,void(null!=i.chart&&(i.chart.setChartFields(n),i.chart.show())))}}),$("#aqi_24_index_select").multiselect()},setTimeField:function(t){this.timeField=t},setTimePoint:function(t){this.timePoint=t},setStationCode:function(t){this.stationCode=t},setStationCodeField:function(t){this.stationCodeField=t},setDbName:function(t){this.dbName=t},setTableName:function(t){this.tableName=t},setChartField:function(t){this.chartFields.push(t),this.indexSelect.multiselect("select",[t])},setPositionName:function(t){this.positionName=t},showAQIIndexChart:function(){if(null!=this.container&&null!=this.dbName&&null!=this.tableName&&null!=this.chartFields&&null!=this.stationCode&&null!=this.stationCodeField&&null!=this.timeField){var t=this.getTimeList(this.timePoint);if(null!=t){var i=this.positionName+"24小时空气质量变化情况";this.panel.find(".modal-title").html(i);var e=new GeoBeans.AQIIndexChart(i,this.container[0],this.dbName,this.tableName,this.chartFields,this.stationCodeField,this.stationCode,this.timeField,t[0],t[1]);e.setMap(mapObj),e.show(),this.chart=e}}},getTimeList:function(t){if(null==t)return null;var i=new Date(t),e=new Date(t),n=new Date(t),o=n.getHours();i.setHours(o-12),e.setHours(o+12);var l=this.toTimeFormat(i),a=this.toTimeFormat(e);return[l,a]},toTimeFormat:function(t){if(null==t)return null;var i=t.getFullYear().toString(),e=(t.getMonth()+1).toString(),n=t.getDate().toString(),o=t.getHours().toString(),l=t.getMinutes().toString(),a=t.getSeconds().toString();return i+"-"+(e[1]?e:"0"+e[0])+"-"+(n[1]?n:"0"+n[0])+" "+(o[1]?o:"0"+o[0])+":"+(l[1]?l:"0"+l[0])+":"+(a[1]?a:"0"+a[0])}});
MapCloud.AQIFeaturesDialog=MapCloud.Class(MapCloud.Dialog,{maxCount:30,pageCount:null,pageNumber:5,features:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments)},cleanup:function(){this.panel.find("table tbody").empty(),this.panel.find(".aqi-count span").html("0"),this.panel.find(".pagination").empty()},setAqiFeatures:function(t){if($.isArray(t)){this.features=t;var a=t.length,i=Math.ceil(a/this.maxCount);this.pageCount=i,this.initPageControl(1,this.pageCount),this.panel.find(".aqi-count span").html(a)}},initPageControl:function(t,a){if(!(0>=t||t>a)){var i="";if(i+=1==t?'<li class="disabled">		<a href="#" aria-label="Previous">			<span aria-hidden="true">«</span>		</a>	</li>':'<li>		<a href="#" aria-label="Previous">			<span aria-hidden="true">«</span>		</a>	</li>',a<=this.pageNumber)for(var e=1;a>=e;++e)i+=e==t?'<li class="active">	<a href="#">'+t.toString()+'		<span class="sr-only">(current)</span></a></li>':"<li><a href='#'>"+e+"</a></li>";else{var l=a-this.pageNumber+1;if(l>=t)for(var e=t;e<t+this.pageNumber;++e)i+=e==t?'<li class="active">	<a href="#">'+t+"</a></li>":"<li><a href='#'>"+e+"</a></li>";else for(var e=l;a>=e;++e)i+=e==t?'<li class="active">	<a href="#">'+t+"</a></li>":"<li><a href='#'>"+e+"</a></li>"}i+=t==a?'<li class="disabled">		<a href="#" aria-label="Next">			<span aria-hidden="true">»</span>		</a>	</li>':'<li>		<a href="#" aria-label="Next">			<span aria-hidden="true">»</span>		</a>	</li>',this.panel.find(".pagination").html(i),this.registerPageEvent();var n=(t-1)*this.maxCount,s=this.features.slice(n,n+this.maxCount-1);this.displayFeatures(s)}},registerPageEvent:function(){var t=this;this.panel.find(".pagination li a").click(function(){var a=t.panel.find(".pagination li.active a").html(),i=parseInt(a),e=$(this).attr("aria-label");"Previous"==e?i-=1:"Next"==e?i+=1:i=parseInt($(this).html()),t.initPageControl(i,t.pageCount)})},displayFeatures:function(t){if($.isArray(t)){var a=t[0].featureType;if(null!=a){for(var i=a.getFieldIndex("x"),e=a.getFieldIndex("y"),l=null,n=null,s=null,d=null,r="",u=0;u<t.length;++u)l=t[u],null!=l&&(d=l.values,null!=d&&(n=d[i],s=d[e],null==n||null==s||"0"==n&&"0"==s||(r+="<tr>	<td>"+d[0]+"</td>	<td>"+d[1]+"</td>	<td>"+d[2]+"</td>	<td>"+d[3]+"</td>	<td>"+d[4]+"</td>	<td>"+d[5]+"</td>	<td>"+d[6]+"</td>	<td>"+d[7]+"</td>	<td>"+d[8]+"</td>	<td>"+d[9]+"</td>	<td>"+d[10]+"</td>	<td>"+d[11]+"</td>	<td>"+d[12]+"</td>	<td>"+d[13]+"</td>	<td>"+d[14]+"</td>	<td>"+d[15]+"</td>	<td>"+d[16]+"</td>	<td>"+d[17]+"</td>	<td>"+d[18]+"</td>	<td>"+d[19]+"</td>	<td>"+d[20]+"</td>	<td class='xvalue'>"+d[21]+"</td>	<td class='yvalue'>"+d[22]+"</td></tr>")));this.panel.find("table tbody").html(r)}}}});
MapCloud.AQIStatCompDialog=MapCloud.Class(MapCloud.Dialog,{chartLayer:null,controlPanel:null,stations:null,chart:null,initialize:function(t,i){MapCloud.Dialog.prototype.initialize.apply(this,arguments),this.controlPanel=$("#"+i);var n=this;this.stations=[],this.controlPanel.find(".aqi-station-btn .btn-comp").click(function(){return n.stations.length<2?void MapCloud.notify.showInfo("请至少选择两个站点","Warning"):(n.showDialog(),void n.compareStations())}),this.controlPanel.find(".aqi-station-btn .btn-close").click(function(){n.hideControlPanel()}),this.container=this.panel.find("#aqi_stat_com_div")},cleanup:function(){null!=this.chart&&this.chart.cleanup()},cleanupStations:function(){this.stations=[],this.displayStations(),this.hideControlPanel(),this.cleanup()},setChartLayer:function(t){this.chartLayer=t},showControlPanel:function(){this.controlPanel.css("display","block")},hideControlPanel:function(){this.controlPanel.css("display","none")},addStation:function(t){if(this.showControlPanel(),null!=t){for(var i=(t.name,t.code),n=null,a=0;a<this.stations.length;++a)if(n=this.stations[a],n.code==i)return;this.stations.push(t),this.displayStations(),this.showControlPanel()}},displayStations:function(){if(null!=this.stations){for(var t=null,i="",n=0;n<this.stations.length;++n)if(t=this.stations[n],null!=t){var a=t.name,s=t.code;i+='<div class="aqi-station-div" code="'+s+'">		<button type="button" class="close">			<span aria-hidden="true">×</span>			<span class="sr-only">Close</span>		</button>		<span>'+a+"</span>	</div>"}this.controlPanel.find(".aqi-station-list").html(i),this.registerStationListEvent()}},registerStationListEvent:function(){var t=this;this.controlPanel.find(".close").click(function(){var i=$(this).parents(".aqi-station-div"),n=i.attr("code");t.removeStation(n)})},removeStation:function(t){if(null!=t)for(var i=null,n=null,a=0;a<this.stations.length;++a)if(i=this.stations[a],null!=i&&(n=i.code,n==t))return this.stations.splice(a,1),void this.displayStations()},compareStations:function(){if(null!=this.stations&&0!=this.stations.length&&null!=this.chartLayer){var t=this.getStationCodes();if(null!=t){var i=this.chartLayer.getDbName(),n=this.chartLayer.getTableName(),a=this.chartLayer.getChartField(),s=this.chartLayer.getFlagField(),o=this.chartLayer.getTimeField(),l=this.chartLayer.getTimePoint(),e=MapCloud.aqi_24h_dialog.getTimeList(l);if(null!=e){var h=this.chartLayer.getLableField(),r=new GeoBeans.AQIStatCompChart("站点对比图",this.container[0],i,n,[a],s,t,o,e[0],e[1],h);r.setMap(mapObj),r.show(),this.chart=r}}}},getStationCodes:function(){if(null==this.stations)return null;for(var t=null,i=null,n=[],a=0;a<this.stations.length;++a)t=this.stations[a],null!=t&&(i=t.code,n.push(i));return n}});
MapCloud.BaseLayerDialog=MapCloud.Class(MapCloud.Dialog,{map:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var a=this;this.panel.find(".list-group-item").click(function(){var e=$(this).attr("btype");a.showMap(e)}),this.panel.find(".btn-confirm").click(function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var e=a.panel.find(".list-group-item.active").attr("btype"),i=null;"image"==e?i=new GeoBeans.Layer.QSLayer("base","/QuadServer/maprequest?services=world_image"):"vector"==e&&(i=new GeoBeans.Layer.QSLayer("base","/QuadServer/maprequest?services=world_vector")),null!=i&&(i.MAX_ZOOM_LEVEL=18,MapCloud.notify.loading(),mapObj.insertLayer(i,a.insertLayer_callback),a.closeDialog())})},insertLayer_callback:function(e){var a=MapCloud.base_layer_dialog,i=a.panel.find(".list-group-item.active").attr("btype"),s="";"image"==i?s="影像":"vector"==i&&(s="矢量");var t=(a.panel.find("#new_layer_name").val(),"注册"+s+"底图 ");MapCloud.notify.showInfo(e,t),"success"==e.toLowerCase()&&MapCloud.refresh_panel.refreshPanel(),mapObj.draw()},showDialog:function(e){var a=$("body").width(),i=this.panel.find(".modal-dialog").width();i>a&&(i=a-40,this.panel.find(".modal-dialog").css("width",i+"px")),MapCloud.Dialog.prototype.showDialog.apply(this,arguments),this.showMap(e)},cleanup:function(){this.panel.find("#base_layer_canvas_wrapper").empty(),null!=this.map&&(this.map.close(),this.map=null)},showMap:function(e){if(null!=e){this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".list-group-item[btype='"+e+"']").addClass("active");var a=new GeoBeans.Geometry.Point(0,0),i=2;if(null==this.map){var s=new GeoBeans.Envelope(-180,-90,180,90);this.map=new GeoBeans.Map(null,"base_layer_canvas_wrapper","name",s,4326)}else this.map.removeBaseLayer(),this.map.draw(),a=this.map.center,i=this.map.level;var t=null;"image"==e?t=new GeoBeans.Layer.QSLayer("base","/QuadServer/maprequest?services=world_image"):"vector"==e&&(t=new GeoBeans.Layer.QSLayer("base","/QuadServer/maprequest?services=world_vector")),this.map.setBaseLayer(t),this.map.setCenter(a),this.map.setLevel(i),this.map.draw()}}});
MapCloud.CreateMapDialog=MapCloud.Class(MapCloud.Dialog,{initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var e=this;this.panel.find(".thumbnail").each(function(){$(this).click(function(){$(this).hasClass("selected")?$(this).removeClass("selected"):($(this).parents("#base_map_list").find(".thumbnail").removeClass("selected"),$(this).addClass("selected"))})}),this.panel.find("#create_map_infos").click(function(){$(this).hasClass("info-invis")?(e.panel.find(".create-map-info-item").slideDown(),$(this).removeClass("info-invis"),$(this).addClass("info-vis")):(e.panel.find(".create-map-info-item").slideUp(),$(this).addClass("info-invis"),$(this).removeClass("info-vis"))}),this.panel.find("#create_map_name").keypress(function(a){13==a.which&&e.onCreateMap()}),this.panel.find(".btn-confirm").each(function(){$(this).click(function(){e.onCreateMap()})})},onCreateMap:function(){var a=this,e=a.panel.find("#create_map_name").val();if(null==e||""==e)return MapCloud.notify.showInfo("请输入地图名称！","Warning"),void a.panel.find("#create_map_name").focus();var n=/^([\u4E00-\uFA29]|[\uE7C7-\uE7F3]|[a-zA-Z0-9]|[_])*$/;if(!n.test(e))return MapCloud.notify.showInfo("请输入有效的地图名称","Warning"),void a.panel.find("#create_map_name").focus();var i=a.panel.find("#create_map_srid").val();if(null==i||""==i)return MapCloud.notify.showInfo("请输入空间参考","Warning"),void a.panel.find("#create_map_srid").focus();if(!$.isNumeric(i))return MapCloud.notify.showInfo("请输入有效的空间参考","Warning"),void a.panel.find("#create_map_srid").focus();var l=a.panel.find("#create_map_xmin").val(),s=a.panel.find("#create_map_ymin").val(),t=a.panel.find("#create_map_xmax").val(),o=a.panel.find("#create_map_ymax").val(),p=new GeoBeans.Envelope(parseFloat(l),parseFloat(s),parseFloat(t),parseFloat(o));return null==p?void MapCloud.notify.showInfo("请输入有效的范围！","Warning"):(MapCloud.notify.loading(),mapManager.createMap("mapCanvas_wrapper",e,p,i,a.createMap_callback),void ribbonObj.showMapTab())},createMap_callback:function(a,e){var n=MapCloud.create_map_dlg,i=n.panel.find("#create_map_name").val(),l="创建地图 [ "+i+" ]";MapCloud.notify.showInfo(e,l),n.closeDialog();var s=null,t=n.panel.find(".thumbnail.selected").attr("bname");switch(t){case"vector":s="/QuadServer/maprequest?services=world_vector";break;case"image":s="/QuadServer/maprequest?services=world_image";break;case"none":s=null}n.drawMap(a,s),n.cleanupPage()},showDialog:function(){this.cleanup(),this.panel.modal();var a=this;this.panel.on("shown.bs.modal",function(){a.panel.find("#create_map_name").focus()})},cleanup:function(){this.panel.find("#create_map_name").each(function(){$(this).val("")})},drawMap:function(a,e){if(null!=a){if(mapObj=a,null!=e){var n=new GeoBeans.Layer.QSLayer("base",e);mapObj.insertLayer(n,null)}else mapObj.setViewer(mapObj.extent);mapObj.draw(),mapObj.addEventListener(GeoBeans.Event.MOUSE_MOVE,MapCloud.tools.onMapMove),mapObj.setNavControl(!1)}$(".mc-panel").css("display","none")},cleanupPage:function(){MapCloud.refresh_panel.refreshPanel(),MapCloud.dataGrid.cleanup(),$(".mc-panel").css("display","none")}});
MapCloud.CutMapDialog=MapCloud.Class(MapCloud.Dialog,{createTileStoreName:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var e=this;e.registerPanelDialog()},registerPanelDialog:function(){var a=this;this.panel.find(".db-list").change(function(){a.createTileStoreName=null;var e=$(this).val();a.getTileStores(e)}),this.panel.find(".btn-create-tile-store").click(function(){a.createTileStoreName=null;var e=a.panel.find(".db-list").val(),n=a.panel.find(".map-start-level").val();if(n=parseInt(n),!$.isNumeric(n)||1>n||n>5)return MapCloud.notify.showInfo("请输入有效的起始级别","Warning"),void a.panel.find(".map-start-level").focus();var i=a.panel.find(".map-end-level").val();if(i=parseInt(i),!$.isNumeric(i))return MapCloud.notify.showInfo("请输入有效的终止级别","Warning"),void a.panel.find(".map-end-level").focus();if(i>11)return MapCloud.notify.showInfo("最大级别为11","Warning"),void a.panel.find(".map-end-level").focus();var l=a.panel.find(".map-extent-xmin").val(),t=a.panel.find(".map-extent-xmax").val(),o=a.panel.find(".map-extent-ymin").val(),p=a.panel.find(".map-extent-ymax").val(),r=new GeoBeans.Envelope(l,o,t,p),s={startLevel:n,endLevel:i,extent:r};MapCloud.create_tile_store_dialog.showDialog("cutMap",e,s)}),this.panel.find(".btn-build-pyramid").click(function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var e=a.panel.find(".db-list").val();if(null==e||""==e)return void MapCloud.notify.showInfo("请选择一个数据库","Warning");var n=a.panel.find(".tile-list").val();if(null==n||""==n)return void MapCloud.notify.showInfo("请选择一个瓦片库","Warning");var i=a.panel.find(".map-start-level").val();if(i=parseInt(i),!$.isNumeric(i)||1>i||i>5)return MapCloud.notify.showInfo("请输入有效的起始级别","Warning"),void a.panel.find(".map-start-level").focus();var l=a.panel.find(".map-end-level").val();return l=parseInt(l),$.isNumeric(l)?l>11?(MapCloud.notify.showInfo("最大级别为11","Warning"),void a.panel.find(".map-end-level").focus()):i>l?void MapCloud.notify.showInfo("请输入有效的起止和终止级别","Warning"):(MapCloud.notify.loading(),void gpsManager.buildPyramid(mapObj.name,e,n,i,l,a.buildPyramid_callback)):(MapCloud.notify.showInfo("请输入有效的终止级别","Warning"),void a.panel.find(".map-end-level").focus())})},showDialog:function(){if(MapCloud.Dialog.prototype.showDialog.apply(this,arguments),null!=mapObj){var a=mapObj.srid,e=mapObj.extent;this.panel.find(".map-srid").val(a),null!=e&&(this.panel.find(".map-extent-xmin").val(e.xmin),this.panel.find(".map-extent-xmax").val(e.xmax),this.panel.find(".map-extent-ymin").val(e.ymin),this.panel.find(".map-extent-ymax").val(e.ymax)),this.getDataSources()}},cleanup:function(){this.panel.find(".db-list").empty(),this.panel.find(".tile-list").empty(),this.panel.find(".cut-map-extent input").val(""),this.panel.find(".map-srid").val(""),this.panel.find(".map-start-level").val("1"),this.panel.find(".map-end-level").val("4"),this.panel.find(".result-div").empty(),this.createTileStoreName=null},getDataSources:function(){dbsManager.getDataSources(this.getDataSources_callback,"Tile")},getDataSources_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.cut_map_dialog;e.showDataSources(a)},showDataSources:function(a){if(null!=a){for(var e=null,n=null,i="",l=0;l<a.length;++l)e=a[l],null!=e&&(n=e.name,i+="<option value='"+n+"'>"+n+"</option>");this.panel.find(".db-list").html(i);var t=this.panel.find(".db-list").val();null!=t&&""!=t&&this.getTileStores(t)}},getTileStores:function(a){this.panel.find(".tile-list").empty(),MapCloud.notify.loading(),dbsManager.describeTileStores(a,this.getTileStores_callback)},getTileStores_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.cut_map_dialog;e.showTileStoreList(a)},showTileStoreList:function(a){if(null!=a){for(var e="",n=null,i=0;i<a.length;++i)n=a[i],null!=n&&(e+="<option value='"+n.name+"'>"+n.name+"</option>");this.panel.find(".tile-list").html(e),null!=this.createTileStoreName&&(this.panel.find(".tile-list option[value='"+this.createTileStoreName+"']").attr("selected",!0),this.createTileStoreName=null)}},buildPyramid_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.cut_map_dialog,n="切图结果:"+a;e.panel.find(".result-div").html(n)},setCreateStoreName:function(a){this.createTileStoreName=a}});
MapCloud.FeaturesDialog=MapCloud.Class(MapCloud.Dialog,{layerName:null,maxFeatures:30,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPageEvent()},setLayerName:function(e){this.layerName=e},showDialog:function(){var e=mapObj.getLayer(this.layerName),a=e.getFeatureCount(null,null);return $.isNumeric(a)?(this.panel.modal(),this.showFields(),void this.showPages(a)):void MapCloud.notify.showInfo(a,"Warning")},cleanup:function(){this.panel.find(".features-list table thead tr").html(""),this.panel.find(".features-list table tbody").html(""),this.panel.find(".query_count span").html("0"),this.panel.find(".pages-form-page").html("0"),this.panel.find(".pages-form-pages").html("0"),this.layerName=null},registerPageEvent:function(){var e=this;this.panel.find(".pages-form-page").keyup(function(a){if(13==a.keyCode){var t=parseInt($(this).val());return e.setPage(t),!1}}),this.panel.find(".glyphicon-step-backward").each(function(){$(this).click(function(){var a=parseInt(e.panel.find(".pages-form-pages").html());a>=1&&e.setPage(1)})}),this.panel.find(".glyphicon-step-forward").each(function(){$(this).click(function(){var a=parseInt(e.panel.find(".pages-form-pages").html());a>=1&&e.setPage(a)})}),this.panel.find(".glyphicon-chevron-left").each(function(){$(this).click(function(){var a=parseInt(e.panel.find(".pages-form-page").val());e.setPage(a-1)})}),this.panel.find(".glyphicon-chevron-right").each(function(){$(this).click(function(){var a=parseInt(e.panel.find(".pages-form-page").val());e.setPage(a+1)})})},showFields:function(){var e=mapObj.getLayer(this.layerName);if(null!=e){var a=e.getFields();if(null!=a){for(var t=null,n="",i=0;i<a.length;++i)t=a[i],"geometry"!=t.type&&(n+="<th>"+t.name+"</th>");this.panel.find(".features-list table thead tr").html(n)}}},showPages:function(e){if(null!=e){if(0==e)return void this.cleanup();this.panel.find(".query_count span").html(e);var a=Math.ceil(e/this.maxFeatures);this.panel.find(".pages-form-pages").html(a),this.setPage(1)}},setPage:function(e){var a=parseInt(this.panel.find(".pages-form-pages").html());if(this.panel.find(".pages-form-page").val(e),1==e?this.panel.find(".glyphicon-step-backward").addClass("disabled"):this.panel.find(".glyphicon-step-backward").removeClass("disabled"),e==a?this.panel.find(".glyphicon-step-forward").addClass("disabled"):this.panel.find(".glyphicon-step-forward").removeClass("disabled"),0>=e-1?this.panel.find(".glyphicon-chevron-left").addClass("disabled"):this.panel.find(".glyphicon-chevron-left").removeClass("disabled"),e+1>a?this.panel.find(".glyphicon-chevron-right").addClass("disabled"):this.panel.find(".glyphicon-chevron-right").removeClass("disabled"),!(0>=e||e>a)){var t=(e-1)*this.maxFeatures,n=mapObj.getLayer(this.layerName);MapCloud.notify.loading();var i=n.getFeatureBBoxGet(null,this.maxFeatures,t);this.showFeatures(i),MapCloud.notify.hideLoading()}},showFeatures:function(e){if(null!=e){var a="",t=null,n=null,i=null,l=null,s=null;if(null!=e[0]){var r=e[0].featureType;null!=r&&(l=r.fields)}for(var h=0;h<e.length;++h)if(t=e[h],null!=t&&(i=t.values,null!=i)){a+="<tr>";for(var o=0;o<i.length;++o)null!=l&&(s=l[o]),(null==s||"geometry"!=s.type)&&(n=i[o],n instanceof GeoBeans.Geometry||(a+="<td>"+n+"</td>"));a+="</tr>"}this.panel.find(".features-list table tbody").html(a)}}});
MapCloud.HeatMapDialog=MapCloud.Class(MapCloud.Dialog,{layer:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var l=this;this.panel.find(".field-enable").change(function(){var e=$(this).parents(".form-group");this.checked?e.find("#heat_map_field").prop("disabled",!1):e.find("#heat_map_field").prop("disabled",!0)}),this.panel.find(".btn-confirm").click(function(){if(null==l.layer)return void MapCloud.notify.showInfo("请先设置点图层","Warning");l.closeDialog();var e=l.panel.find(".field-enable").prop("checked"),a=null,i=null;return e?a=l.panel.find("#heat_map_field").val():i=1,null==a&&null==i?void MapCloud.notify.showInfo("请设置有效的字段","Warning"):(mapObj.addHeatMap(l.layer.name,a,i,null),mapObj.draw(),void MapCloud.refresh_panel.refreshPanel())})},setLayer:function(e){if(null!=e){this.layer=e;var l=e.getHeatMapLayer();if(null==l)this.showFields(e);else{this.showFields(e);var a=l.getUniqueValue(),i=l.getField();null==a&&null!=i&&(this.panel.find(".field-enable").prop("checked",!0),this.panel.find("#heat_map_field").prop("disabled",!1),this.panel.find("#heat_map_field option[value='"+i+"']").attr("selected",!0)),null!=a&&(this.panel.find(".field-enable").prop("checked",!1),this.panel.find("#heat_map_field").prop("disabled",!0))}}},showFields:function(e){if(null!=e&&null!=mapObj){var l=e.getFields();if(null!=l){for(var a="",i=0;i<l.length;++i){var n=l[i],p=n.type;p=p.toLowerCase(),("int"==p||"double"==p||"float"==p)&&(a+="<option value='"+n.name+"'>"+n.name+"</option>")}this.panel.find("#heat_map_field").html(a)}}},cleanup:function(){this.layer=null,this.panel.find("#heat_map_field").empty().prop("disabled",!1),this.panel.find(".field-enable").prop("checked",!0)}});
MapCloud.LayerInfoDialog=MapCloud.Class(MapCloud.Dialog,{initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){},cleanup:function(){this.panel.find(".modal-body").empty()},showDialog:function(t){if(MapCloud.Dialog.prototype.showDialog.apply(this,arguments),null!=mapObj){var e=mapObj.getLayer(t);this.getLayerInfo(e)}},getLayerInfo:function(t){t instanceof GeoBeans.Layer.DBLayer?mapObj.describeLayer(t.name,this.describeLayer_callback):t instanceof GeoBeans.Layer.ChartLayer?this.showChartLayer(t):this.showLayer(t)},describeLayer_callback:function(t){var e=MapCloud.layer_info_dialog;e.showDBLayerInfo(t)},showChartLayer:function(t){if(null!=t){var e=t.type,a=null;switch(e){case GeoBeans.Layer.ChartLayer.Type.RANGE:a="分级图";break;case GeoBeans.Layer.ChartLayer.Type.BAR:a="柱状图";break;case GeoBeans.Layer.ChartLayer.Type.PIE:a="饼状图";break;case GeoBeans.Layer.ChartLayer.Type.AQI:a="空气质量时刻图";break;case GeoBeans.Layer.ChartLayer.Type.AQITIMELINE:a="空气质量序列图"}var r='<table class="table table-hover table-bordered"><tbody>	<tr>		<td>名称</td>		<td>'+t.name+"</td>	</tr>";null!=a&&(r+="	<tr>		<td>类型</td>		<td>"+a+"</td>	</tr>"),(e==GeoBeans.Layer.ChartLayer.Type.AQI||e==GeoBeans.Layer.ChartLayer.Type.AQITIMELINE)&&(r+="	<tr>		<td>字段</td>		<td>"+t.chartField+"</td>	</tr>"),this.panel.find(".modal-body").html(r)}},showDBLayerInfo:function(t){if(null!=t){var e=t.type;null!=e&&(e=e.toLowerCase(),"raster"==e?this.showRasterDBLayer(t):"feature"==e&&this.showFeatureDBLayer(t))}},showFeatureDBLayer:function(t){var e='<table class="table table-hover table-bordered"><tbody>	<tr>		<td>名称</td>		<td>'+t.name+"</td>	</tr>	<tr>		<td>类型</td>		<td>"+t.type+"</td>	</tr>	<tr>		<td>数据名称</td>		<td>"+t.featureName+"</td>	</tr>	<tr>		<td>几何类型</td>		<td>"+t.geomType+"</td>	</tr>	<tr>		<td>要素个数</td>		<td>"+t.count+"</td>	</tr>	<tr>		<td>范围</td>		<td>东 :"+t.extent.xmax+"</td>	</tr>	<tr>		<td></td>		<td>西 :"+t.extent.xmin+"</td>	</tr>	<tr>		<td></td>		<td>南 :"+t.extent.ymin+"</td>	</tr>	<tr>		<td></td>		<td>北 :"+t.extent.ymax+"</td>	</tr></tbody></table>";this.panel.find(".modal-body").html(e)},showRasterDBLayer:function(t){var e='<table class="table table-hover table-bordered"><tbody>	<tr>		<td>名称</td>		<td>'+t.name+"</td>	</tr>	<tr>		<td>类型</td>		<td>"+t.type+"</td>	</tr>	<tr>		<td>数据名称</td>		<td>"+t.rasterName+"</td>	</tr>	<tr>		<td>波段个数</td>		<td>"+t.bands+"</td>	</tr>	<tr>		<td>格式</td>		<td>"+t.format+"</td>	</tr>	<tr>		<td>像素类型</td>		<td>"+t.pixelType+"</td>	</tr>	<tr>		<td>像素宽度</td>		<td>"+t.pixelSize+"</td>	</tr>	<tr>		<td>X分辨率</td>		<td>"+t.resolutionX+"</td>	</tr>	<tr>		<td>Y分辨率</td>		<td>"+t.resolutionY+"</td>	</tr>	<tr>		<td>宽度</td>		<td>"+t.width+"</td>	</tr>	<tr>		<td>高度</td>		<td>"+t.height+"</td>	</tr>	<tr>		<td>范围</td>		<td>东 :"+t.extent.xmax+"</td>	</tr>	<tr>		<td></td>		<td>西 :"+t.extent.xmin+"</td>	</tr>	<tr>		<td></td>		<td>南 :"+t.extent.ymin+"</td>	</tr>	<tr>		<td></td>		<td>北 :"+t.extent.ymax+"</td>	</tr></tbody></table>";this.panel.find(".modal-body").html(e)},showLayer:function(t){var e="";t instanceof GeoBeans.Layer.RippleLayer?e="波纹图":t instanceof GeoBeans.Layer.AirLineLayer?e="航线图":t instanceof GeoBeans.Layer.ClusterLayer&&(e="聚合图");var a='<table class="table table-hover table-bordered"><tbody>	<tr>		<td>名称</td>		<td>'+t.name+"</td>	</tr>";null!=e&&(a+="	<tr>		<td>类型</td>		<td>"+e+"</td>	</tr>"),this.panel.find(".modal-body").html(a)}});
MapCloud.LoginDialog=MapCloud.Class(MapCloud.Dialog,{username:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var n=this;this.panel.find(".btn-confirm").click(function(){var a=n.panel.find("input[name='username']").val();if(""==a)return MapCloud.notify.showInfo("请输入用户名","Warning"),void n.panel.find("input[name='username']").focus();var i=n.panel.find("input[name='password']").val();return""==i?(MapCloud.notify.showInfo("请输入密码","Warning"),void n.panel.find("input[name='password']").focus()):(MapCloud.notify.loading(),n.username=a,void authManager.login(a,i,n.login_callback))})},cleanup:function(){this.username=null,this.panel.find("input").val("")},login_callback:function(a){if(MapCloud.notify.showInfo(a,"登录"),"success"==a){var n=MapCloud.login_dialog;n.initUser(),n.closeDialog()}},initUser:function(){user=new GeoBeans.User(this.username),mapManager=user.getMapManager(),styleManager=user.getStyleManager(),MapCloud.userToolBar.showUser(this.username),MapCloud.notify.loading(),mapManager.getMaps(ribbonObj.getMaps_callback)}});
MapCloud.MapInfoDialog=MapCloud.Class(MapCloud.Dialog,{initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.panel.find("#map_info_dialog_tab a").each(function(){$(this).click(function(t){t.preventDefault(),$(this).tab("show")})})},showDialog:function(t){if(null!=t){this.cleanup(),this.panel.modal();var a=t.name;this.panel.find(".map-info-name").val(a);var e=t.srid;this.panel.find(".map-info-srid").val(e);var l=t.extent;if(null!=l){var i=l.xmin.toFixed(2)+" , "+l.ymin.toFixed(2)+" , "+l.xmax.toFixed(2)+" , "+l.ymax.toFixed(2);this.panel.find(".map-info-extent").val(i)}this.panel.find("#map_layers").empty();var n='<table class="table table-hover table-bordered "><thead><tr>	<th>名称</th>	<th>类型</th>	<th>范围</th></tr></thead><tbody>';null!=t.baseLayer&&(n+="<tr><td>"+t.baseLayer.name+"</td><td>底图</td><td></td></tr>");for(var d=t.getLayers(),l=null,o=null,a=null,p=null,i="",r=0;r<d.length;r++)o=d[r],null!=o&&(a=o.name,p=o.geomType,o.type==GeoBeans.Layer.DBLayer.Type.Raster&&(p=o.type),l=o.extent,null!=l&&(i=l.xmin.toFixed(2)+" , "+l.ymin.toFixed(2)+" , "+l.xmax.toFixed(2)+" , "+l.ymax.toFixed(2)),null==p&&(p=o.type),n+="<tr><td>"+a+"</td><td>"+(null==p?"":p)+"</td><td>"+i+"</td></tr>");n+="</tbody>",this.panel.find("#map_layers").html(n)}}});
MapCloud.NewLayerDialog=MapCloud.Class(MapCloud.Dialog,{dataSource:null,dataSet:null,style:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var e=this;e.panel.find("#new_layer_select_dbs").each(function(){$(this).click(function(){MapCloud.vector_db_dialog.showDialog("select")})}),e.panel.find("#new_layer_select_style").click(function(){if(null==e.dataSet)return void MapCloud.notify.showInfo("请先选择数据源","Warning");var a=e.dataSet.geometryType;return null==a?void MapCloud.notify.showInfo("请选择有效的数据源","Warning"):void MapCloud.style_list_dialog.showDialog(a)}),e.panel.find(".btn-confirm").each(function(){$(this).click(function(){var a=e.panel.find("#new_layer_name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入名称","Warning"),void e.panel.find("#new_layer_name").focus();var n=/^[0-9a-zA-Z_]+$/;if(n.test(a)||MapCloud.notify.showInfo("请输入有效的名称","Warning"),null==e.dataSource||null==e.dataSet)return void MapCloud.notify.showInfo("请选择数据","Warning");var l=e.dataSource.name,t=e.dataSet.name;if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");if(null!=mapObj){var o=new GeoBeans.Layer.FeatureDBLayer(a,null,l,t,null,null);MapCloud.notify.loading(),o.geomType=e.dataSet.geometryType,mapObj.insertLayer(o,e.insertLayer_callback)}e.closeDialog()})})},destory:function(){MapCloud.Dialog.prototype.destory.apply(this,arguments)},cleanup:function(){this.panel.find("#new_layer_name").val(""),this.panel.find("#new_layer_dbs").val(""),this.panel.find("#new_layer_style").val(""),this.style=null,this.dataSource=null,this.dataSet=null},setDataSet:function(a,e){if(null!=a&&null!=e){this.dataSource=a,this.dataSet=e;var n="数据源："+a.name+"; 数据："+e.name;this.panel.find("#new_layer_dbs").val(n),this.panel.find("#new_layer_name").val(e.name)}},insertLayer_callback:function(a){var e=MapCloud.new_layer_dialog,n=e.panel.find("#new_layer_name").val(),l="注册图层 [ "+n+" ]";MapCloud.notify.showInfo(a,l),"success"==a.toLowerCase()&&(MapCloud.refresh_panel.refreshPanel(),null!=e.style&&mapObj.setStyle(n,e.style,e.setStyle_callback)),mapObj.draw()},setStyle:function(a){null!=a&&(this.style=a,this.panel.find("#new_layer_style").val(this.style.name))},setStyle_callback:function(a){"success"!=a.toLowerCase()&&MapCloud.notify.showInfo(a,"设置样式"),mapObj.draw()}});
MapCloud.NewRasterDBLayerDialog=MapCloud.Class(MapCloud.Dialog,{initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments),this.registerPanelEvent()},registerPanelEvent:function(){var a=this;this.panel.find(".btn-choose-raster").click(function(){MapCloud.raster_db_dialog.showDialog("newLayer",!1)}),this.panel.find(".btn-confirm").click(function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var e=a.panel.find(".new-layer-name").val();if(null==e||""==e)return MapCloud.notify.showInfo("请输入名称","Warning"),void a.panel.find(".new-layer-name").focus();var n=/^[0-9a-zA-Z_]+$/;if(!n.test(e))return MapCloud.notify.showInfo("请输入有效的名称","Warning"),void a.panel.find(".new-layer-name").focus();if(null==a.sourceName||null==a.rasterName||null==a.rasterPath)return void MapCloud.notify.showInfo("请选择影像","Warning");var r=new GeoBeans.Layer.RasterDBLayer(e,null,a.sourceName,a.rasterName,null,!0,a.rasterPath);MapCloud.notify.loading(),mapObj.insertLayer(r,a.insertLayer_callback)})},cleanup:function(){this.sourceName=null,this.rasterName=null,this.rasterPath=null,this.panel.find(".source-name").val(""),this.panel.find(".raster-name").val(""),this.panel.find(".new-layer-name").val(""),this.panel.find(".raster-path").val("")},setRaster:function(a,e,n){this.sourceName=a,this.rasterName=e,this.rasterPath=n,this.panel.find(".source-name").val(this.sourceName),this.panel.find(".raster-name").val(this.rasterName),this.panel.find(".raster-path").val(this.rasterPath);var r=this.rasterName.slice(0,this.rasterName.lastIndexOf("."));this.panel.find(".new-layer-name").val(r)},insertLayer_callback:function(a){var e=MapCloud.new_raster_dblayer_dialog,n=e.panel.find(".new-layer-name").val(),r="注册图层 [ "+n+" ]";MapCloud.notify.showInfo(a,r),"success"==a.toLowerCase()&&(MapCloud.refresh_panel.refreshPanel(),mapObj.draw()),e.closeDialog()}});
MapCloud.PoiDialog=MapCloud.Class(MapCloud.Dialog,{initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPageEvent()},registerPageEvent:function(){},cleanup:function(){this.panel.find("table tbody").empty()},showDialog:function(){MapCloud.Dialog.prototype.showDialog.apply(this,arguments)},setPois:function(t){if($.isArray(t)){for(var l=null,i=null,n=null,a=null,o=null,e=null,d="",u=0;u<t.length;++u)l=t[u],null!=l&&(i=l.name,n=l.x,a=l.y,o=l.address,e=l.type,d+="<tr>	<td>"+(u+1)+"</td>	<td>"+i+"</td>	<td>"+o+"</td>	<td>"+e+"</td>	<td>"+n+"</td>	<td>"+a+"</td></tr>");this.panel.find("table tbody").html(d)}}});
MapCloud.ProcessDialog=MapCloud.Class(MapCloud.Dialog,{maxCount:15,initialize:function(i){MapCloud.Dialog.prototype.initialize.apply(this,arguments),this.registerPanelEvent()},showDialog:function(){MapCloud.Dialog.prototype.showDialog.apply(this,arguments),this.getJob(GeoBeans.Job.Status.RUNNING,this.maxCount,0)},registerPanelEvent:function(){var i=this;i.panel.find("select").change(function(){var l=$(this).val(),t=null;"running"==l?t=GeoBeans.Job.Status.RUNNING:"finished"==l?t=GeoBeans.Job.Status.FINISHED:"canceled"==l&&(t=GeoBeans.Job.Status.CANCELED),null!=t&&i.getJob(t,i.maxCount,0)}),this.panel.find(".pagination li a").click(function(){})},cleanup:function(){this.panel.find("select option[value='running']").attr("selected",!0),this.panel.find(".job-list").empty()},getJob:function(i,l,t){null!=i&&null!=l&&null!=t&&gpsManager.getJob(i,l,t,this.getJob_callback)},getJob_callback:function(i){if($.isArray(i)){var l=MapCloud.process_dialog;l.showJobList(i)}},showJobList:function(i){for(var l=null,t="",o=0;o<i.length;++o)if(l=i[o],null!=l){var n=l.oper,a=l.server,e=l.startTime,s=l.endTime;t+="<div class='row'><div class='col-md-3 col-xs-3 text-ellip' title='"+n+"'>"+n+"</div><div class='col-md-3 col-xs-3'>"+a+"</div><div class='col-md-3 col-xs-3'>"+e+"</div><div class='col-md-3 col-xs-3'>"+s+"</div></div>"}this.panel.find(".job-list").html(t)}});
MapCloud.QueryDialog=MapCloud.Class(MapCloud.Dialog,{layer:null,field:null,oper:null,filter:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments),this.registerPanelEvent()},registerPanelEvent:function(){var e=this;this.panel.find(".btn-get-unique").click(function(){e.getUniqueValues(e.layer,e.field)}),this.panel.find(".search-oper .oper-row .btn").click(function(){var l=$(this).html(),n=null;switch(l){case"=":n="=";break;case"Between":n="between";break;case"&gt;":n=">";break;case"&lt;":n="<";break;case"&gt;=":n=">=";break;case"&lt;=":n="<="}e.oper=n,e.setExpression(e.oper),e.panel.find(".search-oper .oper-row .btn").removeClass("active"),$(this).addClass("active")}),this.panel.find(".btn-confirm").click(function(){var l=e.getComparisionOperator(e.oper);if(null==l)return void MapCloud.notify.showInfo("请选择一种查询条件","Warning");var n=null;if(n=l==GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween?e.verifyIsBetweenQuery():e.verifyQuery(),"success"==n){var i=e.getFilter(l);if(null==i)return void MapCloud.notify.showInfo("请检查表达式","Warning");e.closeDialog(),null==e.filter?i.name=null:i.name=e.filter.name,MapCloud.styleManager_dialog.setCustomFilter(i)}})},cleanup:function(){this.layer=null,this.field=null,this.panel.find(".query-field span").html(""),this.panel.find(".query-field-input").val(""),this.oper="=",this.panel.find(".search-oper .oper-row .btn").removeClass("active"),this.panel.find(".search-oper .oper-row .btn").first().addClass("active"),this.panel.find(".search-unique-values").empty();var e='<div class="col-md-5">		<input type="text" disabled="" class="form-control">	</div>	<label class="col-md-2 control-label">=</label>	<div class="col-md-5">		<input type="text" class="form-control">	</div>';this.panel.find(".query-exp").html(e),this.filter=null},setLayer:function(e,l){this.layer=e,this.field=l,null!=this.layer&&null!=this.field&&(this.panel.find(".query-field span").html(this.field),this.panel.find(".query-field-input").val(this.field),this.setExpression("="))},getUniqueValues:function(e,l){if(null!=l&&null!=e){var n=e.getFeatureType();if(null!=n){var i=n.workspace;null!=i&&i.getValue(e.name,l,mapObj.name,this.getUniqueValues_callback)}}},getUniqueValues_callback:function(e){if(null!=e){var l=MapCloud.query_dialog;l.displayUniqueValues(e)}},displayUniqueValues:function(e){if(null!=e){for(var l=null,n="",i=0;i<e.length;++i)l=e[i],n+="<a href='#' class='list-group-item'>"+l+"</a>";this.panel.find(".search-unique-values").html(n),this.registerUniqueValuesEvent()}},registerUniqueValuesEvent:function(){var e=this;this.panel.find(".search-unique-values .list-group-item").click(function(){$(this).parent().children().removeClass("active"),$(this).addClass("active")}).dblclick(function(){var l=$(this).html(),n=e.panel.find(".query-exp input:enabled");if(1==n.length)n.val(l);else for(var i=0;i<n.length;++i)if(""==$(n[i]).val()){$(n[i]).val(l);break}})},getComparisionOperator:function(e){if(null==e)return null;var l=null;switch(e){case"=":l=GeoBeans.ComparisionFilter.OperatorType.ComOprEqual;break;case">":l=GeoBeans.ComparisionFilter.OperatorType.ComOprGreaterThan;break;case">=":l=GeoBeans.ComparisionFilter.OperatorType.ComOprGreaterThanOrEqual;break;case"<":l=GeoBeans.ComparisionFilter.OperatorType.ComOprLessThan;break;case"<=":l=GeoBeans.ComparisionFilter.OperatorType.ComOprLessThanOrEqual;break;case"between":l=GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween}return l},setExpression:function(e){if(null!=e){var l="";l="between"==e?'<div class="col-md-3">		<input type="text" class="form-control" value="">	</div>		<label class="col-md-1 control-label">&lt;</label>	<div class="col-md-4">		<input type="text" disabled="" class="form-control" value="'+this.field+'">	</div>	<label class="col-md-1 control-label">&lt;</label>	<div class="col-md-3">		<input type="text" class="form-control" value="">	</div>':'<div class="col-md-5">	<input type="text" disabled="" class="form-control" value="'+this.field+'">	</div>	<label class="col-md-2 control-label">'+e+'</label>	<div class="col-md-5">		<input type="text" class="form-control" value="">	</div>',this.panel.find(".query-exp").html(l),this.panel.find(".query-exp input:enabled").first().focus()}},verifyIsBetweenQuery:function(){for(var e=this.panel.find(".query-exp input:enabled"),l=0;l<e.length;++l){var n=$(e[l]);if(""==n.val())return MapCloud.notify.showInfo("请输入查询条件","Warning"),n.focus(),"failed"}return"success"},verifyQuery:function(){var e=this.panel.find(".query-exp input:enabled");return""==e.val()?(MapCloud.notify.showInfo("请输入查询条件","Warning"),e.focus(),"failed"):"success"},getFilter:function(e){if(null==e)return null;var l=null;if(e==GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween){var n=this.panel.find(".query-exp input:enabled").first().val(),i=$(this.panel.find(".query-exp input:enabled")[1]).val();l=this.getBetweenFilter(e,this.field,n,i)}else{var a=this.panel.find(".query-exp input:enabled").val();l=this.getBinaryComparisionFilter(e,this.field,a)}return l},getBetweenFilter:function(e,l,n,i){if(e!=GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween||null==l||null==n||null==i)return null;var a=new GeoBeans.IsBetweenFilter,t=new GeoBeans.PropertyName;t.setName(l);var r=new GeoBeans.Literal;r.setValue(n);var s=new GeoBeans.Literal;return s.setValue(i),a.expression=t,a.lowerBound=r,a.upperBound=s,a},getBinaryComparisionFilter:function(e,l,n){if(null==e||null==l||null==n)return null;var i=new GeoBeans.BinaryComparisionFilter,a=new GeoBeans.PropertyName;a.setName(l);var t=new GeoBeans.Literal;return t.setValue(n),i.expression1=a,i.expression2=t,i.operator=e,i}});
MapCloud.RasterDBDialog=MapCloud.Class(MapCloud.Dialog,{raster:null,rasterPath:null,rasterName:null,source:null,outputFlag:!1,registerDataSourceName:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var a=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),this.panel.find(".db-list").change(function(){var e=$(this).val();null!=e&&(a.panel.find(".foler-ul").remove(),a.getList(e,"/"))}),this.panel.find(".btn-add-server").click(function(){MapCloud.pgis_connection_dialog.showDialog("raster","raster")}),this.panel.find(".btn-remove-server").click(function(){a.removeDataSource()}),this.panel.find(".btn-add-folder").click(function(){a.createFolder()}),this.panel.find(".btn-remove-file").click(function(){var e=a.panel.find(".db-list").val();if(null==e)return void MapCloud.notify.showInfo("请选择一个数据源","Warning");var l=a.panel.find("input[type='checkbox']:checked");if(0==l.length){var s=a.panel.find(".tree-folder.selected").attr("fpath");if("/"==s)return void MapCloud.notify.showInfo("无法删除根目录","Warning");var i=a.panel.find(".tree-folder.selected span").html();if(null==i)return void MapCloud.notify.showInfo("请选择删除的文件","Warning");if(!confirm("确定要删除文件夹["+i+"]?"))return;var t=a.panel.find(".tree-folder.selected").parents(".nav").first().prev();a.panel.find(".tree-folder").removeClass("selected"),t.addClass("selected");var r=t.attr("fpath");a.panel.find(".current-path").val(r);var e=a.panel.find(".db-list").val();return void a.removeFolder(e,s)}confirm("确定要删除吗？")&&l.each(function(){var e=$(this).parent().parent().parent(),l=e.attr("fpath"),s=a.panel.find(".db-list").val();if(e.hasClass("row-file")){var i=a.panel.find(".current-path").val(),t=e.find(".row-fname span").html();a.removeRaster(s,i,t)}else e.hasClass("row-folder")&&a.removeFolder(s,l)})}),this.panel.find(".btn-upload-raster").click(function(){var e=a.panel.find(".db-list").val();if(null==e)return void MapCloud.notify.showInfo("请选择要上传的数据源","Warning");var l=a.panel.find(".current-path").val();MapCloud.import_raster_dialog.showDialog("raster"),MapCloud.import_raster_dialog.setRasterPath(e,l)}),this.panel.find(".btn-refresh").click(function(){a.getListRefresh()}),this.panel.find(".btn-raster-info").click(function(){null!=a.raster&&(a.panel.find(".btn-raster-info").attr("disabled",!0),a.panel.find(".bbtn-raster-preview").attr("disabled",!1),a.showRasterInfo(a.raster))}),this.panel.find(".btn-raster-preview").click(function(){a.panel.find(".btn-raster-info").attr("disabled",!1),a.panel.find(".bbtn-raster-preview").attr("disabled",!0);var e=a.panel.find(".db-list").val();a.showRasterPreview(e,a.rasterName,a.rasterPath)}),this.panel.find(".btn-confirm").click(function(){if(null==a.source)return void a.closeDialog();var e=null,l=a.panel.find(".db-list").val();switch(a.source){case"newLayer":e=MapCloud.new_raster_dblayer_dialog;break;case"rasterEdgeDetect":e=MapCloud.gps_raster_edge_detect_dialog;break;case"rasterExtract":e=MapCloud.gps_raster_extract_dialog;break;case"rasterReverse":e=MapCloud.gps_raster_reverse_dialog;break;case"rasterGraylize":e=MapCloud.gps_raster_graylize_dialog;break;case"rasterSmooth":e=MapCloud.gps_raster_smooth_dialog;break;case"rasterStretch":e=MapCloud.gps_raster_stretch_dialog;break;case"rasterSubtract-1":case"rasterSubtract-2":case"rasterSubtract":e=MapCloud.gps_raster_subtract_dialog;break;case"rasterPixelBlend-1":case"rasterPixelBlend-2":case"rasterPixelBlend":e=MapCloud.gps_raster_pixel_blend_dialog;break;case"rasterThreshold":e=MapCloud.gps_raster_threshold_dialog;break;case"rasterHisEqual":e=MapCloud.gps_raster_his_equal_dialog;break;case"rasterSepiaTone":e=MapCloud.gps_raster_sepia_tone_dialog;break;case"demAspect":e=MapCloud.gps_dem_aspect_dialog;break;case"demSlope":e=MapCloud.gps_dem_slope_dialog;break;case"demStretch":e=MapCloud.gps_dem_stretch_dialog;break;case"demHillshade":e=MapCloud.gps_dem_hillshade_dialog}if(a.outputFlag){var s=a.panel.find(".current-path").val();null!=e&&e.setOutput(l,s)}else{var i=null,t=null;if(null==a.raster){var r=a.panel.find("input[type='radio']:checked");if(0==r.length)return void MapCloud.notify.showInfo("请选择一张影像","Warning");i=r.parents(".row-file").find(".row-fname span").html(),t=a.panel.find(".current-path").val()}else i=a.rasterName,t=a.rasterPath;if("rasterExtract"==a.source)return a.returnExtractRaster(l,i,t),e.setRaster(l,i,t,a.raster),void a.closeDialog();if("rasterSubtract-1"==a.source)return e.setRaster_1(l,i,t),void a.closeDialog();if("rasterSubtract-2"==a.source)return e.setRaster_2(l,i,t),void a.closeDialog();if("rasterPixelBlend-1"==a.source)return e.setRaster_1(l,i,t),void a.closeDialog();if("rasterPixelBlend-2"==a.source)return e.setRaster_2(l,i,t),void a.closeDialog();null!=e&&e.setRaster(l,i,t)}a.closeDialog()})},showDialog:function(a,e){var l=$("body").width(),s=this.panel.find(".modal-dialog").width();s>l&&(s=l-40,this.panel.find(".modal-dialog").css("width",s+"px")),MapCloud.notify.loading(),this.cleanup(),this.panel.modal(),this.source=a,null!=e&&(this.outputFlag=e),this.getDataSources(),null==this.source?this.panel.find(".btn-confirm").html("确定"):this.panel.find(".btn-confirm").html("选择")},getDataSources:function(){dbsManager.getDataSources(this.getDataSources_callback,"Raster")},cleanup:function(){this.raster=null,this.rasterName=null,this.rasterPath=null,this.source=null,this.outputFlag=!1,this.registerDataSourceName=null,this.panel.find(".db-list").html(""),this.panel.find(".nav.foler-ul").remove(),this.panel.find(".raster-list-content-div").empty(),this.panel.find(".current-path").val("/"),this.panel.find(".current-raster-path").val(""),this.panel.find(".raster-col").css("display","none"),this.panel.find(".raster-list-col").css("display","block")},getDataSources_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.raster_db_dialog;e.showDataSources(a)},showDataSources:function(a){if(null!=a){for(var e=null,l=null,s="",i=0;i<a.length;++i)e=a[i],null!=e&&(l=e.name,s+="<option value='"+l+"'>"+l+"</option>");if(this.panel.find(".db-list").html(s),null!=this.registerDataSourceName)this.panel.find(".db-list option[value='"+this.registerDataSourceName+"']").attr("selected",!0),this.getList(this.registerDataSourceName,"/"),this.registerDataSourceName=null;else{var t=this.panel.find(".db-list").val();null!=t&&""!=t&&this.getList(t,"/")}}},getList:function(a,e){null!=a&&null!=e&&(MapCloud.notify.loading(),rasterDBManager.getList(a,e,this.getList_callback))},getList_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.raster_db_dialog;e.showListTree(a),e.showListPanel(a)},getListTreeClick:function(a,e){MapCloud.notify.loading(),rasterDBManager.getList(a,e,this.getListTreeClick_callback)},getListTreeClick_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.raster_db_dialog;e.list=a,e.showListPanel(a)},showListTree:function(a){for(var e=null,l=null,s="<ul class='nav foler-ul'>",i=0;i<a.length;++i)if(e=a[i],null!=e&&e instanceof GeoBeans.Folder){var t=e.name;s+="<li><a href='javascript:void(0)' class='tree-folder' fpath=\""+e.path+'"><i class="fa fa-folder-o"></i><span>'+t+"</span></a></li>"}s+="</ul>",l=this.panel.find(".current-path").val();var r=this.panel.find(".db-tree a[fpath='"+l+"']");r.find("i").removeClass("fa-folder-o"),r.find("i").addClass("fa-folder-open-o"),r.parent().find("ul.nav").remove(),r.after(s);var n=this;this.panel.find(".tree-folder").unbind("click"),this.panel.find(".tree-folder").unbind("dblclick");var o=300,d=0,c=null;this.panel.find(".tree-folder").on("click",function(a){if(d++,1===d){var e=this;c=setTimeout(function(){var a=$(e).attr("fpath");n.panel.find(".current-path").val(a);var l=n.panel.find(".db-list").val();n.getListTreeClick(l,a),n.panel.find(".tree-folder.selected").removeClass("selected"),$(e).addClass("selected"),d=0},o)}else{clearTimeout(c);var l=$(this).attr("fpath"),s=$(this).parent();if(0!=s.find("ul.nav").length&&"none"==s.find("ul.nav").first().css("display")){s.find("ul.nav").first().css("display","block"),$(this).find("i").removeClass("fa-folder-o"),$(this).find("i").addClass("fa-folder-open-o");var i=n.panel.find(".db-list").val();n.getListTreeClick(i,l)}else if(0!=s.find("ul.nav").length&&"block"==s.find("ul.nav").first().css("display")){s.find("ul.nav").first().css("display","none"),$(this).find("i").addClass("fa-folder-o"),$(this).find("i").removeClass("fa-folder-open-o");var i=n.panel.find(".db-list").val();n.getListTreeClick(i,l)}else{n.panel.find(".current-path").val(l);var i=n.panel.find(".db-list").val();n.getList(i,l)}n.panel.find(".tree-folder").removeClass("selected"),$(this).addClass("selected"),d=0}}).on("dblclick",function(a){a.preventDefault()})},showListPanel:function(a){var e=null,l="";this.panel.find(".raster-col").css("display","none"),this.panel.find(".raster-list-col").css("display","block"),this.rasterName=null,this.rasterPath=null,this.raster=null;for(var s=0;s<a.length;++s)if(e=a[s],null!=e)if(this.outputFlag){if(e instanceof GeoBeans.Folder){var i=e.name,t=e.accessTime,r=e.lastTime,n=e.path;l+="<div class='row row-folder' fpath='"+n+"'><div class='col-md-1 col-xs-1 row'><div class='col-md-6 col-xs-6'>",l+="</div><div class='col-md-6 col-xs-6'><i class='fa fa-folder-o'></i></div>",l+="</div><div class='col-md-3 col-xs-3 row-fname'>		<span>"+i+"</span></div><div class='col-md-1 col-xs-1'>文件夹</div><div class='col-md-3 col-xs-3'>"+t+"</div><div class='col-md-3 col-xs-3'>"+r+"</div><div class='col-md-1 col-xs-1'></div></div>"}else if(e instanceof GeoBeans.File){var i=e.name,t=e.accessTime,r=e.lastTime,o=e.size,n=e.path;l+="<div class='row row-file' fpath='"+n+"'><div class='col-md-1 col-xs-1 row'><div class='col-md-6 col-xs-6'>",l+="</div><div class='col-md-6 col-xs-6'><i class='fa fa-file-o'></i></div>",l+="</div><div class='col-md-3 col-xs-3 row-fname'>		<span>"+i+"</span></div><div class='col-md-1 col-xs-1'>文件</div><div class='col-md-3 col-xs-3'>"+t+"</div><div class='col-md-3 col-xs-3'>"+r+"</div><div class='col-md-1 col-xs-1'>"+o+"</div></div>"}}else if(e instanceof GeoBeans.File){var i=e.name,t=e.accessTime,r=e.lastTime,o=e.size,n=e.path;l+="<div class='row row-file' fpath='"+n+"'><div class='col-md-1 col-xs-1 row'><div class='col-md-6 col-xs-6'>",l+=null!=this.source?"	<input type='radio' name='chooseRaster'>":"		<input type='checkbox' name='"+i+"'>",l+="</div><div class='col-md-6 col-xs-6'><i class='fa fa-file-o'></i></div>",l+="</div><div class='col-md-3 col-xs-3 row-fname'>		<span>"+i+"</span></div><div class='col-md-1 col-xs-1'>文件</div><div class='col-md-3 col-xs-3'>"+t+"</div><div class='col-md-3 col-xs-3'>"+r+"</div><div class='col-md-1 col-xs-1'>"+o+"</div></div>"}else if(e instanceof GeoBeans.Folder){var i=e.name,t=e.accessTime,r=e.lastTime,n=e.path;l+="<div class='row row-folder' fpath='"+n+"'><div class='col-md-1 col-xs-1 row'><div class='col-md-6 col-xs-6'>",l+=null!=this.source?"	<input type='radio' name='chooseRaster' disabled>":"	<input type='checkbox' name='"+i+"'>",l+="</div><div class='col-md-6 col-xs-6'><i class='fa fa-folder-o'></i></div>",l+="</div><div class='col-md-3 col-xs-3 row-fname'>		<span>"+i+"</span></div><div class='col-md-1 col-xs-1'>文件夹</div><div class='col-md-3 col-xs-3'>"+(null==t?" ":t)+"</div><div class='col-md-3 col-xs-3'>"+(null==r?" ":r)+"</div><div class='col-md-1 col-xs-1'></div></div>"}this.panel.find(".raster-list-content-div").html(l);var d=this;this.panel.find(".row-folder .row-fname").click(function(){var a=$(this).parent().attr("fpath");d.panel.find(".tree-folder").removeClass("selected");var e=d.panel.find(".tree-folder[fpath='"+a+"']");e.parents(".nav").first().css("display","block"),e.addClass("selected"),d.panel.find(".current-path").val(a);var l=d.panel.find(".db-list").val();d.getList(l,a)}),this.outputFlag||this.panel.find(".row-file .row-fname").click(function(){var a=d.panel.find(".db-list").val(),e=$(this).find("span").html(),l=d.panel.find(".current-path").val();d.rasterName=e,d.rasterPath=l,d.showRasterTab(a,e,l)})},createFolder:function(){var a=this.panel.find(".db-list").val();return null==a?void MapCloud.notify.showInfo("请选择一个数据源","Warning"):void MapCloud.create_folder_dialog.showDialog("raster")},setCreateFolderName:function(a){var e=this.panel.find(".current-path").val(),l=null;l="/"==e?"/"+a:e+"/"+a;var s=this.panel.find(".db-list").val();this.rasterCreateFolder(s,l)},rasterCreateFolder:function(a,e){return null==a||null==e?void MapCloud.notify.showInfo("参数无效","Warning"):(MapCloud.notify.loading(),void rasterDBManager.createFolder(a,e,this.createFolder_callback))},createFolder_callback:function(a){var e="新建文件夹";MapCloud.notify.showInfo(a,e);var l=MapCloud.raster_db_dialog,s=l.panel.find(".db-list").val(),i=l.panel.find(".current-path").val();l.getList(s,i)},getListRefresh:function(a,e){var a=this.panel.find(".db-list").val();if(null==a)return void MapCloud.notify.showInfo("请选择一个数据源","Warning");var e=this.panel.find(".current-path").val();null==e&&MapCloud.notify.showInfo("请选择刷新的路径","Warning"),MapCloud.notify.loading(),rasterDBManager.getList(a,e,this.getListRefresh_callback)},getListRefresh_callback:function(a){MapCloud.notify.showInfo("Success","刷新成功");var e=MapCloud.raster_db_dialog;e.showListTree(a),e.showListPanel(a)},removeRaster:function(a,e,l){rasterDBManager.removeRaster(a,l,e,this.removeRaster_callback)},removeRaster_callback:function(a){MapCloud.notify.showInfo(a,"删除影像");var e=MapCloud.raster_db_dialog,l=e.panel.find(".db-list").val(),s=e.panel.find(".current-path").val();e.getList(l,s)},removeFolder:function(a,e){rasterDBManager.removeFolder(a,e,this.removeFolder_callback)},removeFolder_callback:function(a){MapCloud.notify.showInfo(a,"删除文件夹");var e=MapCloud.raster_db_dialog,l=e.panel.find(".db-list").val(),s=e.panel.find(".current-path").val();e.panel.find(".tree-folder[fpath='"+s+"']").next().remove(),e.getList(l,s)},showRasterTab:function(a,e,l){this.panel.find(".raster-list-col").css("display","none"),this.panel.find(".raster-col").css("display","block"),this.panel.find(".btn-raster-info").attr("disabled",!0),this.panel.find(".bbtn-raster-preview").attr("disabled",!1);var s="";s="/"==l?"/"+e:l+"/"+e,this.panel.find(".current-raster-path").val(s),this.panel.find(".raster-tab").css("display","none"),rasterDBManager.describeRaster(a,e,l,this.describeRaster_callback)},describeRaster_callback:function(a){var e=MapCloud.raster_db_dialog;e.raster=a,e.showRasterInfo(a)},showRasterInfo:function(a){if(null!=a){var e="";e+="<div class='row'>		<div class='col-md-4 col-xs-4'>名称</div>		<div class='col-md-8 col-xs-8'>"+a.name+"</div>	</div>	<div class='row'>		<div class='col-md-4 col-xs-4'>格式</div>		<div class='col-md-8 col-xs-8'>"+a.format+"</div>	</div>	<div class='row'>		<div class='col-md-4 col-xs-4'>波段</div>		<div class='col-md-8 col-xs-8'>"+a.bands+"</div>	</div>	<div class='row'>		<div class='col-md-4 col-xs-4'>空间参考</div>		<div class='col-md-8 col-xs-8'>"+a.srid+"</div>	</div>	<div class='row'>		<div class='col-md-4 col-xs-4'>宽度</div>		<div class='col-md-8 col-xs-8'>"+a.width+"</div>	</div>	<div class='row'>		<div class='col-md-4 col-xs-4'>高度</div>		<div class='col-md-8 col-xs-8'>"+a.height+"</div>	</div>";var l=a.extent;null!=l&&(e+="	<div class='row'>		<div class='col-md-4 col-xs-4'>范围</div>		<div class='col-md-8 col-xs-8'>"+l.xmin+","+l.ymin+","+l.xmax+","+l.ymax+"</div>	</div>"),this.panel.find(".raster-info-div").html(e),this.panel.find(".raster-info-div").css("display","block"),this.panel.find(".raster-preview-div").css("display","none")}},showRasterPreview:function(a,e,l){rasterDBManager.getThumbnail(a,l,e,this.getThumbnail_callback)},getThumbnail_callback:function(a){if(null!=a){var e=a.thumb;if(null!=e){var l=MapCloud.raster_db_dialog;l.panel.find(".raster-preview-div img").attr("src",e),l.panel.find(".raster-info-div").css("display","none"),l.panel.find(".raster-preview-div").css("display","table-cell")}}},returnExtractRaster:function(a,e,l){if(null!=this.raster){var s=MapCloud.gps_raster_extract_dialog;s.setRaster(a,e,l,this.raster),this.closeDialog()}else rasterDBManager.describeRaster(a,e,l,this.rasterExtract_callback)},rasterExtract_callback:function(a){var e=MapCloud.raster_db_dialog;if(null!=a){var l=e.panel.find(".db-list").val(),s=e.panel.find(".current-path").val(),i=a.name,t=MapCloud.gps_raster_extract_dialog;t.setRaster(l,i,s,a)}e.closeDialog()},removeDataSource:function(){var a=this.panel.find(".db-list").val();return null==a||""==a?void MapCloud.notify.showInfo("请选择一个数据源","Warning"):void(confirm("确定要删除["+a+"]数据库吗?")&&(this.panel.find(".db-list").html(""),this.panel.find(".nav.foler-ul").remove(),this.panel.find(".raster-list-content-div").empty(),this.panel.find(".current-path").val("/"),this.panel.find(".current-raster-path").val(""),this.panel.find(".raster-col").css("display","none"),this.panel.find(".raster-list-col").css("display","block"),dbsManager.unRegisterDataSource(a,this.unRegisterDataSource_callback)))},unRegisterDataSource_callback:function(a){var e="注销数据源";MapCloud.notify.showInfo(a,e);var l=MapCloud.raster_db_dialog;l.getDataSources()},setRegisterDataSourceName:function(a){this.registerDataSourceName=a}});
MapCloud.StyleDialog=MapCloud.Class(MapCloud.Dialog,{rule:null,source:null,type:null,fonts:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var t=this;this.rule=null,this.panel.find("#style-info-div-tab a").each(function(){$(this).click(function(e){e.preventDefault(),$(this).tab("show")})}),this.panel.find('[data-toggle="tooltip"]').tooltip(),this.panel.find(".slider").each(function(){$(this).slider({tooltip:"hide"}),$(this).on("slide",function(e){var t=$(this).parents(".form-group");t.find(".slider-value").val(e.value+"%");t.find(".colorSelector div").css("opacity",e.value/100)})}),this.panel.find(".colorSelector").each(function(){$(this).colpick({color:"cccccc",onChange:function(e,t,l,i,n){$(i).children().css("background-color","#"+t)},onSubmit:function(e,t,l,i,n){$(i).children().css("background-color","#"+t),$(i).colpickHide()}})}),this.panel.find(".style_enable").each(function(){$(this).change(function(){var e=$(this).parents(".form-group");t.setSytleItemEnable(e,this.checked)})});var l=this.panel.find("#style-text .text-prop .style_enable"),i=this.panel.find("#style-text .text-text .style_enable");l.change(function(){if(this.checked){i.prop("checked",!1);var e=i.parents(".form-group");t.setSytleItemEnable(e,!1),t.setFontEnable(!0)}else t.setFontEnable(!1)}),i.change(function(){if(this.checked){l.prop("checked",!1);var e=l.parents(".form-group");t.setSytleItemEnable(e,!1),t.setFontEnable(!0)}else t.setFontEnable(!1)}),this.panel.find(".btn-confirm").each(function(){$(this).click(function(){var e=t.getRule();"styleMgr"==t.source?MapCloud.styleManager_dialog.setRule(e):"refresh"==t.source&&MapCloud.refresh_panel.setRule(e),t.closeDialog()})})},showDialog:function(){this.cleanup(),this.panel.modal();var e=new GeoBeans.FontManager("/ows/user1/mgr","1.0.0");this.fonts=e.getFonts(this.getFontsCallback),this.displayFonts(this.fonts)},cleanup:function(){var e=this.panel.find("ul.nav-tabs li a").first();e.tab("show"),this.panel.find(".text-text  input[type='text']").val("自定义文本")},setFontEnable:function(e){var t=this.panel.find("#style-text"),l=t.find(".text-font"),i=t.find(".text-fill");e?(this.setSytleItemEnable(l,!0),l.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(i,!0),i.find(".style_enable").prop("checked",!0)):(this.setSytleItemEnable(l,!1),l.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(i,!1),i.find(".style_enable").prop("checked",!1))},displayFonts:function(e){if(null!=e){for(var t="",l=0;l<e.length;++l){var i=e[l],n=i.face,s=i.family;t+="<option value='"+s+"'>"+n+"</option>"}if(this.panel.find(".font-family").html(t),null!=this.rule){var a=this.rule.textSymbolizer;if(null!=a){var i=a.font;if(null!=i){var s=i.family;null!=s&&this.panel.find(".font-family option[value='"+s+"']").attr("selected",!0)}}}}},setRule:function(e,t,l){this.rule=e,this.source=l,this.displayFields(t),this.displayRule(this.rule)},setSytleItemEnable:function(e,t){var l=e.find("input[type='text']").not(".slider-value ,.slider"),i=e.find("select"),n=e.find("input.slider");e.find(".colorSelector");t?(l.prop("readonly",!1),n.slider("enable"),i.prop("disabled",!1)):(l.prop("readonly",!0),n.slider("disable"),i.prop("disabled",!0))},displayFields:function(e){if(null!=e){for(var t=null,l=null,i=null,n=0;n<e.length;++n)l=e[n],i=l.name,t+="<option value='"+i+"''>"+i+"</option>";this.panel.find("#style-text .text-prop select").html(t)}},displayRule:function(e){var t=e.symbolizer;if(null!=t){var l=t.type;switch(this.setType(l),l){case GeoBeans.Symbolizer.Type.Point:this.displayPointSymbolizer(t);break;case GeoBeans.Symbolizer.Type.Line:this.displayLineSymbolizer(t);break;case GeoBeans.Symbolizer.Type.Polygon:this.displayPolygonSymoblizer(t)}}var i=e.minScale,n=this.panel.find("#style-info .sytle-min-scale");this.displayMinScale(n,i);var s=e.maxRule,a=this.panel.find("#style-info .sytle-max-scale");this.displayMaxScale(a,s);var o=e.textSymbolizer;this.displayTextSymbolizer(o)},setType:function(e){this.type=e;var t=null;switch(e){case GeoBeans.Symbolizer.Type.Point:t="点样式";break;case GeoBeans.Symbolizer.Type.Line:t="线样式";break;case GeoBeans.Symbolizer.Type.Polygon:t="面样式";break;default:t="样式"}this.panel.find(".modal-header .modal-title").html(t)},displayPointSymbolizer:function(e){var t=e.stroke,l=this.panel.find("#style-info .style-stroke");this.displayStroke(l,t);var i=e.fill,n=this.panel.find("#style-info .style-fill");this.displayFill(n,i);var s=e.shadow,a=this.panel.find("#style-info .style-shadow");this.displayShadow(a,s);var o=e.size,r=this.panel.find("#style-info .style-mark");this.displaySize(r,o)},displayLineSymbolizer:function(e){var t=e.stroke,l=this.panel.find("#style-info .style-stroke");this.displayStroke(l,t);var i=e.fill,n=this.panel.find("#style-info .style-fill");this.displayFill(n,i);var s=e.shadow,a=this.panel.find("#style-info .style-shadow");this.displayShadow(a,s);var o=this.panel.find("#style-info .style-mark");this.undisplayStyleItem(o)},displayPolygonSymoblizer:function(e){var t=e.stroke,l=this.panel.find("#style-info .style-stroke");this.displayStroke(l,t);var i=e.fill,n=this.panel.find("#style-info .style-fill");this.displayFill(n,i);var s=this.shadow,a=this.panel.find("#style-info .style-shadow");this.displayShadow(a,s);var o=this.panel.find("#style-info .style-mark");this.undisplayStyleItem(o)},displayStroke:function(e,t){if(null==t)e.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(e,!1);else{e.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(e,!0);var l=t.color;if(null!=l){var i=l.getHex(),n=100*l.getOpacity();n=parseInt(n.toFixed()),e.find(".colorSelector").colpickSetColor(i),e.find(".colorSelector div").css("background-color",i),e.find(".slider-value").val(n+"%"),e.find("input.slider").slider("setValue",n)}var s=t.width;e.find(".stroke-width").val(s);var a=t.lineCap;null!=a&&e.find(".stroke-line-cap").find("option[value="+a+"]").attr("selected",!0);var o=t.lineJoin;null!=o&&e.find(".stroke-line-join").find("option[value="+o+"]").attr("selected",!0)}},displayFill:function(e,t){if(null==t)e.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(e,!1);else{e.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(e,!0);var l=t.color;if(null!=l){var i=l.getHex(),n=l.getOpacity(),s=100*n;s=parseInt(s.toFixed()),e.find(".colorSelector").colpickSetColor(i),e.find(".colorSelector div").css("background-color",i),e.find(".colorSelector div").css("opacity",n),e.find(".slider-value").val(s+"%"),e.find("input.slider").slider("setValue",s)}}},displayShadow:function(e,t){null==t?(e.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(e,!1)):(e.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(e,!0))},displaySize:function(e,t){null==t?(e.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(e,!1)):(e.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(e,!0),e.find(".mark-size").val(t))},displayMinScale:function(e,t){null==t?(e.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(e,!1)):(e.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(e,!0),e.find(".min-scale-value").val(t))},displayMaxScale:function(e,t){null==t?(e.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(e,!1)):(e.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(e,!0),e.find(".max-scale-value").val(t))},undisplayStyleItem:function(e){e.find(".style_enable").prop("checked",!1).prop("disabled",!0),this.setSytleItemEnable(e,!1)},displayTextSymbolizer:function(e){var t=this.panel.find("#style-text"),l=t.find(".text-prop"),i=t.find(".text-text"),n=t.find(".text-font"),s=t.find(".text-stroke"),a=t.find(".text-fill"),o=t.find(".text-shadow");if(null==e)this.displayTextProp(l,null),this.displayTextText(i,null),this.displayTextFont(n,null),this.displayStroke(s,null),this.displayFill(a,null),this.displayShadow(o,null);else{var r=e.labelProp;this.displayTextProp(l,r);var d=e.labelText;this.displayTextText(i,d);var f=e.font;this.displayTextFont(n,f);var p=e.stroke;this.displayStroke(s,p);var y=e.fill;this.displayFill(a,y);var c=e.shadow;this.displayShadow(o,c)}},displayTextProp:function(e,t){if(null==t)e.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(e,!1);else{e.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(e,!0);var l=e.find("select option[value='"+t+"']");if(1==l.length)l.attr("selected",!0);else{l=e.find("select option[value='"+t+"']"),l.attr("selected",!0)}}},displayTextText:function(e,t){null==t?(e.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(e,!1)):(e.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(e,!0),e.find("input[type='text']").val(t))},displayTextFont:function(e,t){if(null==t)e.find(".style_enable").prop("checked",!1),this.setSytleItemEnable(e,!1);else{e.find(".style_enable").prop("checked",!0),this.setSytleItemEnable(e,!0);var l=e.find(".font-family"),i=t.family;null!=i&&l.find("option[value='"+i+"']").attr("selected",!0);var n=e.find(".font-style"),s=t.style;null!=s&&n.find("option[value='"+s+"']").attr("selected",!0);var a=e.find(".font-weight"),o=t.weight;null!=o&&a.find("option[value='"+o+"']").attr("selected",!0);var r=e.find(".font-size"),d=t.size;null!=d&&r.val(d)}},getRule:function(){var e=new GeoBeans.Rule,t=this.getSymbolizer();e.symbolizer=t;var l=this.getTextSymbolizer();e.textSymbolizer=l;var i=this.panel.find("#style-info .sytle-min-scale"),n=this.getMinScale(i);e.minScale=n;var s=this.panel.find("#style-info .sytle-max-scale"),a=this.getMaxScale(s);return e.maxScale=a,e},getSymbolizer:function(){var e=null;switch(this.type){case GeoBeans.Symbolizer.Type.Point:e=this.getPointSymbolizer();break;case GeoBeans.Symbolizer.Type.Line:e=this.getLineSymbolizer();break;case GeoBeans.Symbolizer.Type.Polygon:e=this.getPolygonSymbolizer()}return e},getPointSymbolizer:function(){var e=new GeoBeans.Symbolizer.PointSymbolizer,t=this.panel.find("#style-info .style-fill"),l=this.getFill(t);e.fill=l;var i=this.panel.find("#style-info .style-stroke"),n=this.getStroke(i);e.stroke=n;var s=this.panel.find("#style-info .style-shadow"),a=this.getShadow(s);e.shadow=a;var o=this.panel.find("#style-info .style-mark"),r=this.getSize(o);return e.size=r,e},getLineSymbolizer:function(){var e=new GeoBeans.Symbolizer.LineSymbolizer,t=this.panel.find("#style-info .style-stroke"),l=this.getStroke(t);e.stroke=l;var i=this.panel.find("#style-info .style-fill"),n=this.getFill(i);e.fill=n;var s=this.panel.find("#style-info .style-shadow"),a=this.getShadow(s);return e.shadow=a,e},getPolygonSymbolizer:function(){var e=new GeoBeans.Symbolizer.PolygonSymbolizer,t=this.panel.find("#style-info .style-stroke"),l=this.getStroke(t);e.stroke=l;var i=this.panel.find("#style-info .style-shadow"),n=this.getShadow(i);e.shadow=n;var s=this.panel.find("#style-info .style-fill"),a=this.getFill(s);return e.fill=a,e},getFill:function(e){if(1!=e.length)return null;var t=e.find(".style_enable").prop("checked");if(!t)return null;var l=new GeoBeans.Fill,i=e.find(".colorSelector div"),n=i.css("background-color"),s=i.css("opacity"),a=new GeoBeans.Color;return a.setByRgb(n,s),l.color=a,l},getStroke:function(e){if(1!=e.length)return null;var t=e.find(".style_enable").prop("checked");if(!t)return null;var l=new GeoBeans.Stroke,i=e.find(".colorSelector div"),n=i.css("background-color"),s=i.css("opacity"),a=new GeoBeans.Color;a.setByRgb(n,s),l.color=a;var o=e.find(".stroke-width").val();l.width=parseFloat(o);var r=e.find(".stroke-line-cap option:selected").val();l.lineCap=r;var d=e.find(".stroke-line-join option:selected").val();return l.lineJoin=d,l},getShadow:function(e){return null},getSize:function(e){if(1!=e.length)return null;var t=e.find(".style_enable").prop("checked");if(!t)return null;var l=e.find(".mark-size").val();return l},getMinScale:function(e){if(1!=e.length)return null;var t=e.find(".style_enable").prop("checked");if(!t)return null;var l=e.find(".min-scale-value").val();return l},getMaxScale:function(e){if(1!=e.length)return null;var t=e.find(".style_enable").prop("checked");if(!t)return null;var l=e.find(".max-scale-value").val();return l},getTextSymbolizer:function(){var e=this.panel.find("#style-text"),t=e.find(".text-prop"),l=e.find(".text-text"),i=t.find(".style_enable").prop("checked"),n=l.find(".style_enable").prop("checked");if(!i&&!n)return null;var s=new GeoBeans.Symbolizer.TextSymbolizer;if(i){var a=t.find("select option:selected").val();s.labelProp=a}if(n){var o=l.find("input[type='text']").val();s.labelText=o}var r=e.find(".text-font"),d=this.getFont(r);s.font=d;var f=e.find(".text-stroke"),p=this.getStroke(f);s.stroke=p;var y=e.find(".text-shadow"),c=this.getShadow(y);s.shadow=c;var h=e.find(".text-fill"),u=this.getFill(h);return s.fill=u,s},getFont:function(e){if(1!=e.length)return null;var t=e.find(".style_enable").prop("checked");if(!t)return null;var l=new GeoBeans.Font,i=e.find(".font-family option:selected").attr("value");l.family=i;var n=e.find(".font-style option:selected").val();l.style=n;var s=e.find(".font-weight option:selected").val();l.weight=s;var a=e.find(".font-size").val();return l.size=a,l}});
MapCloud.StyleListDialog=MapCloud.Class(MapCloud.Dialog,{initialize:function(l){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var t=this;this.panel.find(".btn-confirm").click(function(){var l=t.panel.find(".style-list").val();if(null==l||""==l)return void MapCloud.notify.showInfo("请选择有效的样式","Warning");var a=MapCloud.new_layer_dialog,i=styleManager.getStyle(l);a.setStyle(i),t.closeDialog()})},cleanup:function(){this.panel.find(".style-list").html("")},showDialog:function(l){if(MapCloud.Dialog.prototype.showDialog.apply(this,arguments),styleManager.getStyles(),null!=l){var t=MapCloud.styleManager_dialog.getStyleTypeByGeomType(l);if(null!=t){var a=styleManager.getStyleByType(t);this.displayStyles(a)}}},displayStyles:function(l){if(null!=l){for(var t="",a=null,i=null,e=0;e<l.length;++e)a=l[e],null!=a&&(i=a.name,t+="<option value='"+i+"'>"+i+"</option>");this.panel.find(".style-list").html(t)}}});
MapCloud.StyleManagerDialog=MapCloud.Class(MapCloud.Dialog,{styleNameCur:null,styleCur:null,defaultStyle:null,wfsWorkspace:null,typeName:null,uniqueValues:null,dbLayer:null,singleStyle:null,uniqueStyle:null,quantitiesStyle:null,styleChangedClass:null,styleChangedIndex:null,symbolChangedClass:null,symbolChangedIndex:null,minMaxValue:null,customStyle:null,customStyleFilters:null,dotDensityStyle:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var l=this;this.panel.find(".btn-confirm").each(function(){$(this).click(function(){var e=l.panel.find("#style_list option:selected").text(),t=l.getCurrentStyle();if(null==t)return void MapCloud.notify.showInfo("Warning","请设置一个有效样式");if(t.name=e,"default"!=e){var n=styleManager.getStyle(e);return null==n?(l.addStyle(t),l.setLayerStyleFlag=!0,void l.closeDialog()):(l.updateStyle(t),null!=l.typeName&&l.setStyle(l.typeName,t,l.setStyle_callback),void l.closeDialog())}null!=l.typeName&&l.setStyle(l.typeName,t,l.setStyle_callback),l.closeDialog()})}),this.panel.find(".btn-success").each(function(){$(this).click(function(){var e=l.panel.find("#style_list option:selected").text(),t=l.getCurrentStyle();if(null==t)return void MapCloud.notify.showInfo("Warning","请设置一个有效样式");if(t.name=e,"default"!=e){var n=styleManager.getStyle(e);return null==n?(l.addStyle(t),void(l.setLayerStyleFlag=!0)):(l.updateStyle(t),void(null!=l.typeName&&l.setStyle(l.typeName,t,l.setStyle_callback)))}null!=l.typeName&&l.setStyle(l.typeName,t,l.setStyle_callback)})}),this.registerSingleSymbolEvent(),this.registerDotDensitySymbolEvent(),this.panel.find("#style_type_list li a").each(function(){$(this).click(function(){var e=$(this).text(),t=e+"<span class='caret'></span>";if(l.panel.find("#style_type_name").html(t),e=e.toLowerCase(),"all"==e){var n=styleManager.getStyles();l.getStyles_callback(n)}else{var a=l.getStyleType(e);if(null!=a){var n=styleManager.getStyleByType(a);l.getStyles_callback(n)}}})}),this.panel.find("#style_list").each(function(){$(this).focus(function(){preStyleName=this.value}).change(function(){if("default"==this.value&&null!=l.wfsLayer){var e=l.wfsLayer.style;return l.styleNameCur="default",void l.getStyleXML_callback(e)}var t=$(this).children(":selected"),n=t.text(),e=styleManager.getStyle(n);null!=e&&(MapCloud.notify.loading(),styleManager.getStyleXML(n,l.getStyleXML_callback))})}),this.panel.find("#add_style").each(function(){$(this).click(function(){var e=l.panel.find("#style_type_name").text();return"All"==e?void MapCloud.notify.showInfo("请选择一个类型","Warning"):(MapCloud.styleName_dialog.setFlag("add"),void MapCloud.styleName_dialog.showDialog())})}),this.panel.find("#save_style").each(function(){$(this).click(function(){var e=l.panel.find("#style_list option:selected").val(),t=l.getCurrentStyle();if(null==t)return void MapCloud.notify.showInfo("Warning","请设置一个有效样式");if(t.name=e,"default"==e)return MapCloud.styleName_dialog.setFlag("save"),void MapCloud.styleName_dialog.showDialog();var n=styleManager.getStyle(e);null==n?l.addStyle(t):l.updateStyle(t)})}),this.panel.find("#remove_style").each(function(){$(this).click(function(){var e=l.panel.find("#style_list option:selected").text(),t=confirm("确认删除"+e+"样式？");t&&(MapCloud.notify.loading(),l.currentStyle=null,l.singleStyle=null,l.quantitiesStyle=null,l.uniqueStyle=null,l.dotDensityStyle=null,styleManager.removeStyle(e,l.removeStyle_callback))})}),this.panel.find("#add_all_value").each(function(){$(this).click(function(){var e=l.panel.find(".unique-pane .layer-fields option:selected").val();null!=e&&l.wfsWorkspace.getValue(l.typeName,e,mapObj.name,l.getValuesCallback)})}),this.panel.find("#remove_value").each(function(){$(this).click(function(){var e=l.panel.find(".unique-pane .style-list-table"),t=e.find("tbody tr.selected"),n=e.find("tbody tr"),a=n.index(t);if(-1!=a){if(!confirm("确定删除该行样式吗？"))return;l.uniqueStyle.removeRule(a),l.displayUniqueStyle(l.uniqueStyle)}})}),this.panel.find("#remove_all_value").each(function(){$(this).click(function(){l.uniqueStyle=null,l.cleanupUniquePanel()})}),this.panel.find(".quantities-pane .layer-fields").change(function(){var e=$(this).find("option:selected").val();if("none"==e)l.quantitiesStyle=null,l.cleanupQuantitiesPanel();else{if(null==l.wfsWorkspace)return;l.wfsWorkspace.getMinMaxValue(l.typeName,e,mapObj.name,l.getMinMaxValue_callback)}}),this.panel.find(".quantities-pane .classes").each(function(){$(this).change(function(){var e=$(this).val(),t=l.panel.find(".quantities-pane .layer-fields option:selected").val();if(null!=t&&"none"!=t){var n=l.panel.find(".quantities-pane .select-color-ramp li").attr("cid");null==l.minMaxValue?l.wfsWorkspace.getMinMaxValue(l.typeName,t,mapObj.name,l.getMinMaxValue_callback):styleManager.getColorMap(n,e,l.getColorMapMinMax_callback)}})}),this.panel.find("#quantities_add_all_value").click(function(){var e=l.panel.find(".quantities-pane .layer-fields").val();if("none"==e)l.quantitiesStyle=null,l.cleanupQuantitiesPanel();else{if(null==l.wfsWorkspace)return;l.wfsWorkspace.getMinMaxValue(l.typeName,e,mapObj.name,l.getMinMaxValue_callback)}}),this.panel.find("#quantities_remove_value").click(function(){var e=l.panel.find(".quantities-pane .style-list-table"),t=e.find("tbody tr.selected"),n=e.find("tbody tr"),a=n.index(t);if(-1!=a){if(!confirm("确定删除该行样式吗？"))return;l.quantitiesStyle.removeRule(a),l.displayQuantitiesStyle(l.quantitiesStyle)}}),this.panel.find("#quantities_remove_all_value").click(function(){l.quantitiesStyle=null,l.cleanupQuantitiesPanel()}),this.panel.find("#custom_add_value").click(function(){var e=l.panel.find(".custom-pane .layer-fields").val();return null==e||""==e?void MapCloud.notify.showInfo("请先选择一个字段","Warning"):null==l.dbLayer?void MapCloud.notify.showInfo("当前图层为空","Warning"):(MapCloud.query_dialog.showDialog(),void MapCloud.query_dialog.setLayer(l.dbLayer,e))}),this.panel.find("#custom_remove_value").click(function(){var e=l.panel.find(".custom-pane .style-list-table"),t=e.find("tbody tr.selected"),n=e.find("tbody tr"),a=n.index(t);if(-1!=a){if(!confirm("确定删除该行样式吗？"))return;l.customStyle.removeRule(a);var s=l.getCustomStyleFilters(this.customStyle);l.customStyleFilters=s,l.displayCustomStyle(l.customStyle)}}),this.panel.find("#custom_remove_all_value").click(function(){l.customStyle=null,l.customStyleFilters=[],l.cleanupCustomPanel()}),this.panel.find(".list-group-item").click(function(){if(l.panel.find(".list-group-item").removeClass("active"),$(this).addClass("active"),$(this).hasClass("single-style"))l.panel.find(".style-pane").css("display","none"),l.panel.find(".single-pane").css("display","block");else if($(this).hasClass("unique-style"))l.panel.find(".style-pane").css("display","none"),l.panel.find(".unique-pane").css("display","block");else if($(this).hasClass("quantities-style"))l.panel.find(".style-pane").css("display","none"),l.panel.find(".quantities-pane").css("display","block");else if($(this).hasClass("custom-style"))l.panel.find(".style-pane").css("display","none"),l.panel.find(".custom-pane").css("display","block");else if($(this).hasClass("dot-density-style")){if(l.panel.find(".style-pane").css("display","none"),l.panel.find(".dot-density-pane").css("display","block"),null==l.dotDensityStyle){var e=l.getDotDensityStyle(l.singleStyle);l.dotDensityStyle=e}l.displayDotDensityStyle(l.dotDensityStyle)}}),this.panel.find(".single-pane .symbol-icon").click(function(){if(null!=l.singleStyle){var e=null,t=l.singleStyle.geomType;t==GeoBeans.Style.FeatureStyle.GeomType.Point?e="marker":t==GeoBeans.Style.FeatureStyle.GeomType.LineString?e="line":t==GeoBeans.Style.FeatureStyle.GeomType.Polygon&&(e="fill"),l.symbolChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.SINGLE,l.symbolChangedIndex=0;var n=l.singleStyle.rules[0].symbolizer.symbol,a=null;null!=n&&(a=n.name),MapCloud.symbol_dialog.showDialog("styleManager",e,a)}})},showDialog:function(e){this.cleanup(),this.panel.modal();var l="All<span class='caret'></span>";this.panel.find("#style_type_name").html(l);var t=styleManager.getStyles();(null==e||void 0==e)&&(e=!0),this.getStyles_callback(t,e),styleManager.getColorMaps(this.getColorMaps_callback)},cleanup:function(){this.panel.find("#styles_list_table").html(""),this.typeName=null,this.styleNameCur=null,this.defaultStyle=null,this.uniqueValues=null,this.minMaxValue=null,this.wfsWorkspace=null,this.panel.find("#style_type_name").removeClass("disabled"),this.panel.find("#layer_fields").html(""),this.panel.find(".layer-fields").html(""),this.panel.find("#add_style,#save_style,#remove_style").removeAttr("disabled"),this.panel.find("#style_list").removeAttr("disabled"),this.panel.find(".col-md-3 .list-group-item").removeClass("disabled"),this.dbLayer=null,this.singleStyle=null,this.uniqueStyle=null,this.quantitiesStyle=null,this.customStyle=null,this.customStyleFilters=[],this.dotDensityStyle=null,this.cleanupUniquePanel(),this.cleanupQuantitiesPanel(),this.cleanupCustomPanel()},cleanupUniquePanel:function(){this.panel.find(".unique-pane .style-list-table").html("")},cleanupQuantitiesPanel:function(){this.panel.find(".quantities-pane .style-list-table").html("")},cleanupCustomPanel:function(){this.panel.find(".custom-pane .style-list-table").html("")},getStyleType:function(e){if(null==e)return null;var l=null;switch(e){case"point":l=GeoBeans.Style.FeatureStyle.GeomType.Point;break;case"linestring":l=GeoBeans.Style.FeatureStyle.GeomType.LineString;break;case"polygon":l=GeoBeans.Style.FeatureStyle.GeomType.Polygon}return l},closeDialog:function(){this.panel.modal("hide"),MapCloud.refresh_panel.refreshPanel()},getStyles_callback:function(e,l){for(var t="",t="",n=0;n<e.length;++n){var a=e[n],s=a.name,i=a.geomType;t+="<option value='"+s+"' type='"+i+"'>"+s+"</option>"}var o=MapCloud.styleManager_dialog,r=o.panel;if(r.find("#style_list").html(t),(null==l||void 0==l)&&(l=!0),l){var y=r.find("#style_list option:selected").val();o.styleNameCur=y,styleManager.getStyleXML(o.styleNameCur,o.getStyleXML_callback)}},getStyleXML_callback:function(e){if(MapCloud.notify.hideLoading(),null!=e){var l=MapCloud.styleManager_dialog,t=(l.panel,e.styleClass);(null==t||""==t)&&(t=l.getStyleClass(e)),l.setPanelStyle(e,t)}},getStyleClass:function(e){if(null==e)return null;var l=e.rules;if(null==l)return null;if(1==l.length){var t=l[0];if(null!=t){var n=t.filter;if(null==n)return GeoBeans.Style.FeatureStyle.StyleClass.SINGLE}}else{for(var a=0,s=0,i=0;i<l.length;++i){var t=l[i];if(null!=t){var n=t.filter;if(null!=n)if(n instanceof GeoBeans.BinaryComparisionFilter){var o=n.operator;o==GeoBeans.ComparisionFilter.OperatorType.ComOprEqual&&a++}else n instanceof GeoBeans.IsBetweenFilter&&s++}}if(a==l.length)return GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE;if(s==l.length)return GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES}return null},displaySingleStyle:function(e){if(null!=e){var l=e.rules;if(null!=l){var t=l.length;if(1==t){var n=l[0];if(null==n)return;var a=n.symbolizer;if(null==a)return;var s=this.getStyleSymbolCss(a);this.panel.find(".single-pane .style-symbol").css(s);var i=null,o=a.symbol;if(null!=o){var r=o.name;if(i=o.icon,null==i){var y=this.getSymbolIconType(a.type);i=styleManager.getSymbolIcon(y,r)}}else switch(a.type){case GeoBeans.Symbolizer.Type.Point:i="../images/Circle.png";break;case GeoBeans.Symbolizer.Type.Line:i="../images/SimpleLine.png";break;case GeoBeans.Symbolizer.Type.Polygon:i="../images/SimpleRegion.png"}var u="url("+i+")";this.panel.find(".single-pane .symbol-icon").css("background-image",u)}}}},displayUniqueStyle:function(e){if(null!=e){var l=this.getProperyNameByRule(e.rules[0]),t=this.panel.find(".unique-pane .layer-fields option[value='"+l+"']");t.attr("selected",!0);var n=this.getRulesListHtml(l,e.rules);this.panel.find(".unique-pane .style-list-table").html(n),this.registerUniqueSymbolEvent(),this.registerUniqueSymbolIconEvent(),this.registerUnqiueSelectEvent()}},displayQuantitiesStyle:function(e){var l=this.getProperyNameByRule(e.rules[0]),t=this.panel.find(".quantities-pane .layer-fields option[value='"+l+"']");t.attr("selected",!0);var n=e.rules.length,a=this.panel.find(".quantities-pane .classes option[value='"+n+"']");a.attr("selected",!0);var s=this.getRulesListHtml(l,e.rules);this.panel.find(".quantities-pane .style-list-table").html(s),this.registerQuantitiesSymbolEvent(),this.registerQuantitiesSymbolIconEvent(),this.registerQuantitiesSelectEvent()},displayCustomStyle:function(e){if(null!=e){var l=this.getRulesHtml(e.rules);this.panel.find(".custom-pane .style-list-table").html(l),this.registerCustomSymbolEvent(),this.registerCustomSymbolIconEvent(),this.registerCustomSelectEvent()}},displayDotDensityStyle:function(e){if(null!=e){var l=e.rules;if(null!=l){var t=l.length;if(1==t){var n=l[0];if(null!=n){var a=n.symbolizer;if(null!=a){var s=this.getStyleSymbolCss(a);this.panel.find(".dot-density-pane .style-symbol").css(s);var i=e.field;if(null!=i){var o=this.panel.find(".dot-density-pane .layer-fields option[value='"+i+"']");o.attr("selected",!0)}}}}}}},setPanelStyle:function(e,l){var t=this.getSingleStyle(e);if(this.singleStyle=t,e.geomType!=GeoBeans.Style.FeatureStyle.GeomType.Polygon?this.panel.find(".dot-density-style").addClass("disabled"):this.panel.find(".dot-density-style").removeClass("disabled"),this.displaySingleStyle(this.singleStyle),l==GeoBeans.Style.FeatureStyle.StyleClass.SINGLE)this.uniqueStyle=null,this.quantitiesStyle=null,this.customStyle=null,this.cleanupUniquePanel(),this.cleanupQuantitiesPanel(),this.cleanupCustomPanel(),this.panel.find(".style-pane").css("display","none"),this.panel.find(".single-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".single-style").addClass("active");else if(l==GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE)this.uniqueStyle=e.clone(),this.quantitiesStyle=null,this.customStyle=null,this.cleanupQuantitiesPanel(),this.cleanupCustomPanel(),this.displayUniqueStyle(this.uniqueStyle),this.panel.find(".style-pane").css("display","none"),this.panel.find(".unique-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".unique-style").addClass("active");else if(l==GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES)this.uniqueStyle=null,this.customStyle=null,this.cleanupUniquePanel(),this.cleanupCustomPanel(),this.quantitiesStyle=e.clone(),this.displayQuantitiesStyle(e),this.panel.find(".style-pane").css("display","none"),this.panel.find(".quantities-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".quantities-style").addClass("active");else if(l==GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM){this.uniqueStyle=null,this.quantitiesStyle=null,this.cleanupUniquePanel(),this.cleanupQuantitiesPanel(),this.customStyle=e.clone(),this.displayCustomStyle(this.customStyle);var n=this.getCustomStyleFilters(this.customStyle);this.customStyleFilters=n,this.panel.find(".style-pane").css("display","none"),this.panel.find(".custom-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".custom-style").addClass("active")}else l==GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY&&(this.dotDensityStyle=e.clone(),this.displayDotDensityStyle(this.dotDensityStyle),this.panel.find(".style-pane").css("display","none"),this.panel.find(".dot-density-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".dot-density-style").addClass("active"))},registerSingleSymbolEvent:function(){var e=this;this.panel.find(".single-pane .style-symbol").click(function(){if(null!=e.singleStyle){var l=e.singleStyle.rules;if(null!=l){var t=l[0];MapCloud.style_dialog.setRule(t,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.SINGLE,e.styleChangedIndex=0}}})},registerUniqueSymbolEvent:function(){var e=this;this.panel.find(".unique-pane .style-symbol").click(function(){var l=$(this).parents("tbody").find(".style-symbol"),t=l.index($(this));if(-1!=t&&null!=e.uniqueStyle){var n=e.uniqueStyle.rules;if(null!=n){var a=n[t];MapCloud.style_dialog.setRule(a,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE,e.styleChangedIndex=t}}})},registerUniqueSymbolIconEvent:function(){var e=this;this.panel.find(".unique-pane .symbol-icon").click(function(){var l=$(this).parents("tbody").find(".symbol-icon"),t=l.index($(this));if(-1!=t&&null!=e.uniqueStyle){var n=e.uniqueStyle.rules;if(null!=n){var a=n[t];if(null!=a){var s=a.symbolizer;if(null!=s){var i=s.symbol,o=null;null!=i&&(o=i.name);var r=e.getSymbolIconType(s.type);MapCloud.symbol_dialog.showDialog("styleManager",r,o),e.symbolChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE,e.symbolChangedIndex=t}}}}})},registerUnqiueSelectEvent:function(){var e=this;this.panel.find(".unique-pane .style-list-table tbody tr").click(function(){e.panel.find(".unique-pane .style-list-table tr").removeClass("selected"),$(this).addClass("selected")})},registerQuantitiesSymbolEvent:function(){var e=this;this.panel.find(".quantities-pane .style-symbol").click(function(){var l=$(this).parents("tbody").find(".style-symbol"),t=l.index($(this));if(-1!=t&&null!=e.quantitiesStyle){var n=e.quantitiesStyle.rules;if(null!=n){var a=n[t];MapCloud.style_dialog.setRule(a,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES,e.styleChangedIndex=t}}})},registerQuantitiesSymbolIconEvent:function(){var e=this;e.panel.find(".quantities-pane .symbol-icon").click(function(){var l=$(this).parents("tbody").find(".symbol-icon"),t=l.index($(this));if(-1!=t&&null!=e.quantitiesStyle){var n=e.quantitiesStyle.rules;if(null!=n){var a=n[t];if(null!=a){var s=a.symbolizer;if(null!=s){var i=s.symbol,o=null;null!=i&&(o=i.name);var r=e.getSymbolIconType(s.type);MapCloud.symbol_dialog.showDialog("styleManager",r,o),e.symbolChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES,e.symbolChangedIndex=t}}}}})},registerQuantitiesSelectEvent:function(){var e=this;this.panel.find(".quantities-pane .style-list-table tbody tr").click(function(){e.panel.find(".quantities-pane .style-list-table tr").removeClass("selected"),$(this).addClass("selected")})},registerCustomSymbolEvent:function(){var e=this;this.panel.find(".custom-pane .style-symbol").click(function(){var l=$(this).parents("tbody").find(".style-symbol"),t=l.index($(this));if(-1!=t&&null!=e.customStyle){var n=e.customStyle.rules;if(null!=n){var a=n[t];MapCloud.style_dialog.setRule(a,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM,e.styleChangedIndex=t}}})},registerCustomSymbolIconEvent:function(){var e=this;e.panel.find(".custom-pane .symbol-icon").click(function(){var l=$(this).parents("tbody").find(".symbol-icon"),t=l.index($(this));if(-1!=t&&null!=e.customStyle){var n=e.customStyle.rules;if(null!=n){var a=n[t];if(null!=a){var s=a.symbolizer;if(null!=s){var i=s.symbol,o=null;null!=i&&(o=i.name);var r=e.getSymbolIconType(s.type);MapCloud.symbol_dialog.showDialog("styleManager",r,o),e.symbolChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM,e.symbolChangedIndex=t}}}}})},registerCustomSelectEvent:function(){var e=this;this.panel.find(".custom-pane .style-list-table tbody tr").click(function(){e.panel.find(".custom-pane .style-list-table tr").removeClass("selected"),$(this).addClass("selected")})},registerDotDensitySymbolEvent:function(){var e=this;this.panel.find(".dot-density-pane .style-symbol").click(function(){if(null!=e.dotDensityStyle){var l=e.dotDensityStyle.rules;if(null!=l){var t=l[0];MapCloud.style_dialog.setRule(t,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY,e.styleChangedIndex=0}}})},getSingleStyle:function(e){if(null==e)return null;var l=e.rules;if(null!=l){var t=e.geomType,n=e.styleClass,a=null;if(l.length>=1){var s=l[0];if(null!=s){var i=s.textSymbolizer,o=s.symbolizer,a=new GeoBeans.Style.FeatureStyle("single",t);a.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.SINGLE;var s=new GeoBeans.Rule;if(null!=o)if(n==GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY){var r=o.fill,y=o.stroke,u=new GeoBeans.Symbolizer.PolygonSymbolizer;null!=r&&(u.fill=r.clone()),null!=y&&(u.stroke=y.clone()),s.symbolizer=u,a.geomType=GeoBeans.Style.FeatureStyle.GeomType.Polygon}else s.symbolizer=o.clone();null!=i&&(s.textSymbolizer=i.clone()),a.addRule(s)}}return a}},getDotDensityStyle:function(e){if(null==e)return null;var l=GeoBeans.Style.FeatureStyle.GeomType.Point,t=new GeoBeans.Style.FeatureStyle("dotDensity",l);t.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY;var n=new GeoBeans.Rule,a=new GeoBeans.Symbolizer.PointSymbolizer,s=e.rules;if(null!=s){var i=s[0];if(null!=n){var o=i.symbolizer;if(null!=o){var r=o.fill,y=o.stroke;null!=r&&(a.fill=r.clone()),null!=y&&(a.stroke=y.clone())}}}return n.symbolizer=a,t.addRule(n),t},getStyleSymbolCss:function(e){var l={},t=null,n=null,a=null,s=null,i=null,o=null,r=e.type;switch(r){case GeoBeans.Symbolizer.Type.Point:t=e.stroke,null!=t&&(a=t.color,s=a.getRgba());var n=e.fill;null!=n&&(i=n.color,o=i.getRgba()),l={"background-color":o,"border-color":s};break;case GeoBeans.Symbolizer.Type.Line:var t=e.stroke;null!=t&&(a=t.color,s=a.getRgba()),l={"background-color":s,"border-color":"#fff"};break;case GeoBeans.Symbolizer.Type.Polygon:t=e.stroke,null!=t&&(a=t.color,s=a.getRgba());var n=e.fill;null!=n&&(i=n.color,o=i.getRgba()),l={"background-color":o,"border-color":s}}return l},getSymbolHtml:function(e){var l=e.type,t="",n=null,a=null,s=null,i=null;if(l==GeoBeans.Symbolizer.Type.Point){var o=e.stroke;null!=o&&(n=o.color,a=n.getRgba());var r=e.fill;null!=r&&(s=r.color,i=s.getRgba()),t='<div class="style-symbol" style="background-color:'+i+";border-color:"+a+'"></div>'}else if(l==GeoBeans.Symbolizer.Type.Line){var o=e.stroke;null!=o&&(n=o.color,a=n.getRgba()),t='<div class="style-symbol" style="background-color:'+a+'"></div>'}else if(l==GeoBeans.Symbolizer.Type.Polygon){var o=e.stroke;null!=o&&(n=o.color,a=n.getRgba());var r=e.fill;null!=r&&(s=r.color,i=s.getRgba()),t='<div class="style-symbol" style="background-color:'+i+";border-color:"+a+'"></div>'}return t},getSymbolIconHtml:function(e,l){var t="",n=null;if(null!=l&&(n=l.icon,null==n)){var a=this.getSymbolIconType(e);n=styleManager.getSymbolIcon(a,l.name)}if(null==n){switch(e){case GeoBeans.Symbolizer.Type.Point:n="../images/Circle.png";break;case GeoBeans.Symbolizer.Type.Line:n="../images/SimpleLine.png";break;case GeoBeans.Symbolizer.Type.Polygon:n="../images/SimpleRegion.png"}console.log("symbol is null")}var t="<div class='symbol-icon' style='background-image:url("+n+")'></div>";return t},getProperyNameByRule:function(e){if(null==e)return null;var l=e.filter;if(null==l)return null;var t=l.type;if(t==GeoBeans.Filter.Type.FilterComparsion){var n=l.operator;if(n==GeoBeans.ComparisionFilter.OperatorType.ComOprEqual){var a=l.expression1,s=a.type;if(s==GeoBeans.Expression.Type.PropertyName){var i=a.name;return i}var o=l.expression2;if(s=o.type,s==GeoBeans.Expression.Type.PropertyName){var i=a.name;return i}}else if(n==GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween){var r=l.expression;if(null!=r){var i=r.name;return i}}}return null},getRulesListHtml:function(e,l){if(null!=l){for(var t="<thead>	<tr>		<th class='style-col'><span>&nbsp;</span></th>		<th class='style-col'><span>&nbsp;</span></th>		<th class='value-col'>值列表</th>		<th class='value-col'>"+e+"</th>	</tr></thead><tbody>",n=0;n<l.length;++n){var a=l[n],s=a.filter,i="";if(null!=s){var o=s.type;if(o==GeoBeans.Filter.Type.FilterComparsion){var r=s.operator;if(r==GeoBeans.ComparisionFilter.OperatorType.ComOprEqual){var y=s.expression1,u=s.expression2;null!=y&&y.type==GeoBeans.Expression.Type.Literal?i=y.value:null!=u&&u.type==GeoBeans.Expression.Type.Literal&&(i=u.value)}else if(r==GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween){var p=s.lowerBound,d=s.upperBound,c="",f="";null!=p&&(c=parseFloat(p.value)),null!=d&&(f=parseFloat(d.value)),i=c.toFixed(2)+"-"+f.toFixed(2)}}var m=a.symbolizer,h=this.getSymbolHtml(m),S=this.getSymbolIconHtml(m.type,m.symbol);t+="<tr>		<td class='style-col'>"+h+"		</td>		<td class='style-col'>"+S+"		</td>		<td class='value-col'>"+i+"		</td>		<td value='value-col'>"+i+"		</td>	</tr>"}}return t+="</tbody>"}},removeStyle_callback:function(e){var l=MapCloud.styleManager_dialog,t=l.panel,n=l.panel.find("#style_list option:selected").text(),a="删除样式 [ "+n+" ]";if(MapCloud.notify.showInfo(e,a),t.find(".style-pane").css("display","none"),"SUCCESS"==e.toUpperCase()){var s=t.find("#style_type_name").text();if(s=s.toLowerCase(),"all"==s){var i=styleManager.getStyles();l.getStyles_callback(i)}else{var o=l.getStyleType(s);if(null!=o){var i=styleManager.getStyleByType(o);l.getStyles_callback(i)}}}},registerStyleSelected:function(){this.panel.find(".unique-pane .style-list-table tbody tr").each(function(){$(this).click(function(){$(this).parent().children().removeClass("selected"),$(this).addClass("selected")})})},setRule:function(e){if(null!=e)if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.SINGLE&&0==this.styleChangedIndex){var l=this.singleStyle.rules[0].symbolizer.symbol;e.symbolizer.symbol=l,this.singleStyle.rules[0]=e,this.displaySingleStyle(this.singleStyle)}else if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE){var l=this.uniqueStyle.rules[this.styleChangedIndex].symbolizer.symbol;e.symbolizer.symbol=l,this.uniqueStyle.rules[this.styleChangedIndex].symbolizer=e.symbolizer,this.uniqueStyle.rules[this.styleChangedIndex].textSymbolizer=e.textSymbolizer,this.displayUniqueStyle(this.uniqueStyle)}else if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES){var l=this.quantitiesStyle.rules[this.styleChangedIndex].symbolizer.symbol;e.symbolizer.symbol=l,this.quantitiesStyle.rules[this.styleChangedIndex].symbolizer=e.symbolizer,this.quantitiesStyle.rules[this.styleChangedIndex].textSymbolizer=e.textSymbolizer,this.displayQuantitiesStyle(this.quantitiesStyle)}else if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM){var l=this.customStyle.rules[this.styleChangedIndex].symbolizer.symbol;e.symbolizer.symbol=l,this.customStyle.rules[this.styleChangedIndex].symbolizer=e.symbolizer,this.customStyle.rules[this.styleChangedIndex].textSymbolizer=e.textSymbolizer,this.displayCustomStyle(this.customStyle)}else if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY){var l=this.dotDensityStyle.rules[this.styleChangedIndex].symbolizer.symbol;e.symbolizer.symbol=l,this.dotDensityStyle.rules[this.styleChangedIndex].symbolizer=e.symbolizer,this.dotDensityStyle.rules[this.styleChangedIndex].textSymbolizer=e.textSymbolizer,this.displayDotDensityStyle(this.dotDensityStyle)}},setAddStyleName:function(e,l){if(null!=e){this.addStyleName=e;var t=styleManager.getStyle(e);if(null!=t){var n="已经有"+e+"样式，请重新输入";return MapCloud.notify.showInfo("failed",n),void MapCloud.styleName_dialog.showDialog()}var a=this.panel.find("#style_list");if("add"==l){var s=this.panel.find("#style_type_name").text(),i=this.getStyleType(s.toLowerCase()),o='<option value="'+e+'" type="'+i+'">'+e+"</option>";a.append(o),a.find("option[value='"+e+"']").attr("selected",!0),this.loadAddStyle(i)}else if("save"==l){this.panel.find("#style_list option[value='default']").text(e);var t=this.getCurrentStyle();this.addStyle(t)}}},loadAddStyle:function(e){if(null!=e){var l=this,t=null;switch(e){case GeoBeans.Style.FeatureStyle.GeomType.Point:t="js/StyleXML/point.xml";break;case GeoBeans.Style.FeatureStyle.GeomType.LineString:t="js/StyleXML/line.xml";break;case GeoBeans.Style.FeatureStyle.GeomType.Polygon:t="js/StyleXML/polygon.xml"}$.get(t,function(e){var t=styleManager.reader.read(e);t.name=l.addStyleName;var n=l.panel.find("#style_type_name").text();t.geomType=n,l.getStyleXML_callback(t)})}},getCurrentStyle:function(){var e=this.panel.find(".list-group-item.active");if(e.hasClass("single-style"))return this.singleStyle;if(e.hasClass("unique-style"))return this.uniqueStyle;if(e.hasClass("quantities-style"))return this.quantitiesStyle;if(e.hasClass("custom-style"))return this.customStyle;if(e.hasClass("dot-density-style")){var l=this.panel.find(".dot-density-pane .layer-fields").val();return null==l||""==l?(MapCloud.notify.showInfo("请选择一个字段","Warning"),null):(this.dotDensityStyle.field=l,this.dotDensityStyle)}},updateStyle:function(e){if(null!=e){var l=e.name;if("default"!=l){var t=styleManager.writer.write(e);MapCloud.notify.loading(),styleManager.updateStyle(t,l,this.updateCallback)}}},updateCallback:function(e){var l=MapCloud.styleManager_dialog,t=l.panel,n=t.find("#style_list option:selected").text(),a="更新样式 [ "+n+" ]";MapCloud.notify.showInfo(e,a)},addStyle:function(e){if(null!=e){var l=styleManager.writer.write(e);if(null!=l){var t=e.name,n=e.geomType;MapCloud.notify.loading(),styleManager.addStyle(l,t,n,this.addStyleCallback)}}},addStyleCallback:function(e){var l=MapCloud.styleManager_dialog,t=l.panel.find("#style_type_name").text(),n=l.getStyleType(t.toLowerCase()),a=styleManager.getStyleByType(n);l.getStyles_callback(a);var s=l.addStyleName,i="添加样式 [ "+s+" ]";MapCloud.notify.showInfo(e,i);var o=l.panel.find("#style_list option[value='"+s+"']");o.attr("selected",!0),l.panel.find("#styles_list_table").html(""),l.defaultStyle=null,l.styleCur=null,l.styleNameCur=l.addStyleName,l.isDefaultStyle=!1;var r=styleManager.getStyle(s);if(null!=r&&styleManager.getStyleXML(s,l.getStyleXML_callback),l.addStyleName=null,l.setLayerStyleFlag&&null!=l.typeName){var y=l.getCurrentStyle();l.setStyle(l.typeName,y,l.setStyle_callback)}l.setLayerStyleFlag=!1},setWFSLayer:function(e){if(null!=e){this.wfsLayer=e;var l=this.wfsLayer.workspace;this.wfsWorkspace=l;var t=this.wfsLayer.style;if(null!=t){this.typeName=this.wfsLayer.name;var n=e.featureType.fields;this.setFields(n);var a=t.name;this.styleNameCur=a;var s=t.geomType,i=this.panel.find("#style_list option[type='"+s+"']"),o=s+"<span class='caret'></span>";this.panel.find("#style_type_name").html(o),this.panel.find("#style_type_name").addClass("disabled");var r=this.panel.find("#style_list");r.html(i);var y=styleManager.getStyle(a);"default"==a||null==y?(r.append("<option value='default'>default</option>"),r.find("option[value='default']").attr("selected",!0),this.getStyleXML_callback(t)):(r.find("option[value='"+a+"']").attr("selected",!0),this.getStyleXML_callback(t)),this.setWFSLayerPanelStyle()}}},setWFSLayerPanelStyle:function(){this.panel.find("#add_style,#save_style,#remove_style").attr("disabled","true"),this.panel.find("#style_list").attr("disabled","true"),this.panel.find(".col-md-3 .list-group-item").addClass("disabled"),this.panel.find(".single-pane .symbol-icon").unbind("click")},setDBLayer:function(e){if(null!=e){this.dbLayer=e,this.typeName=e.name,this.wfsWorkspace=new GeoBeans.WFSWorkspace("tmp",mapObj.server,"1.0.0");var l=e.getFields();this.setFields(l);var t=this.dbLayer.geomType,n=this.getStyleTypeByGeomType(t),a=this.panel.find("#style_list option[type='"+n+"']"),s=n+"<span class='caret'></span>";this.panel.find("#style_type_name").html(s),this.panel.find("#style_type_name").addClass("disabled");var i=this.panel.find("#style_list");i.html(a);var o=this.dbLayer.styleName;if(null!=o&&""!=o)this.styleNameCur=o,i.find("option[value='"+o+"']").attr("selected",!0),styleManager.getStyleXML(this.styleNameCur,this.getStyleXML_callback);else{var r=styleManager.getStyleByType(n);this.getStyles_callback(r)}}},setFields:function(e){if(null!=e){this.fields=e;for(var l,t,n="",a=0;a<e.length;++a)l=e[a],null!=l&&(t=l.name,n+="<option value='"+t+"'>"+t+"</option>");this.panel.find(".unique-pane .layer-fields").html(n);var s=this;this.panel.find(".unique-pane .layer-fields").each(function(){
$(this).change(function(){s.panel.find(".unique-pane .style-list-table").html(""),s.uniqueStyle=null})});var i="<option value='none'>none</option>";n=null;for(var o=null,a=0;a<e.length;++a)l=e[a],o=l.type,("int"==o||"double"==o||"float"==o)&&(t=l.name,n+="<option value='"+t+"'>"+t+"</option>");i+=n,this.panel.find(".quantities-pane .layer-fields").html(i),n="";for(var a=0;a<e.length;++a)l=e[a],null!=l&&(t=l.name,n+="<option value='"+t+"'>"+t+"</option>");this.panel.find(".custom-pane .layer-fields").html(n),n="",n=null;for(var o=null,a=0;a<e.length;++a)l=e[a],o=l.type,("int"==o||"double"==o||"float"==o)&&(t=l.name,n+="<option value='"+t+"'>"+t+"</option>");this.panel.find(".dot-density-pane .layer-fields").html(n)}},getColorMaps_callback:function(e){if(null!=e){for(var l=MapCloud.styleManager_dialog,t=l.panel,n=null,a=null,s="",i=0;i<e.length;++i)n=e[i],a=n.url,s+="<li cid='"+n.id+"'>	<div class='color-ramp-item' style='background-image:	url("+a+")'>	</div></li>";if(t.find(".color-ramp-div ul").html(s),n=e[0],null!=n){a=n.url;var o=n.id,r="<li cid='"+o+"'>	<div class='color-ramp-item' style='background-image:	url("+a+")'>	</div></li>";t.find(".select-color-ramp").html(r),null==l.uniqueValues}l.panel.find(".unique-pane .color-ramp-div ul li").click(function(){var e=$(this).attr("cid"),n=t.find(".unique-pane");n.find(".select-color-ramp li").attr("cid",e);var a=$(this).find(".color-ramp-item").css("background-image");if(n.find(".select-color-ramp li .color-ramp-item").css("background-image",a),null==l.uniqueValues){var s=n.find(".layer-fields option:selected").val();if(null==s)return;l.wfsWorkspace.getValue(l.typeName,s,mapObj.name,l.getValuesCallback)}else{var i=l.uniqueValues.length;styleManager.getColorMap(e,i,l.getColorMap_callback)}}),l.panel.find(".quantities-pane .color-ramp-div ul li").click(function(){var e=$(this).attr("cid"),n=t.find(".quantities-pane");n.find(".select-color-ramp li").attr("cid",e);var a=$(this).find(".color-ramp-item").css("background-image");n.find(".select-color-ramp li .color-ramp-item").css("background-image",a);var s=n.find(".layer-fields option:selected").val();if(null!=s&&"none"!=s)if(null==l.minMaxValue)l.wfsWorkspace.getMinMaxValue(l.typeName,s,mapObj.name,l.getMinMaxValue_callback);else{var i=l.panel.find(".quantities-pane .classes option:selected").val();styleManager.getColorMap(e,i,l.getColorMapMinMax_callback)}}),l.panel.find(".custom-pane .color-ramp-div ul li").click(function(){var e=$(this).attr("cid"),n=t.find(".custom-pane");n.find(".select-color-ramp li").attr("cid",e);var a=$(this).find(".color-ramp-item").css("background-image");n.find(".select-color-ramp li .color-ramp-item").css("background-image",a);var s=l.customStyleFilters.length;styleManager.getColorMap(e,s,l.getColorMapCustom_callback)})}},getValuesCallback:function(e){if(null!=e){var l=e.length,t=MapCloud.styleManager_dialog,n=t.panel;t.uniqueValues=e;var a=n.find(".unique-pane .select-color-ramp li").attr("cid");styleManager.getColorMap(a,l,t.getColorMap_callback)}},getColorMap_callback:function(e){if(null!=e){var l=MapCloud.styleManager_dialog;l.panel;if(null==l.singleStyle)return void MapCloud.notify.showInfo("请设置一个有效样式","Warning");var t=l.singleStyle.rules[0],n=l.panel.find(".unique-pane .layer-fields option:selected").val(),a=l.uniqueValues,s=l.getStyleByValues(t,n,a,e);l.uniqueStyle=s,null!=s&&l.displayUniqueStyle(l.uniqueStyle)}},getMinMaxValue_callback:function(e){if(null!=e){var l=(e.min,e.max,MapCloud.styleManager_dialog);l.minMaxValue=e;var t=l.panel.find(".quantities-pane .classes option:selected"),n=t.val(),a=l.panel.find(".quantities-pane .select-color-ramp li").attr("cid");styleManager.getColorMap(a,n,l.getColorMapMinMax_callback)}},getColorMapMinMax_callback:function(e){if(null!=e){var l=MapCloud.styleManager_dialog;if(null==l.singleStyle)return void MapCloud.notify.showInfo("请设置一个有效样式","Warning");var t=l.singleStyle.rules[0],n=l.panel.find(".quantities-pane .classes option:selected").val(),a=l.minMaxValue.min,s=l.minMaxValue.max,i=l.panel.find(".quantities-pane .layer-fields option:selected").val(),o=l.getStyleByMinMaxValues(t,i,a,s,n,e);l.quantitiesStyle=o,l.displayQuantitiesStyle(l.quantitiesStyle)}},getStyleByMinMaxValues:function(e,l,t,n,a,s){if(null==e||null==t||null==n||null==a)return null;var i=this.singleStyle.geomType,o=new GeoBeans.Style.FeatureStyle("quantities",i);o.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES;for(var r=[],y=e.symbolizer,u=y.type,p=e.textSymbolizer,d=null,c=(n-t)/a,f=0;a>f;++f){var m=t+c*f,h=t+c*(f+1),S=new GeoBeans.Rule;d=s[f];var g=y.clone();if(u==GeoBeans.Symbolizer.Type.Point){var v=g.fill.getOpacity();color=new GeoBeans.Color,color.setByHex(d,v),g.fill.color=color}else if(u==GeoBeans.Symbolizer.Type.Line){var v=g.stroke.getOpacity();color=new GeoBeans.Color,color.setByHex(d,v),g.stroke.color=color}else if(u==GeoBeans.Symbolizer.Type.Polygon){var v=g.fill.getOpacity();color=new GeoBeans.Color,color.setByHex(d,v),g.fill.color=color}S.symbolizer=g,null!=p&&(S.textSymbolizer=p);var b=new GeoBeans.IsBetweenFilter,C=new GeoBeans.PropertyName;C.name=l;var M=new GeoBeans.Literal;M.value=m;var k=new GeoBeans.Literal;k.value=h,b.expression=C,b.lowerBound=M,b.upperBound=k,S.filter=b,S.name=f,r.push(S)}return o.rules=r,o},getStyleTypeByGeomType:function(e){if(null==e)return null;e=e.toUpperCase();var l=null;switch(e){case"POINT":case"MULTIPOINT":l=GeoBeans.Style.FeatureStyle.GeomType.Point;break;case"LINESTRING":case"MULTILINESTRING":l=GeoBeans.Style.FeatureStyle.GeomType.LineString;break;case"POLYGON":case"MULTIPOLYGON":l=GeoBeans.Style.FeatureStyle.GeomType.Polygon}return l},getStyleByValues:function(e,l,t,n){var a=null,s=null,i=e.symbolizer,o=e.textSymbolizer,r=(n.length,i.type),y=this.singleStyle.geomType,u=(this.panel.find("#style_list option:selected").text(),new GeoBeans.Style.FeatureStyle("unique",y));u.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE;for(var p=[],d=0;d<t.length;++d){var c=t[d],f=new GeoBeans.Rule;s=n[d];var m=i.clone();if(r==GeoBeans.Symbolizer.Type.Point){var h=m.fill.getOpacity();a=new GeoBeans.Color,a.setByHex(s,h),m.fill.color=a}else if(r==GeoBeans.Symbolizer.Type.Line){var h=m.stroke.getOpacity();a=new GeoBeans.Color,a.setByHex(s,h),m.stroke.color=a}else if(r==GeoBeans.Symbolizer.Type.Polygon){var h=m.fill.getOpacity();a=new GeoBeans.Color,a.setByHex(s,h),m.fill.color=a}f.symbolizer=m;var S=new GeoBeans.BinaryComparisionFilter,g=new GeoBeans.PropertyName;g.name=l;var v=new GeoBeans.Literal;v.value=c,S.operator=GeoBeans.ComparisionFilter.OperatorType.ComOprEqual,S.expression1=g,S.expression2=v,f.filter=S,f.name=d,null!=o&&(f.textSymbolizer=o),p.push(f)}return u.rules=p,u},setStyle:function(e,l){null!=e&&null!=l&&mapObj.setStyle(e,l,this.setStyle_callback)},setStyle_callback:function(e){var l="设置样式";MapCloud.notify.showInfo(e,l),mapObj.draw()},setSymbol:function(e){if(null!=e){var l="url("+e.icon+")";if(this.symbolChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.SINGLE&&0==this.symbolChangedIndex)this.panel.find(".single-pane .symbol-icon").css("background-image",l),null!=this.singleStyle&&(this.singleStyle.rules[0].symbolizer.symbol=e);else if(this.symbolChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE){var t=this.panel.find(".unique-pane .symbol-icon")[this.symbolChangedIndex];$(t).css("background-image",l),null!=this.uniqueStyle&&(this.uniqueStyle.rules[this.symbolChangedIndex].symbolizer.symbol=e)}else if(this.symbolChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES){var t=this.panel.find(".quantities-pane .symbol-icon")[this.symbolChangedIndex];$(t).css("background-image",l),null!=this.quantitiesStyle&&(this.quantitiesStyle.rules[this.symbolChangedIndex].symbolizer.symbol=e)}else if(this.symbolChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM){var t=this.panel.find(".custom-pane .symbol-icon")[this.symbolChangedIndex];$(t).css("background-image",l),null!=this.customStyle&&(this.customStyle.rules[this.symbolChangedIndex].symbolizer.symbol=e)}}},getSymbolIconType:function(e){var l=null;switch(e){case GeoBeans.Symbolizer.Type.Point:l="marker";break;case GeoBeans.Symbolizer.Type.Line:l="line";break;case GeoBeans.Symbolizer.Type.Polygon:l="fill"}return l},getSqlExpression:function(e){if(null!=e){var l=null;if(e instanceof GeoBeans.ComparisionFilter){var t=e.operator;if(t==GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween){var n=e.expression,a=e.lowerBound,s=e.upperBound;if(null==n||null==a||null==s)return null;var i=n.name,o=a.value,r=s.value;if(null==i||null==o||null==r)return null;l=o+" &lt; "+i+" &lt; "+r}else{var y=e.expression1,u=e.expression2;if(null==y||null==u)return null;var i=null,p=null;y.type==GeoBeans.Expression.Type.PropertyName?i=y.name:y.type==GeoBeans.Expression.Type.Literal&&(p=y.value),u.type==GeoBeans.Expression.Type.PropertyName?i=u.name:u.type==GeoBeans.Expression.Type.Literal&&(p=u.value);var d=this.getOperatorExpression(t);if(null==d||null==i||null==p)return null;l=i+" "+d+" "+p}}return l}},getOperatorExpression:function(e){var l=null;switch(e){case GeoBeans.ComparisionFilter.OperatorType.ComOprEqual:l="=";break;case GeoBeans.ComparisionFilter.OperatorType.ComOprGreaterThan:l=">";break;case GeoBeans.ComparisionFilter.OperatorType.ComOprGreaterThanOrEqual:l=">=";break;case GeoBeans.ComparisionFilter.OperatorType.ComOprLessThan:l="<";break;case GeoBeans.ComparisionFilter.OperatorType.ComOprLessThanOrEqual:l="<=";break;default:l=null}return l},setCustomFilter:function(e){if(null!=e){var l=e.name;if(null==l)this.customStyleFilters.push(e);else for(var t=0;t<this.customStyleFilters.length;++t)if(l==this.customStyleFilters[t].name){this.customStyleFilters[t]=e;break}var n=this.panel.find(".custom-pane .select-color-ramp li").attr("cid"),a=this.customStyleFilters.length;styleManager.getColorMap(n,a,this.getColorMapCustom_callback)}},getColorMapCustom_callback:function(e){if(null!=e){var l=MapCloud.styleManager_dialog,t=l.singleStyle.rules[0],n=l.customStyleFilters,a=l.getCustomStyle(t,n,e);l.customStyle=a,l.displayCustomStyle(l.customStyle)}},getCustomStyle:function(e,l,t){if(null==e||null==l||null==t)return null;var n=null,a=e.symbolizer,s=e.textSymbolizer,i=this.singleStyle.geomType,o=a.type,r=new GeoBeans.Style.FeatureStyle("custom",i);r.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM;for(var y=[],u=null,p=0;p<t.length;++p){u=t[p];var d=new GeoBeans.Rule,c=l[p],f=a.clone();if(o==GeoBeans.Symbolizer.Type.Point){var m=f.fill.getOpacity();n=new GeoBeans.Color,n.setByHex(u,m),f.fill.color=n}else if(o==GeoBeans.Symbolizer.Type.Line){var m=f.stroke.getOpacity();n=new GeoBeans.Color,n.setByHex(u,m),f.stroke.color=n}else if(o==GeoBeans.Symbolizer.Type.Polygon){var m=f.fill.getOpacity();n=new GeoBeans.Color,n.setByHex(u,m),f.fill.color=n}d.symbolizer=f,d.filter=c,d.name=p,null!=s&&(d.textSymbolizer=s),y.push(d)}return r.rules=y,r},getRulesHtml:function(e){if(null!=e){for(var l="<thead>	<tr>			<th class='style-col'><span>&nbsp;</span></th>			<th class='style-col'><span>&nbsp;</span></th>		<th class='value-col'>表达式</th>		<th class='value-col'>表达式</th>	</tr></thead><tbody>",t=null,n=0;n<e.length;++n){t=e[n];var a=t.filter;if(null!=a){var s=this.getSqlExpression(a),i=t.symbolizer,o=this.getSymbolHtml(i),r=this.getSymbolIconHtml(i.type,i.symbol);l+="<tr>		<td class='style-col'>"+o+"		</td>		<td class='style-col'>"+r+"		</td>		<td class='value-col'>"+s+"		</td>		<td value='value-col'>"+s+"		</td>	</tr>"}}return l+="</tbody>"}},getCustomStyleFilters:function(e){if(null==e)return[];var l=e.rules;if(null==l)return[];for(var t=[],n=0;n<l.length;++n){var a=l[n];null!=a&&t.push(a.filter)}return t}});
MapCloud.StyleManagerDialog=MapCloud.Class(MapCloud.Dialog,{styleNameCur:null,styleCur:null,defaultStyle:null,wfsWorkspace:null,typeName:null,uniqueValues:null,dbLayer:null,singleStyle:null,uniqueStyle:null,quantitiesStyle:null,styleChangedClass:null,styleChangedIndex:null,symbolChangedClass:null,symbolChangedIndex:null,minMaxValue:null,customStyle:null,customStyleFilters:null,dotDensityStyle:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var l=this;this.panel.find(".btn-confirm").each(function(){$(this).click(function(){var e=l.panel.find("#style_list option:selected").text(),t=l.getCurrentStyle();if(null==t)return void MapCloud.notify.showInfo("Warning","请设置一个有效样式");if(t.name=e,"default"!=e){var n=styleManager.getStyle(e);return null==n?(l.addStyle(t),l.setLayerStyleFlag=!0,void l.closeDialog()):(l.updateStyle(t),null!=l.typeName&&l.setStyle(l.typeName,t,l.setStyle_callback),void l.closeDialog())}null!=l.typeName&&l.setStyle(l.typeName,t,l.setStyle_callback),l.closeDialog()})}),this.panel.find(".btn-success").each(function(){$(this).click(function(){var e=l.panel.find("#style_list option:selected").text(),t=l.getCurrentStyle();if(null==t)return void MapCloud.notify.showInfo("Warning","请设置一个有效样式");if(t.name=e,"default"!=e){var n=styleManager.getStyle(e);return null==n?(l.addStyle(t),void(l.setLayerStyleFlag=!0)):(l.updateStyle(t),void(null!=l.typeName&&l.setStyle(l.typeName,t,l.setStyle_callback)))}null!=l.typeName&&l.setStyle(l.typeName,t,l.setStyle_callback)})}),this.registerSingleSymbolEvent(),this.registerDotDensitySymbolEvent(),this.panel.find("#style_type_list li a").each(function(){$(this).click(function(){var e=$(this).text(),t=e+"<span class='caret'></span>";if(l.panel.find("#style_type_name").html(t),e=e.toLowerCase(),"all"==e){var n=styleManager.getStyles();l.getStyles_callback(n)}else{var a=l.getStyleType(e);if(null!=a){var n=styleManager.getStyleByType(a);l.getStyles_callback(n)}}})}),this.panel.find("#style_list").each(function(){$(this).focus(function(){preStyleName=this.value}).change(function(){if("default"==this.value&&null!=l.wfsLayer){var e=l.wfsLayer.style;return l.styleNameCur="default",void l.getStyleXML_callback(e)}var t=$(this).children(":selected"),n=t.text(),e=styleManager.getStyle(n);null!=e&&(MapCloud.notify.loading(),styleManager.getStyleXML(n,l.getStyleXML_callback))})}),this.panel.find("#add_style").each(function(){$(this).click(function(){var e=l.panel.find("#style_type_name").text();return"All"==e?void MapCloud.notify.showInfo("请选择一个类型","Warning"):(MapCloud.styleName_dialog.setFlag("add"),void MapCloud.styleName_dialog.showDialog())})}),this.panel.find("#save_style").each(function(){$(this).click(function(){var e=l.panel.find("#style_list option:selected").val(),t=l.getCurrentStyle();if(null==t)return void MapCloud.notify.showInfo("Warning","请设置一个有效样式");if(t.name=e,"default"==e)return MapCloud.styleName_dialog.setFlag("save"),void MapCloud.styleName_dialog.showDialog();var n=styleManager.getStyle(e);null==n?l.addStyle(t):l.updateStyle(t)})}),this.panel.find("#remove_style").each(function(){$(this).click(function(){var e=l.panel.find("#style_list option:selected").text(),t=confirm("确认删除"+e+"样式？");t&&(MapCloud.notify.loading(),l.currentStyle=null,l.singleStyle=null,l.quantitiesStyle=null,l.uniqueStyle=null,l.dotDensityStyle=null,styleManager.removeStyle(e,l.removeStyle_callback))})}),this.panel.find("#add_all_value").each(function(){$(this).click(function(){var e=l.panel.find(".unique-pane .layer-fields option:selected").val();null!=e&&l.wfsWorkspace.getValue(l.typeName,e,mapObj.name,l.getValuesCallback)})}),this.panel.find("#remove_value").each(function(){$(this).click(function(){var e=l.panel.find(".unique-pane .style-list-table"),t=e.find("tbody tr.selected"),n=e.find("tbody tr"),a=n.index(t);if(-1!=a){if(!confirm("确定删除该行样式吗？"))return;l.uniqueStyle.removeRule(a),l.displayUniqueStyle(l.uniqueStyle)}})}),this.panel.find("#remove_all_value").each(function(){$(this).click(function(){l.uniqueStyle=null,l.cleanupUniquePanel()})}),this.panel.find(".quantities-pane .layer-fields").change(function(){var e=$(this).find("option:selected").val();if("none"==e)l.quantitiesStyle=null,l.cleanupQuantitiesPanel();else{if(null==l.wfsWorkspace)return;l.wfsWorkspace.getMinMaxValue(l.typeName,e,mapObj.name,l.getMinMaxValue_callback)}}),this.panel.find(".quantities-pane .classes").each(function(){$(this).change(function(){var e=$(this).val(),t=l.panel.find(".quantities-pane .layer-fields option:selected").val();if(null!=t&&"none"!=t){var n=l.panel.find(".quantities-pane .select-color-ramp li").attr("cid");null==l.minMaxValue?l.wfsWorkspace.getMinMaxValue(l.typeName,t,mapObj.name,l.getMinMaxValue_callback):styleManager.getColorMapNew(n,e,l.getColorMapMinMax_callback)}})}),this.panel.find("#quantities_add_all_value").click(function(){var e=l.panel.find(".quantities-pane .layer-fields").val();if("none"==e)l.quantitiesStyle=null,l.cleanupQuantitiesPanel();else{if(null==l.wfsWorkspace)return;l.wfsWorkspace.getMinMaxValue(l.typeName,e,mapObj.name,l.getMinMaxValue_callback)}}),this.panel.find("#quantities_remove_value").click(function(){var e=l.panel.find(".quantities-pane .style-list-table"),t=e.find("tbody tr.selected"),n=e.find("tbody tr"),a=n.index(t);if(-1!=a){if(!confirm("确定删除该行样式吗？"))return;l.quantitiesStyle.removeRule(a),l.displayQuantitiesStyle(l.quantitiesStyle)}}),this.panel.find("#quantities_remove_all_value").click(function(){l.quantitiesStyle=null,l.cleanupQuantitiesPanel()}),this.panel.find("#custom_add_value").click(function(){var e=l.panel.find(".custom-pane .layer-fields").val();return null==e||""==e?void MapCloud.notify.showInfo("请先选择一个字段","Warning"):null==l.dbLayer?void MapCloud.notify.showInfo("当前图层为空","Warning"):(MapCloud.query_dialog.showDialog(),void MapCloud.query_dialog.setLayer(l.dbLayer,e))}),this.panel.find("#custom_remove_value").click(function(){var e=l.panel.find(".custom-pane .style-list-table"),t=e.find("tbody tr.selected"),n=e.find("tbody tr"),a=n.index(t);if(-1!=a){if(!confirm("确定删除该行样式吗？"))return;l.customStyle.removeRule(a);var s=l.getCustomStyleFilters(this.customStyle);l.customStyleFilters=s,l.displayCustomStyle(l.customStyle)}}),this.panel.find("#custom_remove_all_value").click(function(){l.customStyle=null,l.customStyleFilters=[],l.cleanupCustomPanel()}),this.panel.find(".list-group-item").click(function(){if(l.panel.find(".list-group-item").removeClass("active"),$(this).addClass("active"),$(this).hasClass("single-style"))l.panel.find(".style-pane").css("display","none"),l.panel.find(".single-pane").css("display","block");else if($(this).hasClass("unique-style"))l.panel.find(".style-pane").css("display","none"),l.panel.find(".unique-pane").css("display","block");else if($(this).hasClass("quantities-style"))l.panel.find(".style-pane").css("display","none"),l.panel.find(".quantities-pane").css("display","block");else if($(this).hasClass("custom-style"))l.panel.find(".style-pane").css("display","none"),l.panel.find(".custom-pane").css("display","block");else if($(this).hasClass("dot-density-style")){if(l.panel.find(".style-pane").css("display","none"),l.panel.find(".dot-density-pane").css("display","block"),null==l.dotDensityStyle){var e=l.getDotDensityStyle(l.singleStyle);l.dotDensityStyle=e}l.displayDotDensityStyle(l.dotDensityStyle)}}),this.panel.find(".single-pane .symbol-icon").click(function(){if(null!=l.singleStyle){var e=null,t=l.singleStyle.geomType;t==GeoBeans.Style.FeatureStyle.GeomType.Point?e="marker":t==GeoBeans.Style.FeatureStyle.GeomType.LineString?e="line":t==GeoBeans.Style.FeatureStyle.GeomType.Polygon&&(e="fill"),l.symbolChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.SINGLE,l.symbolChangedIndex=0;var n=l.singleStyle.rules[0].symbolizer.symbol,a=null;null!=n&&(a=n.name),MapCloud.symbol_dialog.showDialog("styleManager",e,a)}})},showDialog:function(e){this.cleanup(),this.panel.modal();var l="All<span class='caret'></span>";this.panel.find("#style_type_name").html(l);var t=styleManager.getStyles();(null==e||void 0==e)&&(e=!0),this.getStyles_callback(t,e),styleManager.getColorMaps(this.getColorMaps_callback)},cleanup:function(){this.panel.find("#styles_list_table").html(""),this.typeName=null,this.styleNameCur=null,this.defaultStyle=null,this.uniqueValues=null,this.minMaxValue=null,this.wfsWorkspace=null,this.panel.find("#style_type_name").removeClass("disabled"),this.panel.find("#layer_fields").html(""),this.panel.find(".layer-fields").html(""),this.panel.find("#add_style,#save_style,#remove_style").removeAttr("disabled"),this.panel.find("#style_list").removeAttr("disabled"),this.panel.find(".col-md-3 .list-group-item").removeClass("disabled"),this.dbLayer=null,this.singleStyle=null,this.uniqueStyle=null,this.quantitiesStyle=null,this.customStyle=null,this.customStyleFilters=[],this.dotDensityStyle=null,this.cleanupUniquePanel(),this.cleanupQuantitiesPanel(),this.cleanupCustomPanel()},cleanupUniquePanel:function(){this.panel.find(".unique-pane .style-list-table").html("")},cleanupQuantitiesPanel:function(){this.panel.find(".quantities-pane .style-list-table").html("")},cleanupCustomPanel:function(){this.panel.find(".custom-pane .style-list-table").html("")},getStyleType:function(e){if(null==e)return null;var l=null;switch(e){case"point":l=GeoBeans.Style.FeatureStyle.GeomType.Point;break;case"linestring":l=GeoBeans.Style.FeatureStyle.GeomType.LineString;break;case"polygon":l=GeoBeans.Style.FeatureStyle.GeomType.Polygon}return l},closeDialog:function(){this.panel.modal("hide"),MapCloud.refresh_panel.refreshPanel()},getStyles_callback:function(e,l){for(var t="",t="",n=0;n<e.length;++n){var a=e[n],s=a.name,i=a.geomType;t+="<option value='"+s+"' type='"+i+"'>"+s+"</option>"}var o=MapCloud.styleManager_dialog,r=o.panel;if(r.find("#style_list").html(t),(null==l||void 0==l)&&(l=!0),l){var y=r.find("#style_list option:selected").val();o.styleNameCur=y,styleManager.getStyleXML(o.styleNameCur,o.getStyleXML_callback)}},getStyleXML_callback:function(e){if(MapCloud.notify.hideLoading(),null!=e){var l=MapCloud.styleManager_dialog,t=(l.panel,e.styleClass);(null==t||""==t)&&(t=l.getStyleClass(e)),l.setPanelStyle(e,t)}},getStyleClass:function(e){if(null==e)return null;var l=e.rules;if(null==l)return null;if(1==l.length){var t=l[0];if(null!=t){var n=t.filter;if(null==n)return GeoBeans.Style.FeatureStyle.StyleClass.SINGLE}}else{for(var a=0,s=0,i=0;i<l.length;++i){var t=l[i];if(null!=t){var n=t.filter;if(null!=n)if(n instanceof GeoBeans.BinaryComparisionFilter){var o=n.operator;o==GeoBeans.ComparisionFilter.OperatorType.ComOprEqual&&a++}else n instanceof GeoBeans.IsBetweenFilter&&s++}}if(a==l.length)return GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE;if(s==l.length)return GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES}return null},displaySingleStyle:function(e){if(null!=e){var l=e.rules;if(null!=l){var t=l.length;if(1==t){var n=l[0];if(null==n)return;var a=n.symbolizer;if(null==a)return;var s=this.getStyleSymbolCss(a);this.panel.find(".single-pane .style-symbol").css(s);var i=null,o=a.symbol;if(null!=o){var r=o.name;if(i=o.icon,null==i){var y=this.getSymbolIconType(a.type);i=styleManager.getSymbolIcon(y,r)}}else switch(a.type){case GeoBeans.Symbolizer.Type.Point:i="../images/Circle.png";break;case GeoBeans.Symbolizer.Type.Line:i="../images/SimpleLine.png";break;case GeoBeans.Symbolizer.Type.Polygon:i="../images/SimpleRegion.png"}var u="url("+i+")";this.panel.find(".single-pane .symbol-icon").css("background-image",u)}}}},displayUniqueStyle:function(e){if(null!=e){var l=this.getProperyNameByRule(e.rules[0]),t=this.panel.find(".unique-pane .layer-fields option[value='"+l+"']");t.attr("selected",!0);var n=this.getRulesListHtml(l,e.rules);this.panel.find(".unique-pane .style-list-table").html(n),this.registerUniqueSymbolEvent(),this.registerUniqueSymbolIconEvent(),this.registerUnqiueSelectEvent()}},displayQuantitiesStyle:function(e){var l=this.getProperyNameByRule(e.rules[0]),t=this.panel.find(".quantities-pane .layer-fields option[value='"+l+"']");t.attr("selected",!0);var n=e.rules.length,a=this.panel.find(".quantities-pane .classes option[value='"+n+"']");a.attr("selected",!0);var s=this.getRulesListHtml(l,e.rules);this.panel.find(".quantities-pane .style-list-table").html(s),this.registerQuantitiesSymbolEvent(),this.registerQuantitiesSymbolIconEvent(),this.registerQuantitiesSelectEvent()},displayCustomStyle:function(e){if(null!=e){var l=this.getRulesHtml(e.rules);this.panel.find(".custom-pane .style-list-table").html(l),this.registerCustomSymbolEvent(),this.registerCustomSymbolIconEvent(),this.registerCustomSelectEvent()}},displayDotDensityStyle:function(e){if(null!=e){var l=e.rules;if(null!=l){var t=l.length;if(1==t){var n=l[0];if(null!=n){var a=n.symbolizer;if(null!=a){var s=this.getStyleSymbolCss(a);this.panel.find(".dot-density-pane .style-symbol").css(s);var i=e.field;if(null!=i){var o=this.panel.find(".dot-density-pane .layer-fields option[value='"+i+"']");o.attr("selected",!0)}}}}}}},setPanelStyle:function(e,l){var t=this.getSingleStyle(e);if(this.singleStyle=t,e.geomType!=GeoBeans.Style.FeatureStyle.GeomType.Polygon?this.panel.find(".dot-density-style").addClass("disabled"):this.panel.find(".dot-density-style").removeClass("disabled"),this.displaySingleStyle(this.singleStyle),l==GeoBeans.Style.FeatureStyle.StyleClass.SINGLE)this.uniqueStyle=null,this.quantitiesStyle=null,this.customStyle=null,this.cleanupUniquePanel(),this.cleanupQuantitiesPanel(),this.cleanupCustomPanel(),this.panel.find(".style-pane").css("display","none"),this.panel.find(".single-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".single-style").addClass("active");else if(l==GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE)this.uniqueStyle=e.clone(),this.quantitiesStyle=null,this.customStyle=null,this.cleanupQuantitiesPanel(),this.cleanupCustomPanel(),this.displayUniqueStyle(this.uniqueStyle),this.panel.find(".style-pane").css("display","none"),this.panel.find(".unique-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".unique-style").addClass("active");else if(l==GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES)this.uniqueStyle=null,this.customStyle=null,this.cleanupUniquePanel(),this.cleanupCustomPanel(),this.quantitiesStyle=e.clone(),this.displayQuantitiesStyle(e),this.panel.find(".style-pane").css("display","none"),this.panel.find(".quantities-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".quantities-style").addClass("active");else if(l==GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM){this.uniqueStyle=null,this.quantitiesStyle=null,this.cleanupUniquePanel(),this.cleanupQuantitiesPanel(),this.customStyle=e.clone(),this.displayCustomStyle(this.customStyle);var n=this.getCustomStyleFilters(this.customStyle);this.customStyleFilters=n,this.panel.find(".style-pane").css("display","none"),this.panel.find(".custom-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".custom-style").addClass("active")}else l==GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY&&(this.dotDensityStyle=e.clone(),this.displayDotDensityStyle(this.dotDensityStyle),this.panel.find(".style-pane").css("display","none"),this.panel.find(".dot-density-pane").css("display","block"),this.panel.find(".list-group-item").removeClass("active"),this.panel.find(".dot-density-style").addClass("active"))},registerSingleSymbolEvent:function(){var e=this;this.panel.find(".single-pane .style-symbol").click(function(){if(null!=e.singleStyle){var l=e.singleStyle.rules;if(null!=l){var t=l[0];MapCloud.style_dialog.setRule(t,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.SINGLE,e.styleChangedIndex=0}}})},registerUniqueSymbolEvent:function(){var e=this;this.panel.find(".unique-pane .style-symbol").click(function(){var l=$(this).parents("tbody").find(".style-symbol"),t=l.index($(this));if(-1!=t&&null!=e.uniqueStyle){var n=e.uniqueStyle.rules;if(null!=n){var a=n[t];MapCloud.style_dialog.setRule(a,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE,e.styleChangedIndex=t}}})},registerUniqueSymbolIconEvent:function(){var e=this;this.panel.find(".unique-pane .symbol-icon").click(function(){var l=$(this).parents("tbody").find(".symbol-icon"),t=l.index($(this));if(-1!=t&&null!=e.uniqueStyle){var n=e.uniqueStyle.rules;if(null!=n){var a=n[t];if(null!=a){var s=a.symbolizer;if(null!=s){var i=s.symbol,o=null;null!=i&&(o=i.name);var r=e.getSymbolIconType(s.type);MapCloud.symbol_dialog.showDialog("styleManager",r,o),e.symbolChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE,e.symbolChangedIndex=t}}}}})},registerUnqiueSelectEvent:function(){var e=this;this.panel.find(".unique-pane .style-list-table tbody tr").click(function(){e.panel.find(".unique-pane .style-list-table tr").removeClass("selected"),$(this).addClass("selected")})},registerQuantitiesSymbolEvent:function(){var e=this;this.panel.find(".quantities-pane .style-symbol").click(function(){var l=$(this).parents("tbody").find(".style-symbol"),t=l.index($(this));if(-1!=t&&null!=e.quantitiesStyle){var n=e.quantitiesStyle.rules;if(null!=n){var a=n[t];MapCloud.style_dialog.setRule(a,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES,e.styleChangedIndex=t}}})},registerQuantitiesSymbolIconEvent:function(){var e=this;e.panel.find(".quantities-pane .symbol-icon").click(function(){var l=$(this).parents("tbody").find(".symbol-icon"),t=l.index($(this));if(-1!=t&&null!=e.quantitiesStyle){var n=e.quantitiesStyle.rules;if(null!=n){var a=n[t];if(null!=a){var s=a.symbolizer;if(null!=s){var i=s.symbol,o=null;null!=i&&(o=i.name);var r=e.getSymbolIconType(s.type);MapCloud.symbol_dialog.showDialog("styleManager",r,o),e.symbolChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES,e.symbolChangedIndex=t}}}}})},registerQuantitiesSelectEvent:function(){var e=this;this.panel.find(".quantities-pane .style-list-table tbody tr").click(function(){e.panel.find(".quantities-pane .style-list-table tr").removeClass("selected"),$(this).addClass("selected")})},registerCustomSymbolEvent:function(){var e=this;this.panel.find(".custom-pane .style-symbol").click(function(){var l=$(this).parents("tbody").find(".style-symbol"),t=l.index($(this));if(-1!=t&&null!=e.customStyle){var n=e.customStyle.rules;if(null!=n){var a=n[t];MapCloud.style_dialog.setRule(a,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM,e.styleChangedIndex=t}}})},registerCustomSymbolIconEvent:function(){var e=this;e.panel.find(".custom-pane .symbol-icon").click(function(){var l=$(this).parents("tbody").find(".symbol-icon"),t=l.index($(this));if(-1!=t&&null!=e.customStyle){var n=e.customStyle.rules;if(null!=n){var a=n[t];if(null!=a){var s=a.symbolizer;if(null!=s){var i=s.symbol,o=null;null!=i&&(o=i.name);var r=e.getSymbolIconType(s.type);MapCloud.symbol_dialog.showDialog("styleManager",r,o),e.symbolChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM,e.symbolChangedIndex=t}}}}})},registerCustomSelectEvent:function(){var e=this;this.panel.find(".custom-pane .style-list-table tbody tr").click(function(){e.panel.find(".custom-pane .style-list-table tr").removeClass("selected"),$(this).addClass("selected")})},registerDotDensitySymbolEvent:function(){var e=this;this.panel.find(".dot-density-pane .style-symbol").click(function(){if(null!=e.dotDensityStyle){var l=e.dotDensityStyle.rules;if(null!=l){var t=l[0];MapCloud.style_dialog.setRule(t,e.fields,"styleMgr"),MapCloud.style_dialog.showDialog(),e.styleChangedClass=GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY,e.styleChangedIndex=0}}})},getSingleStyle:function(e){if(null==e)return null;var l=e.rules;if(null!=l){var t=e.geomType,n=e.styleClass,a=null;if(l.length>=1){var s=l[0];if(null!=s){var i=s.textSymbolizer,o=s.symbolizer,a=new GeoBeans.Style.FeatureStyle("single",t);a.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.SINGLE;var s=new GeoBeans.Rule;if(null!=o)if(n==GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY){var r=o.fill,y=o.stroke,u=new GeoBeans.Symbolizer.PolygonSymbolizer;null!=r&&(u.fill=r.clone()),null!=y&&(u.stroke=y.clone()),s.symbolizer=u,a.geomType=GeoBeans.Style.FeatureStyle.GeomType.Polygon}else s.symbolizer=o.clone();null!=i&&(s.textSymbolizer=i.clone()),a.addRule(s)}}return a}},getDotDensityStyle:function(e){if(null==e)return null;var l=GeoBeans.Style.FeatureStyle.GeomType.Point,t=new GeoBeans.Style.FeatureStyle("dotDensity",l);t.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY;var n=new GeoBeans.Rule,a=new GeoBeans.Symbolizer.PointSymbolizer,s=e.rules;if(null!=s){var i=s[0];if(null!=n){var o=i.symbolizer;if(null!=o){var r=o.fill,y=o.stroke;null!=r&&(a.fill=r.clone()),null!=y&&(a.stroke=y.clone())}}}return n.symbolizer=a,t.addRule(n),t},getStyleSymbolCss:function(e){var l={},t=null,n=null,a=null,s=null,i=null,o=null,r=e.type;switch(r){case GeoBeans.Symbolizer.Type.Point:t=e.stroke,null!=t&&(a=t.color,s=a.getRgba());var n=e.fill;null!=n&&(i=n.color,o=i.getRgba()),l={"background-color":o,"border-color":s};break;case GeoBeans.Symbolizer.Type.Line:var t=e.stroke;null!=t&&(a=t.color,s=a.getRgba()),l={"background-color":s,"border-color":"#fff"};break;case GeoBeans.Symbolizer.Type.Polygon:t=e.stroke,null!=t&&(a=t.color,s=a.getRgba());var n=e.fill;null!=n&&(i=n.color,o=i.getRgba()),l={"background-color":o,"border-color":s}}return l},getSymbolHtml:function(e){var l=e.type,t="",n=null,a=null,s=null,i=null;if(l==GeoBeans.Symbolizer.Type.Point){var o=e.stroke;null!=o&&(n=o.color,a=n.getRgba());var r=e.fill;null!=r&&(s=r.color,i=s.getRgba()),t='<div class="style-symbol" style="background-color:'+i+";border-color:"+a+'"></div>'}else if(l==GeoBeans.Symbolizer.Type.Line){var o=e.stroke;null!=o&&(n=o.color,a=n.getRgba()),t='<div class="style-symbol" style="background-color:'+a+'"></div>'}else if(l==GeoBeans.Symbolizer.Type.Polygon){var o=e.stroke;null!=o&&(n=o.color,a=n.getRgba());var r=e.fill;null!=r&&(s=r.color,i=s.getRgba()),t='<div class="style-symbol" style="background-color:'+i+";border-color:"+a+'"></div>'}return t},getSymbolIconHtml:function(e,l){var t="",n=null;if(null!=l&&(n=l.icon,null==n)){var a=this.getSymbolIconType(e);n=styleManager.getSymbolIcon(a,l.name)}if(null==n){switch(e){case GeoBeans.Symbolizer.Type.Point:n="../images/Circle.png";break;case GeoBeans.Symbolizer.Type.Line:n="../images/SimpleLine.png";break;case GeoBeans.Symbolizer.Type.Polygon:n="../images/SimpleRegion.png"}console.log("symbol is null")}var t="<div class='symbol-icon' style='background-image:url("+n+")'></div>";return t},getProperyNameByRule:function(e){if(null==e)return null;var l=e.filter;if(null==l)return null;var t=l.type;if(t==GeoBeans.Filter.Type.FilterComparsion){var n=l.operator;if(n==GeoBeans.ComparisionFilter.OperatorType.ComOprEqual){var a=l.expression1,s=a.type;if(s==GeoBeans.Expression.Type.PropertyName){var i=a.name;return i}var o=l.expression2;if(s=o.type,s==GeoBeans.Expression.Type.PropertyName){var i=a.name;return i}}else if(n==GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween){var r=l.expression;if(null!=r){var i=r.name;return i}}}return null},getRulesListHtml:function(e,l){if(null!=l){for(var t="<thead>	<tr>		<th class='style-col'><span>&nbsp;</span></th>		<th class='style-col'><span>&nbsp;</span></th>		<th class='value-col'>值列表</th>		<th class='value-col'>"+e+"</th>	</tr></thead><tbody>",n=0;n<l.length;++n){var a=l[n],s=a.filter,i="";if(null!=s){var o=s.type;if(o==GeoBeans.Filter.Type.FilterComparsion){var r=s.operator;if(r==GeoBeans.ComparisionFilter.OperatorType.ComOprEqual){var y=s.expression1,u=s.expression2;null!=y&&y.type==GeoBeans.Expression.Type.Literal?i=y.value:null!=u&&u.type==GeoBeans.Expression.Type.Literal&&(i=u.value)}else if(r==GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween){var p=s.lowerBound,d=s.upperBound,c="",f="";null!=p&&(c=parseFloat(p.value)),null!=d&&(f=parseFloat(d.value)),i=c.toFixed(2)+"-"+f.toFixed(2)}}var m=a.symbolizer,h=this.getSymbolHtml(m),S=this.getSymbolIconHtml(m.type,m.symbol);t+="<tr>		<td class='style-col'>"+h+"		</td>		<td class='style-col'>"+S+"		</td>		<td class='value-col'>"+i+"		</td>		<td value='value-col'>"+i+"		</td>	</tr>"}}return t+="</tbody>"}},removeStyle_callback:function(e){var l=MapCloud.styleManager_dialog,t=l.panel,n=l.panel.find("#style_list option:selected").text(),a="删除样式 [ "+n+" ]";if(MapCloud.notify.showInfo(e,a),t.find(".style-pane").css("display","none"),"SUCCESS"==e.toUpperCase()){var s=t.find("#style_type_name").text();if(s=s.toLowerCase(),"all"==s){var i=styleManager.getStyles();l.getStyles_callback(i)}else{var o=l.getStyleType(s);if(null!=o){var i=styleManager.getStyleByType(o);l.getStyles_callback(i)}}}},registerStyleSelected:function(){this.panel.find(".unique-pane .style-list-table tbody tr").each(function(){$(this).click(function(){$(this).parent().children().removeClass("selected"),$(this).addClass("selected")})})},setRule:function(e){if(null!=e)if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.SINGLE&&0==this.styleChangedIndex){var l=this.singleStyle.rules[0].symbolizer.symbol;e.symbolizer.symbol=l,this.singleStyle.rules[0]=e,this.displaySingleStyle(this.singleStyle)}else if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE){var l=this.uniqueStyle.rules[this.styleChangedIndex].symbolizer.symbol;e.symbolizer.symbol=l,this.uniqueStyle.rules[this.styleChangedIndex].symbolizer=e.symbolizer,this.uniqueStyle.rules[this.styleChangedIndex].textSymbolizer=e.textSymbolizer,this.displayUniqueStyle(this.uniqueStyle)}else if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES){var l=this.quantitiesStyle.rules[this.styleChangedIndex].symbolizer.symbol;e.symbolizer.symbol=l,this.quantitiesStyle.rules[this.styleChangedIndex].symbolizer=e.symbolizer,this.quantitiesStyle.rules[this.styleChangedIndex].textSymbolizer=e.textSymbolizer,this.displayQuantitiesStyle(this.quantitiesStyle)}else if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM){var l=this.customStyle.rules[this.styleChangedIndex].symbolizer.symbol;e.symbolizer.symbol=l,this.customStyle.rules[this.styleChangedIndex].symbolizer=e.symbolizer,this.customStyle.rules[this.styleChangedIndex].textSymbolizer=e.textSymbolizer,this.displayCustomStyle(this.customStyle)}else if(this.styleChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.DOTDENSITY){var l=this.dotDensityStyle.rules[this.styleChangedIndex].symbolizer.symbol;e.symbolizer.symbol=l,this.dotDensityStyle.rules[this.styleChangedIndex].symbolizer=e.symbolizer,this.dotDensityStyle.rules[this.styleChangedIndex].textSymbolizer=e.textSymbolizer,this.displayDotDensityStyle(this.dotDensityStyle)}},setAddStyleName:function(e,l){if(null!=e){this.addStyleName=e;var t=styleManager.getStyle(e);if(null!=t){var n="已经有"+e+"样式，请重新输入";return MapCloud.notify.showInfo("failed",n),void MapCloud.styleName_dialog.showDialog()}var a=this.panel.find("#style_list");if("add"==l){var s=this.panel.find("#style_type_name").text(),i=this.getStyleType(s.toLowerCase()),o='<option value="'+e+'" type="'+i+'">'+e+"</option>";a.append(o),a.find("option[value='"+e+"']").attr("selected",!0),this.loadAddStyle(i)}else if("save"==l){this.panel.find("#style_list option[value='default']").text(e);var t=this.getCurrentStyle();this.addStyle(t)}}},loadAddStyle:function(e){if(null!=e){var l=this,t=null;switch(e){case GeoBeans.Style.FeatureStyle.GeomType.Point:t="js/StyleXML/point.xml";break;case GeoBeans.Style.FeatureStyle.GeomType.LineString:t="js/StyleXML/line.xml";break;case GeoBeans.Style.FeatureStyle.GeomType.Polygon:t="js/StyleXML/polygon.xml"}$.get(t,function(e){var t=styleManager.reader.read(e);t.name=l.addStyleName;var n=l.panel.find("#style_type_name").text();t.geomType=n,l.getStyleXML_callback(t)})}},getCurrentStyle:function(){var e=this.panel.find(".list-group-item.active");if(e.hasClass("single-style"))return this.singleStyle;if(e.hasClass("unique-style"))return this.uniqueStyle;if(e.hasClass("quantities-style"))return this.quantitiesStyle;if(e.hasClass("custom-style"))return this.customStyle;if(e.hasClass("dot-density-style")){var l=this.panel.find(".dot-density-pane .layer-fields").val();return null==l||""==l?(MapCloud.notify.showInfo("请选择一个字段","Warning"),null):(this.dotDensityStyle.field=l,this.dotDensityStyle)}},updateStyle:function(e){if(null!=e){var l=e.name;if("default"!=l){var t=styleManager.writer.write(e);MapCloud.notify.loading(),styleManager.updateStyle(t,l,this.updateCallback)}}},updateCallback:function(e){var l=MapCloud.styleManager_dialog,t=l.panel,n=t.find("#style_list option:selected").text(),a="更新样式 [ "+n+" ]";MapCloud.notify.showInfo(e,a)},addStyle:function(e){if(null!=e){var l=styleManager.writer.write(e);if(null!=l){var t=e.name,n=e.geomType;MapCloud.notify.loading(),styleManager.addStyle(l,t,n,this.addStyleCallback)}}},addStyleCallback:function(e){var l=MapCloud.styleManager_dialog,t=l.panel.find("#style_type_name").text(),n=l.getStyleType(t.toLowerCase()),a=styleManager.getStyleByType(n);l.getStyles_callback(a);var s=l.addStyleName,i="添加样式 [ "+s+" ]";MapCloud.notify.showInfo(e,i);var o=l.panel.find("#style_list option[value='"+s+"']");o.attr("selected",!0),l.panel.find("#styles_list_table").html(""),l.defaultStyle=null,l.styleCur=null,l.styleNameCur=l.addStyleName,l.isDefaultStyle=!1;var r=styleManager.getStyle(s);if(null!=r&&styleManager.getStyleXML(s,l.getStyleXML_callback),l.addStyleName=null,l.setLayerStyleFlag&&null!=l.typeName){var y=l.getCurrentStyle();l.setStyle(l.typeName,y,l.setStyle_callback)}l.setLayerStyleFlag=!1},setWFSLayer:function(e){if(null!=e){this.wfsLayer=e;var l=this.wfsLayer.workspace;this.wfsWorkspace=l;var t=this.wfsLayer.style;if(null!=t){this.typeName=this.wfsLayer.name;var n=e.featureType.fields;this.setFields(n);var a=t.name;this.styleNameCur=a;var s=t.geomType,i=this.panel.find("#style_list option[type='"+s+"']"),o=s+"<span class='caret'></span>";this.panel.find("#style_type_name").html(o),this.panel.find("#style_type_name").addClass("disabled");var r=this.panel.find("#style_list");r.html(i);var y=styleManager.getStyle(a);"default"==a||null==y?(r.append("<option value='default'>default</option>"),r.find("option[value='default']").attr("selected",!0),this.getStyleXML_callback(t)):(r.find("option[value='"+a+"']").attr("selected",!0),this.getStyleXML_callback(t)),this.setWFSLayerPanelStyle()}}},setWFSLayerPanelStyle:function(){this.panel.find("#add_style,#save_style,#remove_style").attr("disabled","true"),this.panel.find("#style_list").attr("disabled","true"),this.panel.find(".col-md-3 .list-group-item").addClass("disabled"),this.panel.find(".single-pane .symbol-icon").unbind("click")},setDBLayer:function(e){if(null!=e){this.dbLayer=e,this.typeName=e.name,this.wfsWorkspace=new GeoBeans.WFSWorkspace("tmp",mapObj.server,"1.0.0");var l=e.getFields();this.setFields(l);var t=this.dbLayer.geomType,n=this.getStyleTypeByGeomType(t),a=this.panel.find("#style_list option[type='"+n+"']"),s=n+"<span class='caret'></span>";this.panel.find("#style_type_name").html(s),this.panel.find("#style_type_name").addClass("disabled");var i=this.panel.find("#style_list");i.html(a);var o=this.dbLayer.styleName;if(null!=o&&""!=o)this.styleNameCur=o,i.find("option[value='"+o+"']").attr("selected",!0),styleManager.getStyleXML(this.styleNameCur,this.getStyleXML_callback);else{var r=styleManager.getStyleByType(n);this.getStyles_callback(r)}}},setFields:function(e){if(null!=e){this.fields=e;for(var l,t,n="",a=0;a<e.length;++a)l=e[a],null!=l&&(t=l.name,n+="<option value='"+t+"'>"+t+"</option>");this.panel.find(".unique-pane .layer-fields").html(n);var s=this;this.panel.find(".unique-pane .layer-fields").each(function(){
$(this).change(function(){s.panel.find(".unique-pane .style-list-table").html(""),s.uniqueStyle=null})});var i="<option value='none'>none</option>";n=null;for(var o=null,a=0;a<e.length;++a)l=e[a],o=l.type,("int"==o||"double"==o||"float"==o)&&(t=l.name,n+="<option value='"+t+"'>"+t+"</option>");i+=n,this.panel.find(".quantities-pane .layer-fields").html(i),n="";for(var a=0;a<e.length;++a)l=e[a],null!=l&&(t=l.name,n+="<option value='"+t+"'>"+t+"</option>");this.panel.find(".custom-pane .layer-fields").html(n),n="",n=null;for(var o=null,a=0;a<e.length;++a)l=e[a],o=l.type,("int"==o||"double"==o||"float"==o)&&(t=l.name,n+="<option value='"+t+"'>"+t+"</option>");this.panel.find(".dot-density-pane .layer-fields").html(n)}},getColorMaps_callback:function(e){if(null!=e){for(var l=MapCloud.styleManager_dialog,t=l.panel,n=null,a=null,s="",i=0;i<e.length;++i)n=e[i],a=n.url,s+="<li cid='"+n.id+"'>	<div class='color-ramp-item' style='background-image:	url("+a+")'>	</div></li>";if(t.find(".color-ramp-div ul").html(s),n=e[0],null!=n){a=n.url;var o=n.id,r="<li cid='"+o+"'>	<div class='color-ramp-item' style='background-image:	url("+a+")'>	</div></li>";t.find(".select-color-ramp").html(r),null==l.uniqueValues}l.panel.find(".unique-pane .color-ramp-div ul li").click(function(){var e=$(this).attr("cid"),n=t.find(".unique-pane");n.find(".select-color-ramp li").attr("cid",e);var a=$(this).find(".color-ramp-item").css("background-image");if(n.find(".select-color-ramp li .color-ramp-item").css("background-image",a),null==l.uniqueValues){var s=n.find(".layer-fields option:selected").val();if(null==s)return;l.wfsWorkspace.getValue(l.typeName,s,mapObj.name,l.getValuesCallback)}else{var i=l.uniqueValues.length;styleManager.getColorMapNew(e,i,l.getColorMap_callback)}}),l.panel.find(".quantities-pane .color-ramp-div ul li").click(function(){var e=$(this).attr("cid"),n=t.find(".quantities-pane");n.find(".select-color-ramp li").attr("cid",e);var a=$(this).find(".color-ramp-item").css("background-image");n.find(".select-color-ramp li .color-ramp-item").css("background-image",a);var s=n.find(".layer-fields option:selected").val();if(null!=s&&"none"!=s)if(null==l.minMaxValue)l.wfsWorkspace.getMinMaxValue(l.typeName,s,mapObj.name,l.getMinMaxValue_callback);else{var i=l.panel.find(".quantities-pane .classes option:selected").val();styleManager.getColorMapNew(e,i,l.getColorMapMinMax_callback)}}),l.panel.find(".custom-pane .color-ramp-div ul li").click(function(){var e=$(this).attr("cid"),n=t.find(".custom-pane");n.find(".select-color-ramp li").attr("cid",e);var a=$(this).find(".color-ramp-item").css("background-image");n.find(".select-color-ramp li .color-ramp-item").css("background-image",a);var s=l.customStyleFilters.length;styleManager.getColorMapNew(e,s,l.getColorMapCustom_callback)})}},getValuesCallback:function(e){if(null!=e){var l=e.length,t=MapCloud.styleManager_dialog,n=t.panel;t.uniqueValues=e;var a=n.find(".unique-pane .select-color-ramp li").attr("cid");styleManager.getColorMapNew(a,l,t.getColorMap_callback)}},getColorMap_callback:function(e){if(null!=e){var l=MapCloud.styleManager_dialog;l.panel;if(null==l.singleStyle)return void MapCloud.notify.showInfo("请设置一个有效样式","Warning");var t=l.singleStyle.rules[0],n=l.panel.find(".unique-pane .layer-fields option:selected").val(),a=l.uniqueValues,s=l.getStyleByValues(t,n,a,e);l.uniqueStyle=s,null!=s&&l.displayUniqueStyle(l.uniqueStyle)}},getMinMaxValue_callback:function(e){if(null!=e){var l=(e.min,e.max,MapCloud.styleManager_dialog);l.minMaxValue=e;var t=l.panel.find(".quantities-pane .classes option:selected"),n=t.val(),a=l.panel.find(".quantities-pane .select-color-ramp li").attr("cid");styleManager.getColorMapNew(a,n,l.getColorMapMinMax_callback)}},getColorMapMinMax_callback:function(e){if(console.log(e),null!=e){var l=MapCloud.styleManager_dialog;if(null==l.singleStyle)return void MapCloud.notify.showInfo("请设置一个有效样式","Warning");var t=l.singleStyle.rules[0],n=l.panel.find(".quantities-pane .classes option:selected").val(),a=l.minMaxValue.min,s=l.minMaxValue.max,i=l.panel.find(".quantities-pane .layer-fields option:selected").val(),o=l.getStyleByMinMaxValues(t,i,a,s,n,e);l.quantitiesStyle=o,l.displayQuantitiesStyle(l.quantitiesStyle)}},getStyleByMinMaxValues:function(e,l,t,n,a,s){if(null==e||null==t||null==n||null==a)return null;var i=this.singleStyle.geomType,o=new GeoBeans.Style.FeatureStyle("quantities",i);o.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES;for(var r=[],y=e.symbolizer,u=y.type,p=e.textSymbolizer,d=null,c=(n-t)/a,f=0;a>f;++f){var m=t+c*f,h=t+c*(f+1),S=new GeoBeans.Rule;d=s[f];var g=y.clone();if(u==GeoBeans.Symbolizer.Type.Point){var v=g.fill.getOpacity();color=new GeoBeans.Color,color.setByHex(d,v),g.fill.color=color}else if(u==GeoBeans.Symbolizer.Type.Line){var v=g.stroke.getOpacity();color=new GeoBeans.Color,color.setByHex(d,v),g.stroke.color=color}else if(u==GeoBeans.Symbolizer.Type.Polygon){var v=.8;color=new GeoBeans.Color,color.setByHex(d,v),g.fill.color=color;var b=.6,C=new GeoBeans.Color;C.setByHex(d,b),null==g.stroke&&(g.stroke=new GeoBeans.Stroke),g.stroke.color=C,g.stroke.width=.1}S.symbolizer=g,null!=p&&(S.textSymbolizer=p);var M=new GeoBeans.IsBetweenFilter,k=new GeoBeans.PropertyName;k.name=l;var B=new GeoBeans.Literal;B.value=m;var G=new GeoBeans.Literal;G.value=h,M.expression=k,M.lowerBound=B,M.upperBound=G,S.filter=M,S.name=f,r.push(S)}return o.rules=r,o},getStyleTypeByGeomType:function(e){if(null==e)return null;e=e.toUpperCase();var l=null;switch(e){case"POINT":case"MULTIPOINT":l=GeoBeans.Style.FeatureStyle.GeomType.Point;break;case"LINESTRING":case"MULTILINESTRING":l=GeoBeans.Style.FeatureStyle.GeomType.LineString;break;case"POLYGON":case"MULTIPOLYGON":l=GeoBeans.Style.FeatureStyle.GeomType.Polygon}return l},getStyleByValues:function(e,l,t,n){var a=null,s=null,i=e.symbolizer,o=e.textSymbolizer,r=(n.length,i.type),y=this.singleStyle.geomType,u=(this.panel.find("#style_list option:selected").text(),new GeoBeans.Style.FeatureStyle("unique",y));u.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE;for(var p=[],d=0;d<t.length;++d){var c=t[d],f=new GeoBeans.Rule;s=n[d];var m=i.clone();if(r==GeoBeans.Symbolizer.Type.Point){var h=m.fill.getOpacity();a=new GeoBeans.Color,a.setByHex(s,h),m.fill.color=a}else if(r==GeoBeans.Symbolizer.Type.Line){var h=m.stroke.getOpacity();a=new GeoBeans.Color,a.setByHex(s,h),m.stroke.color=a}else if(r==GeoBeans.Symbolizer.Type.Polygon){var h=.8;a=new GeoBeans.Color,a.setByHex(s,h),m.fill.color=a;var S=.6,g=new GeoBeans.Color;g.setByHex(s,S),null==m.stroke&&(m.stroke=new GeoBeans.Stroke),m.stroke.color=g,m.stroke.width=.1}f.symbolizer=m;var v=new GeoBeans.BinaryComparisionFilter,b=new GeoBeans.PropertyName;b.name=l;var C=new GeoBeans.Literal;C.value=c,v.operator=GeoBeans.ComparisionFilter.OperatorType.ComOprEqual,v.expression1=b,v.expression2=C,f.filter=v,f.name=d,null!=o&&(f.textSymbolizer=o),p.push(f)}return u.rules=p,u},setStyle:function(e,l){null!=e&&null!=l&&mapObj.setStyle(e,l,this.setStyle_callback)},setStyle_callback:function(e){var l="设置样式";MapCloud.notify.showInfo(e,l),mapObj.draw()},setSymbol:function(e){if(null!=e){var l="url("+e.icon+")";if(this.symbolChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.SINGLE&&0==this.symbolChangedIndex)this.panel.find(".single-pane .symbol-icon").css("background-image",l),null!=this.singleStyle&&(this.singleStyle.rules[0].symbolizer.symbol=e);else if(this.symbolChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.UNIQUE){var t=this.panel.find(".unique-pane .symbol-icon")[this.symbolChangedIndex];$(t).css("background-image",l),null!=this.uniqueStyle&&(this.uniqueStyle.rules[this.symbolChangedIndex].symbolizer.symbol=e)}else if(this.symbolChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.QUANTITIES){var t=this.panel.find(".quantities-pane .symbol-icon")[this.symbolChangedIndex];$(t).css("background-image",l),null!=this.quantitiesStyle&&(this.quantitiesStyle.rules[this.symbolChangedIndex].symbolizer.symbol=e)}else if(this.symbolChangedClass==GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM){var t=this.panel.find(".custom-pane .symbol-icon")[this.symbolChangedIndex];$(t).css("background-image",l),null!=this.customStyle&&(this.customStyle.rules[this.symbolChangedIndex].symbolizer.symbol=e)}}},getSymbolIconType:function(e){var l=null;switch(e){case GeoBeans.Symbolizer.Type.Point:l="marker";break;case GeoBeans.Symbolizer.Type.Line:l="line";break;case GeoBeans.Symbolizer.Type.Polygon:l="fill"}return l},getSqlExpression:function(e){if(null!=e){var l=null;if(e instanceof GeoBeans.ComparisionFilter){var t=e.operator;if(t==GeoBeans.ComparisionFilter.OperatorType.ComOprIsBetween){var n=e.expression,a=e.lowerBound,s=e.upperBound;if(null==n||null==a||null==s)return null;var i=n.name,o=a.value,r=s.value;if(null==i||null==o||null==r)return null;l=o+" &lt; "+i+" &lt; "+r}else{var y=e.expression1,u=e.expression2;if(null==y||null==u)return null;var i=null,p=null;y.type==GeoBeans.Expression.Type.PropertyName?i=y.name:y.type==GeoBeans.Expression.Type.Literal&&(p=y.value),u.type==GeoBeans.Expression.Type.PropertyName?i=u.name:u.type==GeoBeans.Expression.Type.Literal&&(p=u.value);var d=this.getOperatorExpression(t);if(null==d||null==i||null==p)return null;l=i+" "+d+" "+p}}return l}},getOperatorExpression:function(e){var l=null;switch(e){case GeoBeans.ComparisionFilter.OperatorType.ComOprEqual:l="=";break;case GeoBeans.ComparisionFilter.OperatorType.ComOprGreaterThan:l=">";break;case GeoBeans.ComparisionFilter.OperatorType.ComOprGreaterThanOrEqual:l=">=";break;case GeoBeans.ComparisionFilter.OperatorType.ComOprLessThan:l="<";break;case GeoBeans.ComparisionFilter.OperatorType.ComOprLessThanOrEqual:l="<=";break;default:l=null}return l},setCustomFilter:function(e){if(null!=e){var l=e.name;if(null==l)this.customStyleFilters.push(e);else for(var t=0;t<this.customStyleFilters.length;++t)if(l==this.customStyleFilters[t].name){this.customStyleFilters[t]=e;break}var n=this.panel.find(".custom-pane .select-color-ramp li").attr("cid"),a=this.customStyleFilters.length;styleManager.getColorMap(n,a,this.getColorMapCustom_callback)}},getColorMapCustom_callback:function(e){if(null!=e){var l=MapCloud.styleManager_dialog,t=l.singleStyle.rules[0],n=l.customStyleFilters,a=l.getCustomStyle(t,n,e);l.customStyle=a,l.displayCustomStyle(l.customStyle)}},getCustomStyle:function(e,l,t){if(null==e||null==l||null==t)return null;var n=null,a=e.symbolizer,s=e.textSymbolizer,i=this.singleStyle.geomType,o=a.type,r=new GeoBeans.Style.FeatureStyle("custom",i);r.styleClass=GeoBeans.Style.FeatureStyle.StyleClass.CUSTOM;for(var y=[],u=null,p=0;p<t.length;++p){u=t[p];var d=new GeoBeans.Rule,c=l[p],f=a.clone();if(o==GeoBeans.Symbolizer.Type.Point){var m=f.fill.getOpacity();n=new GeoBeans.Color,n.setByHex(u,m),f.fill.color=n}else if(o==GeoBeans.Symbolizer.Type.Line){var m=f.stroke.getOpacity();n=new GeoBeans.Color,n.setByHex(u,m),f.stroke.color=n}else if(o==GeoBeans.Symbolizer.Type.Polygon){var m=f.fill.getOpacity();n=new GeoBeans.Color,n.setByHex(u,m),f.fill.color=n}d.symbolizer=f,d.filter=c,d.name=p,null!=s&&(d.textSymbolizer=s),y.push(d)}return r.rules=y,r},getRulesHtml:function(e){if(null!=e){for(var l="<thead>	<tr>			<th class='style-col'><span>&nbsp;</span></th>			<th class='style-col'><span>&nbsp;</span></th>		<th class='value-col'>表达式</th>		<th class='value-col'>表达式</th>	</tr></thead><tbody>",t=null,n=0;n<e.length;++n){t=e[n];var a=t.filter;if(null!=a){var s=this.getSqlExpression(a),i=t.symbolizer,o=this.getSymbolHtml(i),r=this.getSymbolIconHtml(i.type,i.symbol);l+="<tr>		<td class='style-col'>"+o+"		</td>		<td class='style-col'>"+r+"		</td>		<td class='value-col'>"+s+"		</td>		<td value='value-col'>"+s+"		</td>	</tr>"}}return l+="</tbody>"}},getCustomStyleFilters:function(e){if(null==e)return[];var l=e.rules;if(null==l)return[];for(var t=[],n=0;n<l.length;++n){var a=l[n];null!=a&&t.push(a.filter)}return t}});
MapCloud.StyleNameDialog=MapCloud.Class(MapCloud.Dialog,{flag:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var n=this;this.panel.find(".btn-confirm").each(function(){$(this).click(function(){n.onSetStyleName()})}),this.panel.find("#wms_style_add_name").keypress(function(a){13==a.which&&n.onSetStyleName()})},showDialog:function(){MapCloud.Dialog.prototype.showDialog.apply(this,arguments);var a=this;this.panel.on("shown.bs.modal",function(){a.panel.find("#wms_style_add_name").focus()})},cleanup:function(){this.panel.find("#wms_style_add_name").val("")},setFlag:function(a){this.flag=a,"save"==this.flag?this.panel.find(".modal-title").text("保存样式"):"add"==this.flag&&this.panel.find(".modal-title").text("新建样式")},onSetStyleName:function(){var a=this,n=a.panel.find("#wms_style_add_name").val();if(""==n)return MapCloud.notify.showInfo("请输入名称","Warning"),void a.panel.find("#wms_style_add_name").focus();var t=/^[0-9a-zA-Z_]+$/;return t.test(n)?(MapCloud.styleManager_dialog.setAddStyleName(n,a.flag),void a.closeDialog()):(MapCloud.notify.showInfo("请输入有效的名称","Warning"),void a.panel.find("#wms_style_add_name").focus())}});
MapCloud.SymbolDialog=MapCloud.Class(MapCloud.Dialog,{symbols:null,initialize:function(l){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var l=this;this.panel.find(".btn-confirm").click(function(){if("styleManager"==l.source){var i=l.panel.find("li a.selected"),a=i.parent().attr("sindex"),e=l.symbols[a];if(null==e)return void MapCloud.notify.showInfo("请选择一种样式","Warning");var s=MapCloud.styleManager_dialog;s.setSymbol(e)}else if("refresh"==l.source){var i=l.panel.find("li a.selected"),a=i.parent().attr("sindex"),e=l.symbols[a];if(null==e)return void MapCloud.notify.showInfo("请选择一种样式","Warning");var t=MapCloud.refresh_panel;t.setSymbol(e)}l.closeDialog()})},showDialog:function(l,i,a){MapCloud.Dialog.prototype.showDialog.apply(this,arguments),this.source=l,this.type=i,this.symbolName=a,this.getSymbol(this.type)},cleanup:function(){this.panel.find("ul").empty(),this.symbols=null,this.symbolName=null,this.type=null},getSymbol:function(l){MapCloud.notify.loading(),styleManager.getSymbols(l,this.getSymbol_callback)},getSymbol_callback:function(l){MapCloud.notify.hideLoading();var i=MapCloud.symbol_dialog;i.symbols=l,i.showSymbols(l)},showSymbols:function(l){for(var i=null,a="",e=null,s=null,t=0;t<l.length;++t)i=l[t],null!=i&&(e=i.name,s=i.icon,a+="<li class='symbol-wrapper' sindex='"+t+"'>",a+=this.symbolName==e?"<a href='javascript:void(0)' class='symbol-thumb selected' ":"<a href='javascript:void(0)' class='symbol-thumb' ",a+=" title='"+e+"'  style='background-image:url("+s+")'></a><div class='caption text-center'>	<h6>"+e+"</h6></div></li>");this.panel.find("ul").html(a);var o=this;this.panel.find("li a").click(function(){o.panel.find("li a").removeClass("selected"),$(this).addClass("selected")})}});
MapCloud.TileDBDialog=MapCloud.Class(MapCloud.Dialog,{tileStore:null,registerDataSourceName:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var e=this;this.panel.find("[data-toggle='tooltip']").tooltip({container:"body"}),this.panel.find(".db-list").change(function(){var i=$(this).val();e.getTileStores(i)}),this.panel.find(".btn-add-server").click(function(){MapCloud.pgis_connection_dialog.showDialog("tile","tile")}),this.panel.find(".btn-remove-server").click(function(){e.removeDataSource()}),this.panel.find(".btn-refresh").click(function(){var i=e.panel.find(".db-list").val();return null==i?void MapCloud.notify.showInfo("请选择一个数据源","Warning"):void e.getTileStores(i)}),this.panel.find(".btn-create-tile-store").click(function(){var i=e.panel.find(".db-list").val();return null==i?void MapCloud.notify.showInfo("请选择一个数据源","Warning"):void MapCloud.create_tile_store_dialog.showDialog("tileDB",i)}),this.panel.find(".btn-remove-tile-store").click(function(){var i=e.panel.find(".db-list").val();if(null==i)return void MapCloud.notify.showInfo("请选择一个数据源","Warning");var l=e.panel.find(".tile-store-name.selected span").html();confirm("确定删除["+l+"]瓦片库吗？")&&e.removeTileStore(i,l)}),this.panel.find(".btn-infos").click(function(){e.panel.find(".db-tool .btn-group .btn").attr("disabled",!1),$(this).attr("disabled",!0),e.panel.find(".layer-content").removeClass("active"),e.panel.find(".layer-infos-pane").addClass("active");var i=e.panel.find(".tile-store-name.selected span").html();e.showTileStore(i)}),this.panel.find(".btn-preview").click(function(){e.panel.find(".layer-content").removeClass("active"),e.panel.find(".layer-preview-pane").addClass("active"),e.panel.find(".db-tool .btn-group .btn").attr("disabled",!1),$(this).attr("disabled",!0),null!=e.tileStore&&e.showTileStorePreview(e.tileStore)}),this.panel.find(".btn-confirm").click(function(){if(null==e.source)return void e.closeDialog();if("wmtsLayer"==e.source){var i=e.panel.find(".db-list").val();if(null==i||""==i)return void MapCloud.notify.showInfo("请选择一个数据源","Warning");if(null!=e.tileStore){var l=e.tileStore,t=new GeoBeans.Layer.WMTSLayer(l.name,dbsManager.server,l.name,l.extent,l.tms,l.format,l.sourceName);null!=l.startLevel&&(t.MIN_ZOOM_LEVEL=l.startLevel),null!=l.endLevel&&(t.MAX_ZOOM_LEVEL=l.endLevel),MapCloud.wmts_dialog.setWMTSLayer(i,t)}e.closeDialog()}else if("buildPyramid"==e.source){var i=e.panel.find(".db-list").val();if(null==i||""==i)return void MapCloud.notify.showInfo("请选择一个数据源","Warning");null!=e.tileStore&&MapCloud.gps_build_pyramid_dialog.setTileStore(i,e.tileStore.name),e.closeDialog()}})},showDialog:function(e){var i=$("body").width(),l=this.panel.find(".modal-dialog").width();l>i&&(l=i-40,this.panel.find(".modal-dialog").css("width",l+"px")),MapCloud.Dialog.prototype.showDialog.apply(this,arguments),this.getDataSources(),this.source=e,null!=this.source?this.panel.find(".btn-confirm").html("选择"):this.panel.find(".btn-confirm").html("确定")},getDataSources:function(){dbsManager.getDataSources(this.getDataSources_callback,"Tile")},cleanup:function(){null!=this.map&&(this.map.close(),this.map=null),this.source=null,this.tileStore=null,this.panel.find(".db-list").empty(),this.panel.find(".layer-tree .nav").empty(),this.panel.find(".layer-infos-pane").empty(),this.panel.find(".db-tool .btn-group .btn").attr("disabled",!1),this.panel.find(".btn-infos").attr("disabled",!0)},getDataSources_callback:function(e){MapCloud.notify.hideLoading();var i=MapCloud.tile_db_dialog;i.showDataSources(e)},showDataSources:function(e){if(null!=e){for(var i=null,l=null,t="",a=0;a<e.length;++a)i=e[a],null!=i&&(l=i.name,t+="<option value='"+l+"'>"+l+"</option>");if(this.panel.find(".db-list").html(t),null!=this.registerDataSourceName)this.panel.find(".db-list option[value='"+this.registerDataSourceName+"']").attr("selected",!0),this.getTileStores(this.registerDataSourceName),this.registerDataSourceName=null;else{var n=this.panel.find(".db-list").val();null!=n&&""!=n&&this.getTileStores(n)}}},getTileStores:function(e){this.panel.find(".layer-tree .nav").empty(),this.panel.find(".layer-infos-pane").empty(),null!=this.map&&(this.map.removeBaseLayer("tile"),this.map.draw()),this.tileStore=null,MapCloud.notify.loading(),dbsManager.describeTileStores(e,this.getTileStores_callback)},getTileStores_callback:function(e){MapCloud.notify.hideLoading();var i=MapCloud.tile_db_dialog;i.showTileStoreList(e)},showTileStoreList:function(e){if(null!=e){for(var i="",l=null,t=null,a=0;a<e.length;++a)l=e[a],null!=l&&(t=l.name,i+="<li>		<a href='javascript:void(0)' class='tile-store-name' tname='"+t+"'>			<span>"+t+"</span>		</a></li>");this.panel.find(".layer-tree .nav").html(i);var n=this.panel.find(".tile-store-name span").first().html();null!=n&&this.showTileStore(n);var s=this;this.panel.find(".tile-store-name").click(function(){var e=$(this).find("span").html();s.showTileStore(e)})}},showTileStore:function(e){this.panel.find(".tile-store-name").removeClass("selected"),this.panel.find(".tile-store-name[tname='"+e+"']").addClass("selected");var i=this.panel.find(".db-list").val();null!=e&&(MapCloud.notify.loading(),dbsManager.describeTileStore(i,e,this.describeTileStore_callback))},describeTileStore_callback:function(e){MapCloud.notify.hideLoading();var i=MapCloud.tile_db_dialog,l=i.panel.find(".db-tool .btn-group .btn[disabled='disabled']");l.hasClass("btn-preview")?i.showTileStorePreview(e):l.hasClass("btn-infos")&&i.showTileStoreInfo(e)},showTileStoreInfo:function(e){if(this.panel.find(".layer-content").removeClass("active"),this.panel.find(".layer-infos-pane").addClass("active"),this.panel.find(".db-tool .btn-group .btn").attr("disabled",!1),this.panel.find(".btn-infos").attr("disabled",!0),null!=e&&e instanceof GeoBeans.TileStore){this.tileStore=e;var i="";i+="<div class='row'>			<div class='col-md-4 col-xs-4'>瓦片库名称</div>			<div class='col-md-8 col-xs-8'>"+e.name+"</div>		</div>		<div class='row'>			<div class='col-md-4 col-xs-4'>格式</div>			<div class='col-md-8 col-xs-8'>"+e.format+"</div>		</div>		<div class='row'>			<div class='col-md-4 col-xs-4'>切图标准</div>			<div class='col-md-8 col-xs-8'>"+e.tms+"</div>		</div>		<div class='row'>			<div class='col-md-4 col-xs-4'>范围</div>			<div class='col-md-8 col-xs-8'>"+(null!=e.extent?e.extent.toString():"")+"</div>		</div>		<div class='row'>			<div class='col-md-4 col-xs-4'>投影</div>			<div class='col-md-8 col-xs-8'>"+e.srid+"</div>		</div>		<div class='row'>			<div class='col-md-4 col-xs-4'>起始级别</div>			<div class='col-md-8 col-xs-8'>"+e.startLevel+"</div>		</div>		<div class='row'>			<div class='col-md-4 col-xs-4'>终止级别</div>			<div class='col-md-8 col-xs-8'>"+e.endLevel+"</div>		</div>",this.panel.find(".layer-infos-pane").html(i)}},removeDataSource:function(){var e=this.panel.find(".db-list").val();return null==e?void MapCloud.notify.showInfo("请选择一个数据源","Warning"):void(confirm("确定要删除["+e+"]数据库吗?")&&(this.panel.find(".db-list").empty(),this.panel.find(".layer-tree .nav").empty(),this.panel.find(".layer-infos-pane").empty(),this.panel.find(".db-tool .btn-group .btn").attr("disabled",!1),this.panel.find(".btn-infos").attr("disabled",!0),dbsManager.unRegisterDataSource(e,this.unRegisterDataSource_callback)))},unRegisterDataSource_callback:function(e){var i="注销数据源";MapCloud.notify.showInfo(e,i);var l=MapCloud.tile_db_dialog;l.getDataSources()},showTileStorePreview:function(e){if(this.panel.find(".layer-content").removeClass("active"),this.panel.find(".layer-preview-pane").addClass("active"),null!=e){var i=new GeoBeans.Layer.WMTSLayer(e.name,dbsManager.server,e.name,e.extent,e.tms,e.format,e.sourceName),l=e.extent,t=e.startLevel,a=e.endLevel;if(null!=t&&(i.MIN_ZOOM_LEVEL=t),null!=a&&(i.MAX_ZOOM_LEVEL=a),null!=this.map)this.map.removeBaseLayer(),this.map.draw(),this.map.setBaseLayer(i);else{var l=i.extent,n=4326;this.map=new GeoBeans.Map(user.server,"tile_canvas_wrapper","tile",l,n,l),this.map.setBaseLayer(i)}if(null!=l){var s=l.getCenter();this.map.setCenter(s)}this.map.draw()}},removeTileStore:function(e,i){MapCloud.notify.loading(),dbsManager.removeTileStore(e,i,this.removeTileStore_callback)},removeTileStore_callback:function(e){MapCloud.notify.showInfo(e,"删除瓦片库");var i=MapCloud.tile_db_dialog,l=i.panel.find(".db-list").val();i.getTileStores(l)},setRegisterDataSourceName:function(e){this.registerDataSourceName=e}});
MapCloud.VectorDBDialog=MapCloud.Class(MapCloud.Dialog,{dataSourceCur:null,maxFeatures:20,flag:null,registerDataSourceName:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments),this.registerPanelEvent()},registerPanelEvent:function(){var a=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),this.panel.find(".btn-confirm").click(function(){if(null==a.flag)return void a.closeDialog();var e=a.panel.find(".tree-table.selected"),t=e.attr("dindex");if(null==t)return void MapCloud.notify.showInfo("请选择一个数据","Warning");if(null==a.dataSourceCur)return void MapCloud.notify.showInfo("当前数据库为空","Warning");var n=a.dataSourceCur.dataSets;if(null==n)return void MapCloud.notify.showInfo("当前数据库为空","Warning");var l=n[t],i=null;switch(a.flag){case"select":i=MapCloud.new_layer_dialog,MapCloud.new_layer_dialog.setDataSet(a.dataSourceCur,l);break;case"range":i=MapCloud.chart_panel,i.setDataSet(a.dataSourceCur.name,l.name);break;case"bar":i=MapCloud.bar_chart_panel,i.setDataSet(a.dataSourceCur.name,l.name);break;case"pie":i=MapCloud.pie_chart_panel,i.setDataSet(a.dataSourceCur.name,l.name);break;case"symbol":i=MapCloud.symbol_chart_panel,i.setDataSet(a.dataSourceCur.name,l.name);break;case"rs":i=MapCloud.range_symbol_chart_panel,i.setDataSet(a.dataSourceCur.name,l.name);break;case"kmean":i=MapCloud.gps_kmean_dialog,i.setDataSet(a.dataSourceCur.name,l.name);break;case"featureProject":i=MapCloud.gps_feature_project_dialog,i.setDataSet(a.dataSourceCur.name,l);break;case"csvImport":if(null!=l.geometryType)return void MapCloud.notify.showInfo("请选择一个属性数据","Warning");i=MapCloud.gps_csv_import_dialog,i.setDataSet(a.dataSourceCur.name,l);break;case"getArea":i=MapCloud.gps_get_area_dialog,i.setDataSet(a.dataSourceCur.name,l.name);break;case"getLength":i=MapCloud.gps_get_length_dialog,i.setDataSet(a.dataSourceCur.name,l.name);break;case"buffer":i=MapCloud.gps_buffer_dialog;var s=l.getFields();i.setDataSet(a.dataSourceCur.name,l.name,s);case"centroid":i=MapCloud.gps_centroid_dialog,i.setDataSet(a.dataSourceCur.name,l.name);break;case"convexHull":i=MapCloud.gps_convex_hull_dialog,i.setDataSet(a.dataSourceCur.name,l.name);break;case"multiPointToPoints":i=MapCloud.gps_multi_point_to_points_dialog,i.setDataSet(a.dataSourceCur.name,l.name);case"lineToPoints":i=MapCloud.gps_line_to_points_dialog,i.setDataSet(a.dataSourceCur.name,l.name);break;case"polygonToPoints":i=MapCloud.gps_polygon_to_points_dialog,i.setDataSet(a.dataSourceCur.name,l.name);break;case"polygonToLine":i=MapCloud.gps_polygon_to_line_dialog,i.setDataSet(a.dataSourceCur.name,l.name);break;case"genRandomPointsInPolgyon":i=MapCloud.gps_gen_random_points_in_polygon_dialog,i.setDataSet(a.dataSourceCur.name,l.name);case"delaunay":i=MapCloud.gps_delaunay_dialog;var s=l.getFields();i.setDataSet(a.dataSourceCur.name,l.name,s)}a.closeDialog()}),this.panel.find(".btn-add-server").click(function(){MapCloud.pgis_connection_dialog.showDialog("feature","feature")}),this.panel.find(".btn-remove-server").click(function(){a.removeDataSource()}),this.panel.find(".db-list").change(function(){var e=$(this).val();a.getDataSource(e)}),this.panel.find(".btn-import").click(function(){var e=a.panel.find(".db-list").val();return null==e?void MapCloud.notify.showInfo("请先选择一个数据源","Warning"):(MapCloud.import_dialog.showDialog("vector"),void MapCloud.import_dialog.setDataSourceName(e))}),this.panel.find(".btn-import-csv").click(function(){var e=a.panel.find(".db-list").val();return null==e?void MapCloud.notify.showInfo("请先选择一个数据源","Warning"):(MapCloud.importCSV_dialog.showDialog("vector"),void MapCloud.importCSV_dialog.setDataSourceName(e))}),this.panel.find(".btn-create-dataset").click(function(){a.createDataSet()}),this.panel.find(".btn-remove-dataset").click(function(){a.removeDataset()}),this.panel.find(".btn-refresh").click(function(){a.refresh()}),this.panel.find(".btn-infos").click(function(){$(this).attr("disabled",!0),a.panel.find(".btn-thum").attr("disabled",!1),a.panel.find(".table-pane").css("display","none"),a.panel.find(".server-pane").css("display","block"),a.panel.find(".server-pane .db-content").css("display","none"),a.panel.find(".db-infos-pane").css("display","block"),a.panel.find(".table-tree .nav a.selected").removeClass("selected")}),this.panel.find(".btn-thum").click(function(){$(this).attr("disabled",!0),a.panel.find(".btn-infos").attr("disabled",!1),a.panel.find(".table-pane").css("display","none"),a.panel.find(".server-pane").css("display","block"),a.panel.find(".server-pane .db-content").css("display","none"),a.panel.find(".db-thum-pane").css("display","block"),a.panel.find(".table-tree .nav a.selected").removeClass("selected")}),this.panel.find(".table-pane .btn-refresh-dataset").click(function(){var e=a.panel.find(".tree-table.selected"),t=e.attr("dindex");if(null!=a.dataSourceCur){var n=a.dataSourceCur.dataSets;if(null!=n){var l=n[t];null!=l&&a.dataSourceCur.refresh(l.name,a.refreshDataSet_callback)}}}),a.panel.find("#show-dataset-infos").click(function(){a.panel.find(".table-pane .btn-group .btn").attr("disabled",!1),$(this).attr("disabled",!0),null!=a.dataSetCur&&null==a.dataSetCur.geometryType&&a.panel.find("#show-dataset-preview").attr("disabled",!0),a.showDataSetInfosPanel(a.dataSetCur)}),a.panel.find("#show-dataset-fields").click(function(){a.panel.find(".table-pane .btn-group .btn").attr("disabled",!1),$(this).attr("disabled",!0),null!=a.dataSetCur&&null==a.dataSetCur.geometryType&&a.panel.find("#show-dataset-preview").attr("disabled",!0),a.showDataSetFieldsPanel(a.dataSetCur)}),a.panel.find("#show-dataset-features").click(function(){a.panel.find(".table-pane .btn-group .btn").attr("disabled",!1),$(this).attr("disabled",!0),null!=a.dataSetCur&&null==a.dataSetCur.geometryType&&a.panel.find("#show-dataset-preview").attr("disabled",!0),a.showDataSetFeaturesPanel(a.dataSetCur)}),a.panel.find("#show-dataset-preview").click(function(){a.panel.find(".table-pane .btn-group .btn").attr("disabled",!1),$(this).attr("disabled",!0),a.showDataSetPreviewPanel(a.dataSetCur)}),this.panel.find(".glyphicon-step-backward").each(function(){$(this).click(function(){var e=parseInt(a.panel.find(".pages-form-pages").html());e>=1&&a.setDataSetFeaturePage(1)})}),this.panel.find(".glyphicon-step-forward").each(function(){$(this).click(function(){var e=parseInt(a.panel.find(".pages-form-pages").html());e>=1&&a.setDataSetFeaturePage(e)})}),this.panel.find(".glyphicon-chevron-left").each(function(){$(this).click(function(){var e=parseInt(a.panel.find(".pages-form-page").val());a.setDataSetFeaturePage(e-1)})}),this.panel.find(".glyphicon-chevron-right").each(function(){$(this).click(function(){var e=parseInt(a.panel.find(".pages-form-page").val());a.setDataSetFeaturePage(e+1)})})},showDialog:function(a){var e=$("body").width(),t=this.panel.find(".modal-dialog").width();t>e&&(t=e-40,this.panel.find(".modal-dialog").css("width",t+"px")),MapCloud.notify.loading(),this.cleanup(),this.panel.modal(),this.getDataSources(),this.flag=a,null==this.flag?this.panel.find(".modal-footer").css("display","none"):(this.panel.find(".btn-confirm").html("选择"),this.panel.find(".modal-footer").css("display","block"))},getDataSources:function(){dbsManager.getDataSources(this.getDataSources_callback,"Feature")},cleanup:function(){this.flag=null,this.registerDataSourceName=null,this.panel.find(".db-pane").css("display","none"),this.panel.find(".server-pane").css("display","block"),this.panel.find(".db-list").empty(),this.panel.find(".db-list-div .nav").html(""),this.panel.find(".db-infos-pane table tbody").html(""),this.panel.find(".db-thum-pane ul").html(""),this.panel.find(".table-pane #dataset_infos table tbody").html(""),this.panel.find(".table-pane #dataset_fields table tbody").html(""),this.panel.find("#dataset_features_list table thead tr").html(""),this.panel.find(".table-pane #dataset_features table tbody").html(""),this.panel.find(".table-pane #dataset_preview img").css("src",""),this.panel.find(".query_count span").html(0),this.panel.find(".pages-form-page").val(0),this.panel.find(".pages-form-pages").html(0)},getDataSources_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.vector_db_dialog;e.showDataSources(a)},showDataSources:function(a){if(null!=a){for(var e=null,t=null,n="",l=a.length-1;l>=0;--l)e=a[l],null!=e&&(t=e.name,n+="<option value='"+t+"'>"+t+"</option>");if(this.panel.find(".db-list").html(n),null!=this.registerDataSourceName)this.panel.find(".db-list option[value='"+this.registerDataSourceName+"']").attr("selected",!0),this.getDataSource(this.registerDataSourceName),this.registerDataSourceName=null;else{var i=this.panel.find(".db-list").val();null!=i&&""!=i&&this.getDataSource(i)}}},getDataSource:function(a){null!=a&&(MapCloud.notify.loading(),this.panel.find(".db-infos-pane table tbody").html(""),this.panel.find(".db-thum-pane ul").html(""),this.panel.find(".table-tree .nav").html(""),this.panel.find(".query_count span").html(0),this.panel.find(".pages-form-page").val(0),this.panel.find(".pages-form-pages").html(0),this.panel.find(".table-pane #dataset_infos table tbody").html(""),this.panel.find(".table-pane #dataset_fields table tbody").html(""),this.panel.find("#dataset_features_list table thead tr").html(""),this.panel.find(".table-pane #dataset_features table tbody").html(""),this.panel.find(".table-pane #dataset_preview img").css("src",""),dbsManager.getDataSource(a,this.getDataSource_callback))},getDataSource_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.vector_db_dialog;e.dataSourceCur=a,e.getDataSets(a)},getDataSets:function(a){null!=a&&(MapCloud.notify.loading(),this.panel.find(".table-tree .nav").html(""),this.panel.find(".db-infos-pane table tbody").html(""),a.getDataSets(this.getDataSets_callback))},getDataSets_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.vector_db_dialog;e.showDataSets(a),e.showDataSetsPanel(a)},showDataSets:function(a){if(null!=a){var e=this;if(null!=this.dataSourceCur){for(var t="",n=null,l=null,i=null,s="",d=0;d<a.length;++d)n=a[d],null!=n&&(i=n.name,l=n.geometryType,s=this.getDataSetGeomTypeHtml(l),t+="<li>	<a href='#' class='tree-table' dindex='"+d+"'>"+s+"		<span title='"+i+"'>"+i+"</span>	</a></li>");e.panel.find(".table-tree .nav").html(t),e.panel.find(".tree-table").click(function(){var a=$(this).attr("dindex"),t=e.panel.find(".table-tree .nav a.selected").attr("dindex");if(a!=t){e.panel.find(".table-tree .nav a.selected").removeClass("selected"),$(this).addClass("selected");var n=$(this).find("span").html();e.getDataSet(n)}})}}},getDataSetGeomTypeHtml:function(a){var e="";switch(a){case GeoBeans.Geometry.Type.POINT:case GeoBeans.Geometry.Type.MULTIPOINT:e='<i class="mc-db-icon mc-db-icon-dataset-point"></i>';break;case GeoBeans.Geometry.Type.LINESTRING:case GeoBeans.Geometry.Type.MULTILINESTRING:e='<i class="mc-db-icon mc-db-icon-dataset-line"></i>';break;case GeoBeans.Geometry.Type.POLYGON:case GeoBeans.Geometry.Type.MULTIPOLYGON:e='<i class="mc-db-icon mc-db-icon-dataset-polygon"></i>';break;default:e='<i class="mc-db-icon mc-db-icon-dataset"></i>'}return e},showDataSetsPanel:function(a){this.panel.find(".db-pane").css("display","none"),this.panel.find(".server-pane").css("display","block");for(var e=this,t=null,n=null,l=null,i=null,s="",d=0;d<a.length;++d)t=a[d],n=t.name,l=t.geometryType,null==l&&(l=""),i=t.srid,null==i&&(i=""),s+="<tr>		<td><input type='checkbox'></td>		<td class='dataset-name' dindex='"+ +d+"'>"+n+"</td>		<td>"+l+"</td>		<td>"+i+"</td></tr>";this.panel.find(".server-pane .db-infos-pane table tbody").html(s),this.panel.find(".server-pane .dataset-name").click(function(){var a=$(this).attr("dindex");if(null!=e.dataSourceCur){var t=$(this).text();e.getDataSet(t),e.panel.find(".table-tree .nav li a[dindex='"+a+"']").addClass("selected")}}),s="";for(var o=null,d=0;d<a.length;++d)t=a[d],n=t.name,l=t.geometryType,null!=l&&(o=t.thumbnail,null!=o&&(s+="<li><a href='#' class='dataset-thum' dindex='"+d+"' style='background-image:url("+o+")'></a>"),s+="<div class='caption text-center'><h6 title='"+n+"'>"+n+"</h6></div></li>");this.panel.find(".server-pane .db-thum-pane ul").html(s),this.panel.find(".server-pane .db-thum-pane .dataset-thum").dblclick(function(){$(this).addClass("selected");var a=$(this).attr("dindex");if(null!=e.dataSourceCur){var t=$(this).parent().find("h6").text();e.getDataSet(t),e.panel.find(".table-tree .nav li a").removeClass("selected"),e.panel.find(".table-tree .nav li a[dindex='"+a+"']").addClass("selected")}}).hover(function(){e.panel.find(".server-pane .db-thum-pane .dataset-thum").removeClass("selected"),$(this).addClass("selected")})},removeDataset:function(){var a=MapCloud.vector_db_dialog.panel.find(".table-tree .tree-table.selected span").html();if(null!=a){if(!confirm("确定要删除数据["+a+"]吗?"))return;return void this.dataSourceCur.removeDataSet(a,this.removeDataSet_callback)}var e=this,t=this.panel.find(".server-pane .db-infos-pane table input[type='checkbox']:checked");if(0==t.length)return void MapCloud.notify.showInfo("请选择要删除的数据","Warning");if(confirm("确定要删除吗？")){var e=this;t.parents("tr").find(".dataset-name").each(function(){var a=$(this).html();e.dataSourceCur.removeDataSet(a,e.removeDataSet_callback)})}},removeDataSet_callback:function(a){var e="注销图层";MapCloud.notify.showInfo(a,e);var t=MapCloud.vector_db_dialog;t.panel.find(".server-pane table tbody").html(""),t.getDataSets(t.dataSourceCur)},getDataSet:function(a){null!=this.dataSourceCur&&this.dataSourceCur.getDataSet(a,this.getDataSet_callback)},getDataSet_callback:function(a){var e=MapCloud.vector_db_dialog;e.showDataSetPanel(a)},showDataSetPanel:function(a){this.dataSetCur=a,this.panel.find(".db-pane").css("display","none"),this.panel.find(".table-pane").css("display","block"),this.panel.find(".table-pane .dataset-pane").css("display","none"),this.panel.find(".table-pane #dataset_fields").css("display","block");var e=this.panel.find(".table-pane .btn-group .btn[disabled='disabled']").attr("id");switch(null==a.geometryType?(this.panel.find("#show-dataset-preview").attr("disabled",!0),"show-dataset-preview"==e&&(this.panel.find(".table-pane .btn-group .show-dataset-infos").attr("disabled",!0),e="show-dataset-infos")):"show-dataset-preview"!=e&&this.panel.find("#show-dataset-preview").attr("disabled",!1),e){case"show-dataset-infos":this.showDataSetInfosPanel(a);break;case"show-dataset-fields":this.showDataSetFieldsPanel(a);break;case"show-dataset-features":this.showDataSetFeaturesPanel(a);break;case"show-dataset-preview":this.showDataSetPreviewPanel(a)}},showDataSetInfosPanel:function(a){if(this.panel.find(".dataset-pane").css("display","none"),this.panel.find("#dataset_infos").css("display","block"),this.panel.find(".table-pane #dataset_infos table tbody").html(""),null!=a){html="<tr><td>名称</td><td>"+a.name+"</td></tr>",null!=a.type&&(html+="<tr><td>类型</td><td>"+a.type+"</td></tr>");var e=a.geometryType;null!=e&&(html+="<tr><td>几何类型</td><td>"+e+"</td></tr>");var t=a.count;null!=t&&(html+="<tr><td>个数</td><td>"+t+"</td></tr>");var n=a.srid;null!=n&&(html+="<tr><td>空间参考</td><td>"+n+"</td></tr>");var l=a.extent;null!=l&&(html+="	<tr>		<td>范围</td>		<td>东 :"+l.xmax+"</td>	</tr>	<tr>		<td></td>		<td>西 :"+l.xmin+"</td>	</tr>	<tr>		<td></td>		<td>南 :"+l.ymin+"</td>	</tr>	<tr>		<td></td>		<td>北 :"+l.ymax+"</td>	</tr>"),this.panel.find(".table-pane #dataset_infos table tbody").html(html)}},showDataSetFieldsPanel:function(a){if(this.panel.find(".dataset-pane").css("display","none"),this.panel.find("#dataset_fields").css("display","block"),this.panel.find(".table-pane #dataset_fields table tbody").html(""),null!=a){var e=a.getFields();if(null!=e){for(var t="",n=null,l=null,i=null,s=null,d=0;d<e.length;++d)n=e[d],l=n.name,i=n.type,s=n.length,t+="<tr>	<td>"+l+"	</td>	<td>"+i+"	</td>	<td>"+(null==s?"":s)+"	</td></tr>";this.panel.find("#dataset_fields table tbody").html(t)}}},showDataSetFeaturesPanel:function(a){if(this.panel.find(".dataset-pane").css("display","none"),this.panel.find("#dataset_features").css("display","block"),null!=a){var e=this.panel.find(".table-pane #dataset_features").attr("dsname");null==e&&this.panel.find(".table-pane #dataset_features").attr("dsname",a.name),this.panel.find(".table-pane #dataset_features").attr("dsname",a.name),this.panel.find(".table-pane #dataset_features table tbody").html("");var t=a.getFields();if(null!=t){this.displayDataSetFeaturesFields(t);var n=a.count,l=Math.ceil(n/this.maxFeatures);this.panel.find(".pages-form-pages").html(l),this.panel.find(".query_count span").html(n),l>=1?this.setDataSetFeaturePage(1):this.panel.find(".pages-form-page").val(0)}}},displayDataSetFeaturesFields:function(a){if(null!=a){for(var e=null,t=null,n="",l=0,i=0;i<a.length;++i)e=a[i],"geometry"!=e.type&&(t=e.name,n+="<th width='80'><nobr>"+t+"</nobr></th>",l+=1);this.panel.find("#dataset_features_list table thead tr").html(n)}},setDataSetFeaturePage:function(a){var e=parseInt(this.panel.find(".pages-form-pages").html());this.panel.find(".pages-form-page").val(a),1==a?this.panel.find(".glyphicon-step-backward").addClass("disabled"):this.panel.find(".glyphicon-step-backward").removeClass("disabled"),a==e?this.panel.find(".glyphicon-step-forward").addClass("disabled"):this.panel.find(".glyphicon-step-forward").removeClass("disabled"),0>=a-1?this.panel.find(".glyphicon-chevron-left").addClass("disabled"):this.panel.find(".glyphicon-chevron-left").removeClass("disabled"),a+1>e?this.panel.find(".glyphicon-chevron-right").addClass("disabled"):this.panel.find(".glyphicon-chevron-right").removeClass("disabled");var t=(a-1)*this.maxFeatures;MapCloud.notify.loading();var n=this.dataSetCur.getFieldsWithoutGeom();this.dataSetCur.getFeatures(this.maxFeatures,t,n,this.getFeatures_callback)},getFeatures_callback:function(a){MapCloud.notify.hideLoading();var e=MapCloud.vector_db_dialog;e.displayFeatures(a)},displayFeatures:function(a){if(null!=a){for(var e="",t=null,n=null,l=null,i=0;i<a.length;++i)if(t=a[i],null!=t&&(n=t.values,null!=n)){e+="<tr>";for(var s=0;s<n.length;++s)l=n[s],null!=l&&(l instanceof GeoBeans.Geometry||(e+="<td>"+l+"</td>"));e+="</tr>"}this.panel.find("#dataset_features_list table tbody").html(e)}},showDataSetPreviewPanel:function(a){this.panel.find("#dataset_preview_img").attr("src",null),this.panel.find(".dataset-pane").css("display","none"),this.panel.find("#dataset_preview").css("display","block"),null!=a&&null!=a.geometryType&&this.panel.find("#dataset_preview_img").attr("src",a.thumbnail)},removeDataSource:function(){var a=this.panel.find(".db-list").val();null!=a&&confirm("确定要删除["+a+"]数据库吗?")&&(this.panel.find(".table-pane").css("display","none"),this.panel.find(".server-pane").css("display","block"),this.panel.find(".db-infos-pane table tbody").html(""),this.panel.find(".table-tree .nav").html(""),this.panel.find(".db-thum-pane ul").html(""),this.panel.find(".query_count span").html(0),this.panel.find(".pages-form-page").val(0),this.panel.find(".pages-form-pages").html(0),this.panel.find(".table-pane #dataset_infos table tbody").html(""),this.panel.find(".table-pane #dataset_fields table tbody").html(""),this.panel.find("#dataset_features_list table thead tr").html(""),this.panel.find(".table-pane #dataset_features table tbody").html(""),this.panel.find(".table-pane #dataset_preview img").css("src",""),dbsManager.unRegisterDataSource(a,this.unRegisterDataSource_callback))},unRegisterDataSource_callback:function(a){var e="注销数据源";MapCloud.notify.showInfo(a,e);var t=MapCloud.vector_db_dialog;t.getDataSources()},refresh:function(){var a=this.panel.find(".db-list").val();return null==a?void MapCloud.notify.showInfo("请先选择一个数据源","Warning"):void this.getDataSource(a)},setRegisterDataSourceName:function(a){this.registerDataSourceName=a},refreshDataSet_callback:function(a){var e=MapCloud.vector_db_dialog,t=e.panel.find(".tree-table.selected span").html();MapCloud.notify.showInfo(a,"刷新["+t+"]"),"success"==a&&e.getDataSet(t)},createDataSet:function(){var a=this.panel.find(".db-list").val();return null==a?void MapCloud.notify.showInfo("请先选择一个数据源","Warning"):(MapCloud.create_dataset_dialog.showDialog("vector"),void MapCloud.create_dataset_dialog.setDataSourceName(a))}});
MapCloud.VersionDialog=MapCloud.Class(MapCloud.Dialog,{initialize:function(i){MapCloud.Dialog.prototype.initialize.apply(this,arguments)}});
MapCloud.WFSDatasourceDialog=MapCloud.Class(MapCloud.Dialog,{geomType:null,layer:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var n=this,e=null;this.panel.find("#wfsDatasourceDialogTab a").each(function(){$(this).click(function(a){a.preventDefault(),$(this).tab("show")})}),this.panel.find("#wfs_datasource_get_info").each(function(){$(this).click(function(){n.panel.find("#wfs_datasource_layer_url").each(function(){var a=$(this).val();if(""==a)return MapCloud.notify.showInfo("请输入WFS服务地址","Warning"),void n.panel.find("#wfs_datasource_layer_url").focus();var i="1.0.0",t=new GeoBeans.WFSWorkspace("world",a,i);return null==t?void MapCloud.notify.showInfo("error"):(e=t.getFeatureTypes(),null==e?void MapCloud.notify.showInfo("无法获取图层","Warning"):(n.displayLayers(e),void(n.types=e)))})})}),this.panel.find(".btn-confirm").each(function(){$(this).click(function(){var a=null;if(a=n.panel.find("#wfs_datasource_layer_name").val(),null==a||""==a)return MapCloud.notify.showInfo("输入图层名","Warning"),void n.panel.find("#wfs_datasource_layer_name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的图层名","Warning"),void n.panel.find("#wfs_datasource_layer_name").focus();if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");for(var i=mapObj.getLayers(),t=0;t<i.length;++t){var l=i[t];if(l.name==a)return MapCloud.notify.showInfo("图层名重复，请修改","Warning"),void n.panel.find("#wfs_datasource_layer_name").focus()}var o=null;if(o=n.panel.find("#wfs_datasource_layers option:selected").text(),null==o||""==o)return void MapCloud.notify.showInfo("设置有效的图层","Warning");var s=null;if(n.panel.find("#wfs_datasource_layer_url").each(function(){s=$(this).val()}),null==s||""==s)return MapCloud.notify.showInfo("请输入有效的地址","Warning"),void n.panel.find("#wfs_datasource_layer_url").focus();n.layer=new GeoBeans.Layer.WFSLayer(a,s,o,"GML2");var r=n.getFeatureType(o);if(null!=r){var f=r.extent;n.layer.extent=f}mapObj.addLayer(n.layer),null==mapObj.getViewer()&&mapObj.setViewer(new GeoBeans.Envelope(-180,-90,180,90)),mapObj.draw(),n.closeDialog(),MapCloud.refresh_panel.refreshPanel()})}),this.panel.find("#wfs_datasource_layers").each(function(){$(this).change(function(){var a=$(this).find("option:selected").attr("value"),i=e[a];if(null!=i){n.panel.find("#wfs_datasource_layer_epsg").each(function(){$(this).val(i.srs)});var t=i.extent;n.panel.find("#wfs_datasource_layer_xmin").each(function(){$(this).val(t.xmin)}),n.panel.find("#wfs_datasource_layer_ymin").each(function(){$(this).val(t.ymin)}),n.panel.find("#wfs_datasource_layer_xmax").each(function(){$(this).val(t.xmin)}),n.panel.find("#wfs_datasource_layer_ymax").each(function(){$(this).val(t.ymax)})}})})},destory:function(){MapCloud.Dialog.prototype.destory.apply(this,arguments)},cleanup:function(){this.panel.find("#wfs_datasource_layers").each(function(){$(this).empty()}),this.geomType=null,this.layer=null,this.types=null},displayLayers:function(a){this.panel.find("#wfs_datasource_layers").each(function(){$(this).empty()});for(var n=0;n<a.length;++n){var e=a[n];this.panel.find("#wfs_datasource_layers").each(function(){var a="<option value='"+n+"'>"+e.name+"</option>";$(this).append(a)})}var i=a[0];this.panel.find("#wfs_datasource_layer_epsg").each(function(){$(this).val(i.srs)});var t=i.extent;this.panel.find("#wfs_datasource_layer_xmin").each(function(){$(this).val(t.xmin)}),this.panel.find("#wfs_datasource_layer_ymin").each(function(){$(this).val(t.ymin)}),this.panel.find("#wfs_datasource_layer_xmax").each(function(){$(this).val(t.xmin)}),this.panel.find("#wfs_datasource_layer_ymax").each(function(){$(this).val(t.ymax)})},getFeatureType:function(a){if(null==this.types)return null;for(var n=null,e=0;e<this.types.length;++e)if(n=this.types[e],n.name==a)return n;return null}});
MapCloud.WMSDialog=MapCloud.Class(MapCloud.Dialog,{layer:null,wmsWorkspace:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);var a=this;this.panel.find("#wms_get_info").each(function(){$(this).click(function(){a.panel.find("#wms_url").each(function(){var n=$(this).val();if(""==n)return MapCloud.notify.showInfo("WMS地址为空，请输入","Warning"),void a.panel.find("#wms_url").focus();var i="1.3.0",o=a.panel.find("#wms_name").val();return""==o||void 0==o?(MapCloud.notify.showInfo("请输入WMS图层名称","Warning"),void a.panel.find("#wms_name").focus()):(a.wmsWorkspace=new GeoBeans.WMSWorkspace(o,n,i),MapCloud.notify.loading(),a.wmsWorkspace.getLayers(a.getLayersCallback),void a.panel.find("#wms_layers").html(""))})})}),this.panel.find(".btn-confirm").each(function(){$(this).click(function(){var n=null;if(a.panel.find("#wms_name").each(function(){n=$(this).val()}),null==n||""==n)return MapCloud.notify.showInfo("请输入WMS图层名称","Warning"),void a.panel.find("#wms_name").focus();var i=/^[0-9a-zA-Z_]+$/;if(!i.test(n))return MapCloud.notify.showInfo("请输入有效的图层名称","Warning"),void a.panel.find("#wms_name").focus();var o=null;if(a.panel.find("#wms_url").each(function(){o=$(this).val()}),null==o||""==o)return void MapCloud.notify.showInfo("WMS地址为空，请输入","Warning");var e=[];if(a.panel.find("input[name='wms_layer']:checked").each(function(){var n=$(this).val();e.push(n)}),0==e.length)return void MapCloud.notify.showInfo("请选择wms图层","Warning");var l=new GeoBeans.Layer.WMSLayer(n,o,e,null,null);return a.layer=l,MapCloud.wms_layer=a.layer,null==mapObj?void MapCloud.notify.showInfo("当前地图为空","Warning"):void mapObj.insertLayer(a.layer,a.insertLayer_callback)})})},destory:function(){MapCloud.Dialog.prototype.destory.apply(this,arguments)},cleanup:function(){this.panel.find("#wms_name").each(function(){$(this).empty()}),this.panel.find("#wms_layers").each(function(){$(this).empty()})},getLayersCallback:function(n){if(MapCloud.notify.hideLoading(),!$.isArray(n))return void MapCloud.notify.showInfo("获取WMS图层"+n,"Warning");for(var a,i,o,e,l="<list-group>",t=MapCloud.wms_dialog,r=0;r<n.length;++r)a=n[r],i=a.name,o=a.geomType,e=MapCloud.getLayerGeomTypeHtml(o),l+='<a href="#" class="list-group-item">'+e+i+'<input type="checkbox" name="wms_layer" value="'+i+'"></a>';l+="</list-group>",t.panel.find("#wms_layers").html(l)},insertLayer_callback:function(n){MapCloud.notify.showInfo(n,"添加WMS图层");var a=MapCloud.wms_dialog;mapObj.draw(),a.closeDialog(),MapCloud.refresh_panel.refreshPanel()}});
MapCloud.WMTSDialog=MapCloud.Class(MapCloud.Dialog,{sourceName:null,layer:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var a=this;a.panel.find(".btn-choose-tile").click(function(){MapCloud.tile_db_dialog.showDialog("wmtsLayer")}),a.panel.find(".btn-confirm").click(function(){if(null==mapObj)return void MapCloud.notify.showInfo("当前地图为空","Warning");var n=a.panel.find("#wmts_layer_name").val();if(null==n||""==n)return MapCloud.notify.showInfo("请输入图层名称","Warning"),void a.panel.find("#wmts_layer_name").focus();var l=/^[0-9a-zA-Z_]+$/;return l.test(n)?null==a.sourceName||null==a.layer?void MapCloud.notify.showInfo("请选择一个瓦片库","Warning"):(a.layer.name=n,void mapObj.insertLayer(a.layer,a.insertLayer_callback)):(MapCloud.notify.showInfo("请输入有效的图层名称","Warning"),void a.panel.find("#wmts_layer_name").focus())})},cleanup:function(){this.panel.find(".wmts-source-name").val(""),this.panel.find(".wmts-tile-store").val(""),this.panel.find("#wmts_layer_name").val(""),this.sourceName=null,this.layer=null},setWMTSLayer:function(a,n){this.sourceName=a,this.layer=n,this.panel.find(".wmts-source-name").val(a),null!=this.layer&&(this.panel.find(".wmts-tile-store").val(this.layer.name),this.panel.find("#wmts_layer_name").val(this.layer.name))},insertLayer_callback:function(a){if("success"!=a)MapCloud.notify.showInfo(a,"添加WMTS图层");else{mapObj.draw(),MapCloud.refresh_panel.refreshPanel();var n=MapCloud.wmts_dialog;n.closeDialog()}}});
MapCloud.GenRandomPointsInPolygonDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var o=n.panel.find(".modal-body").css("height");o=parseInt(o.slice(0,o.lastIndexOf("px")));var e=o+200;n.panel.find(".modal-body").css("height",e+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var o=n.panel.find(".modal-body").css("height");o=parseInt(o.slice(0,o.lastIndexOf("px")));var a=o-200;n.panel.find(".modal-body").css("height",a+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("genRandomPointsInPolgyon")}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("genRandomPointsInPolgyon","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==n.inputSourceName||null==n.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var o=n.panel.find(".gps-output-typename").val();if(""==o)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var e=/^[a-zA-Z][a-zA-Z0-9_]*$/;if(!e.test(o))return MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var a=n.panel.find(".gps-output-count").val();return $.isNumeric(a)?(a=parseInt(a),0>=a?(MapCloud.notify.showInfo("请输入正数","Warning"),void n.panel.find(".gps-output-count").focus()):a>1e3?(MapCloud.notify.showInfo("请输入小于1000的数","Warning"),void n.panel.find(".gps-output-count").focus()):(MapCloud.notify.loading(),void gpsManager.generateRandomPointsInPolygon(n.inputSourceName,n.inputTypeName,n.outputSourceName,o,a,n.generateRandomPointsInPolygon_callback))):(MapCloud.notify.showInfo("请输入随机生成点的个数","Warning"),void n.panel.find(".gps-output-count").focus())}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.panel.find(".gps-output-count").val(""),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(n,o){this.inputSourceName=n,this.inputTypeName=o,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(n){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},generateRandomPointsInPolygon_callback:function(n){MapCloud.notify.hideLoading();var o=MapCloud.gps_gen_random_points_in_polygon_dialog,e="<div class='row'>输入 [ 数据库 : "+o.inputSourceName+" ; 表 : "+o.inputTypeName+" ]; 输出 [ 数据库 : "+o.outputSourceName+"; 表 : "+o.panel.find(".gps-output-typename").val()+" ];  结果 : "+n+"</div>";o.panel.find(".gps-oper-log-div").append(e)}});
MapCloud.GPSBufferDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var e=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),e.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var n=e.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var a=n+200;e.panel.find(".modal-body").css("height",a+"px"),e.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var n=e.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var t=n-200;e.panel.find(".modal-body").css("height",t+"px"),e.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),e.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("buffer")}),e.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("buffer","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==e.inputSourceName||null==e.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==e.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var n=e.panel.find(".gps-output-typename").val();if(""==n)return void MapCloud.notify.showInfo("请输入输出的数据名称","Warning");var a=/^[a-zA-Z][a-zA-Z0-9_]*$/;if(!a.test(n))return MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void e.panel.find(".gps-output-typename").focus();var t=e.panel.find("input[name='buffer-diastance']:checked");if(t.hasClass("buffer-distance-radio")){var i=t.parents(".form-group").find("input[type='text']"),o=i.val();if(!$.isNumeric(o))return MapCloud.notify.showInfo("请输入缓冲区距离","Warning"),void t.parents(".form-group").find("input[type='text']").focus();if(o=parseFloat(o),0>=o)return MapCloud.notify.showInfo("请输入有效的缓冲区距离","Warning"),void t.parents(".form-group").find("input[type='text']").focus();MapCloud.notify.loading(),gpsManager.getBuffer(e.inputSourceName,e.inputTypeName,o,null,e.outputSourceName,n,e.buffer_callback)}else{var p=t.parents(".form-group").find("select"),u=p.val();MapCloud.notify.loading(),gpsManager.getBuffer(e.inputSourceName,e.inputTypeName,null,u,e.outputSourceName,n,e.buffer_callback)}}),this.panel.find(".gps-btn-reset").click(function(){e.cleanup()}),this.panel.find("input[name='buffer-diastance']").change(function(){e.panel.find("input[name='buffer-diastance']").parents(".form-group").find("input[type='text']").attr("disabled",!0),e.panel.find("input[name='buffer-diastance']").parents(".form-group").find("select").attr("disabled",!0),$(this).parents(".form-group").find("input[type='text']").attr("disabled",!1),$(this).parents(".form-group").find("select").attr("disabled",!1)})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(e,n,a){this.inputSourceName=e,this.inputTypeName=n,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName);for(var t=null,i="",o=0;o<a.length;++o)t=a[o],i+="<option value='"+t.name+"'>"+t.name+"</option>";this.panel.find(".gps-buffer-distance-field").html(i)},setOutputSource:function(e){this.outputSourceName=e,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},buffer_callback:function(e){MapCloud.notify.hideLoading();var n=MapCloud.gps_buffer_dialog,a="<div class='row'>输入 [ 数据库 : "+n.inputSourceName+" ; 表 : "+n.inputTypeName+" ]; 输出 [ 数据库 : "+n.outputSourceName+"; 表 : "+n.panel.find(".gps-output-typename").val()+" ];  结果 : "+e;n.panel.find(".gps-oper-log-div").append(a)}});
MapCloud.GPSBuildPyramidDialog=MapCloud.Class(MapCloud.Dialog,{outputSourceName:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=n.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var i=a+200;n.panel.find(".modal-body").css("height",i+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=n.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var l=a-200;n.panel.find(".modal-body").css("height",l+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.tile_db_dialog.showDialog("buildPyramid")}),this.panel.find(".gps-btn-oper-btn").click(function(){var a=n.panel.find(".gps-map-name").val();if(""==a)return void MapCloud.notify.showInfo("当前地图为空","Warning");if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var i=n.panel.find(".gps-tile-store").val();if(null==i)return void MapCloud.notify.showInfo("请输入瓦片库的名称","Warning");var l=n.panel.find(".gps-start-level").val();if(!$.isNumeric(l))return MapCloud.notify.showInfo("请输入起始级别","Warning"),void n.panel.find(".gps-start-level").focus();if(l=parseInt(l),0>=l||l>5)return MapCloud.notify.showInfo("请输入有效的起始级别","Warning"),void n.panel.find(".gps-start-level").focus();var e=n.panel.find(".gps-end-level").val();return $.isNumeric(e)?(e=parseInt(e),0>=e?(MapCloud.notify.showInfo("请输入有效的终止级别","Warning"),void n.panel.find(".gps-end-level").focus()):e>5?(MapCloud.notify.showInfo("最大级别为5","Warning"),void n.panel.find(".gps-end-level").focus()):l>e?void MapCloud.notify.showInfo("请输入有效的起止级别","Warning"):(MapCloud.notify.loading(),void gpsManager.buildPyramid(a,n.outputSourceName,i,l,e,n.buildPyramid_callback))):(MapCloud.notify.showInfo("请输入终止级别","Warning"),void n.panel.find(".gps-end-level").focus())}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},showDialog:function(){MapCloud.Dialog.prototype.showDialog.apply(this,arguments),null!=mapObj&&this.panel.find(".gps-map-name").val(mapObj.name)},cleanup:function(){this.outputSourceName=null,this.tileStoreName=null,this.panel.find(".gps-map-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-tile-store").val(""),this.panel.find(".gps-start-level").val("1"),this.panel.find(".gps-end-level").val("4"),this.panel.find(".gps-oper-log-div").empty()},setTileStore:function(n,a){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.tileStoreName=a,this.panel.find(".gps-tile-store").val(this.tileStoreName)},buildPyramid_callback:function(n){MapCloud.notify.hideLoading();var a=MapCloud.gps_build_pyramid_dialog,i="<div class='row'>"+n+"</div>";a.panel.find(".gps-oper-log-div").append(i)}});
MapCloud.GPSCentroidDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var t=e+200;n.panel.find(".modal-body").css("height",t+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var a=e-200;n.panel.find(".modal-body").css("height",a+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("centroid")}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("centroid","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==n.inputSourceName||null==n.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var e=n.panel.find(".gps-output-typename").val();if(""==e)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var t=/^[a-zA-Z][a-zA-Z0-9_]*$/;return t.test(e)?(MapCloud.notify.loading(),void gpsManager.getCentroid(n.inputSourceName,n.inputTypeName,n.outputSourceName,e,n.getCentroid_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void n.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(n,e){this.inputSourceName=n,this.inputTypeName=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(n){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},getCentroid_callback:function(n){MapCloud.notify.hideLoading();var e=MapCloud.gps_centroid_dialog,t="<div class='row'>输入 [ 数据库 : "+e.inputSourceName+" ; 表 : "+e.inputTypeName+" ]; 输出 [ 数据库 : "+e.outputSourceName+"; 表 : "+e.panel.find(".gps-output-typename").val()+" ];  结果 : "+n;e.panel.find(".gps-oper-log-div").append(t)}});
MapCloud.GPSConvexHullDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var a=e+200;n.panel.find(".modal-body").css("height",a+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var o=e-200;n.panel.find(".modal-body").css("height",o+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("convexHull")}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("convexHull","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==n.inputSourceName||null==n.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var e=n.panel.find(".gps-output-typename").val();if(""==e)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var a=/^[a-zA-Z][a-zA-Z0-9_]*$/;return a.test(e)?(MapCloud.notify.loading(),void gpsManager.convexHull(n.inputSourceName,n.inputTypeName,n.outputSourceName,e,n.convexHull_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void n.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(n,e){this.inputSourceName=n,this.inputTypeName=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(n){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},convexHull_callback:function(n){MapCloud.notify.hideLoading();var e=MapCloud.gps_convex_hull_dialog,a="<div class='row'>输入 [ 数据库 : "+e.inputSourceName+" ; 表 : "+e.inputTypeName+" ]; 输出 [ 数据库 : "+e.outputSourceName+"; 表 : "+e.panel.find(".gps-output-typename").val()+" ];  结果 : "+n;e.panel.find(".gps-oper-log-div").append(a)}});
MapCloud.GPSCsvImportDialog=MapCloud.Class(MapCloud.Dialog,{outputSourceName:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments),this.registerPanelEvent()},registerPanelEvent:function(){var a=this;this.panel.find("[data-toggle='tooltip']").tooltip({container:"body"}),a.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var l=a.panel.find(".modal-body").css("height");l=parseInt(l.slice(0,l.lastIndexOf("px")));var n=l+200;a.panel.find(".modal-body").css("height",n+"px"),a.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var l=a.panel.find(".modal-body").css("height");l=parseInt(l.slice(0,l.lastIndexOf("px")));var e=l-200;a.panel.find(".modal-body").css("height",e+"px"),a.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),a.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("csvImport")}),a.panel.find(".btn-choose-csv").click(function(){MapCloud.file_dialog.showDialog("csvImport")}),a.panel.find(".gps-btn-oper-btn").click(function(){return null==a.csvPath||null==a.csvName?void MapCloud.notify.showInfo("请选择要导入的CSV数据","Warning"):null==a.sourceName||null==a.typeName?void MapCloud.notify.showInfo("请选择要导入的数据库表格","Warning"):(MapCloud.notify.loading(),void gpsManager.csvImport(a.sourceName,a.typeName,a.csvPath,a.csvName,null,a.csvImport_callback))})},cleanup:function(){this.panel.find(".gps-csv-path").val(""),this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.csvName=null,this.csvPath=null,this.sourceName=null,this.typeName=null},setImportCsv:function(a){if(null!=a){this.panel.find(".gps-csv-path").val(a);var l=a.slice(a.lastIndexOf("/")+1,a.length),a=a.slice(0,a.lastIndexOf("/"));this.csvName=l,this.csvPath=a}},setDataSet:function(a,l){null!=a&&null!=l&&(this.sourceName=a,this.typeName=l.name,this.panel.find(".gps-input-source-name").val(this.sourceName),this.panel.find(".gps-input-type-name").val(this.typeName))},csvImport_callback:function(a){MapCloud.notify.hideLoading();var l="<div class='row'>导入到数据库："+a+"</div>",n=MapCloud.gps_csv_import_dialog;n.panel.find(".gps-oper-log-div").append(l)}});
MapCloud.GPSDelaunayDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var e=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),e.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var n=e.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var a=n+200;e.panel.find(".modal-body").css("height",a+"px"),e.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var n=e.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var i=n-200;e.panel.find(".modal-body").css("height",i+"px"),e.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),e.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("delaunay")}),e.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("delaunay","Feature")}),e.panel.find(".gps-z-field-checkbox").click(function(){var n=$(this).prop("checked");n?e.panel.find(".gps-z-field").attr("disabled",!1):e.panel.find(".gps-z-field").attr("disabled",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==e.inputSourceName||null==e.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");var n=null;if(e.panel.find(".gps-z-field-checkbox").prop("checked")&&(n=e.panel.find(".gps-z-field").val()),null==e.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var a=e.panel.find(".gps-output-typename").val();if(""==a)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void e.panel.find(".gps-output-typename").focus();var i=/^[a-zA-Z][a-zA-Z0-9_]*$/;return i.test(a)?(MapCloud.notify.loading(),void gpsManager.delaunay(e.inputSourceName,e.inputTypeName,n,e.outputSourceName,a,e.delaunay_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void e.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){e.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.panel.find(".gps-z-field").empty(),this.panel.find(".gps-z-field").attr("disabled",!0),this.panel.find(".gps-z-field-checkbox").prop("checked",!1),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(e,n,a){this.inputSourceName=e,this.inputTypeName=n,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName);for(var i=null,p="",t=0;t<a.length;++t)i=a[t],p+="<option value='"+i.name+"'>"+i.name+"</option>";this.panel.find(".gps-z-field").html(p)},setOutputSource:function(e){this.outputSourceName=e,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},delaunay_callback:function(e){MapCloud.notify.hideLoading();var n=MapCloud.gps_delaunay_dialog,a="<div class='row'>输入 [ 数据库 : "+n.inputSourceName+" ; 表 : "+n.inputTypeName+" ]; 输出 [ 数据库 : "+n.outputSourceName+"; 表 : "+n.panel.find(".gps-output-typename").val()+" ];  结果 : "+e;n.panel.find(".gps-oper-log-div").append(a)}});
MapCloud.GPSDemAspectDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("demAspect",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("demAspect",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.demAspect(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.demAspect_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath);var n=this.inputRasterName.lastIndexOf("."),s=this.inputRasterName.slice(n,this.inputRasterName.length);this.panel.find(".gps-output-raster-format").val(s)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},demAspect_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_dem_aspect_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSDemHillshadeDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a+200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a-200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("demHillshade",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("demHillshade",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return void MapCloud.notify.showInfo("请选择输出影像的名称","Warning");var n=/^[0-9a-zA-Z_]+$/;if(!n.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),t.panel.find(".gps-output-raster-name").focus(),void t.panel.find(".gps-output-azimuth").focus();var e=t.panel.find(".gps-output-raster-format").val();a+=e;var i=t.panel.find(".gps-output-azimuth").val();if(!$.isNumeric(i))return MapCloud.notify.showInfo("请输入方位角","Warning"),void t.panel.find(".gps-output-azimuth").focus();var s=t.panel.find(".gps-output-zenith").val();if(!$.isNumeric(s))return MapCloud.notify.showInfo("请输入高度角","Warning"),void t.panel.find(".gps-output-zenith").focus();var p=t.panel.find(".gps-output-zscale").val();return $.isNumeric(p)?(MapCloud.notify.loading(),void gpsManager.demHillshade(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,i,s,p,t.demHillshade_callback)):(MapCloud.notify.showInfo("请输入Z比例因子","Warning"),void t.panel.find(".gps-output-zscale").focus())}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-output-azimuth").val("135"),this.panel.find(".gps-output-zenith").val("45"),this.panel.find(".gps-output-zscale").val("1"),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,n){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=n,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath);var e=this.inputRasterName.lastIndexOf("."),i=this.inputRasterName.slice(e,this.inputRasterName.length);this.panel.find(".gps-output-raster-format").val(i)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},demHillshade_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_dem_hillshade_dialog,n=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),e="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+n+" ];  结果 : "+t+"</div>";a.panel.find(".gps-oper-log-div").append(e)}});
MapCloud.GPSDemSlopeDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("demSlope",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("demSlope",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.demSlope(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.demSlope_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath);var n=this.inputRasterName.lastIndexOf("."),i=this.inputRasterName.slice(n,this.inputRasterName.length);this.panel.find(".gps-output-raster-format").val(i)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},demSlope_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_dem_slope_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSDemStretchDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("demStretch",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("demStretch",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.demStretch(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.demStretch_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath);var n=this.inputRasterName.lastIndexOf("."),i=this.inputRasterName.slice(n,this.inputRasterName.length);this.panel.find(".gps-output-raster-format").val(i)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},demStretch_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_dem_stretch_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t+"</div>";a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSFeatureImportDialog=MapCloud.Class(MapCloud.Dialog,{paths:null,outputSourceName:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var i=t.panel.find(".modal-body").css("height");i=parseInt(i.slice(0,i.lastIndexOf("px")));var s=i+200;t.panel.find(".modal-body").css("height",s+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var i=t.panel.find(".modal-body").css("height");i=parseInt(i.slice(0,i.lastIndexOf("px")));var e=i-200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("featureImport","Feature")}),t.panel.find(".gps-oper-btn-add").click(function(){MapCloud.file_dialog.showDialog("gps-choose-shp")}),t.panel.find(".gps-oper-btn-remove").click(function(){t.removePath()}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()}),this.panel.find(".gps-btn-oper-btn").click(function(){t.importFeatures()})},cleanup:function(){this.outputSourceName=null,this.panel.find(".gps-output-source-name").val(""),this.panel.find(".import-list-div").empty(),this.panel.find(".gps-oper-log-div").empty()},setOutputSource:function(t){this.outputSourceName=t,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},addImportPaths:function(t){if(null==this.paths)this.paths=t;else for(var i=null,s=0;s<t.length;++s)i=t[s],-1==this.paths.indexOf(i)&&this.paths.push(i);this.setImportPaths(this.paths)},setImportPaths:function(t){for(var i=null,s="",e=null,a=0;a<t.length;++a)if(i=t[a],null!=i){var l=i.lastIndexOf("."),n=i.lastIndexOf("/");e=i.slice(n+1,l),s+="<div class='row'><div class='col-md-4 col-xs-4 fpath'>"+i+"</div><div class='col-md-2 col-xs-2'>public</div><div class='col-md-3 col-xs-3 col-md-edit fname'><span>"+e+"</span></div><div class='col-md-2 col-xs-2 col-md-edit fgeom'><span>shape</span></div><div class='col-md-1 col-xs-1 col-md-edit fsrid'><span>4326</span></div></div>"}this.panel.find(".import-list-div").html(s),this.panel.find(".import-list-div .col-md-edit").dblclick(function(){var t=$(this).find("span").html();if(void 0!=t){var i=$(this).css("width"),s=i.slice(0,i.lastIndexOf("px"));s-=2;var e="<input type='text' value='"+t+"' style='width:"+s+"px;padding:0px'>";$(this).html(e),$(this).css("padding","4px 2px 4px 2px");$(this).find("input").focus(),$(this).find("input").focusout(function(){var t=$(this).val();$(this).parent().html("<span>"+t+"</span>"),$(this).parent().css("padding","6px 2px 6px 2px")})}});var o=this;this.panel.find(".import-list-div .row").click(function(){o.panel.find(".import-list-div .row").removeClass("selected"),$(this).addClass("selected")})},removePath:function(){var t=this.panel.find(".import-list-div .row.selected");if(0==t.length)return void MapCloud.notify.showInfo("请选择一行记录进行删除","Warning");for(var i=t.find(".fpath").html(),s=0;s<this.paths.length;++s){var e=this.paths[s];if(e==i){this.paths.splice(s,1);break}}this.setImportPaths(this.paths)},getFeatures:function(){for(var t=this.panel.find(".import-list-div .row"),i=[],s=null,e=null,a=null,l=null,n=null,o=null,p=0;p<t.length;++p)e=t[p],a=$(e).find(".fpath").html(),l=$(e).find(".fname span").html(),n=$(e).find(".fgeom span").html(),o=$(e).find(".fsrid span").html(),s={path:a,name:l,geom:n,srid:o},i.push(s);return i},importFeatures:function(){if(null==this.outputSourceName)return void MapCloud.notify.showInfo("请选择要导入的数据库","Warning");if(null==this.paths||0==this.paths.length)return void MapCloud.notify.showInfo("请添加上传数据","Warning");var t=this.getFeatures();this.features=t;var i=t[0];null!=i&&this.importFeature(i)},importFeature:function(t){if(null!=t){var i=t.name,s=t.path,e=t.srid,a=t.geom,l=s.lastIndexOf("/"),n=s.slice(l+1,s.length);n=n.slice(0,n.lastIndexOf(".shp")),s=s.slice(0,l+1),MapCloud.notify.loading(),gpsManager.featureImport(this.outputSourceName,i,s,n,e,a,this.importFeature_callback)}},importFeature_callback:function(t){var i=MapCloud.gps_feature_import_dialog,s=i.features[0];if(null!=s){var e="<div class='row'>"+s.path+" : "+t+"</div>";i.features.splice(0,1),i.panel.find(".gps-oper-log-div").append(e)}if(MapCloud.notify.hideLoading(),null!=i.features){var a=i.features.length;if(a>=1){var l=i.features[0];i.importFeature(l)}}}});
MapCloud.GPSFeatureProjectDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,inputSrid:null,outputSourceName:null,outputSrid:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var n=t.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var e=n+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var n=t.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var i=n-200;t.panel.find(".modal-body").css("height",i+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("featureProject")}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("featureProject","Feature")}),t.panel.find(".btn-choose-output-srid").click(function(){MapCloud.gps_srid_dialog.showDialog("featureProject")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==t.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var n=t.panel.find(".gps-output-typename").val();if(""==n)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void t.panel.find(".gps-output-typename").focus();var e=/^[0-9a-zA-Z_]+$/;return e.test(n)?null==t.outputSrid?void MapCloud.notify.showInfo("请输入转换后的投影","Warning"):(MapCloud.notify.loading(),void gpsManager.featureProject(t.inputSourceName,t.inputTypeName,t.outputSourceName,n,t.outputSrid,t.featureProject_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void t.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-input-srid").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-output-srid").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.inputSrid=null,this.outputSourceName=null,this.outputSrid=null},setDataSet:function(t,n){null!=t&&null!=n&&(this.inputSourceName=t,this.inputTypeName=n.name,this.inputSrid=n.srid,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName),this.panel.find(".gps-input-srid").val(this.inputSrid))},setOutputSource:function(t){this.outputSourceName=t,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},setSrid:function(t){this.outputSrid=t,this.panel.find(".gps-output-srid").val(this.outputSrid)},featureProject_callback:function(t){MapCloud.notify.hideLoading();var n=MapCloud.gps_feature_project_dialog,e="<div class='row'>输入 [ 数据库 : "+n.inputSourceName+" ; 图层 : "+n.inputTypeName+"] ; 输出 [ 数据库 : "+n.outputSourceName+" ; 图层 : "+n.panel.find(".gps-output-typename").val()+" ; 空间参考 : "+n.outputSrid+" ]; 结果 : "+t+"</div>";n.panel.find(".gps-oper-log-div").append(e)}});
MapCloud.GPSGenRandomPointsDialog=MapCloud.Class(MapCloud.Dialog,{outputSourceName:null,outputSrid:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var o=n.panel.find(".modal-body").css("height");o=parseInt(o.slice(0,o.lastIndexOf("px")));var t=o+200;n.panel.find(".modal-body").css("height",t+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var o=n.panel.find(".modal-body").css("height");o=parseInt(o.slice(0,o.lastIndexOf("px")));var a=o-200;n.panel.find(".modal-body").css("height",a+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("genRandomPoints","Feature")}),n.panel.find(".btn-choose-output-srid").click(function(){MapCloud.gps_srid_dialog.showDialog("genRandomPoints")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var o=n.panel.find(".gps-output-typename").val();if(""==o)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var t=/^[0-9a-zA-Z_]+$/;if(!t.test(o))return MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var a=n.panel.find(".gps-output-count").val();if(!$.isNumeric(a))return MapCloud.notify.showInfo("请输入随机生成点的个数","Warning"),void n.panel.find(".gps-output-count").focus();if(a=parseInt(a),0>=a)return MapCloud.notify.showInfo("请输入正数","Warning"),void n.panel.find(".gps-output-count").focus();if(a>1e3)return MapCloud.notify.showInfo("请输入小于1000的数","Warning"),void n.panel.find(".gps-output-count").focus();if(null==n.outputSrid)return void MapCloud.notify.showInfo("请输入转换后的投影","Warning");var i=n.panel.find(".gps-output-xmin").val(),e=n.panel.find(".gps-output-xmax").val(),p=n.panel.find(".gps-output-ymin").val(),u=n.panel.find(".gps-output-ymax").val();if(i=parseFloat(i),e=parseFloat(e),p=parseFloat(p),u=parseFloat(u),"number"!=typeof i||"number"!=typeof e||"number"!=typeof p||"number"!=typeof u)return void MapCloud.notify.showInfo("请输入随机生成点的范围","Warning");var l=new GeoBeans.Envelope(i,p,e,u);MapCloud.notify.loading(),gpsManager.generateRandomPoints(n.outputSourceName,o,l,n.outputSrid,a,n.generateRandomPoints_callback)}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},cleanup:function(){this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-output-srid").val(""),this.panel.find(".gps-oper-log-div").empty(),this.panel.find(".gps-output-count").val(""),this.panel.find(".gps-output-xmin").val("-180.0"),this.panel.find(".gps-output-xmax").val("180.0"),this.panel.find(".gps-output-ymin").val("-90.0"),this.panel.find(".gps-output-ymax").val("90.0"),this.outputSrid=null,this.outputSourceName=null},setOutputSource:function(n){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},setSrid:function(n){this.outputSrid=n,this.panel.find(".gps-output-srid").val(this.outputSrid)},generateRandomPoints_callback:function(n){MapCloud.notify.hideLoading();var o=MapCloud.gps_gen_random_points_dialog,t="<div class='row'> 输出 [ 数据库 : "+o.outputSourceName+"; 表 : "+o.panel.find(".gps-output-typename").val()+" ];  结果 : "+n+"</div>";o.panel.find(".gps-oper-log-div").append(t)}});
MapCloud.GPSGetAreaDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var e=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),e.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var n=e.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var a=n+200;e.panel.find(".modal-body").css("height",a+"px"),e.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var n=e.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var t=n-200;e.panel.find(".modal-body").css("height",t+"px"),e.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),e.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("getArea")}),e.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("getArea","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==e.inputSourceName||null==e.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==e.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var n=e.panel.find(".gps-output-typename").val();if(""==n)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void e.panel.find(".gps-output-typename").focus();var a=/^[a-zA-Z][a-zA-Z0-9_]*$/;return a.test(n)?(MapCloud.notify.loading(),void gpsManager.getArea(e.inputSourceName,e.inputTypeName,e.outputSourceName,n,e.getArea_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void e.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){e.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(e,n){this.inputSourceName=e,this.inputTypeName=n,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(e){this.outputSourceName=e,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},getArea_callback:function(e){MapCloud.notify.hideLoading();var n=MapCloud.gps_get_area_dialog,a="<div class='row'>输入 [ 数据库 : "+n.inputSourceName+" ; 表 : "+n.inputTypeName+" ]; 输出 [ 数据库 : "+n.outputSourceName+"; 表 : "+n.panel.find(".gps-output-typename").val()+" ];  结果 : "+e;n.panel.find(".gps-oper-log-div").append(a)}});
MapCloud.GPSGetLengthDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(e){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var e=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),e.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var n=e.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var t=n+200;e.panel.find(".modal-body").css("height",t+"px"),e.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var n=e.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var a=n-200;e.panel.find(".modal-body").css("height",a+"px"),e.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),e.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("getLength")}),e.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("getLength","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==e.inputSourceName||null==e.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==e.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var n=e.panel.find(".gps-output-typename").val();if(""==n)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void e.panel.find(".gps-output-typename").focus();var t=/^[a-zA-Z][a-zA-Z0-9_]*$/;return t.test(n)?(MapCloud.notify.loading(),void gpsManager.getLength(e.inputSourceName,e.inputTypeName,e.outputSourceName,n,e.getLength_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void e.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){e.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(e,n){this.inputSourceName=e,this.inputTypeName=n,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(e){this.outputSourceName=e,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},getLength_callback:function(e){MapCloud.notify.hideLoading();var n=MapCloud.gps_get_length_dialog,t="<div class='row'>输入 [ 数据库 : "+n.inputSourceName+" ; 表 : "+n.inputTypeName+" ]; 输出 [ 数据库 : "+n.outputSourceName+"; 表 : "+n.panel.find(".gps-output-typename").val()+" ];  结果 : "+e;n.panel.find(".gps-oper-log-div").append(t)}});
MapCloud.GPSKMeanDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var a=e+200;n.panel.find(".modal-body").css("height",a+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var t=e-200;n.panel.find(".modal-body").css("height",t+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("kmean")}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("kmean","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==n.inputSourceName||null==n.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var e=n.panel.find(".gps-output-typename").val();if(""==e)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var a=/^[a-zA-Z][a-zA-Z0-9_]*$/;if(!a.test(e))return MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var t=n.panel.find(".gps-kmean-clusters").val();return $.isNumeric(t)?(t=parseInt(t),MapCloud.notify.loading(),void gpsManager.clusterKmean(n.inputSourceName,n.inputTypeName,n.outputSourceName,e,t,n.clusterKmean_callback)):(MapCloud.notify.showInfo("请输入聚类","Warning"),void n.panel.find(".gps-kmean-clusters").focus())}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-kmean-clusters").val("10"),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(n,e){this.inputSourceName=n,this.inputTypeName=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(n){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},clusterKmean_callback:function(n){MapCloud.notify.hideLoading();var e=MapCloud.gps_kmean_dialog,a="<div class='row'>输入 [ 数据库 : "+e.inputSourceName+" ; 表 : "+e.inputTypeName+" ]; 输出 [ 数据库 : "+e.outputSourceName+"; 表 : "+e.panel.find(".gps-output-typename").val()+" ];  结果 : "+n;e.panel.find(".gps-oper-log-div").append(a)}});
MapCloud.GPSLineToPointsDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var o=e+200;n.panel.find(".modal-body").css("height",o+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var i=e-200;n.panel.find(".modal-body").css("height",i+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("lineToPoints")}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("lineToPoints","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==n.inputSourceName||null==n.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var e=n.panel.find(".gps-output-typename").val();if(""==e)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var o=/^[a-zA-Z][a-zA-Z0-9_]*$/;return o.test(e)?(MapCloud.notify.loading(),void gpsManager.lineToPoints(n.inputSourceName,n.inputTypeName,n.outputSourceName,e,n.lineToPoints_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void n.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(n,e){this.inputSourceName=n,this.inputTypeName=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(n){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},lineToPoints_callback:function(n){MapCloud.notify.hideLoading();var e=MapCloud.gps_line_to_points_dialog,o="<div class='row'>输入 [ 数据库 : "+e.inputSourceName+" ; 表 : "+e.inputTypeName+" ]; 输出 [ 数据库 : "+e.outputSourceName+"; 表 : "+e.panel.find(".gps-output-typename").val()+" ];  结果 : "+n;e.panel.find(".gps-oper-log-div").append(o)}});
MapCloud.GPSMultiPointToPointsDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var t=n.panel.find(".modal-body").css("height");t=parseInt(t.slice(0,t.lastIndexOf("px")));var o=t+200;n.panel.find(".modal-body").css("height",o+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var t=n.panel.find(".modal-body").css("height");t=parseInt(t.slice(0,t.lastIndexOf("px")));var i=t-200;n.panel.find(".modal-body").css("height",i+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("multiPointToPoints")}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("multiPointToPoints","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==n.inputSourceName||null==n.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var t=n.panel.find(".gps-output-typename").val();if(""==t)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var o=/^[a-zA-Z][a-zA-Z0-9_]*$/;return o.test(t)?(MapCloud.notify.loading(),void gpsManager.multiPointToPoints(n.inputSourceName,n.inputTypeName,n.outputSourceName,t,n.multiPointToPoints_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void n.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(n,t){this.inputSourceName=n,this.inputTypeName=t,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(n){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},multiPointToPoints_callback:function(n){MapCloud.notify.hideLoading();var t=MapCloud.gps_multi_point_to_points_dialog,o="<div class='row'>输入 [ 数据库 : "+t.inputSourceName+" ; 表 : "+t.inputTypeName+" ]; 输出 [ 数据库 : "+t.outputSourceName+"; 表 : "+t.panel.find(".gps-output-typename").val()+" ];  结果 : "+n;t.panel.find(".gps-oper-log-div").append(o)}});
MapCloud.GPSOutputSourceDialog=MapCloud.Class(MapCloud.Dialog,{source:null,initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var a=this;this.panel.find(".btn-confirm").click(function(){var o=a.panel.find(".gps-output-source-list").val();if(null==o)return void a.closeDialog();var e=null;switch(a.source){case"kmean":e=MapCloud.gps_kmean_dialog;break;case"featureProject":e=MapCloud.gps_feature_project_dialog;break;case"featureImport":e=MapCloud.gps_feature_import_dialog;break;case"delaunay":e=MapCloud.gps_delaunay_dialog;break;case"getArea":e=MapCloud.gps_get_area_dialog;break;case"getLength":e=MapCloud.gps_get_length_dialog;break;case"buffer":e=MapCloud.gps_buffer_dialog;break;case"centroid":e=MapCloud.gps_centroid_dialog;break;case"convexHull":e=MapCloud.gps_convex_hull_dialog;break;case"multiPointToPoints":e=MapCloud.gps_multi_point_to_points_dialog;break;case"polygonToPoints":e=MapCloud.gps_polygon_to_points_dialog;break;case"lineToPoints":e=MapCloud.gps_line_to_points_dialog;break;case"polygonToLine":e=MapCloud.gps_polygon_to_line_dialog;break;case"genRandomPoints":e=MapCloud.gps_gen_random_points_dialog;break;case"genRandomPointsInPolgyon":e=MapCloud.gps_gen_random_points_in_polygon_dialog;break;case"buildPyramid":e=MapCloud.gps_build_pyramid_dialog;break;case"updateTile":e=MapCloud.gps_update_tile_dialog}null!=e&&e.setOutputSource(o),a.closeDialog()})},showDialog:function(a,o){MapCloud.Dialog.prototype.showDialog.apply(this,arguments),this.source=a,dbsManager.getDataSources(this.getDataSources_callback,o)},getDataSources_callback:function(a){var o=MapCloud.gps_output_source_dialog;o.showDataSources(a)},showDataSources:function(a){for(var o=null,e=null,l="",t=a.length-1;t>=0;--t)o=a[t],null!=o&&(e=o.name,l+="<option value='"+e+"'>"+e+"</option>");this.panel.find(".gps-output-source-list").html(l)}});
MapCloud.GPSPolygonToLineDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var o=e+200;n.panel.find(".modal-body").css("height",o+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var e=n.panel.find(".modal-body").css("height");e=parseInt(e.slice(0,e.lastIndexOf("px")));var a=e-200;n.panel.find(".modal-body").css("height",a+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("polygonToLine")}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("polygonToLine","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==n.inputSourceName||null==n.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var e=n.panel.find(".gps-output-typename").val();if(""==e)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var o=/^[a-zA-Z][a-zA-Z0-9_]*$/;return o.test(e)?(MapCloud.notify.loading(),void gpsManager.polygonToLine(n.inputSourceName,n.inputTypeName,n.outputSourceName,e,n.polygonToLine_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void n.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(n,e){this.inputSourceName=n,this.inputTypeName=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(n){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},polygonToLine_callback:function(n){MapCloud.notify.hideLoading();var e=MapCloud.gps_polygon_to_line_dialog,o="<div class='row'>输入 [ 数据库 : "+e.inputSourceName+" ; 表 : "+e.inputTypeName+" ]; 输出 [ 数据库 : "+e.outputSourceName+"; 表 : "+e.panel.find(".gps-output-typename").val()+" ];  结果 : "+n;e.panel.find(".gps-oper-log-div").append(o)}});
MapCloud.GPSPolygonToPointsDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputTypeName:null,outputSourceName:null,initialize:function(n){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var n=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),n.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var o=n.panel.find(".modal-body").css("height");o=parseInt(o.slice(0,o.lastIndexOf("px")));var e=o+200;n.panel.find(".modal-body").css("height",e+"px"),n.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var o=n.panel.find(".modal-body").css("height");o=parseInt(o.slice(0,o.lastIndexOf("px")));var t=o-200;n.panel.find(".modal-body").css("height",t+"px"),n.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),n.panel.find(".btn-choose-input").click(function(){MapCloud.vector_db_dialog.showDialog("polygonToPoints")}),n.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("polygonToPoints","Feature")}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==n.inputSourceName||null==n.inputTypeName)return void MapCloud.notify.showInfo("请选择输入的数据","Warning");if(null==n.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var o=n.panel.find(".gps-output-typename").val();if(""==o)return MapCloud.notify.showInfo("请输入输出的数据名称","Warning"),void n.panel.find(".gps-output-typename").focus();var e=/^[a-zA-Z][a-zA-Z0-9_]*$/;return e.test(o)?(MapCloud.notify.loading(),void gpsManager.polygonToPoints(n.inputSourceName,n.inputTypeName,n.outputSourceName,o,n.polygonToPoints_callback)):(MapCloud.notify.showInfo("请输入有效的输出数据名称","Warning"),void n.panel.find(".gps-output-typename").focus())}),this.panel.find(".gps-btn-reset").click(function(){n.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-type-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-typename").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputTypeName=null,this.outputSourceName=null},setDataSet:function(n,o){this.inputSourceName=n,this.inputTypeName=o,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-type-name").val(this.inputTypeName)},setOutputSource:function(n){this.outputSourceName=n,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},polygonToPoints_callback:function(n){MapCloud.notify.hideLoading();var o=MapCloud.gps_polygon_to_points_dialog,e="<div class='row'>输入 [ 数据库 : "+o.inputSourceName+" ; 表 : "+o.inputTypeName+" ]; 输出 [ 数据库 : "+o.outputSourceName+"; 表 : "+o.panel.find(".gps-output-typename").val()+" ];  结果 : "+n;o.panel.find(".gps-oper-log-div").append(e)}});
MapCloud.GPSRasterEdgeDetectDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("rasterEdgeDetect",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterEdgeDetect",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.rasterEdgeDetect(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.rasterEdgeDetect_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterEdgeDetect_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_edge_detect_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSRasterExtractDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,rasterExtent:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a+200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a-200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("rasterExtract",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterExtract",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=/^[0-9a-zA-Z_]+$/;if(!n.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=t.panel.find(".gps-output-raster-format").val();a+=e;var i=t.panel.find(".gps-output-raster-xmin").val(),s=t.panel.find(".gps-output-raster-xmax").val(),p=t.panel.find(".gps-output-raster-ymin").val(),r=t.panel.find(".gps-output-raster-ymax").val();if(!($.isNumeric(i)&&$.isNumeric(s)&&$.isNumeric(p)&&$.isNumeric(r)))return void MapCloud.notify.showInfo("请输入要截取的范围","Warning");if(i=parseFloat(i),s=parseFloat(s),p=parseFloat(p),r=parseFloat(r),i<t.rasterExtent.xmin)return MapCloud.notify.showInfo("请输入有效的范围","Warning"),void t.panel.find(".gps-output-raster-xmin").focus();if(p<t.rasterExtent.ymin)return MapCloud.notify.showInfo("请输入有效的范围","Warning"),void t.panel.find(".gps-output-raster-ymin").focus();if(s>t.rasterExtent.xmax)return MapCloud.notify.showInfo("请输入有效的范围","Warning"),void t.panel.find(".gps-output-raster-xmax").focus();if(r>t.rasterExtent.ymax)return MapCloud.notify.showInfo("请输入有效的范围","Warning"),void t.panel.find(".gps-output-raster-ymax").focus();if(i>s||p>r)return void MapCloud.notify.showInfo("请输入有效的范围","Warning");var l=new GeoBeans.Envelope(i,p,s,r);MapCloud.notify.loading(),gpsManager.rasterExtractByRectangle(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,l,t.rasterExtractByRectangle_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-input-raster-xmin").val(""),this.panel.find(".gps-input-raster-ymin").val(""),this.panel.find(".gps-input-raster-xmax").val(""),this.panel.find(".gps-input-raster-xmax").val(""),this.panel.find(".gps-input-raster-ymax").val(""),this.panel.find(".gps-output-raster-xmin").val(""),this.panel.find(".gps-output-raster-ymin").val(""),this.panel.find(".gps-output-raster-xmax").val(""),this.panel.find(".gps-output-raster-ymax").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null,this.rasterExtent=null},setRaster:function(t,a,n,e){if(this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=n,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath),null!=e){var i=e.extent;null!=i&&(this.rasterExtent=i,this.panel.find(".gps-input-raster-xmin").val(i.xmin),this.panel.find(".gps-input-raster-ymin").val(i.ymin),this.panel.find(".gps-input-raster-xmax").val(i.xmax),this.panel.find(".gps-input-raster-ymax").val(i.ymax))}var s=this.inputRasterName.lastIndexOf("."),p=this.inputRasterName.slice(s,this.inputRasterName.length);this.panel.find(".gps-output-raster-format").val(p)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterExtractByRectangle_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_extract_dialog,n=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),e="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+n+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(e)}});
MapCloud.GPSRasterGraylizeDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("rasterGraylize",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterGraylize",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.rasterGraylize(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.rasterGraylize_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterGraylize_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_graylize_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSRasterHisEquaDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("rasterHisEqual",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterHisEqual",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.rasterHisEqual(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.rasterHisEqual_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterHisEqual_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_his_equal_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSRasterPixelBlendDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName_1:null,inputRasterName_1:null,inputRasterPath_1:null,inputSourceName_2:null,inputRasterName_2:null,inputRasterPath_2:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster-1").click(function(){MapCloud.raster_db_dialog.showDialog("rasterPixelBlend-1",!1)}),t.panel.find(".btn-choose-input-raster-2").click(function(){MapCloud.raster_db_dialog.showDialog("rasterPixelBlend-2",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterPixelBlend",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName_1||null==t.inputRasterName_1||null==t.inputRasterPath_1)return void MapCloud.notify.showInfo("请选择输入影像-1","Warning");if(null==t.inputSourceName_2||null==t.inputRasterName_2||null==t.inputRasterPath_2)return void MapCloud.notify.showInfo("请选择输入影像-2","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return void MapCloud.notify.showInfo("请选择输出影像的名称","Warning");var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.rasterPixelBlend(t.inputSourceName_1,t.inputRasterName_1,t.inputRasterPath_1,t.inputSourceName_2,t.inputRasterName_2,t.inputRasterPath_2,t.outputSourceName,a,t.outputRasterPath,t.rasterPixelBlend_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name-1").val(""),this.panel.find(".gps-input-raster-name-1").val(""),this.panel.find(".gps-input-raster-path-1").val(""),this.panel.find(".gps-input-source-name-2").val(""),this.panel.find(".gps-input-raster-path-2").val(""),this.panel.find(".gps-input-raster-name-2").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName_1=null,this.inputRasterPath_1=null,this.inputRasterName_1=null,this.inputSourceName_2=null,this.inputRasterName_2=null,this.inputRasterPath_2=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster_1:function(t,a,e){this.inputSourceName_1=t,this.inputRasterName_1=a,this.inputRasterPath_1=e,this.panel.find(".gps-input-source-name-1").val(this.inputSourceName_1),this.panel.find(".gps-input-raster-name-1").val(this.inputRasterName_1),this.panel.find(".gps-input-raster-path-1").val(this.inputRasterPath_1)},setRaster_2:function(t,a,e){this.inputSourceName_2=t,this.inputRasterName_2=a,this.inputRasterPath_2=e,this.panel.find(".gps-input-source-name-2").val(this.inputSourceName_2),this.panel.find(".gps-input-raster-name-2").val(this.inputRasterName_2),this.panel.find(".gps-input-raster-path-2").val(this.inputRasterPath_2)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterPixelBlend_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_pixel_blend_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入-1 [ 数据库 : "+a.inputSourceName_1+" ; 路径 : "+a.inputRasterPath_1+" ; 影像 : "+a.inputRasterName_1+" ]; 输入-2 [ 数据库 : "+a.inputSourceName_2+" ; 路径 : "+a.inputRasterPath_2+" ; 影像 : "+a.inputRasterName_2+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSRasterReverseDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("rasterReverse",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterReverse",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return void MapCloud.notify.showInfo("请选择输出影像的名称","Warning");var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.rasterReverse(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.rasterReverse_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterReverse_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_reverse_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSRasterSepiaToneDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("rasterSepiaTone",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterSepiaTone",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.rasterSepiaTone(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.rasterSepiaTone_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterSepiaTone_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_sepia_tone_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSRasterSmoothDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a+200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a-200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("rasterSmooth",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterSmooth",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=/^[0-9a-zA-Z_]+$/;if(!n.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=t.panel.find(".gps-output-raster-format").val();a+=e;var s=t.panel.find(".gps-output-raster-operator").val();return null==s?void MapCloud.notify.showInfo("请选择一种滤波方式","Warning"):(MapCloud.notify.loading(),void gpsManager.rasterSmooth(t.inputSourceName,t.inputRasterName,t.inputRasterPath,s,t.outputSourceName,a,t.outputRasterPath,t.rasterSmooth_callback))}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,n){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=n,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath);var e=this.inputRasterName.lastIndexOf("."),s=this.inputRasterName.slice(e,this.inputRasterName.length);this.panel.find(".gps-output-raster-format").val(s)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterSmooth_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_smooth_dialog,n=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),e="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+n+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(e)}});
MapCloud.GPSRasterStretchDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("rasterStretch",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterStretch",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.rasterStretch(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.rasterStretch_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath);var n=this.inputRasterName.lastIndexOf("."),s=this.inputRasterName.slice(n,this.inputRasterName.length);this.panel.find(".gps-output-raster-format").val(s)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterStretch_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_stretch_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSRasterSubtractDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName_1:null,inputRasterName_1:null,inputRasterPath_1:null,inputSourceName_2:null,inputRasterName_2:null,inputRasterPath_2:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a+200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a-200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster-1").click(function(){MapCloud.raster_db_dialog.showDialog("rasterSubtract-1",!1)}),t.panel.find(".btn-choose-input-raster-2").click(function(){MapCloud.raster_db_dialog.showDialog("rasterSubtract-2",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterSubtract",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName_1||null==t.inputRasterName_1||null==t.inputRasterPath_1)return void MapCloud.notify.showInfo("请选择输入影像-1","Warning");if(null==t.inputSourceName_2||null==t.inputRasterName_2||null==t.inputRasterPath_2)return void MapCloud.notify.showInfo("请选择输入影像-2","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=/^[0-9a-zA-Z_]+$/;if(!n.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=t.panel.find(".gps-output-raster-format").val();a+=e,MapCloud.notify.loading(),gpsManager.rasterSubtract(t.inputSourceName_1,t.inputRasterName_1,t.inputRasterPath_1,t.inputSourceName_2,t.inputRasterName_2,t.inputRasterPath_2,t.outputSourceName,a,t.outputRasterPath,t.rasterSubtract_callback)}),this.panel.find(".gps-btn-reset").click(function(){t.cleanup()})},cleanup:function(){this.panel.find(".gps-input-source-name-1").val(""),this.panel.find(".gps-input-raster-name-1").val(""),this.panel.find(".gps-input-raster-path-1").val(""),this.panel.find(".gps-input-source-name-2").val(""),this.panel.find(".gps-input-raster-path-2").val(""),this.panel.find(".gps-input-raster-name-2").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName_1=null,this.inputRasterPath_1=null,this.inputRasterName_1=null,this.inputSourceName_2=null,this.inputRasterName_2=null,this.inputRasterPath_2=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster_1:function(t,a,n){this.inputSourceName_1=t,this.inputRasterName_1=a,this.inputRasterPath_1=n,this.panel.find(".gps-input-source-name-1").val(this.inputSourceName_1),this.panel.find(".gps-input-raster-name-1").val(this.inputRasterName_1),this.panel.find(".gps-input-raster-path-1").val(this.inputRasterPath_1)},setRaster_2:function(t,a,n){this.inputSourceName_2=t,this.inputRasterName_2=a,this.inputRasterPath_2=n,this.panel.find(".gps-input-source-name-2").val(this.inputSourceName_2),this.panel.find(".gps-input-raster-name-2").val(this.inputRasterName_2),this.panel.find(".gps-input-raster-path-2").val(this.inputRasterPath_2)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterSubtract_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_subtract_dialog,n=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),e="<div class='row'>输入-1 [ 数据库 : "+a.inputSourceName_1+" ; 路径 : "+a.inputRasterPath_1+" ; 影像 : "+a.inputRasterName_1+" ]; 输入-2 [ 数据库 : "+a.inputSourceName_2+" ; 路径 : "+a.inputRasterPath_2+" ; 影像 : "+a.inputRasterName_2+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+n+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(e)}});
MapCloud.GPSRasterThresholdDialog=MapCloud.Class(MapCloud.Dialog,{inputSourceName:null,inputRasterName:null,inputRasterPath:null,outputSourceName:null,outputRasterPath:null,initialize:function(t){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var t=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),t.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var e=a+200;t.panel.find(".modal-body").css("height",e+"px"),t.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var a=t.panel.find(".modal-body").css("height");a=parseInt(a.slice(0,a.lastIndexOf("px")));var n=a-200;t.panel.find(".modal-body").css("height",n+"px"),t.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),t.panel.find(".btn-choose-input-raster").click(function(){MapCloud.raster_db_dialog.showDialog("rasterThreshold",!1)}),t.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.raster_db_dialog.showDialog("rasterThreshold",!0)}),this.panel.find(".gps-btn-oper-btn").click(function(){if(null==t.inputSourceName||null==t.inputRasterName||null==t.inputRasterPath)return void MapCloud.notify.showInfo("请选择输入的影像","Warning");if(null==t.outputSourceName||null==t.outputRasterPath)return void MapCloud.notify.showInfo("请选择输出影像的位置","Warning");var a=t.panel.find(".gps-output-raster-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请选择输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(a))return MapCloud.notify.showInfo("请输入有效的输出影像的名称","Warning"),void t.panel.find(".gps-output-raster-name").focus();var n=t.panel.find(".gps-output-raster-format").val();a+=n,MapCloud.notify.loading(),gpsManager.rasterThreshold(t.inputSourceName,t.inputRasterName,t.inputRasterPath,t.outputSourceName,a,t.outputRasterPath,t.rasterThreshold_callback)})},cleanup:function(){this.panel.find(".gps-input-source-name").val(""),this.panel.find(".gps-input-raster-path").val(""),this.panel.find(".gps-input-raster-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-output-raster-path").val(""),this.panel.find(".gps-output-raster-name").val(""),this.panel.find(".gps-oper-log-div").empty(),this.inputSourceName=null,this.inputRasterName=null,this.inputRasterPath=null,this.outputSourceName=null,this.outputRasterPath=null},setRaster:function(t,a,e){this.inputSourceName=t,this.inputRasterName=a,this.inputRasterPath=e,this.panel.find(".gps-input-source-name").val(this.inputSourceName),this.panel.find(".gps-input-raster-name").val(this.inputRasterName),this.panel.find(".gps-input-raster-path").val(this.inputRasterPath)},setOutput:function(t,a){this.outputSourceName=t,this.outputRasterPath=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName),this.panel.find(".gps-output-raster-path").val(this.outputRasterPath)},rasterThreshold_callback:function(t){MapCloud.notify.hideLoading();var a=MapCloud.gps_raster_threshold_dialog,e=a.panel.find(".gps-output-raster-name").val()+a.panel.find(".gps-output-raster-format").val(),n="<div class='row'>输入 [ 数据库 : "+a.inputSourceName+" ; 路径 : "+a.inputRasterPath+" ; 影像 : "+a.inputRasterName+" ]; 输出 [ 数据库 : "+a.outputSourceName+" ; 路径 :  "+a.outputRasterPath+"; 影像 : "+e+" ];  结果 : "+t;a.panel.find(".gps-oper-log-div").append(n)}});
MapCloud.GPSSridDialog=MapCloud.Class(MapCloud.Dialog,{maxCount:10,pageCount:null,pageNumber:5,source:null,initialize:function(i){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var i=this;this.panel.find(".btn-search-srid").click(function(){var a=i.panel.find(".search-srid-name").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入查询Srid","Warning"),void i.panel.find(".search-srid-name").focus();var e=/^[0-9]+$/;return e.test(a)?(MapCloud.notify.loading(),i.panel.find(".srid-list-div").html(""),void gpsManager.getSpatialReferenceBySrid(a,i.getSpatialReferenceBySrid_callback)):(MapCloud.notify.showInfo("请输入一个有效的查询值","Warning"),void i.panel.find(".search-srid-name").focus())}),this.panel.find(".btn-confirm").click(function(){if("featureProject"==i.source){var a=i.panel.find(".srid-list-div .row.selected"),e=a.attr("sname");if(null==e)return void MapCloud.notify.showInfo("请选择一个空间参考","Warning");var t=MapCloud.gps_feature_project_dialog;t.setSrid(e)}else if("genRandomPoints"==i.source){var a=i.panel.find(".srid-list-div .row.selected"),e=a.attr("sname");if(null==e)return void MapCloud.notify.showInfo("请选择一个空间参考","Warning");var t=MapCloud.gps_gen_random_points_dialog;t.setSrid(e)}i.closeDialog()})},showDialog:function(i){var a=$("body").width(),e=this.panel.find(".modal-dialog").width();e>a&&(e=a-40,this.panel.find(".modal-dialog").css("width",e+"px")),MapCloud.Dialog.prototype.showDialog.apply(this,arguments),this.source=i,this.getSpatialReferenceListCount()},cleanup:function(){this.panel.find(".srid-list-div").empty(),this.panel.find(".search-srid-name").val(),this.panel.find(".pagination").empty(),this.panel.find(".search-srid-name").val("")},getSpatialReferenceList:function(i,a){gpsManager.getSpatialReferenceList(i,a,this.getSpatialReferenceList_callback)},getSpatialReferenceListCount:function(){gpsManager.getSpatialReferenceCount(this.getSpatialReferenceListCount_callback)},getSpatialReferenceListCount_callback:function(i){if(null!=i){var a=MapCloud.gps_srid_dialog,e=Math.ceil(i/a.maxCount);a.pageCount=e,a.initPageControl(1,a.pageCount)}},getSpatialReferenceList_callback:function(i){var a=MapCloud.gps_srid_dialog;a.showSridList(i)},setSpatialReferenceList:function(i){this.list=i;var a=Math.ceil(i.length/this.maxCount);this.pageCount=a,this.initPageControl(1,this.pageCount)},initPageControl:function(i,a){if(!(0>=i||i>a)){var e="";if(e+=1==i?'<li class="disabled">		<a href="#" aria-label="Previous">			<span aria-hidden="true">«</span>		</a>	</li>':'<li>		<a href="#" aria-label="Previous">			<span aria-hidden="true">«</span>		</a>	</li>',a<=this.pageNumber)for(var t=1;a>=t;++t)e+=t==i?'<li class="active">	<a href="#">'+i.toString()+'		<span class="sr-only">(current)</span></a></li>':"<li><a href='#'>"+t+"</a></li>";else{var n=a-this.pageNumber+1;if(n>=i)for(var t=i;t<i+this.pageNumber;++t)e+=t==i?'<li class="active">	<a href="#">'+i+"</a></li>":"<li><a href='#'>"+t+"</a></li>";else for(var t=n;a>=t;++t)e+=t==i?'<li class="active">	<a href="#">'+i+"</a></li>":"<li><a href='#'>"+t+"</a></li>"}e+=i==a?'<li class="disabled">		<a href="#" aria-label="Next">			<span aria-hidden="true">»</span>		</a>	</li>':'<li>		<a href="#" aria-label="Next">			<span aria-hidden="true">»</span>		</a>	</li>',this.panel.find(".pagination").html(e),this.registerPageEvent();var l=(i-1)*this.maxCount;this.getSpatialReferenceList(this.maxCount,l)}},registerPageEvent:function(){var i=this;this.panel.find(".pagination li a").click(function(){var a=i.panel.find(".pagination li.active a").html(),e=parseInt(a),t=$(this).attr("aria-label");"Previous"==t?e-=1:"Next"==t?e+=1:e=parseInt($(this).html()),i.initPageControl(e,i.pageCount)})},showSridList:function(i){if(null!=i){for(var a=null,e="",t=0;t<=i.length;++t)a=i[t],null!=a&&(e+="<div class='row' sname='"+a.srid+"'><div class='col-md-1 col-xs-1'>"+a.srid+"</div><div class='col-md-11 col-xs-11 text-ellip'>"+a.srtext+"</div></div>");this.panel.find(".srid-list-div").html(e);var n=this;this.panel.find(".srid-list-div .row").click(function(){n.panel.find(".srid-list-div .row.selected").removeClass("selected"),$(this).addClass("selected")})}},getSpatialReferenceBySrid_callback:function(i){if(MapCloud.notify.hideLoading(),null!=i&&0!=i.length){var a=MapCloud.gps_srid_dialog;a.showSridList(i)}}});
MapCloud.GPSUpdateTileDialog=MapCloud.Class(MapCloud.Dialog,{initialize:function(a){MapCloud.Dialog.prototype.initialize.apply(this,arguments);this.registerPanelEvent()},registerPanelEvent:function(){var a=this;this.panel.find('[data-toggle="tooltip"]').tooltip({container:"body"}),a.panel.find(".gps-oper-btn-log").click(function(){if($(this).hasClass("log-col")){var n=a.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var i=n+200;a.panel.find(".modal-body").css("height",i+"px"),a.panel.find(".gps-oper-log-wrapper").slideDown(500),$(this).find("i").removeClass("fa-chevron-down").addClass("fa-chevron-up"),$(this).removeClass("log-col").addClass("log-exp")}else{var n=a.panel.find(".modal-body").css("height");n=parseInt(n.slice(0,n.lastIndexOf("px")));var o=n-200;a.panel.find(".modal-body").css("height",o+"px"),a.panel.find(".gps-oper-log-wrapper").slideUp(500),$(this).find("i").removeClass("fa-chevron-up").addClass("fa-chevron-down"),$(this).removeClass("log-exp").addClass("log-col")}}),a.panel.find(".btn-choose-output-source-name").click(function(){MapCloud.gps_output_source_dialog.showDialog("updateTile")}),this.panel.find(".gps-btn-oper-btn").click(function(){var n=a.panel.find(".gps-map-name").val();if(""==n)return void MapCloud.notify.showInfo("当前地图为空","Warning");if(null==a.outputSourceName)return void MapCloud.notify.showInfo("请选择输出的数据库","Warning");var i=a.panel.find(".gps-tile-store").val();if(null==i)return void MapCloud.notify.showInfo("请输入瓦片库的名称","Warning");var o=a.panel.find(".gps-level").val();if(""==o)return void MapCloud.notify.showInfo("请输入级别","Warning");var l=a.panel.find(".gps-tile-row");if(""==l)return void MapCloud.notify.showInfo("请输入行号","Warning");var e=a.panel.find(".gps-tile-col");return""==e?void MapCloud.notify.showInfo("请输入列号","Warning"):(MapCloud.notify.loading(),void gpsManager.updateTile(n,a.outputSourceName,i,o,l,e,a.updateTile_callback))}),this.panel.find(".gps-btn-reset").click(function(){a.cleanup()})},cleanup:function(){this.panel.find(".gps-map-name").val(""),this.panel.find(".gps-output-source-name").val(""),this.panel.find(".gps-tile-store").val(""),this.panel.find(".gps-level").val(""),this.panel.find(".gps-tile-row").val(""),this.panel.find(".gps-tile-col").val(""),this.panel.find(".gps-oper-log-div").empty()},showDialog:function(){MapCloud.Dialog.prototype.showDialog.apply(this,arguments),null!=mapObj&&this.panel.find(".gps-map-name").val(mapObj.name)},setOutputSource:function(a){this.outputSourceName=a,this.panel.find(".gps-output-source-name").val(this.outputSourceName)},updateTile_callback:function(a){MapCloud.notify.hideLoading();var n=MapCloud.gps_update_tile_dialog,i="<div class='row'>"+a+"</div>";n.panel.find(".gps-oper-log-div").append(i)}});