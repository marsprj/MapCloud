var authManager=null;$().ready(function(){cookieObj=new MapCloud.Cookie;var a=cookieObj.getCookie("username");if(admin=null,null!=a&&(admin=new GeoBeans.User(a)),null!=admin){var e="/ows/admin/mgr";authManager=new GeoBeans.AuthManager(e),MapCloud.notify=new MapCloud.Notify("container","alert_loading"),MapCloud.usePanel=new MapCloud.UsePanel("use_panel"),MapCloud.usePanel.getUseStat()}});
MapCloud.UsePanel=MapCloud.Class({panel:null,initialize:function(t){this.panel=$("#"+t),this.registerPanelEvent()},registerPanelEvent:function(){var t=this;t.loadGluster(),this.panel.find("[data-toggle='tooltip']").tooltip()},getUseStat:function(){var t=free.slice(0,free.length-1),e=used.slice(0,used.length-1);t=parseFloat(t),e=parseFloat(e),option={title:{text:"分布式文件系统",x:"center"},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"vertical",x:"left",data:["已使用空间","未使用空间"]},toolbox:{show:!0,feature:{dataView:{show:!0,readOnly:!1},restore:{show:!0},saveAsImage:{show:!0}}},calculable:!0,series:[{name:"分布式文件系统",type:"pie",radius:"55%",center:["30%","60%"],data:[{value:e,name:"已使用空间"},{value:t,name:"未使用空间"}],itemStyle:{normal:{label:{position:"inner",formatter:function(t){return(t.percent-0).toFixed(0)+"%"}},labelLine:{show:!1}}}}],animation:!1};var n=echarts.init(document.getElementById("use_chart"),"macarons");n.setOption(option),this.panel.find("#total_size").html(total),this.panel.find("#used_size").html(used),this.panel.find("#free_size").html(free),this.panel.find("#usage_size").html(usage)},loadGluster:function(){var t="js/gluster.xml",e=this;$.get(t,function(t){e.praseXML(t)})},praseXML:function(t){if(null!=t){var e=$(t).find("Count").text(),n=[];$(t).find("Nodes>Node").each(function(){var t=$(this).find("Host").text(),e=$(this).find("Uuid").text(),a=$(this).find("State").text(),i={host:t,uuid:e,state:a};n.push(i)});var a={count:e,nodes:n},i=MapCloud.usePanel;i.showGluster(a)}},showGluster:function(t){if(null!=t){var e=t.count;this.panel.find("#gluster_node span").html(e);var n=t.nodes;if(null!=n){for(var a=null,i="",l=0;l<n.length;++l)a=n[l],null!=a&&(i+="<tr>\t<td class='td-width-20'>"+a.host+"</td>\t<td  class='td-width-45'>"+a.uuid+"</td>\t<td  class='td-width-35'>"+a.state+"</td></tr>");this.panel.find("#gluster_panel tbody").html(i)}}}});