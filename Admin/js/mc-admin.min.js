var g_catalog=[{name:"用户管理",icon:"user.png",link:"admin_users.html"},{name:"数据管理",icon:"db.png",link:"admin_data.html"},{name:"节点管理",icon:"monitor.png",link:"http://ourgis.digitalearth.cn/monitor/"},{name:"API",icon:"note.png",link:"../API/index_admin.html"}];
function loadLoginPanel(){$(".user-panel").css("display","none"),$(".login-panel").css("display","block")}function logout_callback(a){MapCloud.notify.showInfo(a,"注销"),"success"==a&&(MapCloud.accountPanel.hideRegisterPanel(),MapCloud.accountPanel.hideUserpPanel(),MapCloud.accountPanel.showLoginPanel(),admin.logout(),MapCloud.cookieObj.delCookie("username","/MapCloud"))}function loadCatalog(){$(".login-panel").css("display","none"),$(".user-panel").css("display","block");for(var a="",o=g_catalog.length,n=null,l=null,e=null,i=0;o>i;i++){var c=g_catalog[i];n=c.name,e=c.icon,l=c.link,a+="<div class='catalog-item' onclick='onItemClick(\""+n+'","'+l+"\");' iname='"+n+"'>	<img src='../images/"+e+"'>	<h5>"+n+"</h5></div>"}document.getElementById("catalog_container").innerHTML=a,$(".catalog-item").first().addClass("selected")}var admin=null,cookieObj=null;$().ready(function(){cookieObj=new MapCloud.Cookie;var a=cookieObj.getCookie("username");null!=a&&"admin"==a&&(admin=new GeoBeans.User(a)),MapCloud.notify=new MapCloud.Notify("container","alert_loading"),MapCloud.accountPanel=new MapCloud.AccountPanel("login-panel","register-panel");var o="/ows/admin/mgr";authManager=new GeoBeans.AuthManager(o),MapCloud.cookieObj=new MapCloud.Cookie,null==admin?loadLoginPanel():loadCatalog(),$("#user_logout").click(function(){confirm("确定要退出当前账户吗？")&&(MapCloud.notify.loading(),authManager.logout(admin.name,logout_callback))})});
MapCloud.AccountPanel=MapCloud.Class({loginPanel:null,loginName:null,registerPanel:null,registerName:null,initialize:function(n,e){this.loginPanel=$("."+n),this.registerPanel=$("."+e);var i=this;this.loginPanel.find(".btn-account").click(function(){i.login()}),this.loginPanel.find(".btn-register").click(function(){i.hideLoginPanel(),i.hideUserpPanel(),i.showRegisterPanel()}),this.loginPanel.find("input[name='password']").keypress(function(n){13==n.which&&i.login()}),this.registerPanel.find(".btn-account").click(function(){i.register()}),this.registerPanel.find(".btn-login").click(function(){i.hideRegisterPanel(),i.hideUserpPanel(),i.showLoginPanel()}),this.registerPanel.find("input[name='repassword']").keypress(function(n){13==n.which&&i.register()}),this.registerPanel.find("input[name='password']").bind("keyup onfocus onblur",function(){var n=document.getElementById("tips"),e=n.getElementsByTagName("span"),a=i.checkStrong(this.value),s=["弱","中","强","非常好"];n.style.display="block",n.className="s"+a;for(var t=0;t<e.length;t++)e[t].className=e[t].innerHTML="",""!=this.value&&(e[a-1].className="active",e[a-1].innerHTML=s[a-1])})},showLoginPanel:function(){this.loginName=null,this.loginPanel.css("display","block"),this.loginPanel.find("input").val(""),this.loginPanel.find("input").first().focus()},hideLoginPanel:function(){this.loginPanel.css("display","none")},showRegisterPanel:function(){this.registerName=null,this.registerPanel.css("display","block"),this.registerPanel.find("input").val(""),this.registerPanel.find("input").first().focus()},hideRegisterPanel:function(){this.registerPanel.css("display","none")},hideUserpPanel:function(){$(".user-panel").css("display","none")},showUserPanel:function(){$(".user-panel").css("display","block")},login:function(){var n=this.loginPanel.find("input[name='username']").val();if(""==n)return MapCloud.notify.showInfo("请输入用户名","Warning"),void this.loginPanel.find("input[name='username']").focus();var e=this.loginPanel.find("input[name='password']").val();return""==e?(MapCloud.notify.showInfo("请输入密码","Warning"),void this.loginPanel.find("input[name='password']").focus()):(MapCloud.notify.loading(),this.loginName=n,void authManager.login(n,e,this.login_callback))},login_callback:function(n){MapCloud.notify.showInfo(n,"登录");var e=MapCloud.accountPanel;"success"==n&&("admin"!=e.loginName?(MapCloud.cookieObj.setCookie("username",e.loginName,"/MapCloud"),window.location.href="../User"):(e.hideLoginPanel(),e.hideRegisterPanel(),e.showUserPanel(),e.initUser(e.loginName)))},initUser:function(n){null!=n&&(admin=new GeoBeans.User(n),MapCloud.cookieObj.setCookie("username",n,"/MapCloud"),loadCatalog(),$("#title_panel").html("["+n+"]管理系统"),MapCloud.userPanel=new MapCloud.UsersPanel("user_panel"),MapCloud.userPanel.panel=$("#iframeId").contents().find("#user_panel"),MapCloud.userPanel.registerPanelEvent(),MapCloud.userPanel.getUserInfo(n))},register:function(){var n=this.registerPanel.find("input[name='username']").val();if(null==n||""==n)return MapCloud.notify.showInfo("请输入注册的用户名","Warning"),void this.registerPanel.find("input[name='username']").focus();var e=/^[0-9a-zA-Z_]+$/;if(!e.test(n))return MapCloud.notify.showInfo("请输入有效的用户名","Warning"),void this.registerPanel.find("input[name='username']").focus();var i=this.registerPanel.find("input[name='alias']").val();if(null==i||""==i)return MapCloud.notify.showInfo("请输入注册的昵称","Warning"),void this.registerPanel.find("input[name='alias'").focus();if(!e.test(i))return MapCloud.notify.showInfo("请输入有效的昵称","Warning"),void this.registerPanel.find("input[name='alias'").focus();var a=this.registerPanel.find("input[name='email']").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入注册的邮箱","Warning"),void this.registerPanel.find("input[name='email']").focus();var s=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!s.test(a))return MapCloud.notify.showInfo("请输入有效的邮箱","Warning"),void this.registerPanel.find("input[name='email']").focus();var t=this.registerPanel.find("input[name='password']").val();if(null==t||""==t)return MapCloud.notify.showInfo("请输入注册的密码","Warning"),void this.registerPanel.find("input[name='password']").focus();var l=$("input[name='repassword'").val();return null==l||""==l?(MapCloud.notify.showInfo("请再次输入注册的密码","Warning"),void this.registerPanel.find("input[name='repassword']").focus()):t!=l?(MapCloud.notify.showInfo("两次输入的密码不同","Warning"),void this.registerPanel.find("input[name='repassword']").focus()):(this.registerName=n,MapCloud.notify.loading(),void authManager.createUser(n,i,t,a,"normal",this.register_callback))},register_callback:function(n){if(MapCloud.notify.showInfo(n,"注册"),"success"==n){var e=MapCloud.accountPanel;e.hideLoginPanel(),$(".map-panel").css("display","block"),e.initUser(e.registerName)}},checkStrong:function(n){var e=0;if(n.length<1)return e;switch(/\d/.test(n)&&e++,/[a-z]/.test(n)&&e++,/[A-Z]/.test(n)&&e++,/\W/.test(n)&&e++,e){case 1:return 1;case 2:return 2;case 3:case 4:return n.length<12?3:4}}});