var g_catalog=[{name:"用户管理",icon:"user.png",link:"admin_users.html"},{name:"数据管理",icon:"db.png",link:"admin_data.html"},{name:"节点管理",icon:"monitor.png",link:"http://ourgis.digitalearth.cn/monitor/"},{name:"API",icon:"note.png",link:"../API/index_admin.html"}];
function loadLoginPanel(){$(".user-panel").css("display","none"),$(".login-panel").css("display","block")}function logout_callback(a){MapCloud.notify.showInfo(a,"注销"),"success"==a&&(MapCloud.accountPanel.hideRegisterPanel(),MapCloud.accountPanel.hideUserpPanel(),MapCloud.accountPanel.showLoginPanel(),admin.logout(),MapCloud.cookieObj.delCookie("username","/MapCloud"))}function loadCatalog(){$(".login-panel").css("display","none"),$(".user-panel").css("display","block");for(var a="",o=g_catalog.length,n=null,l=null,e=null,i=0;o>i;i++){var c=g_catalog[i];n=c.name,e=c.icon,l=c.link,a+="<div class='catalog-item' onclick='onItemClick(\""+n+'","'+l+"\");' iname='"+n+"'>	<img src='../images/"+e+"'>	<h5>"+n+"</h5></div>"}document.getElementById("catalog_container").innerHTML=a,$(".catalog-item").first().addClass("selected")}var admin=null,cookieObj=null;$().ready(function(){cookieObj=new MapCloud.Cookie;var a=cookieObj.getCookie("username");null!=a&&"admin"==a&&(admin=new GeoBeans.User(a)),MapCloud.notify=new MapCloud.Notify("container","alert_loading"),MapCloud.accountPanel=new MapCloud.AccountPanel("login-panel","register-panel");var o="/ows/admin/mgr";authManager=new GeoBeans.AuthManager(o),MapCloud.cookieObj=new MapCloud.Cookie,null==admin?loadLoginPanel():loadCatalog(),$("#user_logout").click(function(){confirm("确定要退出当前账户吗？")&&(MapCloud.notify.loading(),authManager.logout(admin.name,logout_callback))})});
MapCloud.AccountPanel=MapCloud.Class({loginPanel:null,loginName:null,registerPanel:null,registerName:null,initialize:function(n,i){this.loginPanel=$("."+n),this.registerPanel=$("."+i);var e=this;this.loginPanel.find(".btn-account").click(function(){e.login()}),this.loginPanel.find(".btn-register").click(function(){e.hideLoginPanel(),e.hideUserpPanel(),e.showRegisterPanel()}),this.loginPanel.find("input[name='password']").keypress(function(n){13==n.which&&e.login()}),this.registerPanel.find(".btn-account").click(function(){e.register()}),this.registerPanel.find(".btn-login").click(function(){e.hideRegisterPanel(),e.hideUserpPanel(),e.showLoginPanel()}),this.registerPanel.find("input[name='repassword']").keypress(function(n){13==n.which&&e.register()})},showLoginPanel:function(){this.loginName=null,this.loginPanel.css("display","block"),this.loginPanel.find("input").val(""),this.loginPanel.find("input").first().focus()},hideLoginPanel:function(){this.loginPanel.css("display","none")},showRegisterPanel:function(){this.registerName=null,this.registerPanel.css("display","block"),this.registerPanel.find("input").val(""),this.registerPanel.find("input").first().focus()},hideRegisterPanel:function(){this.registerPanel.css("display","none")},hideUserpPanel:function(){$(".user-panel").css("display","none")},showUserPanel:function(){$(".user-panel").css("display","block")},login:function(){var n=this.loginPanel.find("input[name='username']").val();if(""==n)return MapCloud.notify.showInfo("请输入用户名","Warning"),void this.loginPanel.find("input[name='username']").focus();var i=this.loginPanel.find("input[name='password']").val();return""==i?(MapCloud.notify.showInfo("请输入密码","Warning"),void this.loginPanel.find("input[name='password']").focus()):(MapCloud.notify.loading(),this.loginName=n,void authManager.login(n,i,this.login_callback))},login_callback:function(n){MapCloud.notify.showInfo(n,"登录");var i=MapCloud.accountPanel;"success"==n&&("admin"!=i.loginName?(MapCloud.cookieObj.setCookie("username",i.loginName,"/MapCloud"),window.location.href="../User"):(i.hideLoginPanel(),i.hideRegisterPanel(),i.showUserPanel(),i.initUser(i.loginName)))},initUser:function(n){null!=n&&(admin=new GeoBeans.User(n),MapCloud.cookieObj.setCookie("username",n,"/MapCloud"),loadCatalog(),$("#title_panel").html("["+n+"]管理页面"),MapCloud.userPanel=new MapCloud.UsersPanel("user_panel"),MapCloud.userPanel.panel=$("#iframeId").contents().find("#user_panel"),MapCloud.userPanel.registerPanelEvent(),MapCloud.userPanel.getUserInfo(n))},register:function(){var n=this.registerPanel.find("input[name='username']").val();if(null==n||""==n)return MapCloud.notify.showInfo("请输入注册的用户名","Warning"),void this.registerPanel.find("input[name='username']").focus();var i=/^[0-9a-zA-Z_]+$/;if(!i.test(n))return MapCloud.notify.showInfo("请输入有效的用户名","Warning"),void this.registerPanel.find("input[name='username']").focus();var e=this.registerPanel.find("input[name='alias']").val();if(null==e||""==e)return MapCloud.notify.showInfo("请输入注册的昵称","Warning"),void this.registerPanel.find("input[name='alias'").focus();if(!i.test(e))return MapCloud.notify.showInfo("请输入有效的昵称","Warning"),void this.registerPanel.find("input[name='alias'").focus();var a=this.registerPanel.find("input[name='email']").val();if(null==a||""==a)return MapCloud.notify.showInfo("请输入注册的邮箱","Warning"),void this.registerPanel.find("input[name='email']").focus();var s=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;if(!s.test(a))return MapCloud.notify.showInfo("请输入有效的邮箱","Warning"),void this.registerPanel.find("input[name='email']").focus();var l=this.registerPanel.find("input[name='password']").val();if(null==l||""==l)return MapCloud.notify.showInfo("请输入注册的密码","Warning"),void this.registerPanel.find("input[name='password']").focus();var o=$("input[name='repassword'").val();return null==o||""==o?(MapCloud.notify.showInfo("请再次输入注册的密码","Warning"),void this.registerPanel.find("input[name='repassword']").focus()):l!=o?(MapCloud.notify.showInfo("两次输入的密码不同","Warning"),void this.registerPanel.find("input[name='repassword']").focus()):(this.registerName=n,MapCloud.notify.loading(),void authManager.createUser(n,e,l,a,"normal",this.register_callback))},register_callback:function(n){if(MapCloud.notify.showInfo(n,"注册"),"success"==n){var i=MapCloud.accountPanel;i.hideLoginPanel(),$(".map-panel").css("display","block"),i.initUser(i.registerName)}}});